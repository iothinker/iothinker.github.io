<!DOCTYPE html>
<!-- saved from url=(0047)http://192.168.50.1:1880/#flow/0217ee1fba23525d -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style id="ace-tomorrow">.ace-tomorrow .ace_gutter {background: #f6f6f6;color: #4D4D4C}.ace-tomorrow .ace_print-margin {width: 1px;background: #f6f6f6}.ace-tomorrow {background-color: #FFFFFF;color: #4D4D4C}.ace-tomorrow .ace_cursor {color: #AEAFAD}.ace-tomorrow .ace_marker-layer .ace_selection {background: #D6D6D6}.ace-tomorrow.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #FFFFFF;}.ace-tomorrow .ace_marker-layer .ace_step {background: rgb(255, 255, 0)}.ace-tomorrow .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid #D1D1D1}.ace-tomorrow .ace_marker-layer .ace_active-line {background: #EFEFEF}.ace-tomorrow .ace_gutter-active-line {background-color : #dcdcdc}.ace-tomorrow .ace_marker-layer .ace_selected-word {border: 1px solid #D6D6D6}.ace-tomorrow .ace_invisible {color: #D1D1D1}.ace-tomorrow .ace_keyword,.ace-tomorrow .ace_meta,.ace-tomorrow .ace_storage,.ace-tomorrow .ace_storage.ace_type,.ace-tomorrow .ace_support.ace_type {color: #8959A8}.ace-tomorrow .ace_keyword.ace_operator {color: #3E999F}.ace-tomorrow .ace_constant.ace_character,.ace-tomorrow .ace_constant.ace_language,.ace-tomorrow .ace_constant.ace_numeric,.ace-tomorrow .ace_keyword.ace_other.ace_unit,.ace-tomorrow .ace_support.ace_constant,.ace-tomorrow .ace_variable.ace_parameter {color: #F5871F}.ace-tomorrow .ace_constant.ace_other {color: #666969}.ace-tomorrow .ace_invalid {color: #FFFFFF;background-color: #C82829}.ace-tomorrow .ace_invalid.ace_deprecated {color: #FFFFFF;background-color: #8959A8}.ace-tomorrow .ace_fold {background-color: #4271AE;border-color: #4D4D4C}.ace-tomorrow .ace_entity.ace_name.ace_function,.ace-tomorrow .ace_support.ace_function,.ace-tomorrow .ace_variable {color: #4271AE}.ace-tomorrow .ace_support.ace_class,.ace-tomorrow .ace_support.ace_type {color: #C99E00}.ace-tomorrow .ace_heading,.ace-tomorrow .ace_markup.ace_heading,.ace-tomorrow .ace_string {color: #718C00}.ace-tomorrow .ace_entity.ace_name.ace_tag,.ace-tomorrow .ace_entity.ace_other.ace_attribute-name,.ace-tomorrow .ace_meta.ace_tag,.ace-tomorrow .ace_string.ace_regexp,.ace-tomorrow .ace_variable {color: #C82829}.ace-tomorrow .ace_comment {color: #8E908C}.ace-tomorrow .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bdu3f/BwAlfgctduB85QAAAABJRU5ErkJggg==) right repeat-y}
/*# sourceURL=ace/css/ace-tomorrow */</style><style id="autocompletion.css">.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_dark.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #3a674e;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);    position: absolute;    z-index: 2;}.ace_dark.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid rgba(109, 150, 13, 0.8);    background: rgba(58, 103, 78, 0.62);}.ace_completion-meta {    opacity: 0.5;    margin: 0.9em;}.ace_completion-message {    color: blue;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #2d69c7;}.ace_dark.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #93ca12;}.ace_editor.ace_autocomplete {    width: 300px;    z-index: 200000;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;    background: #fefefe;    color: #111;}.ace_dark.ace_editor.ace_autocomplete {    border: 1px #484747 solid;    box-shadow: 2px 3px 5px rgba(0, 0, 0, 0.51);    line-height: 1.4;    background: #25282c;    color: #c1c1c1;}
/*# sourceURL=ace/css/autocompletion.css */</style><style>.ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}</style><style>    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }</style><style id="ace-tm">.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}
/*# sourceURL=ace/css/ace-tm */</style><style id="ace_editor.css">.ace_br1 {border-top-left-radius    : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}.ace_editor {position: relative;overflow: hidden;padding: 0;font: 12px/normal 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;direction: ltr;text-align: left;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;box-sizing: border-box;min-width: 100%;contain: style size layout;font-variant-ligatures: no-common-ligatures;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: '';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;contain: style size layout;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {position: absolute;top: 0;left: 0;right: 0;padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {contain: strict;position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;contain: strict;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: transparent;color: inherit;z-index: 1000;opacity: 1;}.ace_composition_placeholder { color: transparent }.ace_composition_marker { border-bottom: 1px solid;position: absolute;border-radius: 0;margin-top: 1px;}[ace_nocontext=true] {transform: none!important;filter: none!important;clip-path: none!important;mask : none!important;contain: none!important;perspective: none!important;mix-blend-mode: initial!important;z-index: auto;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;height: 1000000px;contain: style size layout;}.ace_text-layer {font: inherit !important;position: absolute;height: 1000000px;width: 1000000px;contain: style size layout;}.ace_text-layer > .ace_line, .ace_text-layer > .ace_line_group {contain: style size layout;position: absolute;top: 0;left: 0;right: 0;}.ace_hidpi .ace_text-layer,.ace_hidpi .ace_gutter-layer,.ace_hidpi .ace_content,.ace_hidpi .ace_gutter {contain: strict;will-change: transform;}.ace_hidpi .ace_text-layer > .ace_line, .ace_hidpi .ace_text-layer > .ace_line_group {contain: strict;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_hasPlaceholder .ace_hidden-cursors .ace_cursor {opacity: 0;}.ace_smooth-blinking .ace_cursor {transition: opacity 0.18s;}.ace_animate-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: step-end;animation-name: blink-ace-animate;animation-iteration-count: infinite;}.ace_animate-blinking.ace_smooth-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: ease-in-out;animation-name: blink-ace-animate-smooth;}@keyframes blink-ace-animate {from, to { opacity: 1; }60% { opacity: 0; }}@keyframes blink-ace-animate-smooth {from, to { opacity: 1; }45% { opacity: 1; }60% { opacity: 0; }85% { opacity: 0; }}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_error_bracket {position: absolute;border-bottom: 1px solid #DE5555;border-radius: 0;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;box-sizing: border-box;}.ace_line .ace_fold {box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_inline_button {border: 1px solid lightgray;display: inline-block;margin: -1px 8px;padding: 0 5px;pointer-events: auto;cursor: pointer;}.ace_inline_button:hover {border-color: gray;background: rgba(200,200,200,0.2);display: inline-block;pointer-events: auto;}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}.ace_mobile-menu {position: absolute;line-height: 1.5;border-radius: 4px;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;background: white;box-shadow: 1px 3px 2px grey;border: 1px solid #dcdcdc;color: black;}.ace_dark > .ace_mobile-menu {background: #333;color: #ccc;box-shadow: 1px 3px 2px grey;border: 1px solid #444;}.ace_mobile-button {padding: 2px;cursor: pointer;overflow: hidden;}.ace_mobile-button:hover {background-color: #eee;opacity:1;}.ace_mobile-button:active {background-color: #ddd;}.ace_placeholder {font-family: arial;transform: scale(0.9);transform-origin: left;white-space: pre;opacity: 0.7;margin: 0 10px;}
/*# sourceURL=ace/css/ace_editor.css */</style>

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<!--
  Copyright OpenJS Foundation and other contributors, https://openjsf.org/

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<title>Node-RED : 192.168.50.1</title>
<link rel="icon" type="image/png" href="http://192.168.50.1:1880/favicon.ico">
<link rel="mask-icon" href="http://192.168.50.1:1880/red/images/node-red-icon-black.svg" color="#8f0000">
<link rel="stylesheet" href="./Node-RED _ 192.168.50.1_files/jquery-ui.min.css">
<link rel="stylesheet" href="./Node-RED _ 192.168.50.1_files/font-awesome.min.css">
<link rel="stylesheet" href="./Node-RED _ 192.168.50.1_files/style.min.css">
<script src="./Node-RED _ 192.168.50.1_files/theme-tomorrow.js"></script><script src="./Node-RED _ 192.168.50.1_files/mode-markdown.js"></script><script src="./Node-RED _ 192.168.50.1_files/markdown.js"></script><script src="./Node-RED _ 192.168.50.1_files/mode-nrjavascript.js"></script><script src="./Node-RED _ 192.168.50.1_files/javascript.js"></script></head>
<body spellcheck="false" style="">
<div id="red-ui-editor" class="red-ui-editor"><div id="red-ui-header"><span class="red-ui-header-logo"><img src="./Node-RED _ 192.168.50.1_files/node-red.svg"><span>Node-RED</span></span><ul class="red-ui-header-toolbar hide" style="display: block;"><li><span class="red-ui-deploy-button-group button-group"><a id="red-ui-header-button-deploy" class="red-ui-deploy-button disabled" href="http://192.168.50.1:1880/#"><span class="red-ui-deploy-button-content" style="opacity: 1;"><img id="red-ui-header-button-deploy-icon" src="./Node-RED _ 192.168.50.1_files/deploy-full-o.svg"> <span>部署</span></span><span class="red-ui-deploy-button-spinner hide" style="display: none;"><img src="./Node-RED _ 192.168.50.1_files/spin.svg"></span></a><a id="red-ui-header-button-deploy-options" class="red-ui-deploy-button" href="http://192.168.50.1:1880/#"><i class="fa fa-caret-down"></i></a><ul class="red-ui-menu red-ui-menu-dropdown pull-right" id="red-ui-header-button-deploy-options-submenu"><li><a id="deploymenu-item-full" tabindex="-1" href="http://192.168.50.1:1880/#" class="active"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><img src="./Node-RED _ 192.168.50.1_files/deploy-full.svg"> <span class="red-ui-menu-label-container"><span class="red-ui-menu-label">全面</span><span class="red-ui-menu-sublabel">在工作区中部署所有内容</span></span></a></li><li><a id="deploymenu-item-flow" tabindex="-1" href="http://192.168.50.1:1880/#"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><img src="./Node-RED _ 192.168.50.1_files/deploy-flows.svg"> <span class="red-ui-menu-label-container"><span class="red-ui-menu-label">已修改的流程</span><span class="red-ui-menu-sublabel">只部署包含已更改节点的流</span></span></a></li><li><a id="deploymenu-item-node" tabindex="-1" href="http://192.168.50.1:1880/#"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><img src="./Node-RED _ 192.168.50.1_files/deploy-nodes.svg"> <span class="red-ui-menu-label-container"><span class="red-ui-menu-label">已更改的节点</span><span class="red-ui-menu-sublabel">只部署已经更改的节点</span></span></a></li><li class="red-ui-menu-divider"></li><li><a id="deploymenu-item-reload" tabindex="-1" href="http://192.168.50.1:1880/#"><img src="./Node-RED _ 192.168.50.1_files/deploy-reload.svg"> <span class="red-ui-menu-label-container"><span class="red-ui-menu-label">重启流程</span><span class="red-ui-menu-sublabel">重新启动当前部署的流程</span></span></a></li></ul></span></li><li style="display: none;"><a class="button" href="http://192.168.50.1:1880/#"><i class="fa fa-warning"></i></a></li><li><a id="red-ui-header-button-sidemenu" class="button" href="http://192.168.50.1:1880/#"><i class="fa fa-bars"></i></a><ul class="red-ui-menu red-ui-menu-dropdown pull-right" id="red-ui-header-button-sidemenu-submenu"><li class="red-ui-menu-dropdown-submenu pull-left"><a id="menu-item-edit-menu" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Edit</span></span></a><ul id="menu-item-edit-menu-submenu" class="red-ui-menu-dropdown"><li class=""><a id="menu-item-edit-undo" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>撤消上次执行的更改</span><span class="red-ui-popover-key">⌘z</span></span></a></li><li class="disabled"><a id="menu-item-edit-redo" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Redo</span><span class="red-ui-popover-key">⌘y</span></span></a></li><li class="red-ui-menu-divider"></li><li class=""><a id="menu-item-edit-cut" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>剪切所选节点</span><span class="red-ui-popover-key">⌘x</span></span></a></li><li class=""><a id="menu-item-edit-copy" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>复制所选节点</span><span class="red-ui-popover-key">⌘c</span></span></a></li><li class=""><a id="menu-item-edit-paste" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>粘贴节点</span><span class="red-ui-popover-key">⌘v</span></span></a></li><li class="red-ui-menu-divider"></li><li class="disabled"><a id="menu-item-edit-copy-group-style" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Copy group style</span><span class="red-ui-popover-key">⌘⇧c</span></span></a></li><li class="disabled"><a id="menu-item-edit-paste-group-style" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Paste group style</span><span class="red-ui-popover-key">⌘⇧v</span></span></a></li><li class="red-ui-menu-divider"></li><li><a id="menu-item-edit-select-all" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>选择所有节点</span><span class="red-ui-popover-key">⌘a</span></span></a></li><li class=""><a id="menu-item-edit-select-connected" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>选择所有连接的节点</span><span class="red-ui-popover-key">⌥s c</span></span></a></li><li><a id="menu-item-edit-select-none" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Select none</span><span class="red-ui-popover-key">escape</span></span></a></li></ul></li><li class="red-ui-menu-dropdown-submenu pull-left"><a id="menu-item-view-menu" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>显示</span></span></a><ul id="menu-item-view-menu-submenu" class="red-ui-menu-dropdown"><li><a id="menu-item-palette" tabindex="-1" href="http://192.168.50.1:1880/#" class="active"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><span class="red-ui-menu-label"><span>显示控制板</span><span class="red-ui-popover-key">⌘p</span></span></a></li><li><a id="menu-item-sidebar" tabindex="-1" href="http://192.168.50.1:1880/#" class="active"><i class="fa fa-square pull-left"></i><i class="fa fa-check-square pull-left"></i><span class="red-ui-menu-label"><span>显示侧边栏</span><span class="red-ui-popover-key">⌘space</span></span></a></li><li><a id="menu-item-event-log" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>事件记录日志</span><span class="red-ui-popover-key">⌘⇧l</span></span></a></li><li><a id="menu-item-action-list" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>动作列表</span><span class="red-ui-popover-key">⌘⇧p</span></span></a></li><li class="red-ui-menu-divider"></li><li class="red-ui-menu-group-sidebar-tabs"><a id="menu-item-view-menu-debug" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>名称</span></span></a></li></ul></li><li class="red-ui-menu-dropdown-submenu pull-left"><a id="menu-item-arrange-menu" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Arrange</span></span></a><ul id="menu-item-arrange-menu-submenu" class="red-ui-menu-dropdown"><li class=""><a id="menu-item-view-tools-move-to-back" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Move to back</span></span></a></li><li class=""><a id="menu-item-view-tools-move-to-front" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Move to front</span></span></a></li><li class=""><a id="menu-item-view-tools-move-backwards" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Move backwards</span></span></a></li><li class=""><a id="menu-item-view-tools-move-forwards" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Move forwards</span></span></a></li><li class="red-ui-menu-divider"></li><li class="disabled"><a id="menu-item-view-tools-align-left" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Align to left</span><span class="red-ui-popover-key">⌥a l</span></span></a></li><li class="disabled"><a id="menu-item-view-tools-align-center" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Align to center</span><span class="red-ui-popover-key">⌥a c</span></span></a></li><li class="disabled"><a id="menu-item-view-tools-align-right" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Align to right</span><span class="red-ui-popover-key">⌥a r</span></span></a></li><li class="red-ui-menu-divider"></li><li class="disabled"><a id="menu-item-view-tools-align-top" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Align to top</span><span class="red-ui-popover-key">⌥a t</span></span></a></li><li class="disabled"><a id="menu-item-view-tools-align-middle" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Align to middle</span><span class="red-ui-popover-key">⌥a m</span></span></a></li><li class="disabled"><a id="menu-item-view-tools-align-bottom" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Align to bottom</span><span class="red-ui-popover-key">⌥a b</span></span></a></li><li class="red-ui-menu-divider"></li><li class="disabled"><a id="menu-item-view-tools-distribute-horizontally" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Distribute horizontally</span><span class="red-ui-popover-key">⌥a h</span></span></a></li><li class="disabled"><a id="menu-item-view-tools-distribute-veritcally" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>Distribute vertically</span><span class="red-ui-popover-key">⌥a v</span></span></a></li></ul></li><li class="red-ui-menu-divider"></li><li><a id="menu-item-import" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>导入</span><span class="red-ui-popover-key">⌘i</span></span></a></li><li><a id="menu-item-export" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>导出</span><span class="red-ui-popover-key">⌘e</span></span></a></li><li class="red-ui-menu-divider"></li><li><a id="menu-item-search" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>查找流程</span><span class="red-ui-popover-key">⌘f</span></span></a></li><li class="red-ui-menu-divider"></li><li><a id="menu-item-config-nodes" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>修改节点配置</span><span class="red-ui-popover-key">⌘g c</span></span></a></li><li class="red-ui-menu-dropdown-submenu pull-left"><a id="menu-item-workspace" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>流程</span></span></a><ul id="menu-item-workspace-submenu" class="red-ui-menu-dropdown"><li><a id="menu-item-workspace-add" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>增加</span></span></a></li><li><a id="menu-item-workspace-edit" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>重命名</span></span></a></li><li class="disabled"><a id="menu-item-workspace-delete" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>删除</span></span></a></li></ul></li><li class="red-ui-menu-dropdown-submenu pull-left"><a id="menu-item-subflow" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>子流程</span></span></a><ul id="menu-item-subflow-submenu" class="red-ui-menu-dropdown"><li><a id="menu-item-subflow-create" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>新建子流程</span></span></a></li><li class=""><a id="menu-item-subflow-convert" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>将选择部分更改为子流程</span></span></a></li></ul></li><li class="red-ui-menu-dropdown-submenu pull-left"><a id="menu-item-group" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>组</span></span></a><ul id="menu-item-group-submenu" class="red-ui-menu-dropdown"><li class=""><a id="menu-item-group-group" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>选择组</span><span class="red-ui-popover-key">⌘⇧g</span></span></a></li><li class="disabled"><a id="menu-item-group-ungroup" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>取消选择组</span><span class="red-ui-popover-key">⌘⇧u</span></span></a></li><li class="red-ui-menu-divider"></li><li class="disabled"><a id="menu-item-group-merge" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>合并选择</span></span></a></li><li class="disabled"><a id="menu-item-group-remove" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>从组中移除</span></span></a></li></ul></li><li class="red-ui-menu-divider"></li><li><a id="menu-item-edit-palette" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>节点管理</span><span class="red-ui-popover-key">⌥⇧p</span></span></a></li><li class="red-ui-menu-divider"></li><li><a id="menu-item-user-settings" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>设置</span><span class="red-ui-popover-key">⌘,</span></span></a></li><li class="red-ui-menu-divider"></li><li><a id="menu-item-keyboard-shortcuts" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>键盘快捷方式</span><span class="red-ui-popover-key">⇧?</span></span></a></li><li><a id="menu-item-help" tabindex="-1" href="http://nodered.org/docs" target="_blank"><span class="red-ui-menu-label"><span>Node-RED网页</span></span></a></li><li><a id="menu-item-node-red-version" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>v2.1.3</span></span></a></li></ul></li></ul><div id="red-ui-header-shade" class="hide" style="display: block;"></div></div><div id="red-ui-main-container" class="hide" style="display: block;"><div id="red-ui-workspace"><div class="red-ui-tabs red-ui-tabs-add red-ui-tabs-menu red-ui-tabs-scrollable" style=""><div class="red-ui-tabs-scroll-container"><ul id="red-ui-workspace-tabs" style="width: 1185px;" class=""><li class="red-ui-tab red-ui-tabs-closeable active ui-draggable ui-draggable-handle" id="red-ui-tab-0217ee1fba23525d" style="width: 1167px;"><a href="http://192.168.50.1:1880/#0217ee1fba23525d" class="red-ui-tab-label" title="MQTT相关流程"><span class="red-ui-workspace-disabled-icon"><i class="fa fa-ban"></i> </span><span class="red-ui-text-bidi-aware" dir="">MQTT相关流程</span></a><span class="red-ui-tabs-fade"></span><a href="http://192.168.50.1:1880/#" class="red-ui-tab-close"><i class="fa fa-times"></i></a><span class="red-ui-tabs-badges"><i class="red-ui-tabs-badge-changed fa fa-circle"></i><i class="red-ui-tabs-badge-selected fa fa-check-circle"></i></span></li></ul></div><div class="red-ui-tab-button red-ui-tabs-add"><a href="http://192.168.50.1:1880/#"><i class="fa fa-plus"></i></a></div><div class="red-ui-tab-button red-ui-tabs-menu"><a href="http://192.168.50.1:1880/#"><i class="fa fa-caret-down"></i></a></div><div class="red-ui-tab-button red-ui-tab-scroll red-ui-tab-scroll-left"><a href="http://192.168.50.1:1880/#" style="display:none;"><i class="fa fa-caret-left"></i></a></div><div class="red-ui-tab-button red-ui-tab-scroll red-ui-tab-scroll-right"><a href="http://192.168.50.1:1880/#" style="display:none;"><i class="fa fa-caret-right"></i></a></div></div><div id="red-ui-workspace-tabs-shade" class="hide"></div><div id="red-ui-workspace-chart" tabindex="1" class="ui-droppable" style="margin-top: 0px;"><svg width="5000" height="5000" pointer-events="all" style="cursor: crosshair; touch-action: none;"><g><g class="red-ui-workspace-chart-event-layer" transform="scale(1)"><rect class="red-ui-workspace-chart-background" width="5000" height="5000"></rect><g class="red-ui-workspace-chart-grid" style="visibility: visible;"><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="0" y2="0"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="20" y2="20"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="40" y2="40"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="60" y2="60"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="80" y2="80"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="100" y2="100"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="120" y2="120"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="140" y2="140"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="160" y2="160"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="180" y2="180"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="200" y2="200"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="220" y2="220"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="240" y2="240"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="260" y2="260"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="280" y2="280"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="300" y2="300"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="320" y2="320"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="340" y2="340"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="360" y2="360"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="380" y2="380"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="400" y2="400"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="420" y2="420"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="440" y2="440"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="460" y2="460"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="480" y2="480"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="500" y2="500"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="520" y2="520"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="540" y2="540"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="560" y2="560"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="580" y2="580"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="600" y2="600"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="620" y2="620"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="640" y2="640"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="660" y2="660"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="680" y2="680"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="700" y2="700"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="720" y2="720"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="740" y2="740"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="760" y2="760"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="780" y2="780"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="800" y2="800"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="820" y2="820"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="840" y2="840"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="860" y2="860"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="880" y2="880"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="900" y2="900"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="920" y2="920"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="940" y2="940"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="960" y2="960"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="980" y2="980"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1000" y2="1000"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1020" y2="1020"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1040" y2="1040"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1060" y2="1060"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1080" y2="1080"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1100" y2="1100"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1120" y2="1120"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1140" y2="1140"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1160" y2="1160"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1180" y2="1180"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1200" y2="1200"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1220" y2="1220"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1240" y2="1240"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1260" y2="1260"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1280" y2="1280"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1300" y2="1300"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1320" y2="1320"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1340" y2="1340"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1360" y2="1360"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1380" y2="1380"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1400" y2="1400"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1420" y2="1420"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1440" y2="1440"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1460" y2="1460"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1480" y2="1480"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1500" y2="1500"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1520" y2="1520"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1540" y2="1540"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1560" y2="1560"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1580" y2="1580"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1600" y2="1600"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1620" y2="1620"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1640" y2="1640"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1660" y2="1660"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1680" y2="1680"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1700" y2="1700"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1720" y2="1720"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1740" y2="1740"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1760" y2="1760"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1780" y2="1780"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1800" y2="1800"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1820" y2="1820"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1840" y2="1840"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1860" y2="1860"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1880" y2="1880"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1900" y2="1900"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1920" y2="1920"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1940" y2="1940"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1960" y2="1960"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="1980" y2="1980"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2000" y2="2000"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2020" y2="2020"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2040" y2="2040"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2060" y2="2060"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2080" y2="2080"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2100" y2="2100"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2120" y2="2120"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2140" y2="2140"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2160" y2="2160"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2180" y2="2180"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2200" y2="2200"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2220" y2="2220"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2240" y2="2240"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2260" y2="2260"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2280" y2="2280"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2300" y2="2300"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2320" y2="2320"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2340" y2="2340"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2360" y2="2360"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2380" y2="2380"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2400" y2="2400"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2420" y2="2420"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2440" y2="2440"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2460" y2="2460"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2480" y2="2480"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2500" y2="2500"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2520" y2="2520"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2540" y2="2540"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2560" y2="2560"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2580" y2="2580"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2600" y2="2600"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2620" y2="2620"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2640" y2="2640"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2660" y2="2660"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2680" y2="2680"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2700" y2="2700"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2720" y2="2720"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2740" y2="2740"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2760" y2="2760"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2780" y2="2780"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2800" y2="2800"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2820" y2="2820"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2840" y2="2840"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2860" y2="2860"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2880" y2="2880"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2900" y2="2900"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2920" y2="2920"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2940" y2="2940"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2960" y2="2960"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="2980" y2="2980"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3000" y2="3000"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3020" y2="3020"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3040" y2="3040"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3060" y2="3060"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3080" y2="3080"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3100" y2="3100"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3120" y2="3120"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3140" y2="3140"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3160" y2="3160"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3180" y2="3180"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3200" y2="3200"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3220" y2="3220"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3240" y2="3240"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3260" y2="3260"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3280" y2="3280"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3300" y2="3300"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3320" y2="3320"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3340" y2="3340"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3360" y2="3360"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3380" y2="3380"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3400" y2="3400"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3420" y2="3420"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3440" y2="3440"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3460" y2="3460"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3480" y2="3480"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3500" y2="3500"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3520" y2="3520"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3540" y2="3540"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3560" y2="3560"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3580" y2="3580"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3600" y2="3600"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3620" y2="3620"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3640" y2="3640"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3660" y2="3660"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3680" y2="3680"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3700" y2="3700"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3720" y2="3720"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3740" y2="3740"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3760" y2="3760"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3780" y2="3780"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3800" y2="3800"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3820" y2="3820"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3840" y2="3840"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3860" y2="3860"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3880" y2="3880"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3900" y2="3900"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3920" y2="3920"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3940" y2="3940"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3960" y2="3960"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="3980" y2="3980"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4000" y2="4000"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4020" y2="4020"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4040" y2="4040"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4060" y2="4060"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4080" y2="4080"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4100" y2="4100"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4120" y2="4120"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4140" y2="4140"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4160" y2="4160"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4180" y2="4180"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4200" y2="4200"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4220" y2="4220"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4240" y2="4240"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4260" y2="4260"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4280" y2="4280"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4300" y2="4300"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4320" y2="4320"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4340" y2="4340"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4360" y2="4360"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4380" y2="4380"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4400" y2="4400"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4420" y2="4420"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4440" y2="4440"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4460" y2="4460"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4480" y2="4480"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4500" y2="4500"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4520" y2="4520"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4540" y2="4540"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4560" y2="4560"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4580" y2="4580"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4600" y2="4600"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4620" y2="4620"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4640" y2="4640"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4660" y2="4660"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4680" y2="4680"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4700" y2="4700"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4720" y2="4720"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4740" y2="4740"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4760" y2="4760"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4780" y2="4780"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4800" y2="4800"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4820" y2="4820"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4840" y2="4840"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4860" y2="4860"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4880" y2="4880"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4900" y2="4900"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4920" y2="4920"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4940" y2="4940"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4960" y2="4960"></line><line class="red-ui-workspace-chart-grid-h" x1="0" x2="5000" y1="4980" y2="4980"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="0" x2="0"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="20" x2="20"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="40" x2="40"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="60" x2="60"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="80" x2="80"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="100" x2="100"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="120" x2="120"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="140" x2="140"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="160" x2="160"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="180" x2="180"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="200" x2="200"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="220" x2="220"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="240" x2="240"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="260" x2="260"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="280" x2="280"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="300" x2="300"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="320" x2="320"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="340" x2="340"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="360" x2="360"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="380" x2="380"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="400" x2="400"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="420" x2="420"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="440" x2="440"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="460" x2="460"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="480" x2="480"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="500" x2="500"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="520" x2="520"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="540" x2="540"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="560" x2="560"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="580" x2="580"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="600" x2="600"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="620" x2="620"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="640" x2="640"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="660" x2="660"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="680" x2="680"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="700" x2="700"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="720" x2="720"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="740" x2="740"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="760" x2="760"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="780" x2="780"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="800" x2="800"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="820" x2="820"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="840" x2="840"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="860" x2="860"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="880" x2="880"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="900" x2="900"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="920" x2="920"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="940" x2="940"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="960" x2="960"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="980" x2="980"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1000" x2="1000"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1020" x2="1020"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1040" x2="1040"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1060" x2="1060"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1080" x2="1080"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1100" x2="1100"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1120" x2="1120"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1140" x2="1140"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1160" x2="1160"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1180" x2="1180"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1200" x2="1200"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1220" x2="1220"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1240" x2="1240"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1260" x2="1260"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1280" x2="1280"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1300" x2="1300"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1320" x2="1320"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1340" x2="1340"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1360" x2="1360"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1380" x2="1380"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1400" x2="1400"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1420" x2="1420"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1440" x2="1440"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1460" x2="1460"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1480" x2="1480"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1500" x2="1500"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1520" x2="1520"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1540" x2="1540"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1560" x2="1560"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1580" x2="1580"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1600" x2="1600"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1620" x2="1620"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1640" x2="1640"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1660" x2="1660"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1680" x2="1680"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1700" x2="1700"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1720" x2="1720"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1740" x2="1740"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1760" x2="1760"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1780" x2="1780"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1800" x2="1800"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1820" x2="1820"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1840" x2="1840"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1860" x2="1860"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1880" x2="1880"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1900" x2="1900"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1920" x2="1920"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1940" x2="1940"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1960" x2="1960"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="1980" x2="1980"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2000" x2="2000"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2020" x2="2020"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2040" x2="2040"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2060" x2="2060"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2080" x2="2080"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2100" x2="2100"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2120" x2="2120"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2140" x2="2140"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2160" x2="2160"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2180" x2="2180"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2200" x2="2200"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2220" x2="2220"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2240" x2="2240"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2260" x2="2260"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2280" x2="2280"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2300" x2="2300"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2320" x2="2320"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2340" x2="2340"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2360" x2="2360"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2380" x2="2380"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2400" x2="2400"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2420" x2="2420"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2440" x2="2440"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2460" x2="2460"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2480" x2="2480"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2500" x2="2500"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2520" x2="2520"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2540" x2="2540"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2560" x2="2560"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2580" x2="2580"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2600" x2="2600"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2620" x2="2620"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2640" x2="2640"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2660" x2="2660"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2680" x2="2680"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2700" x2="2700"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2720" x2="2720"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2740" x2="2740"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2760" x2="2760"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2780" x2="2780"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2800" x2="2800"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2820" x2="2820"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2840" x2="2840"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2860" x2="2860"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2880" x2="2880"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2900" x2="2900"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2920" x2="2920"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2940" x2="2940"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2960" x2="2960"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="2980" x2="2980"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3000" x2="3000"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3020" x2="3020"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3040" x2="3040"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3060" x2="3060"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3080" x2="3080"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3100" x2="3100"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3120" x2="3120"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3140" x2="3140"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3160" x2="3160"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3180" x2="3180"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3200" x2="3200"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3220" x2="3220"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3240" x2="3240"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3260" x2="3260"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3280" x2="3280"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3300" x2="3300"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3320" x2="3320"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3340" x2="3340"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3360" x2="3360"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3380" x2="3380"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3400" x2="3400"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3420" x2="3420"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3440" x2="3440"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3460" x2="3460"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3480" x2="3480"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3500" x2="3500"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3520" x2="3520"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3540" x2="3540"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3560" x2="3560"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3580" x2="3580"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3600" x2="3600"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3620" x2="3620"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3640" x2="3640"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3660" x2="3660"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3680" x2="3680"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3700" x2="3700"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3720" x2="3720"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3740" x2="3740"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3760" x2="3760"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3780" x2="3780"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3800" x2="3800"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3820" x2="3820"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3840" x2="3840"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3860" x2="3860"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3880" x2="3880"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3900" x2="3900"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3920" x2="3920"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3940" x2="3940"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3960" x2="3960"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="3980" x2="3980"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4000" x2="4000"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4020" x2="4020"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4040" x2="4040"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4060" x2="4060"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4080" x2="4080"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4100" x2="4100"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4120" x2="4120"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4140" x2="4140"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4160" x2="4160"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4180" x2="4180"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4200" x2="4200"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4220" x2="4220"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4240" x2="4240"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4260" x2="4260"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4280" x2="4280"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4300" x2="4300"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4320" x2="4320"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4340" x2="4340"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4360" x2="4360"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4380" x2="4380"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4400" x2="4400"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4420" x2="4420"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4440" x2="4440"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4460" x2="4460"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4480" x2="4480"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4500" x2="4500"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4520" x2="4520"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4540" x2="4540"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4560" x2="4560"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4580" x2="4580"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4600" x2="4600"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4620" x2="4620"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4640" x2="4640"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4660" x2="4660"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4680" x2="4680"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4700" x2="4700"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4720" x2="4720"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4740" x2="4740"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4760" x2="4760"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4780" x2="4780"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4800" x2="4800"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4820" x2="4820"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4840" x2="4840"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4860" x2="4860"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4880" x2="4880"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4900" x2="4900"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4920" x2="4920"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4940" x2="4940"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4960" x2="4960"></line><line class="red-ui-workspace-chart-grid-v" y1="0" y2="5000" x1="4980" x2="4980"></line></g><g></g><g></g><g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 140 180 C 185 180 155 180 200 180"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 140 180 C 185 180 155 180 200 180"></path><path class="red-ui-flow-link-line red-ui-flow-link-path red-ui-flow-subflow-link" d="M 140 180 C 185 180 155 180 200 180"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 460 180 C 535 180 525 120 600 120"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 460 180 C 535 180 525 120 600 120"></path><path class="red-ui-flow-link-line red-ui-flow-link-path red-ui-flow-subflow-link" d="M 460 180 C 535 180 525 120 600 120"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 460 180 C 535 180 525 180 600 180"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 460 180 C 535 180 525 180 600 180"></path><path class="red-ui-flow-link-line red-ui-flow-link-path red-ui-flow-subflow-link" d="M 460 180 C 535 180 525 180 600 180"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 460 180 C 535 180 525 240 600 240"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 460 180 C 535 180 525 240 600 240"></path><path class="red-ui-flow-link-line red-ui-flow-link-path red-ui-flow-subflow-link" d="M 460 180 C 535 180 525 240 600 240"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 300 180 C 315 180 305 180 320 180"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 300 180 C 315 180 305 180 320 180"></path><path class="red-ui-flow-link-line red-ui-flow-link-path red-ui-flow-subflow-link" d="M 300 180 C 315 180 305 180 320 180"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 120 300 C 135 300 125.00000000000001 300 140 300"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 120 300 C 135 300 125.00000000000001 300 140 300"></path><path class="red-ui-flow-link-line red-ui-flow-link-path red-ui-flow-subflow-link" d="M 120 300 C 135 300 125.00000000000001 300 140 300"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 740 380 C 807.0820393249937 380 752.9179606750063 340 820 340"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 740 380 C 807.0820393249937 380 752.9179606750063 340 820 340"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 740 380 C 807.0820393249937 380 752.9179606750063 340 820 340"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 740 300 C 807.0820393249937 300 752.9179606750063 340 820 340"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 740 300 C 807.0820393249937 300 752.9179606750063 340 820 340"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 740 300 C 807.0820393249937 300 752.9179606750063 340 820 340"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 740 340 C 800 340 760 340 820 340"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 740 340 C 800 340 760 340 820 340"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 740 340 C 800 340 760 340 820 340"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 340 300 C 355 300 345 300 360 300"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 340 300 C 355 300 345 300 360 300"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 340 300 C 355 300 345 300 360 300"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 460 300 C 535 300 505 300 580 300"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 460 300 C 535 300 505 300 580 300"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 460 300 C 535 300 505 300 580 300"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 460 300 C 535 300 505 340 580 340"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 460 300 C 535 300 505 340 580 340"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 460 300 C 535 300 505 340 580 340"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 460 300 C 535 300 505 380 580 380"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 460 300 C 535 300 505 380 580 380"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 460 300 C 535 300 505 380 580 380"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 460 300 C 535 300 505 420 580 420"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 460 300 C 535 300 505 420 580 420"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 460 300 C 535 300 505 420 580 420"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 460 300 C 535 300 505 460 580 460"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 460 300 C 535 300 505 460 580 460"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 460 300 C 535 300 505 460 580 460"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 120 60 C 150 60 130 60 160 60"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 120 60 C 150 60 130 60 160 60"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 120 60 C 150 60 130 60 160 60"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 260 60 C 290 60 270 60 300 60"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 260 60 C 290 60 270 60 300 60"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 260 60 C 290 60 270 60 300 60"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 1000 340 C 1075 340 1085 420 1160 420"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 1000 340 C 1075 340 1085 420 1160 420"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 1000 340 C 1075 340 1085 420 1160 420"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 920 460 C 935 460 925 460 940 460"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 920 460 C 935 460 925 460 940 460"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 920 460 C 935 460 925 460 940 460"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 1080 460 C 1147.0820393249937 460 1092.9179606750063 420 1160 420"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 1080 460 C 1147.0820393249937 460 1092.9179606750063 420 1160 420"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 1080 460 C 1147.0820393249937 460 1092.9179606750063 420 1160 420"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 740 420 C 815 420 765 420 840 420"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 740 420 C 815 420 765 420 840 420"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 740 420 C 815 420 765 420 840 420"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 1000 420 C 1075 420 1085 420 1160 420"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 1000 420 C 1075 420 1085 420 1160 420"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 1000 420 C 1075 420 1085 420 1160 420"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 1080 500 C 1155 500 1085 420 1160 420"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 1080 500 C 1155 500 1085 420 1160 420"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 1080 500 C 1155 500 1085 420 1160 420"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 900 500 C 915 500 905 500 920 500"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 900 500 C 915 500 905 500 920 500"></path><path class="red-ui-flow-link-line red-ui-flow-link-path red-ui-flow-subflow-link" d="M 900 500 C 915 500 905 500 920 500"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 700 240 C 730 240 710 240 740 240"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 700 240 C 730 240 710 240 740 240"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 700 240 C 730 240 710 240 740 240"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 720 460 C 774.0832691319598 460 725.9167308680402 500 780 500"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 720 460 C 774.0832691319598 460 725.9167308680402 500 780 500"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 720 460 C 774.0832691319598 460 725.9167308680402 500 780 500"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 720 460 C 765 460 735 460 780 460"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 720 460 C 765 460 735 460 780 460"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 720 460 C 765 460 735 460 780 460"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 140 580 C 155 580 145 580 160 580"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 140 580 C 155 580 145 580 160 580"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 140 580 C 155 580 145 580 160 580"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 320 580 C 350 580 330 580 360 580"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 320 580 C 350 580 330 580 360 580"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 320 580 C 350 580 330 580 360 580"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 480 580 C 525 580 495 580 540 580"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 480 580 C 525 580 495 580 540 580"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 480 580 C 525 580 495 580 540 580"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 120 700 C 135 700 125.00000000000001 700 140 700"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 120 700 C 135 700 125.00000000000001 700 140 700"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 120 700 C 135 700 125.00000000000001 700 140 700"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 280 700 C 317.5 700 292.5 700 330 700"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 280 700 C 317.5 700 292.5 700 330 700"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 280 700 C 317.5 700 292.5 700 330 700"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 120 840 C 135 840 125.00000000000001 840 140 840"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 120 840 C 135 840 125.00000000000001 840 140 840"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 120 840 C 135 840 125.00000000000001 840 140 840"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 260 840 C 290 840 270 840 300 840"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 260 840 C 290 840 270 840 300 840"></path><path class="red-ui-flow-link-line red-ui-flow-link-path red-ui-flow-subflow-link" d="M 260 840 C 290 840 270 840 300 840"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 400 840 C 430 840 410 840 440 840"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 400 840 C 430 840 410 840 440 840"></path><path class="red-ui-flow-link-line red-ui-flow-link-path" d="M 400 840 C 430 840 410 840 440 840"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 540 840 C 600 840 560 840 620 840"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 540 840 C 600 840 560 840 620 840"></path><path class="red-ui-flow-link-line red-ui-flow-link-path red-ui-flow-subflow-link" d="M 540 840 C 600 840 560 840 620 840"></path></g><g class="red-ui-flow-link"><path class="red-ui-flow-link-background red-ui-flow-link-path" d="M 780 840 C 855 840 805 840 880 840"></path><path class="red-ui-flow-link-outline red-ui-flow-link-path" d="M 780 840 C 855 840 805 840 880 840"></path><path class="red-ui-flow-link-line red-ui-flow-link-path red-ui-flow-subflow-link" d="M 780 840 C 855 840 805 840 880 840"></path></g></g><g></g><g><g class="red-ui-flow-node red-ui-flow-node-group" id="38b9673bc20140e6" transform="translate(0,165)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#d8bfd8" width="140" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/bridge.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">定时烧水开关</text></g><g class="red-ui-flow-node-status-group" style="display: inline;" transform="translate(3,33)"><rect class="red-ui-flow-node-status red-ui-flow-node-status-dot-green" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3" style="display: inline;"></rect><text class="red-ui-flow-node-status-label" x="20" y="10">已连接</text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-output" transform="translate(135,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="6121452342284b5d" transform="translate(320,165)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#DEB887" width="140" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red-contrib-chronos/chronos_scheduler.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">烧水定时器</text></g><g class="red-ui-flow-node-status-group" style="display: inline;" transform="translate(3,33)"><rect class="red-ui-flow-node-status red-ui-flow-node-status-dot-green" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3" style="display: inline;"></rect><text class="red-ui-flow-node-status-label" x="20" y="10">next event at 2/16/2022 6:00 AM</text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(135,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="0c56baf613537011" transform="translate(600,105)"><g transform="translate(154,2)" class="red-ui-flow-node-button" style="display: inherit;"><rect class="red-ui-flow-node-button-background" rx="5" ry="5" width="32" height="26" fill-opacity="1"></rect><rect class="red-ui-flow-node-button-button" x="11" y="4" rx="4" ry="4" width="16" height="18" fill="#87a980" fill-opacity="1"></rect></g><rect class="red-ui-flow-node " rx="5" ry="5" fill="#87a980" width="160" height="30"></rect><g class="red-ui-flow-node-icon-group red-ui-flow-node-icon-group-right" x="0" y="0" style="pointer-events: none;" transform="translate(130,0)"><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/debug.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 0 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label red-ui-flow-node-label-right" transform="translate(122,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">msg.payload ⇲</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="e33537440b224fd0" transform="translate(200,165)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#DEBD5C" width="100" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/parser-json.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">json</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(95,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="dbce16e5ce780b0c" transform="translate(600,165)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#d8bfd8" width="100" height="30"></rect><g class="red-ui-flow-node-icon-group red-ui-flow-node-icon-group-right" x="0" y="0" style="pointer-events: none;" transform="translate(70,0)"><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/bridge.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 0 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label red-ui-flow-node-label-right" transform="translate(62,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">cook</text></g><g class="red-ui-flow-node-status-group" style="display: inline;" transform="translate(3,33)"><rect class="red-ui-flow-node-status red-ui-flow-node-status-dot-green" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3" style="display: inline;"></rect><text class="red-ui-flow-node-status-label" x="20" y="10">已连接</text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="ab632c5b053b1bfb" transform="translate(0,285)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#d8bfd8" width="120" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/bridge.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">pushbafa</text></g><g class="red-ui-flow-node-status-group" style="display: inline;" transform="translate(3,33)"><rect class="red-ui-flow-node-status red-ui-flow-node-status-dot-green" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3" style="display: inline;"></rect><text class="red-ui-flow-node-status-label" x="20" y="10">已连接</text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-output" transform="translate(115,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="1c0a51c054aed784" transform="translate(580,365)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#E2D96E" width="160" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/rbe.png" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">燃气是否变化</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(155,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="8e8497eede12b3e2" transform="translate(540,565)"><g transform="translate(154,2)" class="red-ui-flow-node-button" style="display: inherit;"><rect class="red-ui-flow-node-button-background" rx="5" ry="5" width="32" height="26" fill-opacity="1"></rect><rect class="red-ui-flow-node-button-button" x="11" y="4" rx="4" ry="4" width="16" height="18" fill="#87a980" fill-opacity="1"></rect></g><rect class="red-ui-flow-node " rx="5" ry="5" fill="#87a980" width="160" height="30"></rect><g class="red-ui-flow-node-icon-group red-ui-flow-node-icon-group-right" x="0" y="0" style="pointer-events: none;" transform="translate(130,0)"><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/debug.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 0 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label red-ui-flow-node-label-right" transform="translate(122,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">msg.payload ⇲</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="f4c957c041e8dcde" transform="translate(580,285)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#E2D96E" width="160" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/rbe.png" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">水费是否变化</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(155,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="b784d18872619709" transform="translate(580,325)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#E2D96E" width="160" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/rbe.png" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">电费是否变化</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(155,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="28b5a8ec397006ad" transform="translate(140,285)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#fdd0a2" width="200" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/function.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">转换单引号为双引号</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(195,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="1ce364df267d255c" transform="translate(360,285)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#DEBD5C" width="100" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/parser-json.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">json</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(95,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="1f2dc6bbecbbed08" transform="translate(20,45)"><g transform="translate(-25,2)" class="red-ui-flow-node-button"><rect class="red-ui-flow-node-button-background" rx="5" ry="5" width="32" height="26"></rect><rect class="red-ui-flow-node-button-button" x="5" y="4" rx="4" ry="4" width="16" height="18" fill="#a6bbcf"></rect></g><rect class="red-ui-flow-node " rx="5" ry="5" fill="#a6bbcf" width="100" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/inject.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">时间戳</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-output" transform="translate(95,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="3c5b89ceee4671a3" transform="translate(300,45)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="rgb(231, 231, 174)" width="120" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/white-globe.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">发送通知</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(115,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="8b9fa6744137620d" transform="translate(160,45)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#fdd0a2" width="100" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/function.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">函数</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(95,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="a11ec1d8e519956e" transform="translate(1160,405)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="rgb(231, 231, 174)" width="120" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/white-globe.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">发送通知</text></g><g class="red-ui-flow-node-status-group" style="display: inline;" transform="translate(-14,33)"><rect class="red-ui-flow-node-status red-ui-flow-node-status-dot-blue" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3" style="display: none;"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(115,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="8578faf2b0304c2d" transform="translate(820,325)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#fdd0a2" width="180" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/function.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">生活缴费变动赋值</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(175,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="365faad382ae813e" transform="translate(780,445)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#E2D96E" width="140" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/rbe.png" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">PV是否变化</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(135,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="0903a1b48a89a7ba" transform="translate(940,445)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#fdd0a2" width="140" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/function.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">PV变动赋值</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(135,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="a9707c15ef67a44b" transform="translate(580,405)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#E2D96E" width="160" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/rbe.png" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">油价是否变化</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(155,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="17c12b68b67d99e6" transform="translate(840,405)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#fdd0a2" width="160" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/function.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">油价变动赋值</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(155,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="31744c9d7a63125f" transform="translate(920,485)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#fdd0a2" width="160" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/function.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">天气变动赋值</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(155,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="c106e038f7fe12b4" transform="translate(780,485)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#E2D96E" width="120" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/rbe.png" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">天气变化</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(115,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="5288934ddcba31ee" transform="translate(740,225)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="rgb(231, 231, 174)" width="120" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/white-globe.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">发送通知</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(115,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="fddbb4cc02b06ffa" transform="translate(600,225)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#fdd0a2" width="100" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/function.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">函数</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(95,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="7a1978f77b304b72" transform="translate(0,5)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#ffffff" width="140" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/comment.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">测试发送通知</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="909c0e4d91d43008" transform="translate(0,125)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#ffffff" width="120" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/comment.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">定时烧水</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="b299fe3cab75ef79" transform="translate(0,245)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#ffffff" width="220" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/comment.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">相关信息展示与变动提醒</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="fbc0d0df196bac70" transform="translate(580,445)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#DEB887" width="140" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red-contrib-chronos/chronos_filter.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">免打扰时间</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(135,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="ae991ce119692b7a" transform="translate(20,565)"><g transform="translate(-25,2)" class="red-ui-flow-node-button"><rect class="red-ui-flow-node-button-background" rx="5" ry="5" width="32" height="26"></rect><rect class="red-ui-flow-node-button-button" x="5" y="4" rx="4" ry="4" width="16" height="18" fill="#a6bbcf"></rect></g><rect class="red-ui-flow-node " rx="5" ry="5" fill="#a6bbcf" width="120" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/inject.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">每小时 ↻</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-output" transform="translate(115,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="67a0dd3a350c3136" transform="translate(160,565)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#fdd0a2" width="160" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/function.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">组释放内存报文</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(155,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="eb7d4be2690de45c" transform="translate(360,565)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="rgb(231, 231, 174)" width="120" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/white-globe.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">http 请求</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(115,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="a7c570a76095669a" transform="translate(0,525)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#ffffff" width="200" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/comment.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">每小时释放路由器内存</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="554cc102b9a74d96" transform="translate(20,685)"><g transform="translate(-25,2)" class="red-ui-flow-node-button"><rect class="red-ui-flow-node-button-background" rx="5" ry="5" width="32" height="26"></rect><rect class="red-ui-flow-node-button-button" x="5" y="4" rx="4" ry="4" width="16" height="18" fill="#a6bbcf"></rect></g><rect class="red-ui-flow-node " rx="5" ry="5" fill="#a6bbcf" width="100" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/inject.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">时间戳</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-output" transform="translate(95,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="78eba07c271c1727" transform="translate(140,685)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#DEB887" width="140" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red-contrib-chronos/chronos_filter.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">免打扰时间</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(135,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="4b6bf1369a51d39e" transform="translate(330,685)"><g transform="translate(94,2)" class="red-ui-flow-node-button" style="display: inherit;"><rect class="red-ui-flow-node-button-background" rx="5" ry="5" width="32" height="26" fill-opacity="1"></rect><rect class="red-ui-flow-node-button-button" x="11" y="4" rx="4" ry="4" width="16" height="18" fill="#87a980" fill-opacity="1"></rect></g><rect class="red-ui-flow-node " rx="5" ry="5" fill="#87a980" width="100" height="30"></rect><g class="red-ui-flow-node-icon-group red-ui-flow-node-icon-group-right" x="0" y="0" style="pointer-events: none;" transform="translate(70,0)"><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/debug.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 0 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label red-ui-flow-node-label-right" transform="translate(62,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">msg ⇲</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="8e53d50b1b02caf7" transform="translate(20,825)"><g transform="translate(-25,2)" class="red-ui-flow-node-button"><rect class="red-ui-flow-node-button-background" rx="5" ry="5" width="32" height="26"></rect><rect class="red-ui-flow-node-button-button" x="5" y="4" rx="4" ry="4" width="16" height="18" fill="#a6bbcf" fill-opacity="1"></rect></g><rect class="red-ui-flow-node " rx="5" ry="5" fill="#a6bbcf" width="100" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" transform="" style="pointer-events: none;"><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/inject.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" y="0" style=""></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">时间戳</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide" transform="translate(87, -8)"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-output" transform="translate(95,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="3a56205bcba4c99b" transform="translate(880,825)"><g transform="translate(94,2)" class="red-ui-flow-node-button" style="display: inherit;"><rect class="red-ui-flow-node-button-background" rx="5" ry="5" width="32" height="26" fill-opacity="1"></rect><rect class="red-ui-flow-node-button-button" x="11" y="4" rx="4" ry="4" width="16" height="18" fill="#87a980" fill-opacity="1"></rect></g><rect class="red-ui-flow-node" rx="5" ry="5" fill="#87a980" width="100" height="30"></rect><g class="red-ui-flow-node-icon-group red-ui-flow-node-icon-group-right" x="0" y="0" style="pointer-events: none;" transform="translate(70,0)"><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/debug.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 0 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label red-ui-flow-node-label-right" transform="translate(62,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">msg ⇲</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide" transform="translate(87, -8)"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="9c99fc3bfcd0824c" transform="translate(140,825)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="rgb(231, 231, 174)" width="120" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" transform="" style="pointer-events: none;"><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/white-globe.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" y="0" style=""></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">http 请求</text></g><g class="red-ui-flow-node-status-group" style="display: inline;" transform="translate(-14,33)"><rect class="red-ui-flow-node-status red-ui-flow-node-status-dot-blue" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3" style="display: none;"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide" transform="translate(107, -8)"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(115,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="dbe6de212ac182e6" transform="translate(300,825)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#DEBD5C" width="100" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/parser-json.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">json</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide" transform="translate(87, -8)"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(95,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group red-ui-flow-node-selected" id="d82819c0be1332d3" transform="translate(620,825)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#fdd0a2" width="160" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/function.svg" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label node_label_italic" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">安装变动赋值</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide" transform="translate(147, -8)"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(155,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g><g class="red-ui-flow-node red-ui-flow-node-group" id="0a5b9270639649ce" transform="translate(440,825)"><rect class="red-ui-flow-node " rx="5" ry="5" fill="#E2D96E" width="100" height="30"></rect><g class="red-ui-flow-node-icon-group" x="0" y="0" style="pointer-events: none;" transform=""><rect x="0" y="0" class="red-ui-flow-node-icon-shade" width="30" height="30"></rect><image href="icons/node-red/rbe.png" class="red-ui-flow-node-icon" x="0" width="30" height="30" style="" y="0"></image><path d="M 30 1 l 0 28" class="red-ui-flow-node-icon-shade-border"></path></g><g class="red-ui-flow-node-label" transform="translate(38,16)"><text class="red-ui-flow-node-label-text" x="0" y="0">filter</text></g><g class="red-ui-flow-node-status-group" style="display: none;"><rect class="red-ui-flow-node-status" x="6" y="1" width="9" height="9" rx="2" ry="2" stroke-width="3"></rect><text class="red-ui-flow-node-status-label" x="20" y="10"></text></g><g class="red-ui-flow-node-changed hide" transform="translate(87, -8)"><circle cx="5" cy="5" r="5"></circle></g><g class="red-ui-flow-node-error hide"><path d="M 0,9 l 10,0 -5,-8 z"></path></g><g class="red-ui-flow-port-input" transform="translate(-5,10)"><rect class="red-ui-flow-port" rx="3" ry="3" width="10" height="10"></rect></g><g class="red-ui-flow-port-output" transform="translate(95,10)"><rect rx="3" ry="3" width="10" height="10" class="red-ui-flow-port"></rect></g></g></g></g></g></svg></div><div id="red-ui-workspace-toolbar" style="display: none;"></div><div id="red-ui-workspace-footer" class="red-ui-component-footer"><span class="red-ui-statusbar-bucket red-ui-statusbar-bucket-left"></span><span class="red-ui-statusbar-bucket red-ui-statusbar-bucket-right"><span class="red-ui-statusbar-widget"><button class="red-ui-footer-button-toggle single" id="red-ui-view-navigate"><i class="fa fa-map-o"></i></button></span><span class="red-ui-statusbar-widget"><span class="button-group"><button class="red-ui-footer-button" id="red-ui-view-zoom-out"><i class="fa fa-minus"></i></button><button class="red-ui-footer-button" id="red-ui-view-zoom-zero"><i class="fa fa-circle-o"></i></button><button class="red-ui-footer-button" id="red-ui-view-zoom-in"><i class="fa fa-plus"></i></button></span></span></span></div><div id="red-ui-editor-shade" class="hide" style="display: block;"></div><div style="position: absolute; bottom: 25px; right: 0px; z-index: 1; display: none;"><svg width="200" height="200" pointer-events="all" id="red-ui-navigator-canvas"><rect x="0" y="0" width="200" height="200" style="fill: none; stroke: none;"></rect><rect class="red-ui-navigator-border" x="0" y="0" width="51.56" height="33.96"></rect><g></g></svg></div></div><div id="red-ui-editor-stack" style="z-index: 13;"><div class="red-ui-tray ui-draggable" style="width: 976.188px; right: 0px; transition: right 0.25s ease 0s;"><div class="red-ui-tray-header editor-tray-header"><div class="red-ui-tray-titlebar"><ul class="red-ui-tray-breadcrumbs"><li>编辑 function 节点</li></ul></div><div class="red-ui-tray-toolbar"><button class="ui-button ui-corner-all ui-widget leftButton" id="node-dialog-delete">删除</button><button class="ui-button ui-corner-all ui-widget" id="node-dialog-cancel">取消</button><button class="ui-button ui-corner-all ui-widget primary" id="node-dialog-ok">完成</button></div></div><div class="red-ui-tray-body-wrapper" style="overflow: hidden;"><div class="red-ui-tray-body editor-tray-body" style="min-width: 600.188px; height: 790.2px;"><div class="red-ui-tabs red-ui-tabs-collapsible"><div><ul><li class="red-ui-tab red-ui-tab-pinned active" id="red-ui-tab-editor-tab-properties" style="width: 864px;"><a href="http://192.168.50.1:1880/#editor-tab-properties" class="red-ui-tab-label" title="属性"><i class="red-ui-tab-icon fa fa-cog"></i><span class="red-ui-text-bidi-aware" dir="">属性</span></a><span class="red-ui-tabs-fade"></span><span class="red-ui-tabs-badges"></span></li><li class="red-ui-tab red-ui-tab-pinned" id="red-ui-tab-editor-tab-description" style="width: 864px;"><a href="http://192.168.50.1:1880/#editor-tab-description" class="red-ui-tab-label" title="描述"><i class="red-ui-tab-icon fa fa-file-text-o"></i><span class="red-ui-text-bidi-aware" dir="">描述</span></a><span class="red-ui-tabs-fade"></span><span class="red-ui-tabs-badges"></span></li><li class="red-ui-tab red-ui-tab-pinned" id="red-ui-tab-editor-tab-appearance" style="width: 864px;"><a href="http://192.168.50.1:1880/#editor-tab-appearance" class="red-ui-tab-label" title="外观"><i class="red-ui-tab-icon fa fa-object-group"></i><span class="red-ui-text-bidi-aware" dir="">外观</span></a><span class="red-ui-tabs-fade"></span><span class="red-ui-tabs-badges"></span></li></ul></div><div class="red-ui-tab-link-buttons"><a href="http://192.168.50.1:1880/#editor-tab-properties" class="red-ui-tab-link-button active selected" id="red-ui-tab-editor-tab-properties-link-button"><i class="fa fa-cog"></i></a><a href="http://192.168.50.1:1880/#editor-tab-description" class="red-ui-tab-link-button" id="red-ui-tab-editor-tab-description-link-button"><i class="fa fa-file-text-o"></i></a><a href="http://192.168.50.1:1880/#editor-tab-appearance" class="red-ui-tab-link-button" id="red-ui-tab-editor-tab-appearance-link-button"><i class="fa fa-object-group"></i></a></div></div><div><div class="red-ui-tray-content" style="height: 740px;"><form id="dialog-form" class="form-horizontal" autocomplete="off" style="height: 700px;"><span style="position: absolute; top: -2000px;"><input id="red-ui-trap-user" type="text" autocomplete="off"></span><span style="position: absolute; top: -2000px;"><input id="red-ui-trap-username" type="text" autocomplete="off"></span><span style="position: absolute; top: -2000px;"><input id="red-ui-trap-password" type="password" autocomplete="off"></span>
    <style>
        .func-tabs-row {
            margin-bottom: 0;
        }
        #node-input-libs-container-row .red-ui-editableList-container {
            padding: 0px;
        }
        #node-input-libs-container-row .red-ui-editableList-container li {
            padding:0px;
        }
        #node-input-libs-container-row .red-ui-editableList-item-remove {
            right: 5px;
        }

        #node-input-libs-container-row .red-ui-editableList-header {
            display: flex;
            background: var(--red-ui-tertiary-background);
            padding-right: 75px;
        }
        #node-input-libs-container-row .red-ui-editableList-header > div {
            flex-grow: 1;
        }

        .node-libs-entry {
            display: flex;
        }

        .node-libs-entry .red-ui-typedInput-container {
            border-radius: 0;
            border: none;
        }
        .node-libs-entry .red-ui-typedInput-type-select {
            border-radius: 0 !important;
            height: 34px;
        }
        .node-libs-entry > span > input[type=text] {
            border-radius: 0;
            border-top-color: var(--red-ui-form-background);
            border-bottom-color: var(--red-ui-form-background);
            border-right-color: var(--red-ui-form-background);
        }
        .node-libs-entry > span > input[type=text].input-error {
        }
        .node-libs-entry > span {
            flex-grow: 1;
            width: 50%;
            position: relative;
        }
        .node-libs-entry span .node-input-libs-var, .node-libs-entry span .red-ui-typedInput-container {
            width: 100%;
        }
        .node-libs-entry > span > span > i {
            display: none;
        }
        .node-libs-entry > span > span.input-error > i {
            display: inline;
        }

    </style>
    <input type="hidden" id="node-input-func" autocomplete="off" value="let daily_installs = msg.payload.all_listable_scripts[0].daily_installs;
let total_installs = msg.payload.all_listable_scripts[0].total_installs;
let fan_score = msg.payload.all_listable_scripts[0].fan_score;
let good_ratings = msg.payload.all_listable_scripts[0].good_ratings;
let ok_ratings = msg.payload.all_listable_scripts[0].ok_ratings;
let bad_ratings = msg.payload.all_listable_scripts[0].bad_ratings;
// .padStart(8,&#39;0&#39;)
let msgText = &quot;总安装量:&quot; + total_installs + &quot;; 粉丝得分:&quot;+ fan_score;
msg.test = msgText.length
msgText += &quot;今日安装:&quot; + daily_installs + &quot; 评分:[G:&quot;+ good_ratings + &quot; M:&quot; + ok_ratings + &quot; B:&quot; + bad_ratings + &quot;]&quot;;
msg.msgText = msgText;
return msg;" dir="">
    <input type="hidden" id="node-input-noerr" autocomplete="off" value="0" dir="" class="input-error">
    <input type="hidden" id="node-input-finalize" autocomplete="off" value="" dir="">
    <input type="hidden" id="node-input-initialize" autocomplete="off" value="" dir="">

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name">名称</span></label>
        <div style="display: inline-block; width: calc(100% - 105px)"><input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name" autocomplete="off" dir="" style="width: calc(100% - 52px);" placeholder="名称"><div style="margin-left:5px; display: inline-block;position: relative;"><a id="node-input-function-lookup" class="red-ui-button"><i class="fa fa-book"></i> <i class="fa fa-caret-down"></i></a><ul class="red-ui-menu red-ui-menu-dropdown pull-right" id="node-input-function-lookup-submenu"><li><a id="node-input-function-menu-open-library" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>打开库...</span></span></a></li><li><a id="node-input-function-menu-save-library" tabindex="-1" href="http://192.168.50.1:1880/#"><span class="red-ui-menu-label"><span>保存到库...</span></span></a></li></ul></div></div>
    </div>


    <div class="form-row func-tabs-row">
        <div class="red-ui-tabs"><div><ul style="min-width: 600px; margin-bottom: 20px;" id="func-tabs"><li class="red-ui-tab" id="red-ui-tab-func-tab-config" style="width: 24.0385%;"><a href="http://192.168.50.1:1880/#func-tab-config" class="red-ui-tab-label" title="Setup"><i class="red-ui-tab-icon fa fa-cog"></i><span class="red-ui-text-bidi-aware" dir="">Setup</span></a><span class="red-ui-tabs-fade"></span><span class="red-ui-tabs-badges"></span></li><li class="red-ui-tab" id="red-ui-tab-func-tab-init" style="width: 24.0385%;"><a href="http://192.168.50.1:1880/#func-tab-init" class="red-ui-tab-label" title="设置"><span class="red-ui-text-bidi-aware" dir="">设置</span></a><span class="red-ui-tabs-fade"></span><span class="red-ui-tabs-badges"></span></li><li class="red-ui-tab active" id="red-ui-tab-func-tab-body" style="width: 24.0385%;"><a href="http://192.168.50.1:1880/#func-tab-body" class="red-ui-tab-label" title="函数"><span class="red-ui-text-bidi-aware" dir="">函数</span></a><span class="red-ui-tabs-fade"></span><span class="red-ui-tabs-badges"></span></li><li class="red-ui-tab" id="red-ui-tab-func-tab-finalize" style="width: 24.0385%;"><a href="http://192.168.50.1:1880/#func-tab-finalize" class="red-ui-tab-label" title="关闭"><span class="red-ui-text-bidi-aware" dir="">关闭</span></a><span class="red-ui-tabs-fade"></span><span class="red-ui-tabs-badges"></span></li></ul></div></div>
    </div>
    <div id="func-tabs-content" style="min-height: calc(100% - 95px);">

        <div id="func-tab-config" style="display: none;">
            <div class="form-row">
                <label for="node-input-outputs"><i class="fa fa-random"></i> <span data-i18n="node-red:function.label.outputs">输出</span></label>
                <span class="ui-spinner ui-corner-all ui-widget ui-widget-content"><input id="node-input-outputs" style="width: 60px;" value="1" autocomplete="off" dir="" aria-valuemin="0" aria-valuenow="1" class="ui-spinner-input" role="spinbutton"><a tabindex="-1" aria-hidden="true" class="ui-button ui-widget ui-spinner-button ui-spinner-up ui-corner-tr ui-button-icon-only" role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-n"></span><span class="ui-button-icon-space"> </span></a><a tabindex="-1" aria-hidden="true" class="ui-button ui-widget ui-spinner-button ui-spinner-down ui-corner-br ui-button-icon-only" role="button"><span class="ui-button-icon ui-icon ui-icon-triangle-1-s"></span><span class="ui-button-icon-space"> </span></a></span>
            </div>

            <div class="form-row node-input-libs-row hide" style="margin-bottom: 0px; display: block;">
                <label><i class="fa fa-cubes"></i> <span data-i18n="node-red:function.label.modules">Modules</span></label>
            </div>
            <div class="form-row node-input-libs-row hide" id="node-input-libs-container-row" style="display: block;">
                <div class="red-ui-editableList"><div class="red-ui-editableList-border"><div class="red-ui-editableList-header"><div data-i18n="node-red:function.require.moduleName">Module name</div><div data-i18n="node-red:function.require.importAs">Import as</div></div><div class="red-ui-editableList-container" style="min-height: 100px; max-height: none; overflow-y: scroll;"><ol id="node-input-libs-container" class="red-ui-editableList-list" style="min-height: 0px; min-width: 450px; height: 508px;"></ol></div></div><button type="button" class="red-ui-button red-ui-button-small red-ui-editableList-addButton" style="margin-top: 4px; margin-right: 5px;" title="add an item"><i class="fa fa-plus"></i><span> 添加</span></button></div>
            </div>
        </div>

        <div id="func-tab-init" style="display:none">
            <div class="form-row node-text-editor-row" style="position:relative">
                <div style="height: 617px; min-height: 150px;" class="node-text-editor" id="node-input-init-editor"><div></div><div class="red-ui-editor-text-container ace_editor ace_hidpi ace-tomorrow"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; font-size: 1px;"></textarea><div class="ace_gutter" aria-hidden="true"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="height: 1e+06px;"></div></div><div class="ace_scroller" style="line-height: 0px;"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="height: 1e+06px; margin: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;">&nbsp;</div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;">&nbsp;</div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></div>
                <div style="position: absolute; right:0; bottom: calc(100% - 20px); z-Index: 5;"><button id="node-init-expand-js" class="red-ui-button red-ui-button-small"><i class="fa fa-expand"></i></button></div>
            </div>
        </div>

        <div id="func-tab-body" style="">
            <div class="form-row node-text-editor-row" style="position:relative">
                <div style="height: 617px; min-height: 150px;" class="node-text-editor" id="node-input-func-editor"><div></div><div class="red-ui-editor-text-container ace_editor ace_hidpi ace-tomorrow ace_focus"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; font-size: 1px; height: 1px; width: 1px; transform: translate(281px, 153px);"></textarea><div class="ace_gutter" aria-hidden="true" style="left: 0px; width: 50px;"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="height: 1e+06px; transform: translate(0px, 0px); width: 50px;"><div class="ace_gutter-cell " style="height: 17px; top: 0px;">1<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 17px; top: 17px;">2<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 17px; top: 34px;">3<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 17px; top: 51px;">4<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 17px; top: 68px;">5<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 17px; top: 85px;">6<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 17px; top: 102px;">7<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 17px; top: 119px;">8<span style="display: none;"></span></div><div class="ace_gutter-cell ace_gutter-active-line " style="height: 17px; top: 136px;">9<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 17px; top: 153px;">10<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 17px; top: 170px;">11<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 17px; top: 187px;">12<span style="display: none;"></span></div><div class="ace_gutter-cell " style="height: 17px; top: 204px;">13<span style="display: none;"></span></div></div></div><div class="ace_scroller" style="line-height: 17px; left: 49.8594px; right: 0px; bottom: 0px;"><div class="ace_content" style="transform: translate(0px, 0px); width: 994px; height: 651px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 678px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_active-line" style="height: 17px; top: 136px; left: 0px; right: 0px;"></div></div><div class="ace_layer ace_text-layer" style="height: 1e+06px; margin: 0px 4px; transform: translate(0px, 0px);"><div class="ace_line" style="height: 17px; top: 0px;"><span class="ace_storage ace_type">let</span> <span class="ace_identifier">daily_installs</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">msg</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">payload</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">all_listable_scripts</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">daily_installs</span><span class="ace_punctuation ace_operator">;</span></div><div class="ace_line" style="height: 17px; top: 17px;"><span class="ace_storage ace_type">let</span> <span class="ace_identifier">total_installs</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">msg</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">payload</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">all_listable_scripts</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">total_installs</span><span class="ace_punctuation ace_operator">;</span></div><div class="ace_line" style="height: 17px; top: 34px;"><span class="ace_storage ace_type">let</span> <span class="ace_identifier">fan_score</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">msg</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">payload</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">all_listable_scripts</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">fan_score</span><span class="ace_punctuation ace_operator">;</span></div><div class="ace_line" style="height: 17px; top: 51px;"><span class="ace_storage ace_type">let</span> <span class="ace_identifier">good_ratings</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">msg</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">payload</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">all_listable_scripts</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">good_ratings</span><span class="ace_punctuation ace_operator">;</span></div><div class="ace_line" style="height: 17px; top: 68px;"><span class="ace_storage ace_type">let</span> <span class="ace_identifier">ok_ratings</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">msg</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">payload</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">all_listable_scripts</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">ok_ratings</span><span class="ace_punctuation ace_operator">;</span></div><div class="ace_line" style="height: 17px; top: 85px;"><span class="ace_storage ace_type">let</span> <span class="ace_identifier">bad_ratings</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">msg</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">payload</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">all_listable_scripts</span><span class="ace_paren ace_lparen">[</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">]</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">bad_ratings</span><span class="ace_punctuation ace_operator">;</span></div><div class="ace_line" style="height: 17px; top: 102px;"><span class="ace_comment">// .padEnd(8,'0')</span></div><div class="ace_line" style="height: 17px; top: 119px;"><span class="ace_storage ace_type">let</span> <span class="ace_identifier">msgText</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_string">"<span class="ace_cjk" style="width: 16.8594px;">总</span><span class="ace_cjk" style="width: 16.8594px;">安</span><span class="ace_cjk" style="width: 16.8594px;">装</span><span class="ace_cjk" style="width: 16.8594px;">量</span>:"</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_identifier">total_installs</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_string">"; <span class="ace_cjk" style="width: 16.8594px;">粉</span><span class="ace_cjk" style="width: 16.8594px;">丝</span><span class="ace_cjk" style="width: 16.8594px;">得</span><span class="ace_cjk" style="width: 16.8594px;">分</span>:"</span><span class="ace_keyword ace_operator">+</span> <span class="ace_identifier">fan_score</span><span class="ace_punctuation ace_operator">;</span></div><div class="ace_line" style="height: 17px; top: 136px;"><span class="ace_identifier">msgText</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">msgText</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">padEnd</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">20</span><span class="ace_punctuation ace_operator">,</span><span class="ace_string">' '</span><span class="ace_paren ace_rparen">)</span></div><div class="ace_line" style="height: 17px; top: 153px;"><span class="ace_identifier">msg</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">test</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">msgText</span><span class="ace_punctuation ace_operator">.</span><span class="ace_support ace_constant">length</span></div><div class="ace_line" style="height: 17px; top: 170px;"><span class="ace_identifier">msgText</span> <span class="ace_keyword ace_operator">+=</span> <span class="ace_string">"<span class="ace_cjk" style="width: 16.8594px;">今</span><span class="ace_cjk" style="width: 16.8594px;">日</span><span class="ace_cjk" style="width: 16.8594px;">安</span><span class="ace_cjk" style="width: 16.8594px;">装</span>:"</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_identifier">daily_installs</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_string">" <span class="ace_cjk" style="width: 16.8594px;">评</span><span class="ace_cjk" style="width: 16.8594px;">分</span>:[G:"</span><span class="ace_keyword ace_operator">+</span> <span class="ace_identifier">good_ratings</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_string">" M:"</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_identifier">ok_ratings</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_string">" B:"</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_identifier">bad_ratings</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_string">"]"</span><span class="ace_punctuation ace_operator">;</span></div><div class="ace_line" style="height: 17px; top: 187px;"><span class="ace_identifier">msg</span><span class="ace_punctuation ace_operator">.</span><span class="ace_identifier">msgText</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">msgText</span><span class="ace_punctuation ace_operator">;</span></div><div class="ace_line" style="height: 17px; top: 204px;"><span class="ace_keyword">return</span> <span class="ace_identifier">msg</span><span class="ace_punctuation ace_operator">;</span></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_animate-blinking"><div class="ace_cursor" style="animation-duration: 1000ms; display: block; transform: translate(232px, 136px); width: 8px; height: 17px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 221px;">&nbsp;</div></div><div class="ace_scrollbar ace_scrollbar-h" style="height: 20px; left: 49.8594px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 994px;">&nbsp;</div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;">הההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההההה</div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></div>
                <div style="position: absolute; right:0; bottom: calc(100% - 20px); z-Index: 5;"><button id="node-function-expand-js" class="red-ui-button red-ui-button-small"><i class="fa fa-expand"></i></button></div>
            </div>
        </div>

        <div id="func-tab-finalize" style="display:none">
            <div class="form-row node-text-editor-row" style="position:relative">
                <div style="height: 617px; min-height: 150px;" class="node-text-editor" id="node-input-finalize-editor"><div></div><div class="red-ui-editor-text-container ace_editor ace_hidpi ace-tomorrow"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; font-size: 1px;"></textarea><div class="ace_gutter" aria-hidden="true"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="height: 1e+06px;"></div></div><div class="ace_scroller" style="line-height: 0px;"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="height: 1e+06px; margin: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;">&nbsp;</div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;">&nbsp;</div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></div>
                <div style="position: absolute; right:0; bottom: calc(100% - 20px); z-Index: 5;"><button id="node-finalize-expand-js" class="red-ui-button red-ui-button-small"><i class="fa fa-expand"></i></button></div>
            </div>
        </div>

    </div>
</form></div><div class="red-ui-tray-content" style="display: none; height: 740px;"><form class="dialog-form form-horizontal" autocomplete="off" style="height: 700px;"><div></div><div class="form-row node-text-editor-row" style="position:relative; padding-top: 4px; height: 100%"><div style="height: 100%" class="node-text-editor" id="node-info-input-info-editor-692"><div><div style="margin-bottom: 5px"><span class="button-group"><button type="button" class="red-ui-button" data-style="h1" style="font-size:1.1em; font-weight: bold">h1</button><button type="button" class="red-ui-button" data-style="h2" style="font-size:1.0em; font-weight: bold">h2</button><button type="button" class="red-ui-button" data-style="h3" style="font-size:0.9em; font-weight: bold">h3</button></span><span class="button-group"><button type="button" class="red-ui-button" data-style="b"><i class="fa fa-bold"></i></button><button type="button" class="red-ui-button" data-style="i"><i class="fa fa-italic"></i></button><button type="button" class="red-ui-button" data-style="code"><i class="fa fa-code"></i></button></span><span class="button-group"><button type="button" class="red-ui-button" data-style="ol"><i class="fa fa-list-ol"></i></button><button type="button" class="red-ui-button" data-style="ul"><i class="fa fa-list-ul"></i></button><button type="button" class="red-ui-button" data-style="bq"><i class="fa fa-quote-left"></i></button><button type="button" class="red-ui-button" data-style="hr"><i class="fa fa-minus"></i></button><button type="button" class="red-ui-button" data-style="link"><i class="fa fa-link"></i></button></span><button type="button" class="red-ui-button" style="float: right;"><i class="fa fa-expand"></i></button></div></div><div class="red-ui-editor-text-container ace_editor ace_hidpi ace-tomorrow red-ui-editor-text-container-toolbar"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; font-size: 1px;"></textarea><div class="ace_gutter" aria-hidden="true"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="height: 1e+06px;"></div></div><div class="ace_scroller" style="line-height: 0px;"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="height: 1e+06px; margin: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;">&nbsp;</div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;">&nbsp;</div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><button type="button" class="red-ui-editor-text-help red-ui-button red-ui-button-small"><i class="fa fa-question"></i></button></div></div></form></div><div class="red-ui-tray-content" style="display: none; height: 740px;"><form class="dialog-form form-horizontal" autocomplete="off" style="height: 700px;"><div class="form-row"><label for="node-input-show-label-btn" data-i18n="editor.label">标签</label><span style="margin-right: 2px;"><input type="checkbox" id="node-input-show-label" style="display: none;"><button type="button" class="red-ui-toggleButton red-ui-button toggle single selected"><i class="fa fa-check-square-o"></i><span style="margin-left: 5px;">显示</span></button></span></div><div class="form-row"><label data-i18n="editor.settingIcon">图标</label><button type="button" class="red-ui-button red-ui-editor-node-appearance-button"><i class="fa fa-caret-down"></i><div class="red-ui-search-result-node" style="background-color: rgb(253, 208, 162); border-color: rgb(203, 158, 112);"><div class="red-ui-palette-icon-container"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/function.svg&quot;);"></div></div></div></button><input type="hidden" id="red-ui-editor-node-icon" value=""></div><div class="form-row"><span data-i18n="editor.portLabels">端口标签</span></div><div class="form-row"><span style="margin-left: 50px;" data-i18n="editor.labelInputs">输入</span><div id="red-ui-editor-node-label-form-inputs"><div class="red-ui-editor-node-label-form-row"><label for="red-ui-editor-node-label-form-input-0">1.</label><input type="text" id="red-ui-editor-node-label-form-input-0" placeholder="无"><button type="button" class="red-ui-button red-ui-button-small"><i class="fa fa-times"></i></button></div></div></div><div class="form-row"><span style="margin-left: 50px;" data-i18n="editor.labelOutputs">输出</span><div id="red-ui-editor-node-label-form-outputs"><div class="red-ui-editor-node-label-form-row"><label for="red-ui-editor-node-label-form-output-0">1.</label><input type="text" id="red-ui-editor-node-label-form-output-0" placeholder="无"><button type="button" class="red-ui-button red-ui-button-small"><i class="fa fa-times"></i></button></div></div></div></form></div></div></div></div><div class="red-ui-tray-footer"><div class="red-ui-tray-footer-left"><input id="node-input-node-disabled" type="checkbox" style="display: none;"><button type="button" class="red-ui-toggleButton red-ui-button toggle single selected" style="width: 64px;"><i class="fa fa-circle-thin"></i><span style="margin-left: 5px;">有效</span></button></div></div><div class="red-ui-tray-resize-handle ui-draggable-handle"></div></div></div><div id="red-ui-palette"><img src="./Node-RED _ 192.168.50.1_files/spin.svg" class="red-ui-palette-spinner hide" style="display: none;"><div id="red-ui-palette-search" class="red-ui-palette-search"><div class="red-ui-searchBox-container"><i class="fa fa-search"></i><form class="red-ui-searchBox-form"><input type="text" data-i18n="[placeholder]palette.filter" class="red-ui-searchBox-input" placeholder="过滤节点"></form><a class="red-ui-searchBox-clear" href="http://192.168.50.1:1880/#"><i class="fa fa-times"></i></a><span class="red-ui-searchBox-resultCount hide"></span></div></div><div id="red-ui-palette-container" class="red-ui-palette-scroll"><div id="red-ui-palette-container-subflows" class="red-ui-palette-category hide"><div id="red-ui-palette-header-subflows" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>子流程</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-subflows"><div id="red-ui-palette-subflows"></div><div id="red-ui-palette-subflows-input"></div><div id="red-ui-palette-subflows-output"></div><div id="red-ui-palette-subflows-function"></div></div></div><div id="red-ui-palette-container-common" class="red-ui-palette-category hide red-ui-palette-open" style="display: block;"><div id="red-ui-palette-header-common" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>共通</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-common"><div id="red-ui-palette-common"><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="inject" data-palette-label="inject" style="background-color: rgb(166, 187, 207); height: 28px;"><div class="red-ui-palette-label" dir="">inject</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/inject.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/inject.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="debug" data-palette-label="debug" style="background-color: rgb(135, 169, 128); height: 28px;"><div class="red-ui-palette-label red-ui-palette-label-right" dir="">debug</div><div class="red-ui-palette-icon-container red-ui-palette-icon-container-right" data-palette-icon="icons/node-red/debug.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/debug.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="complete" data-palette-label="complete" style="background-color: rgb(192, 237, 192); height: 28px;"><div class="red-ui-palette-label" dir="">complete</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/alert.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/alert.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="catch" data-palette-label="catch" style="background-color: rgb(228, 145, 145); height: 28px;"><div class="red-ui-palette-label" dir="">catch</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/alert.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/alert.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="status" data-palette-label="status" style="background-color: rgb(148, 193, 208); height: 28px;"><div class="red-ui-palette-label" dir="">status</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/status.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/status.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="link in" data-palette-label="link in" style="background-color: rgb(221, 221, 221); height: 28px;"><div class="red-ui-palette-label" dir="">link   in</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/link-out.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/link-out.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="link call" data-palette-label="link call" style="background-color: rgb(221, 221, 221); height: 28px;"><div class="red-ui-palette-label" dir="">link   call</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/link-call.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/link-call.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="link out" data-palette-label="link out" style="background-color: rgb(221, 221, 221); height: 28px;"><div class="red-ui-palette-label red-ui-palette-label-right" dir="">link   out</div><div class="red-ui-palette-icon-container red-ui-palette-icon-container-right" data-palette-icon="icons/node-red/link-out.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/link-out.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="comment" data-palette-label="comment" style="background-color: rgb(255, 255, 255); height: 28px;"><div class="red-ui-palette-label" dir="">comment</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/comment.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/comment.svg&quot;);"></div></div></div></div><div id="red-ui-palette-common-input"></div><div id="red-ui-palette-common-output"></div><div id="red-ui-palette-common-function"></div></div></div><div id="red-ui-palette-container-function" class="red-ui-palette-category hide red-ui-palette-open" style="display: block;"><div id="red-ui-palette-header-function" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>功能</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-function"><div id="red-ui-palette-function"><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="function" data-palette-label="function" style="background-color: rgb(253, 208, 162); height: 28px;"><div class="red-ui-palette-label" dir="">function</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/function.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/function.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="switch" data-palette-label="switch" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="red-ui-palette-label" dir="">switch</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/switch.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/switch.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="change" data-palette-label="change" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="red-ui-palette-label" dir="">change</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/swap.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/swap.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="range" data-palette-label="range" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="red-ui-palette-label" dir="">range</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/range.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/range.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="template" data-palette-label="template" style="background-color: rgb(243, 181, 103); height: 28px;"><div class="red-ui-palette-label" dir="">template</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/template.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/template.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="delay" data-palette-label="delay" style="background-color: rgb(230, 224, 248); height: 28px;"><div class="red-ui-palette-label" dir="">delay</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/timer.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/timer.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="trigger" data-palette-label="trigger" style="background-color: rgb(230, 224, 248); height: 28px;"><div class="red-ui-palette-label" dir="">trigger</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/trigger.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/trigger.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="exec" data-palette-label="exec" style="background-color: darksalmon; height: 28px;"><div class="red-ui-palette-label" dir="">exec</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/cog.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/cog.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="rbe" data-palette-label="filter" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="red-ui-palette-label" dir="">filter</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/rbe.png"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/rbe.png&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div></div><div id="red-ui-palette-function-input"></div><div id="red-ui-palette-function-output"></div><div id="red-ui-palette-function-function"></div></div></div><div id="red-ui-palette-container-network" class="red-ui-palette-category hide red-ui-palette-open" style="display: block;"><div id="red-ui-palette-header-network" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>网络</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-network"><div id="red-ui-palette-network"><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="mqtt in" data-palette-label="mqtt in" style="background-color: rgb(216, 191, 216); height: 28px;"><div class="red-ui-palette-label" dir="">mqtt   in</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/bridge.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="mqtt out" data-palette-label="mqtt out" style="background-color: rgb(216, 191, 216); height: 28px;"><div class="red-ui-palette-label red-ui-palette-label-right" dir="">mqtt   out</div><div class="red-ui-palette-icon-container red-ui-palette-icon-container-right" data-palette-icon="icons/node-red/bridge.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="http in" data-palette-label="http in" style="background-color: rgb(231, 231, 174); height: 28px;"><div class="red-ui-palette-label" dir="">http   in</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/white-globe.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/white-globe.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="http response" data-palette-label="http response" style="background-color: rgb(231, 231, 174); height: 28px;"><div class="red-ui-palette-label red-ui-palette-label-right" dir="">http   response</div><div class="red-ui-palette-icon-container red-ui-palette-icon-container-right" data-palette-icon="icons/node-red/white-globe.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/white-globe.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="http request" data-palette-label="http request" style="background-color: rgb(231, 231, 174); height: 28px;"><div class="red-ui-palette-label" dir="">http   request</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/white-globe.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/white-globe.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="websocket in" data-palette-label="websocket in" style="background-color: rgb(215, 215, 160); height: 28px;"><div class="red-ui-palette-label" dir="">websocket   in</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/white-globe.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/white-globe.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="websocket out" data-palette-label="websocket out" style="background-color: rgb(215, 215, 160); height: 48px;"><div class="red-ui-palette-label red-ui-palette-label-right" dir="">websocket  <br>out</div><div class="red-ui-palette-icon-container red-ui-palette-icon-container-right" data-palette-icon="icons/node-red/white-globe.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/white-globe.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 19px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="tcp in" data-palette-label="tcp in" style="background-color: rgb(192, 192, 192); height: 28px;"><div class="red-ui-palette-label" dir="">tcp   in</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/bridge-dash.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge-dash.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="tcp out" data-palette-label="tcp out" style="background-color: rgb(192, 192, 192); height: 28px;"><div class="red-ui-palette-label red-ui-palette-label-right" dir="">tcp   out</div><div class="red-ui-palette-icon-container red-ui-palette-icon-container-right" data-palette-icon="icons/node-red/bridge-dash.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge-dash.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="tcp request" data-palette-label="tcp request" style="background-color: rgb(192, 192, 192); height: 28px;"><div class="red-ui-palette-label" dir="">tcp   request</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/bridge-dash.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge-dash.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="udp in" data-palette-label="udp in" style="background-color: rgb(192, 192, 192); height: 28px;"><div class="red-ui-palette-label" dir="">udp   in</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/bridge-dash.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge-dash.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="udp out" data-palette-label="udp out" style="background-color: rgb(192, 192, 192); height: 28px;"><div class="red-ui-palette-label red-ui-palette-label-right" dir="">udp   out</div><div class="red-ui-palette-icon-container red-ui-palette-icon-container-right" data-palette-icon="icons/node-red/bridge-dash.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge-dash.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div></div><div id="red-ui-palette-network-input"></div><div id="red-ui-palette-network-output"></div><div id="red-ui-palette-network-function"></div></div></div><div id="red-ui-palette-container-input" class="red-ui-palette-category hide"><div id="red-ui-palette-header-input" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>输入</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-input"><div id="red-ui-palette-input"></div><div id="red-ui-palette-input-input"></div><div id="red-ui-palette-input-output"></div><div id="red-ui-palette-input-function"></div></div></div><div id="red-ui-palette-container-output" class="red-ui-palette-category hide"><div id="red-ui-palette-header-output" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>输出</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-output"><div id="red-ui-palette-output"></div><div id="red-ui-palette-output-input"></div><div id="red-ui-palette-output-output"></div><div id="red-ui-palette-output-function"></div></div></div><div id="red-ui-palette-container-sequence" class="red-ui-palette-category hide red-ui-palette-open" style="display: block;"><div id="red-ui-palette-header-sequence" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>序列</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-sequence"><div id="red-ui-palette-sequence"><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="split" data-palette-label="split" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="red-ui-palette-label" dir="">split</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/split.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/split.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="join" data-palette-label="join" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="red-ui-palette-label" dir="">join</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/join.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/join.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="sort" data-palette-label="sort" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="red-ui-palette-label" dir="">sort</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/sort.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/sort.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="batch" data-palette-label="batch" style="background-color: rgb(226, 217, 110); height: 28px;"><div class="red-ui-palette-label" dir="">batch</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/batch.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/batch.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div></div><div id="red-ui-palette-sequence-input"></div><div id="red-ui-palette-sequence-output"></div><div id="red-ui-palette-sequence-function"></div></div></div><div id="red-ui-palette-container-parser" class="red-ui-palette-category hide red-ui-palette-open" style="display: block;"><div id="red-ui-palette-header-parser" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>解析</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-parser"><div id="red-ui-palette-parser"><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="csv" data-palette-label="csv" style="background-color: rgb(222, 189, 92); height: 28px;"><div class="red-ui-palette-label" dir="">csv</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/parser-csv.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/parser-csv.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="html" data-palette-label="html" style="background-color: rgb(222, 189, 92); height: 28px;"><div class="red-ui-palette-label" dir="">html</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/parser-html.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/parser-html.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="json" data-palette-label="json" style="background-color: rgb(222, 189, 92); height: 28px;"><div class="red-ui-palette-label" dir="">json</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/parser-json.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/parser-json.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="xml" data-palette-label="xml" style="background-color: rgb(222, 189, 92); height: 28px;"><div class="red-ui-palette-label" dir="">xml</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/parser-xml.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/parser-xml.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="yaml" data-palette-label="yaml" style="background-color: rgb(222, 189, 92); height: 28px;"><div class="red-ui-palette-label" dir="">yaml</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/parser-yaml.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/parser-yaml.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div></div><div id="red-ui-palette-parser-input"></div><div id="red-ui-palette-parser-output"></div><div id="red-ui-palette-parser-function"></div></div></div><div id="red-ui-palette-container-storage" class="red-ui-palette-category hide red-ui-palette-open" style="display: block;"><div id="red-ui-palette-header-storage" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>存储</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-storage"><div id="red-ui-palette-storage"><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="file" data-palette-label="write file" style="background-color: burlywood; height: 28px;"><div class="red-ui-palette-label" dir="">write   file</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/file-out.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/file-out.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="file in" data-palette-label="read file" style="background-color: burlywood; height: 28px;"><div class="red-ui-palette-label" dir="">read   file</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/file-in.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/file-in.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="watch" data-palette-label="watch" style="background-color: burlywood; height: 28px;"><div class="red-ui-palette-label" dir="">watch</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red/watch.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/watch.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div></div></div><div id="red-ui-palette-storage-input"></div><div id="red-ui-palette-storage-output"></div><div id="red-ui-palette-storage-function"></div></div></div><div id="red-ui-palette-container-analysis" class="red-ui-palette-category hide"><div id="red-ui-palette-header-analysis" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>分析</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-analysis"><div id="red-ui-palette-analysis"></div><div id="red-ui-palette-analysis-input"></div><div id="red-ui-palette-analysis-output"></div><div id="red-ui-palette-analysis-function"></div></div></div><div id="red-ui-palette-container-social" class="red-ui-palette-category hide"><div id="red-ui-palette-header-social" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>社交</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-social"><div id="red-ui-palette-social"></div><div id="red-ui-palette-social-input"></div><div id="red-ui-palette-social-output"></div><div id="red-ui-palette-social-function"></div></div></div><div id="red-ui-palette-container-advanced" class="red-ui-palette-category hide"><div id="red-ui-palette-header-advanced" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>高级</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-advanced"><div id="red-ui-palette-advanced"></div><div id="red-ui-palette-advanced-input"></div><div id="red-ui-palette-advanced-output"></div><div id="red-ui-palette-advanced-function"></div></div></div><div id="red-ui-palette-container-chronos" class="red-ui-palette-category hide red-ui-palette-open" style="display: block;"><div id="red-ui-palette-header-chronos" class="red-ui-palette-header"><i class="expanded fa fa-angle-down"></i><span>chronos</span></div><div class="red-ui-palette-content" id="red-ui-palette-base-category-chronos"><div id="red-ui-palette-chronos"><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="chronos-scheduler" data-palette-label="scheduler" style="background-color: rgb(222, 184, 135); height: 28px;"><div class="red-ui-palette-label" dir="">scheduler</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red-contrib-chronos/chronos_scheduler.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red-contrib-chronos/chronos_scheduler.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="chronos-repeat" data-palette-label="repeat" style="background-color: rgb(222, 184, 135); height: 28px;"><div class="red-ui-palette-label" dir="">repeat</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red-contrib-chronos/chronos_repeat.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red-contrib-chronos/chronos_repeat.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="chronos-delay" data-palette-label="delay until" style="background-color: rgb(222, 184, 135); height: 28px;"><div class="red-ui-palette-label" dir="">delay   until</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red-contrib-chronos/chronos_delay.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red-contrib-chronos/chronos_delay.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="chronos-switch" data-palette-label="time switch" style="background-color: rgb(222, 184, 135); height: 28px;"><div class="red-ui-palette-label" dir="">time   switch</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red-contrib-chronos/chronos_switch.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red-contrib-chronos/chronos_switch.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="chronos-filter" data-palette-label="time filter" style="background-color: rgb(222, 184, 135); height: 28px;"><div class="red-ui-palette-label" dir="">time   filter</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red-contrib-chronos/chronos_filter.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red-contrib-chronos/chronos_filter.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div><div class="red-ui-palette-node ui-draggable ui-draggable-handle" data-palette-type="chronos-change" data-palette-label="time change" style="background-color: rgb(222, 184, 135); height: 28px;"><div class="red-ui-palette-label" dir="">time   change</div><div class="red-ui-palette-icon-container" data-palette-icon="icons/node-red-contrib-chronos/chronos_change.svg"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red-contrib-chronos/chronos_change.svg&quot;);"></div></div><div class="red-ui-palette-port red-ui-palette-port-output" style="top: 9px;"></div><div class="red-ui-palette-port red-ui-palette-port-input" style="top: 9px;"></div></div></div><div id="red-ui-palette-chronos-input"></div><div id="red-ui-palette-chronos-output"></div><div id="red-ui-palette-chronos-function"></div></div></div></div><div class="red-ui-component-footer"><span class="button-group"><button type="button" class="red-ui-footer-button"><i class="fa fa-angle-double-up"></i></button><button type="button" class="red-ui-footer-button"><i class="fa fa-angle-double-down"></i></button></span></div><div id="red-ui-palette-shade" class="hide" style="display: block;"></div><div class="red-ui-sidebar-control-left" style="display: none;"><i class="fa fa-chevron-left"></i></div></div><div id="red-ui-sidebar"><div class="red-ui-tabs red-ui-tabs-collapsible"><div><ul id="red-ui-sidebar-tabs"><li class="red-ui-tab red-ui-tab-pinned" id="red-ui-tab-info" style="width: 133px;"><a href="http://192.168.50.1:1880/#info" class="red-ui-tab-label" title="信息"><i class="red-ui-tab-icon fa fa-info"></i><span class="red-ui-text-bidi-aware" dir="">信息</span></a><span class="red-ui-tabs-fade"></span><span class="red-ui-tabs-badges"></span></li><li class="red-ui-tab red-ui-tab-pinned" id="red-ui-tab-help" style="width: 133px;"><a href="http://192.168.50.1:1880/#help" class="red-ui-tab-label" title="帮助"><i class="red-ui-tab-icon fa fa-book"></i><span class="red-ui-text-bidi-aware" dir="">帮助</span></a><span class="red-ui-tabs-fade"></span><span class="red-ui-tabs-badges"></span></li><li class="red-ui-tab red-ui-tab-pinned active" id="red-ui-tab-debug" style="width: 133px;"><a href="http://192.168.50.1:1880/#debug" class="red-ui-tab-label" title="调试窗口"><i class="red-ui-tab-icon fa fa-bug"></i><span class="red-ui-text-bidi-aware" dir="">调试窗口</span></a><span class="red-ui-tabs-fade"></span><span class="red-ui-tabs-badges"></span></li><li class="red-ui-tab red-ui-tab-pinned" id="red-ui-tab-config" style="width: 133px;"><a href="http://192.168.50.1:1880/#config" class="red-ui-tab-label" title="配置"><i class="red-ui-tab-icon fa fa-cog"></i><span class="red-ui-text-bidi-aware" dir="">配置</span></a><span class="red-ui-tabs-fade"></span><span class="red-ui-tabs-badges"></span></li><li class="red-ui-tab red-ui-tab-pinned" id="red-ui-tab-context" style="width: 133px;"><a href="http://192.168.50.1:1880/#context" class="red-ui-tab-label" title="上下文"><i class="red-ui-tab-icon fa fa-database"></i><span class="red-ui-text-bidi-aware" dir="">上下文</span></a><span class="red-ui-tabs-fade"></span><span class="red-ui-tabs-badges"></span></li></ul></div><div class="red-ui-tab-link-buttons"><a href="http://192.168.50.1:1880/#info" class="red-ui-tab-link-button red-ui-tab-link-button-pinned ui-draggable ui-draggable-handle" id="red-ui-tab-info-link-button" style="position: relative;"><i class="fa fa-info"></i></a><a href="http://192.168.50.1:1880/#help" class="red-ui-tab-link-button red-ui-tab-link-button-pinned ui-draggable ui-draggable-handle" id="red-ui-tab-help-link-button" style="position: relative;"><i class="fa fa-book"></i></a><a href="http://192.168.50.1:1880/#debug" class="red-ui-tab-link-button red-ui-tab-link-button-pinned ui-draggable ui-draggable-handle active selected" id="red-ui-tab-debug-link-button" style="position: relative;"><i class="fa fa-bug"></i></a><a href="http://192.168.50.1:1880/#config" class="red-ui-tab-link-button ui-draggable ui-draggable-handle" id="red-ui-tab-config-link-button" style="position: relative;"><i class="fa fa-cog"></i></a><a href="http://192.168.50.1:1880/#context" class="red-ui-tab-link-button ui-draggable ui-draggable-handle" id="red-ui-tab-context-link-button" style="position: relative; display: none;"><i class="fa fa-database"></i></a><a href="http://192.168.50.1:1880/#" class="red-ui-tab-link-button-menu"><i class="fa fa-caret-down"></i></a></div></div><div id="red-ui-sidebar-content"><div style="height: 100%; display: none;"><div class="red-ui-sidebar-info show-tips"><div class="red-ui-sidebar-info-stack red-ui-panels" style="height: 699px;"><div class="red-ui-panel" style="overflow: hidden; height: 414.6px;"><div class="red-ui-info-outline" style="height: 100%;"><div class="red-ui-sidebar-header red-ui-info-toolbar"><div class="red-ui-searchBox-container red-ui-searchBox-compact red-ui-searchBox-has-options"><i class="fa fa-search"></i><form class="red-ui-searchBox-form"><input type="text" data-i18n="[placeholder]menu.label.search" class="red-ui-searchBox-input" placeholder="查找流程"></form><a class="red-ui-searchBox-clear" href="http://192.168.50.1:1880/#"><i class="fa fa-times"></i></a><a class="red-ui-searchBox-opts" href="http://192.168.50.1:1880/#"><i class="fa fa-caret-down"></i></a><span class="red-ui-searchBox-resultCount hide"></span></div></div><div class="red-ui-treeList-label red-ui-info-outline-project" style="display: none;"><span class="red-ui-treeList-icon"><i class="fa fa-archive"></i></span><span></span></div><div class="red-ui-treeList" tabindex="0" style="width: 100%;"><div class="red-ui-treeList-container"><div class="red-ui-editableList" style="inset: 0px; position: absolute;"><div class="red-ui-editableList-border red-ui-editableList-container" style="inset: 0px; position: absolute; overflow-y: scroll;"><ol class="red-ui-treeList-list red-ui-editableList-list" style="position: static; inset: auto; min-height: 0px; height: auto;"><li><div class="red-ui-editableList-item-content expanded"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 0px;"></span><span class="red-ui-treeList-icon"><i class="fa fa-angle-right"></i></span><span class="red-ui-treeList-label-text">流程</span></div><div class="red-ui-editableList"><div class="red-ui-editableList-border red-ui-editableList-container"><ol class="red-ui-treeList-list red-ui-editableList-list" style="min-height: 0px; height: auto;"><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span class="red-ui-info-outline-gutter" style="position: absolute;"><button type="button" class="red-ui-info-outline-item-control-reveal red-ui-button red-ui-button-small"><i class="fa fa-search"></i></button></span><span style="display: inline-block; flex-shrink: 0; width: 22px;"></span><span class="red-ui-treeList-icon"><i class="fa fa-angle-right"></i></span><span class="red-ui-treeList-icon"><i class="red-ui-icons red-ui-icons-flow"></i></span><div class="red-ui-info-outline-item red-ui-info-outline-item-flow" style="width: calc(100% - 62px);"><div class="red-ui-search-result-description red-ui-info-outline-item-label">MQTT相关流程</div><div class="red-ui-info-outline-item-controls red-ui-info-outline-item-hover-controls"><button type="button" class="red-ui-info-outline-item-control-hide red-ui-button red-ui-button-small"><i class="fa fa-eye"></i><i class="fa fa-eye-slash"></i></button><button type="button" class="red-ui-info-outline-item-control-disable red-ui-button red-ui-button-small"><i class="fa fa-circle-thin"></i><i class="fa fa-ban"></i></button></div></div></div></div></li></ol></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 0px;"></span><span class="red-ui-treeList-icon"><i class="fa fa-angle-right"></i></span><span class="red-ui-treeList-label-text">子流程</span></div><div class="red-ui-editableList"><div class="red-ui-editableList-border red-ui-editableList-container"><ol class="red-ui-treeList-list red-ui-editableList-list" style="min-height: 0px; height: auto; display: none;"><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 20px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-info-outline-item red-ui-info-outline-item-empty" style="width: calc(100% - 40px);">空的</div></div></div></li></ol></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 0px;"></span><span class="red-ui-treeList-icon"><i class="fa fa-angle-right"></i></span><span class="red-ui-treeList-label-text">全局配置节点</span></div><div class="red-ui-editableList"><div class="red-ui-editableList-border red-ui-editableList-container"><ol class="red-ui-treeList-list red-ui-editableList-list" style="min-height: 0px; height: auto; display: none;"><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 20px;"></span><span class="red-ui-treeList-icon"><i class="fa fa-angle-right"></i></span><span class="red-ui-treeList-label-text">mqtt-broker</span></div><div class="red-ui-editableList"><div class="red-ui-editableList-border red-ui-editableList-container" style="max-height: none;"><ol class="red-ui-treeList-list red-ui-editableList-list" style="height: auto; display: none;"><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span class="red-ui-info-outline-gutter" style="position: absolute;"><button type="button" class="red-ui-info-outline-item-control-reveal red-ui-button red-ui-button-small"><i class="fa fa-search"></i></button></span><span style="display: inline-block; flex-shrink: 0; width: 42px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item red-ui-info-outline-item" style="width: calc(100% - 62px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(221, 221, 221); border-color: rgb(171, 171, 171);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/cog.svg&quot;);"></div></div><div class="red-ui-node-label red-ui-info-outline-item-label">bafa</div></span><div class="red-ui-info-outline-item-controls red-ui-info-outline-item-hover-controls"><button type="button" class="red-ui-info-outline-item-control-users red-ui-button red-ui-button-small">3</button><button type="button" class="red-ui-info-outline-item-control-disable red-ui-button red-ui-button-small"><i class="fa fa-circle-thin"></i><i class="fa fa-ban"></i></button></div></div></div></div></li></ol></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 20px;"></span><span class="red-ui-treeList-icon"><i class="fa fa-angle-right"></i></span><span class="red-ui-treeList-label-text">chronos-config</span></div><div class="red-ui-editableList"><div class="red-ui-editableList-border red-ui-editableList-container" style="max-height: none;"><ol class="red-ui-treeList-list red-ui-editableList-list" style="height: auto; display: none;"><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span class="red-ui-info-outline-gutter" style="position: absolute;"><button type="button" class="red-ui-info-outline-item-control-reveal red-ui-button red-ui-button-small"><i class="fa fa-search"></i></button></span><span style="display: inline-block; flex-shrink: 0; width: 42px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item red-ui-info-outline-item" style="width: calc(100% - 62px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(221, 221, 221); border-color: rgb(171, 171, 171);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/cog.svg&quot;);"></div></div><div class="red-ui-node-label red-ui-info-outline-item-label">home</div></span><div class="red-ui-info-outline-item-controls red-ui-info-outline-item-hover-controls"><button type="button" class="red-ui-info-outline-item-control-users red-ui-button red-ui-button-small">3</button><button type="button" class="red-ui-info-outline-item-control-disable red-ui-button red-ui-button-small"><i class="fa fa-circle-thin"></i><i class="fa fa-ban"></i></button></div></div></div></div></li></ol></div></div></div></li></ol></div></div></div></li></ol></div></div></div></div></div></div><div class="red-ui-panels-separator ui-draggable ui-draggable-handle" style="position: relative;"></div><div class="red-ui-panel" style="overflow: hidden; height: 100%; display: flex; flex-direction: column;"><div class="red-ui-palette-header red-ui-info-header" style="flex: 0 0 auto;"><span><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(253, 208, 162); border-color: rgb(203, 158, 112);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/function.svg&quot;);"></div></div></span></span><span>安装变动赋值</span><button class="red-ui-button red-ui-button-small" style="position: absolute; top: 12px; right: 32px;"><i class="fa fa-book"></i></button><button class="red-ui-button red-ui-button-small" style="position: absolute; top: 12px; right: 8px;"><i class="fa fa-search"></i></button></div><div style="flex: 1 1 auto; overflow-y: scroll;"><table class="red-ui-info-table"><tbody><tr class="red-ui-help-info-row"><td>节点</td><td><span class="red-ui-debug-msg-element red-ui-debug-msg-top-level"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-string red-ui-debug-msg-object-header">"d82819c0be1332d3"</span></span></span></span></td></tr><tr class="red-ui-help-info-row"><td>类型</td><td>function</td></tr><tr class="red-ui-help-property-expand blank"><td colspan="2"><a href="http://192.168.50.1:1880/#" class="node-info-property-header"><span class="red-ui-help-property-more">展开</span><span class="red-ui-help-property-less">收起</span> <i class="fa fa-caret-down"></i></a></td></tr><tr class="red-ui-help-info-property-row hide"><td>模组</td><td>node-red</td></tr><tr class="red-ui-help-info-property-row hide"><td>func</td><td><span class="red-ui-debug-msg-element red-ui-debug-msg-top-level collapsed"><span class="red-ui-debug-msg-row red-ui-debug-msg-expandable"><i class="fa fa-caret-right red-ui-debug-msg-object-handle"></i><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-string red-ui-debug-msg-object-header">"let daily_installs = msg.payload.all_listable_scripts[0].daily_installs;↵let total_installs = msg.payload.all_listable_scripts[0].total_installs;↵let fan_score = msg.payload.all_listable_scripts[0].fan_score;↵let good_ratings = msg.payload.all_listable_scripts[0].good_ratings;↵let ok_ratings = msg.payload.all_listable_scripts[0].ok_ratings;↵let bad_ratings = msg.payload.all_listable_scripts[0].bad_ratings;↵// .padStart(8,'0')↵let msgText = "总安装量:" + total_installs + "; 粉丝得分:"+ fan_score;↵msg.test = msgText.length↵msgText += "今日安装:" + daily_installs + " 评分:[G:"+ good_ratings + " M:" + ok_ratings + " B:" + bad_ratings + "]";↵msg.msgText = msgText;↵return msg;"</span></span></span></span></td></tr><tr class="red-ui-help-info-property-row hide"><td>outputs</td><td><span class="red-ui-debug-msg-element red-ui-debug-msg-top-level"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-number red-ui-debug-msg-type-number-toggle">1</span></span></span></span></td></tr><tr class="red-ui-help-info-property-row hide"><td>noerr</td><td><span class="red-ui-debug-msg-element red-ui-debug-msg-top-level"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-number red-ui-debug-msg-type-number-toggle">0</span></span></span></span></td></tr><tr class="red-ui-help-info-property-row hide"><td>initialize</td><td><span class="red-ui-debug-msg-element red-ui-debug-msg-top-level"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-string red-ui-debug-msg-object-header">""</span></span></span></span></td></tr><tr class="red-ui-help-info-property-row hide"><td>finalize</td><td><span class="red-ui-debug-msg-element red-ui-debug-msg-top-level"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-string red-ui-debug-msg-object-header">""</span></span></span></span></td></tr><tr class="red-ui-help-info-property-row hide"><td>libs</td><td><span class="red-ui-debug-msg-element red-ui-debug-msg-top-level collapsed"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-object-header"><span>[ </span><span class="red-ui-debug-msg-type-meta">empty</span><span> ]</span></span></span></span></span></td></tr></tbody></table><div style="padding: 0px 6px 6px;"><div class="red-ui-help"><span class="red-ui-text-bidi-aware" dir=""></span></div></div></div></div></div><div class="red-ui-help-tips"><div class="red-ui-help-tip" style=""><span class="help-key-block"><span class="help-key">⌘f</span></span> 可以在流程内搜索节点。</div><div class="red-ui-help-tips-buttons"><a href="http://192.168.50.1:1880/#" class="red-ui-footer-button"><i class="fa fa-refresh"></i></a><a href="http://192.168.50.1:1880/#" class="red-ui-footer-button"><i class="fa fa-times"></i></a></div></div></div></div><div style="height: 100%; display: none;"><div class="red-ui-sidebar-info"><div class="red-ui-sidebar-header red-ui-info-toolbar"><span class="button-group"><a id="red-ui-sidebar-help-show-toc" class="red-ui-button red-ui-button-small selected" href="http://192.168.50.1:1880/#"><i class="fa fa-list-ul"></i></a></span><div class="red-ui-searchBox-container red-ui-searchBox-compact"><i class="fa fa-search"></i><form class="red-ui-searchBox-form"><input type="text" data-i18n="[placeholder]sidebar.help.search" class="red-ui-searchBox-input" placeholder="搜索帮助"></form><a class="red-ui-searchBox-clear" href="http://192.168.50.1:1880/#"><i class="fa fa-times"></i></a><span class="red-ui-searchBox-resultCount hide"></span></div></div><div class="red-ui-sidebar-help-stack red-ui-panels" style="height: 810px;"><div class="red-ui-sidebar-help-toc red-ui-panel" style="height: 240.6px;"><div class="red-ui-treeList" tabindex="0" style="width: 100%;"><div class="red-ui-treeList-container"><div class="red-ui-editableList" style="inset: 0px; position: absolute;"><div class="red-ui-editableList-border red-ui-editableList-container" style="inset: 0px; position: absolute; overflow-y: scroll;"><ol class="red-ui-treeList-list red-ui-editableList-list" style="position: static; inset: auto; min-height: 0px; height: auto;"><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 0px;"></span><span class="red-ui-treeList-icon"></span><span class="red-ui-treeList-label-text">Node-RED v2.1.3</span></div></div></li><li><div class="red-ui-editableList-item-content expanded"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 0px;"></span><span class="red-ui-treeList-icon"><i class="fa fa-angle-right"></i></span><span class="red-ui-treeList-label-text">节点帮助</span></div><div class="red-ui-editableList"><div class="red-ui-editableList-border red-ui-editableList-container" style="max-height: none;"><ol class="red-ui-treeList-list red-ui-editableList-list" style="height: auto;"><li><div class="red-ui-editableList-item-content expanded"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 20px;"></span><span class="red-ui-treeList-icon"><i class="fa fa-angle-right"></i></span><span class="red-ui-treeList-icon"><i class="fa fa-cube"></i></span><span class="red-ui-treeList-label-text">node-red</span></div><div class="red-ui-editableList"><div class="red-ui-editableList-border red-ui-editableList-container" style="max-height: none;"><ol class="red-ui-treeList-list red-ui-editableList-list" style="height: auto;"><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(226, 217, 110); border-color: rgb(176, 167, 60);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/batch.svg&quot;);"></div></div><div class="red-ui-node-label">batch</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(228, 145, 145); border-color: rgb(178, 95, 95);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/alert.svg&quot;);"></div></div><div class="red-ui-node-label">catch</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(226, 217, 110); border-color: rgb(176, 167, 60);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/swap.svg&quot;);"></div></div><div class="red-ui-node-label">change</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(255, 255, 255); border-color: rgb(205, 205, 205);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/comment.svg&quot;);"></div></div><div class="red-ui-node-label">comment</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(192, 237, 192); border-color: rgb(142, 187, 142);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/alert.svg&quot;);"></div></div><div class="red-ui-node-label">complete</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(222, 189, 92); border-color: rgb(172, 139, 42);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/parser-csv.svg&quot;);"></div></div><div class="red-ui-node-label">csv</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(135, 169, 128); border-color: rgb(85, 119, 78);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/debug.svg&quot;);"></div></div><div class="red-ui-node-label">debug</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(230, 224, 248); border-color: rgb(180, 174, 198);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/timer.svg&quot;);"></div></div><div class="red-ui-node-label">delay</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: darksalmon;"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/cog.svg&quot;);"></div></div><div class="red-ui-node-label">exec</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: burlywood;"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/file-out.svg&quot;);"></div></div><div class="red-ui-node-label">file</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: burlywood;"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/file-in.svg&quot;);"></div></div><div class="red-ui-node-label">file in</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label selected"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(253, 208, 162); border-color: rgb(203, 158, 112);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/function.svg&quot;);"></div></div><div class="red-ui-node-label">function</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(222, 189, 92); border-color: rgb(172, 139, 42);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/parser-html.svg&quot;);"></div></div><div class="red-ui-node-label">html</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(231, 231, 174);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/white-globe.svg&quot;);"></div></div><div class="red-ui-node-label">http in</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(221, 221, 221); border-color: rgb(171, 171, 171);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/cog.svg&quot;);"></div></div><div class="red-ui-node-label">http proxy</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(231, 231, 174);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/white-globe.svg&quot;);"></div></div><div class="red-ui-node-label">http request</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(231, 231, 174);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/white-globe.svg&quot;);"></div></div><div class="red-ui-node-label">http response</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(166, 187, 207); border-color: rgb(116, 137, 157);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/inject.svg&quot;);"></div></div><div class="red-ui-node-label">inject</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(226, 217, 110); border-color: rgb(176, 167, 60);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/join.svg&quot;);"></div></div><div class="red-ui-node-label">join</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(222, 189, 92); border-color: rgb(172, 139, 42);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/parser-json.svg&quot;);"></div></div><div class="red-ui-node-label">json</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(221, 221, 221); border-color: rgb(171, 171, 171);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/link-out.svg&quot;);"></div></div><div class="red-ui-node-label">link in</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(221, 221, 221); border-color: rgb(171, 171, 171);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/link-out.svg&quot;);"></div></div><div class="red-ui-node-label">link out</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(216, 191, 216); border-color: rgb(166, 141, 166);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge.svg&quot;);"></div></div><div class="red-ui-node-label">mqtt in</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(216, 191, 216); border-color: rgb(166, 141, 166);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge.svg&quot;);"></div></div><div class="red-ui-node-label">mqtt out</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(221, 221, 221); border-color: rgb(171, 171, 171);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/cog.svg&quot;);"></div></div><div class="red-ui-node-label">mqtt-broker</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(226, 217, 110); border-color: rgb(176, 167, 60);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/range.svg&quot;);"></div></div><div class="red-ui-node-label">range</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(226, 217, 110); border-color: rgb(176, 167, 60);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/rbe.png&quot;);"></div></div><div class="red-ui-node-label">rbe</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(226, 217, 110); border-color: rgb(176, 167, 60);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/sort.svg&quot;);"></div></div><div class="red-ui-node-label">sort</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(226, 217, 110); border-color: rgb(176, 167, 60);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/split.svg&quot;);"></div></div><div class="red-ui-node-label">split</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(148, 193, 208); border-color: rgb(98, 143, 158);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/status.svg&quot;);"></div></div><div class="red-ui-node-label">status</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(226, 217, 110); border-color: rgb(176, 167, 60);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/switch.svg&quot;);"></div></div><div class="red-ui-node-label">switch</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(192, 192, 192);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge-dash.svg&quot;);"></div></div><div class="red-ui-node-label">tcp in</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(192, 192, 192);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge-dash.svg&quot;);"></div></div><div class="red-ui-node-label">tcp out</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(192, 192, 192);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge-dash.svg&quot;);"></div></div><div class="red-ui-node-label">tcp request</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(243, 181, 103);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/template.svg&quot;);"></div></div><div class="red-ui-node-label">template</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(221, 221, 221); border-color: rgb(171, 171, 171);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/cog.svg&quot;);"></div></div><div class="red-ui-node-label">tls-config</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(230, 224, 248); border-color: rgb(180, 174, 198);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/trigger.svg&quot;);"></div></div><div class="red-ui-node-label">trigger</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(192, 192, 192);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge-dash.svg&quot;);"></div></div><div class="red-ui-node-label">udp in</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(192, 192, 192);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/bridge-dash.svg&quot;);"></div></div><div class="red-ui-node-label">udp out</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(255, 240, 240); border-color: rgb(205, 190, 190);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/alert.svg&quot;);"></div></div><div class="red-ui-node-label">unknown</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: burlywood;"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/watch.svg&quot;);"></div></div><div class="red-ui-node-label">watch</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(215, 215, 160);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/white-globe.svg&quot;);"></div></div><div class="red-ui-node-label">websocket in</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(215, 215, 160);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/white-globe.svg&quot;);"></div></div><div class="red-ui-node-label">websocket out</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(221, 221, 221); border-color: rgb(171, 171, 171);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/cog.svg&quot;);"></div></div><div class="red-ui-node-label">websocket-client</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(221, 221, 221); border-color: rgb(171, 171, 171);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/cog.svg&quot;);"></div></div><div class="red-ui-node-label">websocket-listener</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(222, 189, 92); border-color: rgb(172, 139, 42);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/parser-xml.svg&quot;);"></div></div><div class="red-ui-node-label">xml</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(222, 189, 92); border-color: rgb(172, 139, 42);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/parser-yaml.svg&quot;);"></div></div><div class="red-ui-node-label">yaml</div></span></div></div></div></li></ol></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 20px;"></span><span class="red-ui-treeList-icon"><i class="fa fa-angle-right"></i></span><span class="red-ui-treeList-icon"><i class="fa fa-cube"></i></span><span class="red-ui-treeList-label-text">node-red-contrib-chronos</span></div><div class="red-ui-editableList"><div class="red-ui-editableList-border red-ui-editableList-container" style="max-height: none;"><ol class="red-ui-treeList-list red-ui-editableList-list" style="height: auto; display: none;"><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(222, 184, 135); border-color: rgb(172, 134, 85);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red-contrib-chronos/chronos_change.svg&quot;);"></div></div><div class="red-ui-node-label">chronos-change</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(221, 221, 221); border-color: rgb(171, 171, 171);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red/cog.svg&quot;);"></div></div><div class="red-ui-node-label">chronos-config</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(222, 184, 135); border-color: rgb(172, 134, 85);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red-contrib-chronos/chronos_delay.svg&quot;);"></div></div><div class="red-ui-node-label">chronos-delay</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(222, 184, 135); border-color: rgb(172, 134, 85);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red-contrib-chronos/chronos_filter.svg&quot;);"></div></div><div class="red-ui-node-label">chronos-filter</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(222, 184, 135); border-color: rgb(172, 134, 85);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red-contrib-chronos/chronos_repeat.svg&quot;);"></div></div><div class="red-ui-node-label">chronos-repeat</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(222, 184, 135); border-color: rgb(172, 134, 85);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red-contrib-chronos/chronos_scheduler.svg&quot;);"></div></div><div class="red-ui-node-label">chronos-scheduler</div></span></div></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label"><span style="display: inline-block; flex-shrink: 0; width: 40px;"></span><span class="red-ui-treeList-icon"></span><div class="red-ui-node-list-item" style="width: calc(100% - 60px);"><span class="red-ui-node-icon-container"><div class="red-ui-node-icon" style="background-color: rgb(222, 184, 135); border-color: rgb(172, 134, 85);"><div class="red-ui-palette-icon" style="background-image: url(&quot;icons/node-red-contrib-chronos/chronos_switch.svg&quot;);"></div></div><div class="red-ui-node-label">chronos-switch</div></span></div></div></div></li></ol></div></div></div></li></ol></div></div></div></li></ol></div></div></div></div></div><div class="red-ui-panels-separator ui-draggable ui-draggable-handle" style="position: relative;"></div><div class="red-ui-panel" style="overflow-y: scroll;"><div class="red-ui-help" style="padding: 6px;"><h1 class="red-ui-help-title">function</h1><div class="red-ui-help"><span class="red-ui-text-bidi-aware" dir="">
    <p>定义对接收到的消息进行处理的JavaScript代码（函数的主体）。</p>
    <p>输入消息在名为<code>msg</code>的JavaScript对象中传递。</p>
    <p>通常，<code>msg</code>对象将消息正文保留在<code>msg.payload</code>属性中。</p>
    <p>该函数一般会返回一个消息对象（或多个消息对象），但也可以为了停止流而什么都不返回。</p>
    <h3><a class="red-ui-help-info-header expanded" href="http://192.168.50.1:1880/#"><i class="fa fa-angle-right"></i>详细</a></h3>
    <p>请参见<a target="_blank" href="http://nodered.org/docs/writing-functions.html">在线文档</a>来获得更多有关编写函数的信息。</p>
    <h4>传送消息</h4>
    <p>要将消息传递到流中的下一个节点，请返回消息或调用<code>node.send(messages)</code>。</p>
    <p>它将返回/send:</p>
    <ul>
      <li>单个消息对象 - 传递给连接到第一个输出的节点</li>
      <li>消息对象数组，传递给连接到相应输出的节点</li>
    </ul>
    <p>如果数组元素是数组，则将多个消息发送到相应的输出。</p>
    <p>无论return方法是单个值还是数组元素，如果返回值为null，则不会发送任何消息。</p>
    <h4>日志输出和错误处理</h4>
    <p>使用以下功能输出日志信息和输出错误：</p>
      <ul>
          <li><code>node.log("Log message")</code></li>
          <li><code>node.warn("Warning")</code></li>
          <li><code>node.error("Error")</code></li>
      </ul>
    <p></p>
    <p>使用catch节点可以进行错误处理。 要由catch节点处理，请将<code>msg</code>作为<code>node.error</code>的第二个参数传递：</p>
    <pre>node.error("Error",msg);</pre>
    <h4>访问节点信息</h4>
    <p>您可以使用以下属性来在代码中引用节点ID和名称：</p>
    <ul>
        <li><code>node.id</code> - 节点的ID</li>
        <li><code>node.name</code> - 节点的名称</li>
    </ul>
    <h4>使用环境变量</h4>
    <p>环境变量可以通过<code>env.get("MY_ENV_VAR")</code>来进行访问。</p>
</span></div></div></div></div></div></div><div style="height: 100%; display: none;"><div class="red-ui-sidebar-node-config" id="red-ui-sidebar-node-config" tabindex="0"><div class="red-ui-sidebar-header"><span class="button-group"><a class="red-ui-sidebar-header-button-toggle selected" id="red-ui-sidebar-config-filter-all" href="http://192.168.50.1:1880/#"><span data-i18n="sidebar.config.filterAll">所有</span></a><a class="red-ui-sidebar-header-button-toggle" id="red-ui-sidebar-config-filter-unused" href="http://192.168.50.1:1880/#"><span data-i18n="sidebar.config.filterUnused">未使用</span></a> </span></div><div><div class="red-ui-palette-category red-ui-sidebar-config-category" id="red-ui-sidebar-config-category-global"><div class="red-ui-sidebar-config-tray-header red-ui-palette-header"><i class="fa fa-angle-down expanded"></i><span class="red-ui-palette-node-config-label" data-i18n="sidebar.config.global">所有流程</span><span class="red-ui-sidebar-node-config-filter-info" style="display: none;"></span></div><ul class="red-ui-palette-content red-ui-sidebar-node-config-list" style=""><li class="red-ui-palette-node-config-type">chronos-config</li><li class="red-ui-palette-node_id_b3fc41e36bf2418f"><div class="red-ui-palette-node-config red-ui-palette-node"><div class="red-ui-palette-label">home</div><div class="red-ui-palette-icon-container red-ui-palette-icon-container-right"><a href="http://192.168.50.1:1880/#">3</a></div></div></li><li class="red-ui-palette-node-config-type">mqtt-broker</li><li class="red-ui-palette-node_id_72308c18d15026fd"><div class="red-ui-palette-node-config red-ui-palette-node"><div class="red-ui-palette-label">bafa</div><div class="red-ui-palette-icon-container red-ui-palette-icon-container-right"><a href="http://192.168.50.1:1880/#">3</a></div></div></li></ul></div></div><div><div class="red-ui-palette-category red-ui-sidebar-config-category" id="red-ui-sidebar-config-category-0217ee1fba23525d"><div class="red-ui-sidebar-config-tray-header red-ui-palette-header"><i class="fa fa-angle-down"></i><span class="red-ui-palette-node-config-label">MQTT相关流程</span><span class="red-ui-sidebar-node-config-filter-info" style="display: none;"></span></div><ul class="red-ui-palette-content red-ui-sidebar-node-config-list" style="display: none;"><li class="red-ui-palette-node-config-none" data-i18n="sidebar.config.none">无</li></ul></div></div><div></div></div><div class="red-ui-sidebar-shade hide" style="display: block;"></div></div><div style="height: 100%; display: none;"><div style="position: relative; height: 100%;"><div class="red-ui-sidebar-context-stack red-ui-stack"><div class="red-ui-palette-category expanded"><div class="red-ui-palette-header"><i class="fa fa-angle-down expanded"></i><span>节点</span><div style="float: right"><input type="checkbox" style="display: none;"><button type="button" class="red-ui-toggleButton red-ui-sidebar-header-button red-ui-button-small toggle single"><i class="fa fa-square-o"></i></button><button class="red-ui-button red-ui-button-small" style="margin-left: 5px"><i class="fa fa-refresh"></i></button></div></div><div style="position: relative;"><div style="height: 100%;"><div class="red-ui-sidebar-context-updated">&nbsp;</div><table class="red-ui-info-table"><tbody><tr class="red-ui-help-info-row red-ui-search-empty blank" colspan="2"><td data-i18n="sidebar.context.refresh">刷新以加载</td></tr></tbody></table></div></div></div><div class="red-ui-palette-category expanded"><div class="red-ui-palette-header"><i class="fa fa-angle-down expanded"></i><span>流程</span><div style="float: right"><input type="checkbox" style="display: none;"><button type="button" class="red-ui-toggleButton red-ui-sidebar-header-button red-ui-button-small toggle single"><i class="fa fa-square-o"></i></button><button class="red-ui-button red-ui-button-small" style="margin-left: 5px"><i class="fa fa-refresh"></i></button></div></div><div style="position: relative;"><div style="height: 100%;"><div class="red-ui-sidebar-context-updated">&nbsp;</div><table class="red-ui-info-table"><tbody><tr class="red-ui-help-info-row red-ui-search-empty blank" colspan="2"><td data-i18n="sidebar.context.refresh">刷新以加载</td></tr></tbody></table></div></div></div><div class="red-ui-palette-category expanded"><div class="red-ui-palette-header"><i class="fa fa-angle-down expanded"></i><span>全局</span><div style="float: right"><button class="red-ui-button red-ui-button-small"><i class="fa fa-refresh"></i></button></div></div><div style="position: relative;"><div style="height: 100%;"><div class="red-ui-sidebar-context-updated">&nbsp;</div><table class="red-ui-info-table"><tbody><tr class="red-ui-help-info-row red-ui-search-empty blank" colspan="2"><td data-i18n="sidebar.context.refresh">刷新以加载</td></tr></tbody></table></div></div></div></div></div></div><div style="height: 100%;"><div style="position: relative; height: 100%;"><div class="red-ui-sidebar-header"><span class="button-group"><a id="red-ui-sidebar-debug-filter" style="padding-right: 5px" class="red-ui-sidebar-header-button" href="http://192.168.50.1:1880/#"><i class="fa fa-filter"></i> <span>所有节点</span> <i style="padding-left: 5px;" class="fa fa-caret-down"></i></a></span><span class="button-group"><a id="red-ui-sidebar-debug-clear" style="border-right: none; padding-right: 6px" class="red-ui-sidebar-header-button" href="http://192.168.50.1:1880/#" data-clear-type="all"><i class="fa fa-trash"></i> <span>all</span></a><a id="red-ui-sidebar-debug-clear-opts" style="padding: 5px; border-left: none;" class="red-ui-sidebar-header-button" href="http://192.168.50.1:1880/#"><i class="fa fa-caret-down"></i></a></span><div class="red-ui-debug-filter-box hide"><div style="margin-bottom: 3px; display: flex;"><span style="flex-grow:1; text-align: left;"><span class="button-group"><button type="button" id="red-ui-sidebar-filter-select-all" class="red-ui-sidebar-header-button red-ui-button-small" data-i18n="node-red:debug.sidebar.selectAll">select all</button></span><span class="button-group"><button type="button" id="red-ui-sidebar-filter-select-none" class="red-ui-sidebar-header-button red-ui-button-small" data-i18n="node-red:debug.sidebar.selectNone">select none</button></span></span><span class="button-group"><button type="button" id="red-ui-sidebar-filter-select-close" class="red-ui-sidebar-header-button red-ui-button-small"><i class="fa fa-times"></i></button></span></div><div class="red-ui-debug-filter-row" id="red-ui-sidebar-debug-filter-node-list-row"><div class="red-ui-treeList" tabindex="0" style="width: 100%; height: 300px;"><div class="red-ui-treeList-container"><div class="red-ui-editableList" style="inset: 0px; position: absolute;"><div class="red-ui-editableList-border red-ui-editableList-container" style="inset: 0px; position: absolute; overflow-y: scroll;"><ol class="red-ui-treeList-list red-ui-editableList-list" style="position: static; inset: auto; min-height: 0px; height: auto;"><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label selected"><span style="display: inline-block; flex-shrink: 0; width: 0px;"></span><span class="red-ui-treeList-icon"><i class="fa fa-angle-right"></i></span><span class="red-ui-treeList-icon"><input class="red-ui-treeList-checkbox" type="checkbox"></span><span class="red-ui-treeList-label-text">MQTT相关流程</span></div><div class="red-ui-editableList"><div class="red-ui-editableList-border red-ui-editableList-container" style="max-height: none;"><ol class="red-ui-treeList-list red-ui-editableList-list" style="height: auto; display: none;"><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label selected"><span style="display: inline-block; flex-shrink: 0; width: 20px;"></span><span class="red-ui-treeList-icon"></span><span class="red-ui-treeList-icon"><input class="red-ui-treeList-checkbox" type="checkbox"></span><span class="red-ui-treeList-label-text">msg ⇲</span></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label selected"><span style="display: inline-block; flex-shrink: 0; width: 20px;"></span><span class="red-ui-treeList-icon"></span><span class="red-ui-treeList-icon"><input class="red-ui-treeList-checkbox" type="checkbox"></span><span class="red-ui-treeList-label-text">msg ⇲</span></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label selected"><span style="display: inline-block; flex-shrink: 0; width: 20px;"></span><span class="red-ui-treeList-icon"></span><span class="red-ui-treeList-icon"><input class="red-ui-treeList-checkbox" type="checkbox"></span><span class="red-ui-treeList-label-text">msg.payload ⇲</span></div></div></li><li><div class="red-ui-editableList-item-content"><div class="red-ui-treeList-label selected"><span style="display: inline-block; flex-shrink: 0; width: 20px;"></span><span class="red-ui-treeList-icon"></span><span class="red-ui-treeList-icon"><input class="red-ui-treeList-checkbox" type="checkbox"></span><span class="red-ui-treeList-label-text">msg.payload ⇲</span></div></div></li></ol></div></div></div></li></ol></div></div></div></div></div></div></div><div class="red-ui-debug-content red-ui-debug-content-list"><div class="red-ui-debug-msg red-ui-debug-msg-node-3a56205bcba4c99b red-ui-debug-msg-flow-0217ee1fba23525d"><div class="red-ui-debug-msg-meta"><span class="red-ui-debug-msg-date">2022/2/15 14:37:47</span><a href="http://192.168.50.1:1880/#" class="red-ui-debug-msg-name">node: 3a56205bcba4c99b</a><span class="red-ui-debug-msg-tools button-group"><button class="red-ui-button red-ui-button-small"><i class="fa fa-caret-down"></i></button></span><span class="red-ui-debug-msg-topic">msg : Object</span></div><span class="red-ui-debug-msg-payload"><span class="red-ui-debug-msg-element red-ui-debug-msg-top-level built"><span class="red-ui-debug-msg-row red-ui-debug-msg-expandable"><i class="fa fa-caret-right red-ui-debug-msg-object-handle"></i><span class="red-ui-debug-msg-tools"><span class="red-ui-debug-msg-tools-copy button-group"><button class="red-ui-button red-ui-button-small"><i class="fa fa-clipboard"></i></button></span></span><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-object-header"><span>{ </span><span class="red-ui-debug-msg-object-key">_msgid</span><span>: </span><span class="red-ui-debug-msg-object-value red-ui-debug-msg-type-string">"e4e3a4bf4e94abde"</span><span>, </span><span class="red-ui-debug-msg-object-key">payload</span><span>: </span><span class="red-ui-debug-msg-object-value red-ui-debug-msg-type-meta">object</span><span>, </span><span class="red-ui-debug-msg-object-key">topic</span><span>: </span><span class="red-ui-debug-msg-object-value red-ui-debug-msg-type-string">""</span><span>, </span><span class="red-ui-debug-msg-object-key">statusCode</span><span>: </span><span class="red-ui-debug-msg-object-value red-ui-debug-msg-type-number">200</span><span>, </span><span class="red-ui-debug-msg-object-key">headers</span><span>: </span><span class="red-ui-debug-msg-object-value red-ui-debug-msg-type-meta">object</span><span> …</span><span> }</span></span></span><span class="red-ui-debug-msg-type-meta red-ui-debug-msg-object-type-header">object</span></span><div class="red-ui-debug-msg-object-entry collapsed"><span class="red-ui-debug-msg-element"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-tools"><span class="red-ui-debug-msg-tools-copy button-group"><button class="red-ui-button red-ui-button-small"><i class="fa fa-terminal"></i></button><button class="red-ui-button red-ui-button-small"><i class="fa fa-clipboard"></i></button></span><button class="red-ui-button red-ui-button-small red-ui-debug-msg-tools-pin"><i class="fa fa-map-pin"></i></button></span><span class="red-ui-debug-msg-object-key">_msgid</span><span>: </span><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-string red-ui-debug-msg-object-header">"e4e3a4bf4e94abde"</span></span></span></span></div><div class="red-ui-debug-msg-object-entry collapsed"><span class="red-ui-debug-msg-element collapsed"><span class="red-ui-debug-msg-row red-ui-debug-msg-expandable"><i class="fa fa-caret-right red-ui-debug-msg-object-handle"></i><span class="red-ui-debug-msg-tools"><span class="red-ui-debug-msg-tools-copy button-group"><button class="red-ui-button red-ui-button-small"><i class="fa fa-terminal"></i></button><button class="red-ui-button red-ui-button-small"><i class="fa fa-clipboard"></i></button></span><button class="red-ui-button red-ui-button-small red-ui-debug-msg-tools-pin"><i class="fa fa-map-pin"></i></button></span><span class="red-ui-debug-msg-object-key">payload</span><span>: </span><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-meta">object</span></span></span></span></div><div class="red-ui-debug-msg-object-entry collapsed"><span class="red-ui-debug-msg-element"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-tools"><span class="red-ui-debug-msg-tools-copy button-group"><button class="red-ui-button red-ui-button-small"><i class="fa fa-terminal"></i></button><button class="red-ui-button red-ui-button-small"><i class="fa fa-clipboard"></i></button></span><button class="red-ui-button red-ui-button-small red-ui-debug-msg-tools-pin"><i class="fa fa-map-pin"></i></button></span><span class="red-ui-debug-msg-object-key">topic</span><span>: </span><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-string red-ui-debug-msg-object-header">""</span></span></span></span></div><div class="red-ui-debug-msg-object-entry collapsed"><span class="red-ui-debug-msg-element"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-tools"><span class="red-ui-debug-msg-tools-copy button-group"><button class="red-ui-button red-ui-button-small"><i class="fa fa-terminal"></i></button><button class="red-ui-button red-ui-button-small"><i class="fa fa-clipboard"></i></button></span><button class="red-ui-button red-ui-button-small red-ui-debug-msg-tools-pin"><i class="fa fa-map-pin"></i></button></span><span class="red-ui-debug-msg-object-key">statusCode</span><span>: </span><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-number red-ui-debug-msg-type-number-toggle">200</span></span></span></span></div><div class="red-ui-debug-msg-object-entry collapsed"><span class="red-ui-debug-msg-element collapsed"><span class="red-ui-debug-msg-row red-ui-debug-msg-expandable"><i class="fa fa-caret-right red-ui-debug-msg-object-handle"></i><span class="red-ui-debug-msg-tools"><span class="red-ui-debug-msg-tools-copy button-group"><button class="red-ui-button red-ui-button-small"><i class="fa fa-terminal"></i></button><button class="red-ui-button red-ui-button-small"><i class="fa fa-clipboard"></i></button></span><button class="red-ui-button red-ui-button-small red-ui-debug-msg-tools-pin"><i class="fa fa-map-pin"></i></button></span><span class="red-ui-debug-msg-object-key">headers</span><span>: </span><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-meta">object</span></span></span></span></div><div class="red-ui-debug-msg-object-entry collapsed"><span class="red-ui-debug-msg-element"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-tools"><span class="red-ui-debug-msg-tools-copy button-group"><button class="red-ui-button red-ui-button-small"><i class="fa fa-terminal"></i></button><button class="red-ui-button red-ui-button-small"><i class="fa fa-clipboard"></i></button></span><button class="red-ui-button red-ui-button-small red-ui-debug-msg-tools-pin"><i class="fa fa-map-pin"></i></button></span><span class="red-ui-debug-msg-object-key">responseUrl</span><span>: </span><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-string red-ui-debug-msg-object-header">"https://greasyfork.org/zh-CN/users/874768-freefitter.json"</span></span></span></span></div><div class="red-ui-debug-msg-object-entry collapsed"><span class="red-ui-debug-msg-element collapsed"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-tools"><span class="red-ui-debug-msg-tools-copy button-group"><button class="red-ui-button red-ui-button-small"><i class="fa fa-terminal"></i></button><button class="red-ui-button red-ui-button-small"><i class="fa fa-clipboard"></i></button></span><button class="red-ui-button red-ui-button-small red-ui-debug-msg-tools-pin"><i class="fa fa-map-pin"></i></button></span><span class="red-ui-debug-msg-object-key">redirectList</span><span>: </span><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-meta">array[0]</span></span></span></span></div><div class="red-ui-debug-msg-object-entry collapsed"><span class="red-ui-debug-msg-element"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-tools"><span class="red-ui-debug-msg-tools-copy button-group"><button class="red-ui-button red-ui-button-small"><i class="fa fa-terminal"></i></button><button class="red-ui-button red-ui-button-small"><i class="fa fa-clipboard"></i></button></span><button class="red-ui-button red-ui-button-small red-ui-debug-msg-tools-pin"><i class="fa fa-map-pin"></i></button></span><span class="red-ui-debug-msg-object-key">retry</span><span>: </span><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-number red-ui-debug-msg-type-number-toggle">0</span></span></span></span></div><div class="red-ui-debug-msg-object-entry collapsed"><span class="red-ui-debug-msg-element"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-tools"><span class="red-ui-debug-msg-tools-copy button-group"><button class="red-ui-button red-ui-button-small"><i class="fa fa-terminal"></i></button><button class="red-ui-button red-ui-button-small"><i class="fa fa-clipboard"></i></button></span><button class="red-ui-button red-ui-button-small red-ui-debug-msg-tools-pin"><i class="fa fa-map-pin"></i></button></span><span class="red-ui-debug-msg-object-key">test</span><span>: </span><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-number red-ui-debug-msg-type-number-toggle">17</span></span></span></span></div><div class="red-ui-debug-msg-object-entry collapsed"><span class="red-ui-debug-msg-element"><span class="red-ui-debug-msg-row"><span class="red-ui-debug-msg-tools"><span class="red-ui-debug-msg-tools-copy button-group"><button class="red-ui-button red-ui-button-small"><i class="fa fa-terminal"></i></button><button class="red-ui-button red-ui-button-small"><i class="fa fa-clipboard"></i></button></span><button class="red-ui-button red-ui-button-small red-ui-debug-msg-tools-pin"><i class="fa fa-map-pin"></i></button></span><span class="red-ui-debug-msg-object-key">msgText</span><span>: </span><span class="red-ui-debug-msg-object-value"><span class="red-ui-debug-msg-type-string red-ui-debug-msg-object-header">"总安装量:14; 粉丝得分:5.0今日安装:14 评分:[G:0 M:0 B:0]"</span></span></span></span></div></span></span></div></div><div class="red-ui-debug-content  red-ui-debug-content-table hide"></div></div></div></div><div id="red-ui-sidebar-footer" class="red-ui-component-footer"><div style="display: none;"><a class="red-ui-footer-button" id="red-ui-sidebar-config-collapse-all" href="http://192.168.50.1:1880/#"><i class="fa fa-angle-double-up"></i></a> <a class="red-ui-footer-button" id="red-ui-sidebar-config-expand-all" href="http://192.168.50.1:1880/#"><i class="fa fa-angle-double-down"></i></a></div><div style="display: none;"></div><div style=""><span class="button-group"><a id="red-ui-sidebar-debug-open" class="red-ui-footer-button" href="http://192.168.50.1:1880/#"><i class="fa fa-desktop"></i></a></span> </div></div><div id="red-ui-sidebar-shade" class="hide" style="display: none;"></div></div><div id="red-ui-sidebar-separator" class="ui-draggable ui-draggable-handle"><div class="red-ui-sidebar-control-right" style="display: none;"><i class="fa fa-chevron-right" <="" div=""></i></div></div><div id="red-ui-loading-progress" style="display: none;"><div><div class="red-ui-loading-bar-label"></div><div class="red-ui-loading-bar"><span style="width: 0%;"></span></div></div></div></div><div id="red-ui-editor-plugin-configs"><div></div></div><div id="red-ui-editor-node-configs"><script type="text/x-red" data-template-name="_eventLog"><div class="form-row node-text-editor-row"><div style="height: 100%;min-height: 150px;" class="node-text-editor" id="red-ui-event-log-editor"></div></div></script><script type="text/x-red" data-template-name="subflow"><div class="form-row"><label for="node-input-name" data-i18n="[append]editor:common.label.name"><i class="fa fa-tag"></i> </label><input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name"></div><div id="subflow-input-ui"></div></script><script type="text/x-red" data-template-name="subflow-template"><div class="form-row"><label for="subflow-input-name" data-i18n="[append]common.label.name"><i class="fa fa-tag"></i>  </label><input type="text" id="subflow-input-name" data-i18n="[placeholder]common.label.name"></div><div class="form-row"><ul style="margin-bottom: 20px;" id="subflow-env-tabs"></ul></div><div id="subflow-env-tabs-content"><div id="subflow-env-tab-edit"><div class="form-row node-input-env-container-row" id="subflow-input-edit-ui"><ol id="node-input-env-container"></ol><div class="node-input-env-locales-row"><i class="fa fa-language"></i> <select id="subflow-input-env-locale"></select></div></div></div><div id="subflow-env-tab-preview"><div id="subflow-input-ui"/></div></div></script><script type="text/x-red" data-template-name="group"><div class="form-row"><label for="node-input-name" data-i18n="[append]editor:common.label.name"><i class="fa fa-tag"></i> </label><input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name"></div><div class="form-row" id="node-input-row-style-stroke"><label data-i18n="editor:common.label.style"></label><label style="width: 70px;margin-right:10px" for="node-input-style-stroke" data-i18n="editor:common.label.line"></label></div><div class="form-row" style="padding-left: 100px;" id="node-input-row-style-fill"><label style="width: 70px;margin-right: 10px "  for="node-input-style-fill" data-i18n="editor:common.label.fill"></label></div><div class="form-row"><label for="node-input-style-label" data-i18n="editor:common.label.label"></label><input type="checkbox" id="node-input-style-label"/></div><div class="form-row" id="node-input-row-style-label-options"><div style="margin-left: 100px; display: inline-block"><div class="form-row"><span style="display: inline-block; min-width: 140px"  id="node-input-row-style-label-color"><label style="width: 70px;margin-right: 10px" for="node-input-style-fill" data-i18n="editor:common.label.color"></label></span></div><div class="form-row"><span style="display: inline-block; min-width: 140px;" id="node-input-row-style-label-position"><label style="width: 70px;margin-right: 10px " for="node-input-style-label-position" data-i18n="editor:common.label.position"></label></span></div></div></div></script><div><!-- --- [red-module:node-red/inject] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="inject">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>

    <div class="form-row node-input-property-container-row">
        <ol id="node-input-property-container"></ol>
    </div>

    <div class="form-row" id="node-once">
        <label for="node-input-once">&nbsp;</label>
        <input type="checkbox" id="node-input-once" style="display:inline-block; width:15px; vertical-align:baseline;">
        <span data-i18n="inject.onstart"></span>&nbsp;
        <input type="text" id="node-input-onceDelay" placeholder="0.1" style="width:45px; height:28px;">&nbsp;
        <span data-i18n="inject.onceDelay"></span>
    </div>

    <div class="form-row">
        <label for=""><i class="fa fa-repeat"></i> <span data-i18n="inject.label.repeat"></span></label>
        <select id="inject-time-type-select">
            <option value="none" data-i18n="inject.none"></option>
            <option value="interval" data-i18n="inject.interval"></option>
            <option value="interval-time" data-i18n="inject.interval-time"></option>
            <option value="time" data-i18n="inject.time"></option>
        </select>
        <input type="hidden" id="node-input-repeat">
        <input type="hidden" id="node-input-crontab">
    </div>

    <div class="form-row inject-time-row hidden" id="inject-time-row-interval">
        <span data-i18n="inject.every"></span>
        <input id="inject-time-interval-count" class="inject-time-count" value="1"></input>
        <select style="width:100px" id="inject-time-interval-units">
            <option value="s" data-i18n="inject.seconds"></option>
            <option value="m" data-i18n="inject.minutes"></option>
            <option value="h" data-i18n="inject.hours"></option>
        </select><br/>
    </div>

    <div class="form-row inject-time-row hidden" id="inject-time-row-interval-time">
        <span data-i18n="inject.every"></span> <select style="width:90px; margin-left:20px;" id="inject-time-interval-time-units" class="inject-time-int-count" value="1">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="10">10</option>
            <option value="12">12</option>
            <option value="15">15</option>
            <option value="20">20</option>
            <option value="30">30</option>
            <option value="0">60</option>
        </select> <span data-i18n="inject.minutes"></span><br/>
        <span data-i18n="inject.between"></span> <select id="inject-time-interval-time-start" class="inject-time-times"></select>
        <span data-i18n="inject.and"></span> <select id="inject-time-interval-time-end" class="inject-time-times"></select><br/>
        <div id="inject-time-interval-time-days" class="inject-time-days" style="margin-top:5px">
            <div style="display:inline-block; vertical-align:top; margin-right:5px;" data-i18n="inject.on">on</div>
            <div style="display:inline-block;">
                <div>
                    <label><input type='checkbox' checked value='1'/> <span data-i18n="inject.days.0"></span></label>
                    <label><input type='checkbox' checked value='2'/> <span data-i18n="inject.days.1"></span></label>
                    <label><input type='checkbox' checked value='3'/> <span data-i18n="inject.days.2"></span></label>
                </div>
                <div>
                    <label><input type='checkbox' checked value='4'/> <span data-i18n="inject.days.3"></span></label>
                    <label><input type='checkbox' checked value='5'/> <span data-i18n="inject.days.4"></span></label>
                    <label><input type='checkbox' checked value='6'/> <span data-i18n="inject.days.5"></span></label>
                </div>
                <div>
                    <label><input type='checkbox' checked value='0'/> <span data-i18n="inject.days.6"></span></label>
                </div>
            </div>
        </div>
    </div>

    <div class="form-row inject-time-row hidden" id="inject-time-row-time">
        <span data-i18n="inject.at"></span> <input type="text" id="inject-time-time" value="12:00"></input><br/>
        <div id="inject-time-time-days" class="inject-time-days">
            <div style="display:inline-block; vertical-align:top; margin-right:5px;" data-i18n="inject.on"></div>
            <div style="display:inline-block;">
                <div>
                    <label><input type='checkbox' checked value='1'/> <span data-i18n="inject.days.0"></span></label>
                    <label><input type='checkbox' checked value='2'/> <span data-i18n="inject.days.1"></span></label>
                    <label><input type='checkbox' checked value='3'/> <span data-i18n="inject.days.2"></span></label>
                </div>
                <div>
                    <label><input type='checkbox' checked value='4'/> <span data-i18n="inject.days.3"></span></label>
                    <label><input type='checkbox' checked value='5'/> <span data-i18n="inject.days.4"></span></label>
                    <label><input type='checkbox' checked value='6'/> <span data-i18n="inject.days.5"></span></label>
                </div>
                <div>
                    <label><input type='checkbox' checked value='0'/> <span data-i18n="inject.days.6"></span></label>
                </div>
            </div>
        </div>
    </div>

</script>
<style>
    .inject-time-row {
        padding-left: 110px;
    }
    .inject-time-row select {
        margin: 3px 0;
    }
    .inject-time-days label {
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        vertical-align: baseline;
        width: 100px;
    }
    .inject-time-days input {
        width: auto !important;
        vertical-align: baseline !important;
    }
    .inject-time-times {
        width: 90px !important;
    }
    #inject-time-time {
        width: 75px;
        margin-left: 8px;
        margin-bottom: 8px;
    }
    .inject-time-count {
        padding-left: 3px !important;
        width: 80px !important;
    }
</style>

<script type="text/javascript">
(function() {

    function resizeDialog(size) {
        size = size || { height: $(".red-ui-tray-content form").height() }
        var rows = $("#dialog-form>div:not(.node-input-property-container-row):visible");
        var height = size.height;
        for (var i=0; i<rows.length; i++) {
            height -= $(rows[i]).outerHeight(true);
        }
        var editorRow = $("#dialog-form>div.node-input-property-container-row");
        height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
        height += 16;
        $("#node-input-property-container").editableList('height',height);
    }
    /** Retrieve editableList items (refactored for re-use in the form inject button)*/
    function getProps(el, legacy) {
        var result = {
            props: []
        }
        el.each(function(i) {
            var prop = $(this);
            var p = {
                p:prop.find(".node-input-prop-property-name").typedInput('value')
            };
            if (p.p) {
                p.v = prop.find(".node-input-prop-property-value").typedInput('value');
                p.vt = prop.find(".node-input-prop-property-value").typedInput('type');
                if(legacy) {
                    if (p.p === "payload") { // save payload to old "legacy" property
                        result.payloadType = p.vt;
                        result.payload = p.v;
                        delete p.v;
                        delete p.vt;
                    } else if (p.p === "topic" && p.vt === "str") {
                        result.topic = p.v;
                        delete p.v;
                    }
                }
                result.props.push(p);
            }
        });
        return result;
    }
    /** Perform inject, optionally sending a custom msg (refactored for re-use in the form inject button)*/
    function doInject(node, customMsg) {
        var label = node._def.label.call(node,customMsg?customMsg.__user_inject_props__:undefined);
        if (label.length > 30) {
            label = label.substring(0, 50) + "...";
        }
        label = label.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        $.ajax({
            url: "inject/" + node.id,
            type: "POST",
            data: JSON.stringify(customMsg||{}),
            contentType: "application/json; charset=utf-8",
            success: function (resp) {
                RED.notify(node._("inject.success", { label: label }), { type: "success", id: "inject", timeout: 2000 });
            },
            error: function (jqXHR, textStatus, errorThrown) {
                if (jqXHR.status == 404) {
                    RED.notify(node._("common.notification.error", { message: node._("common.notification.errors.not-deployed") }), "error");
                } else if (jqXHR.status == 500) {
                    RED.notify(node._("common.notification.error", { message: node._("inject.errors.failed") }), "error");
                } else if (jqXHR.status == 0) {
                    RED.notify(node._("common.notification.error", { message: node._("common.notification.errors.no-response") }), "error");
                } else {
                    RED.notify(node._("common.notification.error", { message: node._("common.notification.errors.unexpected", { status: jqXHR.status, message: textStatus }) }), "error");
                }
            }
        });
    }
    RED.nodes.registerType('inject',{  
        category: 'common',
        color:"#a6bbcf",
        defaults: {
            name: {value:""},
            props:{value:[{p:"payload"},{p:"topic",vt:"str"}], validate:function(v) {
                    if (!v || v.length === 0) { return true }
                    for (var i=0;i<v.length;i++) {
                        if (/msg|flow|global/.test(v[i].vt)) {
                            if (!RED.utils.validatePropertyExpression(v[i].v)) {
                                return false;
                            }
                        } else if (v[i].vt === "jsonata") {
                            try{jsonata(v[i].v);}catch(e){return false;}
                        } else if ([i].vt === "json") {
                            try{JSON.parse(v[i].v);}catch(e){return false;}
                        }
                    }
                    return true;
                }
            },
            repeat: {value:"", validate:function(v) { return ((v === "") || (RED.validators.number(v) && (v >= 0) && (v <= 2147483))) }},
            crontab: {value:""},
            once: {value:false},
            onceDelay: {value:0.1},
            topic: {value:""},
            payload: {value:"", validate: RED.validators.typedInput("payloadType")},
            payloadType: {value:"date"},
        },
        icon: "inject.svg",
        inputs:0,
        outputs:1,
        outputLabels: function(index) {
            var lab = '';

            // if only payload and topic - display payload type
            // if only one property - show it's type
            // if more than one property (other than payload and topic) - show "x properties" where x is the number of properties.
            // this.props will not be an array for legacy inject nodes until they are re-deployed
            //
            var props = this.props;
            if (!Array.isArray(props)) {
                props = [
                    { p:"payload", v: this.payload, vt: this.payloadType },
                    { p:"topic", v: this.topic, vt: "str" }
                ]
            }
            if (props) {
                for (var i=0,l=props.length; i<l; i++) {
                    if (i > 0) lab += "\n";
                    if (i === 5) {
                        lab += "... +"+(props.length-5);
                        break;
                    }
                    lab += props[i].p+": ";

                    var propType = props[i].p === "payload"? this.payloadType : props[i].vt;
                    if (propType === "json") {
                        try {
                            var parsedProp = JSON.parse(props[i].p === "payload"? this.payload : props[i].v);
                            propType = typeof parsedProp;
                            if (propType === "object" && Array.isArray(parsedProp)) {
                                propType = "Array";
                            }
                        } catch(e) {
                            propType = "invalid";
                        }
                    }
                    lab += this._("inject.label."+propType);
                }
            }
            return lab;
        },
        label: function(customProps) {
            var suffix = "";
            // if fire once then add small indication
            if (this.once) {
                suffix = " ¹";
            }
            // but replace with repeat one if set to repeat
            if ((this.repeat && this.repeat != 0) || this.crontab) {
                suffix = " ↻";
            }
            if (this.name) {
                return this.name+suffix;
            }
            var payload = "";
            var payloadType = "str";
            var topic = "";
            if (customProps) {
                for (var i=0;i<customProps.length;i++) {
                    if (customProps[i].p === "payload") {
                        payload = customProps[i].v;
                        payloadType = customProps[i].vt;
                    } else if (customProps[i].p === "topic") {
                        topic = customProps[i].v;
                    }
                }
            } else {
                payload = this.payload || "";
                payloadType = this.payloadType || "str";
                topic = this.topic || "";
            }
            if (payloadType === "string" ||
                    payloadType === "str" ||
                    payloadType === "num" ||
                    payloadType === "bool" ||
                    payloadType === "json") {
                if ((topic !== "") && ((topic.length + payload.length) <= 32)) {
                    return topic + ":" + payload+suffix;
                } else if (payload.length > 0 && payload.length < 24) {
                    return payload+suffix;
                } else {
                    return this._("inject.inject")+suffix;
                }
            } else if (payloadType === 'date' || payloadType === 'bin' || payloadType === 'env') {
                if ((topic !== "") && (topic.length <= 16)) {
                    return topic + ":" + this._('inject.label.'+payloadType)+suffix;
                } else {
                    return this._('inject.label.'+payloadType)+suffix;
                }
            } else if (payloadType === 'flow' || payloadType === 'global') {
                var key = RED.utils.parseContextKey(payload);
                return payloadType+"."+key.key+suffix;
            } else {
                return this._("inject.inject")+suffix;
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;
            if (node.payloadType == null) {
                if (node.payload == "") {
                    node.payloadType = "date";
                } else {
                    node.payloadType = "str";
                }
            } else if (node.payloadType === 'string' || node.payloadType === 'none') {
                node.payloadType = "str";
            }

            $("#inject-time-type-select").on("change", function() {
                $("#node-input-crontab").val('');
                var id = $("#inject-time-type-select").val();
                $(".inject-time-row").hide();
                $("#inject-time-row-"+id).show();
                if ((id == "none") || (id == "interval") || (id == "interval-time")) {
                    $("#node-once").show();
                }
                else {
                    $("#node-once").hide();
                    $("#node-input-once").prop('checked', false);
                }

                // Scroll down
                var scrollDiv = $("#dialog-form").parent();
                scrollDiv.scrollTop(scrollDiv.prop('scrollHeight'));
                resizeDialog();
            });

            $("#node-input-once").on("change", function() {
                $("#node-input-onceDelay").attr('disabled', !$("#node-input-once").prop('checked'));
            })

            $(".inject-time-times").each(function() {
                for (var i=0; i<24; i++) {
                    var l = (i<10?"0":"")+i+":00";
                    $(this).append($("<option></option>").val(i).text(l));
                }
            });
            $("<option></option>").val(24).text("00:00").appendTo("#inject-time-interval-time-end");
            $("#inject-time-interval-time-start").on("change", function() {
                var start = Number($("#inject-time-interval-time-start").val());
                var end = Number($("#inject-time-interval-time-end").val());
                $("#inject-time-interval-time-end option").remove();
                for (var i=start+1; i<25; i++) {
                    var l = (i<10?"0":"")+i+":00";
                    if (i==24) {
                        l = "00:00";
                    }
                    var opt = $("<option></option>").val(i).text(l).appendTo("#inject-time-interval-time-end");
                    if (i === end) {
                        opt.attr("selected","selected");
                    }
                }
            });

            $(".inject-time-count").spinner({
                //max:60,
                min:1
            });

            var repeattype = "none";
            if (node.repeat != "" && node.repeat != 0) {
                repeattype = "interval";
                var r = "s";
                var c = node.repeat;
                if (node.repeat % 60 === 0) { r = "m"; c = c/60; }
                if (node.repeat % 1440 === 0) { r = "h"; c = c/60; }
                $("#inject-time-interval-count").val(c);
                $("#inject-time-interval-units").val(r);
                $("#inject-time-interval-days").prop("disabled","disabled");
            } else if (node.crontab) {
                var cronparts = node.crontab.split(" ");
                var days = cronparts[4];
                if (!isNaN(cronparts[0]) && !isNaN(cronparts[1])) {
                    repeattype = "time";
                    // Fixed time
                    var time = cronparts[1]+":"+cronparts[0];
                    $("#inject-time-time").val(time);
                    $("#inject-time-type-select").val("s");
                    if (days == "*") {
                        $("#inject-time-time-days input[type=checkbox]").prop("checked",true);
                    } else {
                        $("#inject-time-time-days input[type=checkbox]").removeAttr("checked");
                        days.split(",").forEach(function(v) {
                            $("#inject-time-time-days [value=" + v + "]").prop("checked", true);
                        });
                    }
                } else {
                    repeattype = "interval-time";
                    // interval - time period
                    var minutes = cronparts[0].slice(2);
                    if (minutes === "") { minutes = "0"; }
                    $("#inject-time-interval-time-units").val(minutes);
                    if (days == "*") {
                        $("#inject-time-interval-time-days input[type=checkbox]").prop("checked",true);
                    } else {
                        $("#inject-time-interval-time-days input[type=checkbox]").removeAttr("checked");
                        days.split(",").forEach(function(v) {
                            $("#inject-time-interval-time-days [value=" + v + "]").prop("checked", true);
                        });
                    }
                    var time = cronparts[1];
                    var timeparts = time.split(",");
                    var start;
                    var end;
                    if (timeparts.length == 1) {
                        // 0 or 0-10
                        var hours = timeparts[0].split("-");
                        if (hours.length == 1) {
                            if (hours[0] === "") {
                                start = "0";
                                end = "0";
                            }
                            else {
                                start = hours[0];
                                end = Number(hours[0])+1;
                            }
                        } else {
                            start = hours[0];
                            end = Number(hours[1])+1;
                        }
                    } else {
                        // 23,0 or 17-23,0-10 or 23,0-2 or 17-23,0
                        var startparts = timeparts[0].split("-");
                        start = startparts[0];

                        var endparts = timeparts[1].split("-");
                        if (endparts.length == 1) {
                            end = Number(endparts[0])+1;
                        } else {
                            end = Number(endparts[1])+1;
                        }
                    }
                    $("#inject-time-interval-time-end").val(end);
                    $("#inject-time-interval-time-start").val(start);

                }
            } else {
                $("#inject-time-type-select").val("none");
            }

            $(".inject-time-row").hide();
            $("#inject-time-type-select").val(repeattype);
            $("#inject-time-row-"+repeattype).show();

            /* */

            var eList = $('#node-input-property-container').css('min-height','120px').css('min-width','450px');

            eList.editableList({
                buttons: [
                    {
                        id: "node-inject-test-inject-button",
                        label: node._("inject.injectNow"),
                        click: function(e) {
                            var items = eList.editableList('items');
                            var props = getProps(items);
                            var m = {__user_inject_props__: props.props};
                            doInject(node, m);
                        }
                    }
                ],
                addItem: function(container,i,opt) {
                    var prop = opt;
                    if (!prop.hasOwnProperty('p')) {
                        prop = {p:"",v:"",vt:"str"};
                    }
                    container.css({
                        overflow: 'hidden',
                        whiteSpace: 'nowrap'
                    });
                    var row = $('<div/>').appendTo(container);

                    var propertyName = $('<input/>',{class:"node-input-prop-property-name",type:"text"})
                        .css("width","30%")
                        .appendTo(row)
                        .typedInput({types:['msg']});

                    $('<div/>',{style: 'display:inline-block; padding:0px 6px;'})
                        .text('=')
                        .appendTo(row);

                    var propertyValue = $('<input/>',{class:"node-input-prop-property-value",type:"text"})
                        .css("width","calc(70% - 30px)")
                        .appendTo(row)
                        .typedInput({default:prop.vt || 'str',types:['flow','global','str','num','bool','json','bin','date','jsonata','env','msg']});

                    propertyName.typedInput('value',prop.p);
                    propertyValue.typedInput('value',prop.v);
                },
                removable: true,
                sortable: true
            });
            $('#node-inject-test-inject-button').css("float", "right").css("margin-right", "unset");

            if (RED.nodes.subflow(node.z)) {
                $('#node-inject-test-inject-button').attr("disabled",true);
            }

            if (!node.props) {
                var payload = {
                    p:'payload',
                    v: node.payload ? node.payload : '',
                    vt:node.payloadType ? node.payloadType : 'date'
                };
                var topic = {
                    p:'topic',
                    v: node.topic ? node.topic : '',
                    vt:'str'
                }
                node.props = [payload,topic];
            }

            for (var i=0; i<node.props.length; i++) {
                var prop = node.props[i];
                var newProp = { p: prop.p, v: prop.v, vt: prop.vt };
                if (newProp.v === undefined) {
                    if (prop.p === 'payload') {
                        newProp.v = node.payload ? node.payload : '';
                        newProp.vt = node.payloadType ? node.payloadType : 'date';
                    } else if (prop.p === 'topic' && prop.vt === "str") {
                        newProp.v =  node.topic ? node.topic : '';
                    }
                }
                if (newProp.vt === "string") {
                    // Fix bug in pre 2.1 where an old Inject node might have
                    // a migrated rule with type 'string' not 'str'
                    newProp.vt = "str";
                }
                eList.editableList('addItem',newProp);
            }

            $("#inject-time-type-select").trigger("change");
            $("#inject-time-interval-time-start").trigger("change");

        },
        oneditsave: function() {
            var repeat = "";
            var crontab = "";
            var type = $("#inject-time-type-select").val();
            if (type == "none") {
                // nothing
            } else if (type == "interval") {
                var count = $("#inject-time-interval-count").val();
                var units = $("#inject-time-interval-units").val();
                if (units == "s") {
                    repeat = count;
                } else {
                    if (units == "m") {
                        //crontab = "*/"+count+" * * * "+days;
                        repeat = count * 60;
                    } else if (units == "h") {
                        //crontab = "0 */"+count+" * * "+days;
                        repeat = count * 60 * 60;
                    }
                }
            } else if (type == "interval-time") {
                repeat = "";
                var count = $("#inject-time-interval-time-units").val();
                var startTime = Number($("#inject-time-interval-time-start").val());
                var endTime = Number($("#inject-time-interval-time-end").val());
                var days = $('#inject-time-interval-time-days input[type=checkbox]:checked').map(function(_, el) {
                    return $(el).val()
                }).get();
                if (days.length == 0) {
                    crontab = "";
                } else {
                    if (days.length == 7) {
                        days="*";
                    } else {
                        days = days.join(",");
                    }
                    var timerange = "";
                    if (endTime == 0) {
                        timerange = startTime+"-23";
                    } else if (startTime+1 < endTime) {
                        timerange = startTime+"-"+(endTime-1);
                    } else if (startTime+1 == endTime) {
                        timerange = startTime;
                    } else {
                        var startpart = "";
                        var endpart = "";
                        if (startTime == 23) {
                            startpart = "23";
                        } else {
                            startpart = startTime+"-23";
                        }
                        if (endTime == 1) {
                            endpart = "0";
                        } else {
                            endpart = "0-"+(endTime-1);
                        }
                        timerange = startpart+","+endpart;
                    }
                    if (count === "0") {
                        crontab = count+" "+timerange+" * * "+days;
                    } else {
                        crontab = "*/"+count+" "+timerange+" * * "+days;
                    }
                }
            } else if (type == "time") {
                var time = $("#inject-time-time").val();
                var days = $('#inject-time-time-days  input[type=checkbox]:checked').map(function(_, el) {
                    return $(el).val()
                }).get();
                if (days.length == 0) {
                    crontab = "";
                } else {
                    if (days.length == 7) {
                        days="*";
                    } else {
                        days = days.join(",");
                    }
                    var parts = time.split(":");
                    if (parts.length === 2) {
                        repeat = "";
                        parts[1] = ("00" + (parseInt(parts[1]) % 60)).substr(-2);
                        parts[0] = ("00" + (parseInt(parts[0]) % 24)).substr(-2);
                        crontab = parts[1]+" "+parts[0]+" * * "+days;
                    }
                    else { crontab = ""; }
                }
            }

            $("#node-input-repeat").val(repeat);
            $("#node-input-crontab").val(crontab);

            /* Gather the properties */
            var items = $("#node-input-property-container").editableList('items');
            delete this.payloadType;
            delete this.payload;
            this.topic = "";
            var result = getProps(items, true);
            this.props = result.props;
            if(result.payloadType) { this.payloadType = result.payloadType; };
            if(result.payload) { this.payload = result.payload; };
            if(result.topic) { this.topic = result.topic; };
        },
        button: {
            enabled: function() {
                return !this.changed
            },
            onclick: function () {
                if (this.changed) {
                    return RED.notify(RED._("notification.warning", { message: RED._("notification.warnings.undeployedChanges") }), "warning");
                }
                doInject(this);
            }
        },
        oneditresize: resizeDialog
    });
})();
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="inject">
<p>手动或定期得将消息注入流中。消息的有效荷载可以为多种类型，包括字符串，JavaScript对象或当前时间。</p>
<h3>输出</h3>
<dl class="message-properties">
    <dt>payload<span class="property-type">various</span></dt>
    <dd>指定的消息的有效荷载。</dd>
    <dt class="optional">topic <span class="property-type">字符串</span></dt>
    <dd>可以在节点中配置的可选属性。</dd>
</dl>
<h3>详细</h3>
<p>通过使用特定的有效荷载，注入节点可以启动流。默认有效荷载是当前时间的时间戳（以毫秒为单位，自1970年1月1日起）。</p>
<p>该节点还支持注入字符串，数字，布尔值，JavaScript对象或流/全局上下文值。</p>
<p>默认情况下，节点可以通过在编辑器中单击节点按钮来手动触发。同时也可以被设置为定期或按计划注入。</p>
<p>另一个可选的设置是在每次启动流时注入一次。</p>
<p>可以指定的最大<i>间隔</i>约为596小时/24天。 但是，如果对于间隔超过一天的那些间隔，建议您使用scheduler节点来应对断电或重启。</p>
<p><b>注意</b>：选项<i>“时间间隔” </i>和<i>“特定时间” </i>使用了标准cron系统。这意味着因此“20分钟”并不表示在此之后20分钟，而是每小时的20分钟，40分钟。如果您希望设定为从现在开始的每20分钟，那么请使用<i>“间隔” </i>选项。</p>
<p><b>注意</b>: 如果您想在字符串中包含换行符，必须使用“功能”节点创建有效荷载。</p>
</script>

</div><script src="./Node-RED _ 192.168.50.1_files/debug-utils.js"></script><div><!-- --- [red-module:node-red/debug] --- -->

<script type="text/html" data-template-name="debug">
    <div class="form-row">
        <label for="node-input-typed-complete"><i class="fa fa-list"></i> <span data-i18n="debug.output"></span></label>
        <input id="node-input-typed-complete" type="text" style="width: 70%">
        <input id="node-input-complete" type="hidden">
        <input id="node-input-targetType" type="hidden">
    </div>
    <div class="form-row">
        <label for="node-input-tosidebar"><i class="fa fa-random"></i> <span data-i18n="debug.to"></span></label>
        <label for="node-input-tosidebar" style="width:70%">
        <input type="checkbox" id="node-input-tosidebar" style="display:inline-block; width:22px; vertical-align:top;"><span data-i18n="debug.toSidebar"></span>
        </label>
    </div>
    <div class="form-row">
        <label for="node-input-console"> </label>
        <label for="node-input-console" style="width:70%">
        <input type="checkbox" id="node-input-console" style="display:inline-block; width:22px; vertical-align:top;"><span data-i18n="debug.toConsole"></span>
        </label>
    </div>
    <div class="form-row">
    <label for="node-input-tostatus"> </label>
    <label for="node-input-tostatus" style="width:70%">
        <input type="checkbox" id="node-input-tostatus" style="display:inline-block; width:22px; vertical-align:top;"><span data-i18n="debug.toStatus"></span>
    </label>
    </div>
    <div class="form-row" id="node-tostatus-line">
        <label for="node-input-typed-status"></label>
        <input id="node-input-typed-status" type="text" style="width: 70%">
        <input id="node-input-statusVal" type="hidden">
        <input id="node-input-statusType" type="hidden">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>



<script type="text/javascript">
(function() {
    var subWindow = null;

    function activateAjaxCall(node, active, successCallback) {
        var url;
        var body;

        if (Array.isArray(node)) {
            url = "debug/"+(active?"enable":"disable");
            body = {nodes: node.map(function(n) { return n.id})}
            node = node[0];
        } else {
            url = "debug/"+node.id+"/"+(active?"enable":"disable");
        }
        $.ajax({
            url: url,
            type: "POST",
            data: body,
            success: successCallback,
            error: function(jqXHR,textStatus,errorThrown) {
                if (jqXHR.status == 404) {
                    RED.notify(node._("common.notification.error", {message: node._("common.notification.errors.not-deployed")}),"error");
                } else if (jqXHR.status === 0) {
                    RED.notify(node._("common.notification.error", {message: node._("common.notification.errors.no-response")}),"error");
                } else {
                    // TODO where is the err.status comming from?
                    RED.notify(node._("common.notification.error",{message:node._("common.notification.errors.unexpected",{status:err.status,message:err.response})}),"error");
                }
            }
        });
    }

    RED.nodes.registerType('debug',{
        category: 'common',
        defaults: {
            name: {value:""},
            active: {value:true},
            tosidebar: {value:true},
            console: {value:false},
            tostatus: {value:false},
            complete: {value:"false", required:true},
            targetType: {value:undefined},
            statusVal: {value:""},
            statusType: {value:"auto"}
        },
        label: function() {
            var suffix = "";
            if (this.console === true || this.console === "true") { suffix = " ⇲"; }
            if (this.targetType === "jsonata") {
                return (this.name || "JSONata") + suffix;
            }
            if (this.complete === true || this.complete === "true") {
                return (this.name||"msg") + suffix;
            } else {
                return (this.name || "msg." + ((!this.complete || this.complete === "false") ? "payload" : this.complete)) + suffix;
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        color:"#87a980",
        inputs:1,
        outputs:0,
        icon: "debug.svg",
        align: "right",
        button: {
            toggle: "active",
            visible: function() { return this.tosidebar; },
            onclick: function() {
                var label = RED.utils.sanitize(this.name||"debug");
                var node = this;
                activateAjaxCall(node, node.active, function(resp, textStatus, xhr) {
                    var historyEvent = {
                        t:'edit',
                        node:node,
                        changes:{
                            active:!node.active
                        },
                        dirty:node.dirty,
                        changed:node.changed,
                        callback: function(ev) {
                            activateAjaxCall(ev.node, ev.node.active);
                        }
                    };
                    node.changed = true;
                    node.dirty = true;
                    RED.nodes.dirty(true);
                    RED.history.push(historyEvent);
                    RED.view.redraw();
                    if (xhr.status == 200) {
                        RED.notify(node._("debug.notification.activated",{label:label}),{type: "success", timeout: 2000});
                    } else if (xhr.status == 201) {
                        RED.notify(node._("debug.notification.deactivated",{label:label}),{type: "success", timeout: 2000});
                    }
                });
            }
        },
        onpaletteadd: function() {
            var options = {
                messageMouseEnter: function(sourceId) {
                    if (sourceId) {
                        var n = RED.nodes.node(sourceId);
                        if (n) {
                            n.highlighted = true;
                            n.dirty = true;
                        }
                        RED.view.redraw();
                    }
                },
                messageMouseLeave: function(sourceId) {
                    if (sourceId) {
                        var n = RED.nodes.node(sourceId);
                        if (n) {
                            n.highlighted = false;
                            n.dirty = true;
                        }
                        RED.view.redraw();
                    }
                },
                messageSourceClick: function(sourceId, aliasId, path) {
                    // Get all of the nodes that could have logged this message
                    var candidateNodes = [RED.nodes.node(sourceId)]
                    if (path) {
                        for (var i=2;i<path.length;i++) {
                            candidateNodes.push(RED.nodes.node(path[i]))
                        }
                    }
                    if (aliasId) {
                        candidateNodes.push(RED.nodes.node(aliasId));
                    }
                    if (candidateNodes.length > 1) {
                        // The node is in a subflow. Check to see if the active
                        // workspace is a subflow in the node's parentage. If
                        // so, reveal the relevant subflow instance node.
                        var ws = RED.workspaces.active();
                        for (var i=0;i<candidateNodes.length;i++) {
                            if (candidateNodes[i].z === ws) {
                                RED.view.reveal(candidateNodes[i].id);
                                return
                            }
                        }
                        // The active workspace is unrelated to the node. So
                        // fall back to revealing the top most node
                    }
                    RED.view.reveal(candidateNodes[0].id);
                },
                clear: function() {
                    RED.nodes.eachNode(function(node) {
                        node.highlighted = false;
                        node.dirty = true;
                    });
                    RED.view.redraw();
                }
            };

            var uiComponents = RED.debug.init(options);

            RED.sidebar.addTab({
                id: "debug",
                label: this._("debug.sidebar.label"),
                name: this._("debug.sidebar.name"),
                content: uiComponents.content,
                toolbar: uiComponents.footer,
                enableOnEdit: true,
                pinned: true,
                iconClass: "fa fa-bug",
                action: "core:show-debug-tab"
            });
            RED.actions.add("core:show-debug-tab",function() { RED.sidebar.show('debug'); });

            var that = this;
            RED._debug = function(msg) {
                that.handleDebugMessage("", {
                    name:"debug",
                    msg:msg
                });
            };

            this.refreshMessageList = function() {
                RED.debug.refreshMessageList(RED.workspaces.active());
                if (subWindow) {
                    try {
                        subWindow.postMessage({event:"workspaceChange",activeWorkspace:RED.workspaces.active()},"*");
                    } catch(err) {
                        console.log(err);
                    }
                }
            };
            RED.events.on("workspace:change", this.refreshMessageList);

            this.handleDebugMessage = function(t,o) {
                // console.log("->",o.id,o.z,o._alias);
                //
                // sourceNode should be the top-level node - one that is on a flow.
                var sourceNode;
                var pathParts;
                if (o.path) {
                    // Path is a `/`-separated list of ids that identifies the
                    // complete parentage of the node that generated this message.
                    //    flow-id/subflow-A-instance/subflow-A-type/subflow-B-instance/subflow-B-type/node-id

                    // If it has one id, that is a top level flow
                    // each subsequent id is the instance id of a subflow node
                    //
                    pathParts = o.path.split("/");
                    if (pathParts.length === 1) {
                        // The source node is on a flow - so can use its id to find
                        sourceNode = RED.nodes.node(o.id);
                    } else if (pathParts.length > 1) {
                        // Highlight the subflow instance node.
                        sourceNode = RED.nodes.node(pathParts[1]);
                    }
                } else {
                    // This is probably redundant...
                    sourceNode = RED.nodes.node(o.id) || RED.nodes.node(o.z);
                }
                if (sourceNode) {
                    o._source = {
                        id:sourceNode.id,
                        z:sourceNode.z,
                        name:sourceNode.name,
                        type:sourceNode.type,
                        // _alias identifies the actual logging node. This is
                        // not necessarily the same as sourceNode, which will be
                        // the top-level subflow instance node.
                        // This means the node's name is displayed in the sidebar.
                        _alias:o._alias,
                        path: pathParts
                    };
                }
                RED.debug.handleDebugMessage(o);
                if (subWindow) {
                    try {
                        subWindow.postMessage({event:"message",msg:o},"*");
                    } catch(err) {
                        console.log(err);
                    }
                }
            };
            RED.comms.subscribe("debug",this.handleDebugMessage);

            this.clearMessageList = function() {
                RED.debug.clearMessageList(true);
                if (subWindow) {
                    try {
                        subWindow.postMessage({event:"projectChange"},"*");
                    } catch(err) {
                        console.log(err);
                    }
                }
            };
            RED.events.on("project:change", this.clearMessageList);
            RED.actions.add("core:clear-debug-messages", function() { RED.debug.clearMessageList(true) });
            RED.actions.add("core:clear-filtered-debug-messages", function() { RED.debug.clearMessageList(true, true) });

            RED.actions.add("core:activate-selected-debug-nodes", function() { setDebugNodeState(getSelectedDebugNodes(true), true); });
            RED.actions.add("core:activate-all-debug-nodes", function() { setDebugNodeState(getMatchingDebugNodes(true, true),true); });
            RED.actions.add("core:activate-all-flow-debug-nodes", function() { setDebugNodeState(getMatchingDebugNodes(true, false),true); });

            RED.actions.add("core:deactivate-selected-debug-nodes", function() { setDebugNodeState(getSelectedDebugNodes(false), false); });
            RED.actions.add("core:deactivate-all-debug-nodes", function() { setDebugNodeState(getMatchingDebugNodes(false, true),false); });
            RED.actions.add("core:deactivate-all-flow-debug-nodes", function() { setDebugNodeState(getMatchingDebugNodes(false, false),false); });

            function getSelectedDebugNodes(state) {
                var nodes = [];
                var selection = RED.view.selection();
                if (selection.nodes) {
                    selection.nodes.forEach(function(n) {
                        if (RED.nodes.subflow(n.z)) {
                            return;
                        }
                        if (n.type === 'debug' && n.active !== state) {
                            nodes.push(n);
                        } else if (n.type === 'group') {
                            nodes = nodes.concat( RED.group.getNodes(n,true).filter(function(n) {
                                return n.type === 'debug' && n.active !== state
                            }));
                        }
                    });
                }
                return nodes;

            }
            function getMatchingDebugNodes(state,globally) {
                var nodes = [];
                var filter = {type:"debug"};
                if (!globally) {
                    filter.z = RED.workspaces.active();
                }
                var candidateNodes = RED.nodes.filterNodes(filter);
                nodes = candidateNodes.filter(function(n) {
                    return n.active !== state && !RED.nodes.subflow(n.z)
                })
                return nodes;
            }

            function setDebugNodeState(nodes,state) {
                var historyEvents = [];
                if (nodes.length > 0) {
                    activateAjaxCall(nodes,false, function(resp, textStatus, xhr) {
                        nodes.forEach(function(n) {
                            historyEvents.push({
                                t: "edit",
                                node: n,
                                changed: n.changed,
                                changes: {
                                    active: n.active
                                }
                            });
                            n.active = state;
                            n.changed = true;
                            n.dirty = true;
                        })
                        RED.history.push({
                            t: "multi",
                            events: historyEvents,
                            dirty: RED.nodes.dirty(),
                            callback: function() {
                                activateAjaxCall(nodes,nodes[0].active);
                            }
                        });
                        RED.nodes.dirty(true);
                        RED.view.redraw();
                    });
                }
            }

            $("#red-ui-sidebar-debug-open").on("click", function(e) {
                e.preventDefault();
                subWindow = window.open(document.location.toString().replace(/[?#].*$/,"")+"debug/view/view.html"+document.location.search,"nodeREDDebugView","menubar=no,location=no,toolbar=no,chrome,height=500,width=600");
                subWindow.onload = function() {
                    subWindow.postMessage({event:"workspaceChange",activeWorkspace:RED.workspaces.active()},"*");
                };
            });
            RED.popover.tooltip($("#red-ui-sidebar-debug-open"),RED._('node-red:debug.sidebar.openWindow'));



            $(window).on('beforeunload',function() {
                if (subWindow) {
                    try {
                        subWindow.close();
                    } catch(err) {
                        console.log(err);
                    }
                }
            });

            this.handleWindowMessage = function(evt) {
                var msg = evt.data;
                if (msg.event === "mouseEnter") {
                    options.messageMouseEnter(msg.id);
                } else if (msg.event === "mouseLeave") {
                    options.messageMouseLeave(msg.id);
                } else if (msg.event === "mouseClick") {
                    options.messageSourceClick(msg.id,msg._alias,msg.path);
                } else if (msg.event === "clear") {
                    options.clear();
                }
            };
            window.addEventListener('message',this.handleWindowMessage);
        },
        onpaletteremove: function() {
            RED.comms.unsubscribe("debug",this.handleDebugMessage);
            RED.sidebar.removeTab("debug");
            RED.events.off("workspace:change", this.refreshMessageList);
            window.removeEventListener("message",this.handleWindowMessage);
            RED.actions.remove("core:show-debug-tab");
            RED.actions.remove("core:clear-debug-messages");
            delete RED._debug;
        },
        oneditprepare: function() {
            var autoType = {
                value: "auto",
                label: RED._("node-red:debug.autostatus"),
                hasValue: false
            };
            $("#node-input-typed-status").typedInput({
                default: "auto",
                types:[autoType, "msg", "jsonata"],
                typeField: $("#node-input-statusType")
            });
            var that = this;
            var none = {
                value: "none",
                label: RED._("node-red:debug.none"),
                hasValue: false
            };
            if (this.tosidebar === undefined) {
                this.tosidebar = true;
                $("#node-input-tosidebar").prop('checked', true);
            }
            if (this.statusVal === undefined) {
                this.statusVal = (this.complete === "false") ? "payload" : ((this.complete === "true") ? "payload" : this.complete+"");
                $("#node-input-typed-status").typedInput('value',this.statusVal || "");
            }
            if (this.statusType === undefined) {
                this.statusType = "auto";
                $("#node-input-typed-status").typedInput('type',this.statusType || "auto");
            }
            if (typeof this.console === "string") {
                this.console = (this.console == 'true');
                $("#node-input-console").prop('checked', this.console);
                $("#node-input-tosidebar").prop('checked', true);
            }
            var fullType = {
                value: "full",
                label: RED._("node-red:debug.msgobj"),
                hasValue: false
            };

            $("#node-input-typed-complete").typedInput({
                default: "msg",
                types:['msg', fullType, "jsonata"],
                typeField: $("#node-input-targetType")
            });
            if (this.targetType === "jsonata") {
                var property = this.complete || "";
                $("#node-input-typed-complete").typedInput('type','jsonata');
                $("#node-input-typed-complete").typedInput('value',property);
            } else if ((this.targetType === "full") || this.complete === "true" || this.complete === true) {
                // show complete message object
                $("#node-input-typed-complete").typedInput('type','full');
            } else {
                var property = (!this.complete||(this.complete === "false")) ? "payload" : this.complete+"";
                $("#node-input-typed-complete").typedInput('type','msg');
                $("#node-input-typed-complete").typedInput('value',property);
            }
            $("#node-input-typed-complete").on('change',function() {
                if ($("#node-input-typed-complete").typedInput('type') === 'msg' &&
                    $("#node-input-typed-complete").typedInput('value') === ''
                ) {
                    $("#node-input-typed-complete").typedInput('value','payload');
                }
            });

            $("#node-input-tostatus").on('change',function() {
                if ($(this).is(":checked")) {
                    if (!that.hasOwnProperty("statusVal") || that.statusVal === "") {
                        var type = $("#node-input-typed-complete").typedInput('type');
                        var comp = "payload";
                        if (type !== 'full') {
                            comp = $("#node-input-typed-complete").typedInput('value');
                        }
                        that.statusType = "auto";
                        that.statusVal = comp;
                    }
                    $("#node-input-typed-status").typedInput('type',that.statusType);
                    $("#node-input-typed-status").typedInput('value',that.statusVal);
                    $("#node-tostatus-line").show();
                }
                else {
                    $("#node-tostatus-line").hide();
                    that.statusType = "auto";
                    that.statusVal = "";
                    $("#node-input-typed-status").typedInput('type',that.statusType);
                    $("#node-input-typed-status").typedInput('value',that.statusVal);
                }
            });
        },
        oneditsave: function() {
            var type = $("#node-input-typed-complete").typedInput('type');
            if (type === 'full') {
                $("#node-input-complete").val("true");
            } else {
                $("#node-input-complete").val($("#node-input-typed-complete").typedInput('value'));
            }
            $("#node-input-statusVal").val($("#node-input-typed-status").typedInput('value'));
        }
    });
})();
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="debug">
    <p>在“调试”侧边栏选项卡和运行时日志中显示选定的消息属性。 默认情况下，它会显示<code>msg.payload</code>的值，但您也可以将其设置成显示任意属性，完整消息或JSONata表达式的结果。</p>
    <h3>详细</h3>
    <p>调试侧边栏会提供已发消息的结构化视图，方便您查询消息的结构。</p>
    <p>JavaScript对象和数组可以根据需要来折叠或扩展。缓冲区对象可以显示为原始数据，也可以显示为字符串。</p>
    <p>对任意条消息，调试侧边栏还会显示接收消息的时间，发送消息的节点以及消息类型等信息。单击源节点ID将在工作区中显示该节点。</p>
    <p>节点上的按钮可用于启用或禁用其输出。建议禁用或删除所有未使用的调试节点。</p>
    <p>还可以通过配置节点，将所有消息发送到运行时的日志，或将简短的数据（32个字符内）在调试节点下的状态文本上显示。</p>
</script>

</div><div><!-- --- [red-module:node-red/complete] --- -->
<script type="text/html" data-template-name="complete">
    <div class="form-row node-input-target-row">
        <button id="node-input-complete-target-select" class="red-ui-button" data-i18n="common.label.selectNodes"></button>
    </div>
    <div class="form-row node-input-target-row node-input-target-list-row" style="position: relative; min-height: 100px">
        <div style="position: absolute; top: -30px; right: 0;"><input type="text" id="node-input-complete-target-filter"></div>
        <div id="node-input-complete-target-container-div"></div>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>
<script type="text/javascript">
    RED.nodes.registerType('complete',{
        category: 'common',
        color:"#c0edc0",
        defaults: {
            name: {value:""},
            scope: {value:[], type:"*[]"},
            uncaught: {value:false}
        },
        inputs:0,
        outputs:1,
        icon: "alert.svg",
        label: function() {
            if (this.name) {
                return this.name;
            }
            return this._("complete.completeNodes",{number:this.scope.length});
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;
            var scope = node.scope || [];

            this._resize = function() {
                var rows = $("#dialog-form>div:not(.node-input-target-list-row)");
                var height = $("#dialog-form").height();
                for (var i=0;i<rows.length;i++) {
                    height -= $(rows[i]).outerHeight(true);
                }
                var editorRow = $("#dialog-form>div.node-input-target-list-row");
                editorRow.css("height",height+"px");
            };
            var search = $("#node-input-complete-target-filter").searchBox({
                style: "compact",
                delay: 300,
                change: function() {
                    var val = $(this).val().trim().toLowerCase();
                    if (val === "") {
                        dirList.treeList("filter", null);
                        search.searchBox("count","");
                    } else {
                        var count = dirList.treeList("filter", function(item) {
                            return item.label.toLowerCase().indexOf(val) > -1 || item.node.type.toLowerCase().indexOf(val) > -1
                        });
                        search.searchBox("count",count+" / "+candidateNodes.length);
                    }
                }
            });

            var dirList = $("#node-input-complete-target-container-div").css({width: "100%", height: "100%"})
                .treeList({multi:true}).on("treelistitemmouseover", function(e, item) {
                    item.node.highlighted = true;
                    item.node.dirty = true;
                    RED.view.redraw();
                }).on("treelistitemmouseout", function(e, item) {
                    item.node.highlighted = false;
                    item.node.dirty = true;
                    RED.view.redraw();
                })
            var candidateNodes = RED.nodes.filterNodes({z:node.z});
            var allChecked = true;
            var items = [];
            var nodeItemMap = {};

            candidateNodes.forEach(function(n) {
                if (n.id === node.id) {
                    return;
                }
                var isChecked = scope.indexOf(n.id) !== -1;

                allChecked = allChecked && isChecked;

                var nodeDef = RED.nodes.getType(n.type);
                var label;
                var sublabel;
                if (nodeDef) {
                    var l = nodeDef.label;
                    label = (typeof l === "function" ? l.call(n) : l)||"";
                    sublabel = n.type;
                    if (sublabel.indexOf("subflow:") === 0) {
                        var subflowId = sublabel.substring(8);
                        var subflow = RED.nodes.subflow(subflowId);
                        sublabel = "subflow : "+subflow.name;
                    }
                }
                if (!nodeDef || !label) {
                    label = n.type;
                }
                nodeItemMap[n.id] = {
                    node: n,
                    label: label,
                    sublabel: sublabel,
                    selected: isChecked,
                    checkbox: true
                };
                items.push(nodeItemMap[n.id]);
            });
            dirList.treeList('data',items);

            $("#node-input-complete-target-select").on("click", function(e) {
                e.preventDefault();
                var preselected = dirList.treeList('selected').map(function(n) {return n.node.id});
                RED.tray.hide();
                RED.view.selectNodes({
                    selected: preselected,
                    onselect: function(selection) {
                        RED.tray.show();
                        var newlySelected = {};
                        selection.forEach(function(n) {
                            newlySelected[n.id] = true;
                            if (nodeItemMap[n.id]) {
                                nodeItemMap[n.id].treeList.select(true);
                            }
                        })
                        preselected.forEach(function(id) {
                            if (!newlySelected[id]) {
                                nodeItemMap[id].treeList.select(false);
                            }
                        })
                    },
                    oncancel: function() {
                        RED.tray.show();
                    },
                    filter: function(n) {
                        return n.id !== node.id;
                    }
                });
            })

        },
        oneditsave: function() {
            this.scope = $("#node-input-complete-target-container-div").treeList('selected').map(function(i) { return i.node.id})
        },
        oneditresize: function(size) {
            this._resize();
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="complete">
    <p>当另一个节点完成对消息的处理时触发流。</p>
    <h3>详细</h3>
    <p>如果一个节点通知运行时它已完成消息的处理，该节点可用于触发第二个流。</p>
    <p>这个节点可以与没有输出端口的节点一起使用，例如在使用电子邮件发送节点来发送邮件后触发一个流。</p>
    <p>此节点只能被设置为处理流中某个所选节点的事件。与Catch节点不同，您不能指定“所有节点”模式并以流中的所有节点为目标。</p>
    <p>并非所有节点都会触发此事件。这取决于它们是否支持于Node-RED 1.0中引入的此功能。</p>
</script>

</div><div><!-- --- [red-module:node-red/catch] --- -->

<script type="text/html" data-template-name="catch">
    <div class="form-row">
        <label style="width: auto" for="node-input-scope" data-i18n="catch.label.source"></label>
        <select id="node-input-scope-select">
            <option value="all" data-i18n="catch.scope.all"></option>
            <option value="target" data-i18n="catch.scope.selected"></options>
        </select>
    </div>
    <div class="form-row node-input-uncaught-row">
        <input type="checkbox" id="node-input-uncaught" style="display: inline-block; width: auto; vertical-align: top; margin-left: 30px; margin-right: 5px;">
        <label for="node-input-uncaught" style="width: auto" data-i18n="catch.label.uncaught"></label>
    </div>
    <div class="form-row node-input-target-row">
        <button id="node-input-catch-target-select" class="red-ui-button" data-i18n="common.label.selectNodes"></button>
    </div>
    <div class="form-row node-input-target-row node-input-target-list-row" style="position: relative; min-height: 100px">
        <div style="position: absolute; top: -30px; right: 0;"><input type="text" id="node-input-catch-target-filter"></div>
        <div id="node-input-catch-target-container-div"></div>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>
<script type="text/javascript">
    RED.nodes.registerType('catch',{
        category: 'common',
        color:"#e49191",
        defaults: {
            name: {value:""},
            scope: {value:null, type:"*[]"},
            uncaught: {value:false}
        },
        inputs:0,
        outputs:1,
        icon: "alert.svg",
        label: function() {
            if (this.name) {
                return this.name;
            }
            if (this.scope) {
                return this._("catch.catchNodes",{number:this.scope.length});
            }
            return this.uncaught?this._("catch.catchUncaught"):this._("catch.catch")
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;
            var scope = node.scope || [];

            this._resize = function() {
                var rows = $("#dialog-form>div:not(.node-input-target-list-row)");
                var height = $("#dialog-form").height();
                for (var i=0;i<rows.length;i++) {
                    height -= $(rows[i]).outerHeight(true);
                }
                var editorRow = $("#dialog-form>div.node-input-target-list-row");
                editorRow.css("height",height+"px");
            };
            var search = $("#node-input-catch-target-filter").searchBox({
                style: "compact",
                delay: 300,
                change: function() {
                    var val = $(this).val().trim().toLowerCase();
                    if (val === "") {
                        dirList.treeList("filter", null);
                        search.searchBox("count","");
                    } else {
                        var count = dirList.treeList("filter", function(item) {
                            return item.label.toLowerCase().indexOf(val) > -1 || item.node.type.toLowerCase().indexOf(val) > -1
                        });
                        search.searchBox("count",count+" / "+candidateNodes.length);
                    }
                }
            });
            var dirList = $("#node-input-catch-target-container-div").css({width: "100%", height: "100%"})
                .treeList({multi:true}).on("treelistitemmouseover", function(e, item) {
                    item.node.highlighted = true;
                    item.node.dirty = true;
                    RED.view.redraw();
                }).on("treelistitemmouseout", function(e, item) {
                    item.node.highlighted = false;
                    item.node.dirty = true;
                    RED.view.redraw();
                })
            var candidateNodes = RED.nodes.filterNodes({z:node.z});
            var allChecked = true;
            var items = [];
            var nodeItemMap = {};

            candidateNodes.forEach(function(n) {
                if (n.id === node.id) {
                    return;
                }
                var isChecked = scope.indexOf(n.id) !== -1;

                allChecked = allChecked && isChecked;

                var nodeDef = RED.nodes.getType(n.type);
                var label;
                var sublabel;
                if (nodeDef) {
                    var l = nodeDef.label;
                    label = (typeof l === "function" ? l.call(n) : l)||"";
                    sublabel = n.type;
                    if (sublabel.indexOf("subflow:") === 0) {
                        var subflowId = sublabel.substring(8);
                        var subflow = RED.nodes.subflow(subflowId);
                        sublabel = "subflow : "+subflow.name;
                    }
                }
                if (!nodeDef || !label) {
                    label = n.type;
                }
                nodeItemMap[n.id] = {
                    node: n,
                    label: label,
                    sublabel: sublabel,
                    selected: isChecked,
                    checkbox: true
                };
                items.push(nodeItemMap[n.id]);
            });
            dirList.treeList('data',items);

            $("#node-input-catch-target-select").on("click", function(e) {
                e.preventDefault();
                var preselected = dirList.treeList('selected').map(function(n) {return n.node.id});
                RED.tray.hide();
                RED.view.selectNodes({
                    selected: preselected,
                    onselect: function(selection) {
                        RED.tray.show();
                        var newlySelected = {};
                        selection.forEach(function(n) {
                            newlySelected[n.id] = true;
                            if (nodeItemMap[n.id]) {
                                nodeItemMap[n.id].treeList.select(true);
                            }
                        })
                        preselected.forEach(function(id) {
                            if (!newlySelected[id]) {
                                nodeItemMap[id].treeList.select(false);
                            }
                        })
                    },
                    oncancel: function() {
                        RED.tray.show();
                    },
                    filter: function(n) {
                        return n.id !== node.id;
                    }
                });
            })

            $("#node-input-scope-select").on("change", function(e) {
                var scope = $(this).val();
                if (scope === "target") {
                    $(".node-input-target-row").show();
                    $(".node-input-uncaught-row").hide();
                } else {
                    $(".node-input-target-row").hide();
                    $(".node-input-uncaught-row").show();
                }
                node._resize();
            });
            if (this.scope === null) {
                $("#node-input-scope-select").val("all");
            } else {
                $("#node-input-scope-select").val("target");
            }
            $("#node-input-scope-select").trigger("change");
        },
        oneditsave: function() {
            var scope = $("#node-input-scope-select").val();
            if (scope === 'all') {
                this.scope = null;
            } else {
                $("#node-input-uncaught").prop("checked",false);
                this.scope = $("#node-input-catch-target-container-div").treeList('selected').map(function(i) { return i.node.id})
            }
        },
        oneditresize: function(size) {
            this._resize();
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="catch">
    <p>捕获由同一标签页上的节点引发的错误。</p>
    <h3>输出</h3>
    <dl class="message-properties">
        <dt>error.message <span class="property-type">字符串</span></dt>
        <dd>错误消息。</dd>
        <dt>error.source.id <span class="property-type">字符串</span></dt>
        <dd>引发错误的节点的ID。</dd>
        <dt>error.source.type <span class="property-type">字符串</span></dt>
        <dd>引发错误的节点的类型。</dd>
        <dt>error.source.name <span class="property-type">字符串</span></dt>
        <dd>引发错误的节点的名称。（如果已设置）</dd>
    </dl>
    <h3>详细</h3>
    <p>如果节点在处理消息时抛出错误，则流程通常会停止。该节点可用于捕获那些错误并通过专用流程进行处理。</p>
    <p>默认情况下，该节点将捕获同一标签页上任何节点抛出的错误。或者，它可以针对特定节点，或配置为仅捕获另一个“目标”捕获节点尚未捕获的错误。</p>
    <p>当错误发生时，所有匹配的catch节点都会收到错误消息。</p>
    <p>如果在子流中发送了错误，则该错误将由子流中的任意捕获节点处理。如果子流中不存在捕获节点，则那错误将被传播到子流实例所在的标签页。</p>
    <p>如果消息已经具有<code>error</code>属性，则将该<code>error</code>复制为<code>_error</code>。</p>
</script>

</div><div><!-- --- [red-module:node-red/status] --- -->

<script type="text/html" data-template-name="status">
    <div class="form-row">
        <label style="width: auto" for="node-input-scope" data-i18n="status.label.source"></label>
        <select id="node-input-scope-select">
            <option value="all" data-i18n="status.scope.all"></option>
            <option value="target" data-i18n="status.scope.selected"></options>
        </select>
    </div>
    <div class="form-row node-input-target-row">
        <button id="node-input-status-target-select" class="red-ui-button" data-i18n="common.label.selectNodes"></button>
    </div>
    <div class="form-row node-input-target-row node-input-target-list-row" style="position: relative; min-height: 100px">
        <div style="position: absolute; top: -30px; right: 0;"><input type="text" id="node-input-status-target-filter"></div>
        <div id="node-input-status-target-container-div"></div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('status',{
        category: 'common',
        color:"#94c1d0",
        defaults: {
            name: {value:""},
            scope: {value:null, type:"*[]"}
        },
        inputs:0,
        outputs:1,
        icon: "status.svg",
        label: function() {
            return this.name||(this.scope?this._("status.statusNodes",{number:this.scope.length}):this._("status.status"));
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;
            var scope = node.scope || [];
            this._resize = function() {
                var rows = $("#dialog-form>div:not(.node-input-target-list-row)");
                var height = $("#dialog-form").height();
                for (var i=0;i<rows.length;i++) {
                    height -= $(rows[i]).outerHeight(true);
                }
                var editorRow = $("#dialog-form>div.node-input-target-list-row");
                editorRow.css("height",height+"px");
            };
            var search = $("#node-input-status-target-filter").searchBox({
                style: "compact",
                delay: 300,
                change: function() {
                    var val = $(this).val().trim().toLowerCase();
                    if (val === "") {
                        dirList.treeList("filter", null);
                        search.searchBox("count","");
                    } else {
                        var count = dirList.treeList("filter", function(item) {
                            return item.label.toLowerCase().indexOf(val) > -1 || item.node.type.toLowerCase().indexOf(val) > -1
                        });
                        search.searchBox("count",count+" / "+candidateNodes.length);
                    }
                }
            });

            var dirList = $("#node-input-status-target-container-div").css({width: "100%", height: "100%"})
                .treeList({multi:true}).on("treelistitemmouseover", function(e, item) {
                    item.node.highlighted = true;
                    item.node.dirty = true;
                    RED.view.redraw();
                }).on("treelistitemmouseout", function(e, item) {
                    item.node.highlighted = false;
                    item.node.dirty = true;
                    RED.view.redraw();
                })
            var candidateNodes = RED.nodes.filterNodes({z:node.z});
            var allChecked = true;
            var items = [];
            var nodeItemMap = {};

            candidateNodes.forEach(function(n) {
                if (n.id === node.id) {
                    return;
                }
                var isChecked = scope.indexOf(n.id) !== -1;

                allChecked = allChecked && isChecked;

                var nodeDef = RED.nodes.getType(n.type);
                var label;
                var sublabel;
                if (nodeDef) {
                    var l = nodeDef.label;
                    label = (typeof l === "function" ? l.call(n) : l)||"";
                    sublabel = n.type;
                    if (sublabel.indexOf("subflow:") === 0) {
                        var subflowId = sublabel.substring(8);
                        var subflow = RED.nodes.subflow(subflowId);
                        sublabel = "subflow : "+subflow.name;
                    }
                }
                if (!nodeDef || !label) {
                    label = n.type;
                }
                nodeItemMap[n.id] = {
                    node: n,
                    label: label,
                    sublabel: sublabel,
                    selected: isChecked,
                    checkbox: true
                };
                items.push(nodeItemMap[n.id]);
            });
            dirList.treeList('data',items);

            $("#node-input-status-target-select").on("click", function(e) {
                e.preventDefault();
                var preselected = dirList.treeList('selected').map(function(n) {return n.node.id});
                RED.tray.hide();
                RED.view.selectNodes({
                    selected: preselected,
                    onselect: function(selection) {
                        RED.tray.show();
                        var newlySelected = {};
                        selection.forEach(function(n) {
                            newlySelected[n.id] = true;
                            if (nodeItemMap[n.id]) {
                                nodeItemMap[n.id].treeList.select(true);
                            }
                        })
                        preselected.forEach(function(id) {
                            if (!newlySelected[id]) {
                                nodeItemMap[id].treeList.select(false);
                            }
                        })
                    },
                    oncancel: function() {
                        RED.tray.show();
                    },
                    filter: function(n) {
                        return n.id !== node.id;
                    }
                });
            })

            $("#node-input-scope-select").on("change", function(e) {
                var scope = $(this).val();
                if (scope === "target") {
                    $(".node-input-target-row").show();
                } else {
                    $(".node-input-target-row").hide();
                }
                node._resize();
            });
            if (this.scope === null) {
                $("#node-input-scope-select").val("all");
            } else {
                $("#node-input-scope-select").val("target");
            }
            $("#node-input-scope-select").trigger("change");
        },
        oneditsave: function() {
            var scope = $("#node-input-scope-select").val();
            if (scope === 'all') {
                this.scope = null;
            } else {
                this.scope = $("#node-input-status-target-container-div").treeList('selected').map(function(i) { return i.node.id})
            }
        },
        oneditresize: function(size) {
            this._resize();
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="status">
    <p>获取在同一标签页上的其他节点的状态消息。</p>
    <h3>输出</h3>
    <dl class="message-properties">
        <dt>status.text <span class="property-type">字符串</span></dt>
        <dd>状态文本。</dd>
        <dt>status.source.type <span class="property-type">字符串</span></dt>
        <dd>报告状态的节点的类型。</dd>
        <dt>status.source.id <span class="property-type">字符串</span></dt>
        <dd>报告状态的节点的ID。</dd>
        <dt>status.source.name <span class="property-type">字符串</span></dt>
        <dd>报告状态的节点的名称（如果已设置）。</dd>
    </dl>
    <h3>详细</h3>
   <p>该节点不包含<code>有效荷载</code>。</p>
   <p>默认情况下，节点会获取同一工作空间标签页上报告所有节点的状态。可以通过配置来设定目标节点。</p>
</script>

</div><div><!-- --- [red-module:node-red/link] --- -->

<script type="text/html" data-template-name="link in">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div style="position:relative; height: 30px; text-align: right;"><div style="display:inline-block"><input type="text" id="node-input-link-target-filter"></div></div>
    <div class="form-row node-input-link-row"></div>
</script>
<script type="text/html" data-template-name="link out">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-mode"><span data-i18n="link.outMode"></span></label>
        <select id="node-input-mode" style="width: 70%">
            <option value="link" selected data-i18n="link.sendToAll"></option>
            <option value="return" data-i18n="link.returnToCaller"></option>
        </select>
    </div>
    <div class="node-input-link-rows" style="position:relative; height: 30px; text-align: right;"><div style="display:inline-block"><input type="text" id="node-input-link-target-filter"></div></div>
    <div class="form-row node-input-link-row node-input-link-rows"></div>
</script>

<script type="text/html" data-template-name="link call">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-timeout"><span data-i18n="exec.label.timeout"></span></label>
        <input type="text" id="node-input-timeout" placeholder="30" style="width: 70px; margin-right: 5px;"><span data-i18n="inject.seconds"></span>
    </div>
    <div style="position:relative; height: 30px; text-align: right;"><div style="display:inline-block"><input type="text" id="node-input-link-target-filter"></div></div>
    <div class="form-row node-input-link-row"></div>
</script>

<script type="text/javascript">
(function() {

    var treeList;

    function onEditPrepare(node,targetType) {
        if (!node.links) {
            node.links = [];
        }
        node.oldLinks = [];

        var activeSubflow = RED.nodes.subflow(node.z);

        treeList = $("<div>")
            .css({width: "100%", height: "100%"})
            .appendTo(".node-input-link-row")
            .treeList({autoSelect:false})
            .on('treelistitemmouseover',function(e,item) {
                if (item.node) {
                    item.node.highlighted = true;
                    item.node.dirty = true;
                    RED.view.redraw();
                }
            })
            .on('treelistitemmouseout',function(e,item) {
                if (item.node) {
                    item.node.highlighted = false;
                    item.node.dirty = true;
                    RED.view.redraw();
                }
            });
        var candidateNodes = RED.nodes.filterNodes({type:targetType});
        var candidateNodesCount = 0;

        var search = $("#node-input-link-target-filter").searchBox({
            style: "compact",
            delay: 300,
            change: function() {
                var val = $(this).val().trim().toLowerCase();
                if (val === "") {
                    treeList.treeList("filter", null);
                    search.searchBox("count","");
                } else {
                    var count = treeList.treeList("filter", function(item) {
                        return item.label.toLowerCase().indexOf(val) > -1 || (item.node && item.node.type.toLowerCase().indexOf(val) > -1)
                    });
                    search.searchBox("count",count+" / "+candidateNodesCount);
                }
            }
        });


        var flows = [];
        var flowMap = {};

        if (activeSubflow) {
            flowMap[activeSubflow.id] = {
                id: activeSubflow.id,
                class: 'red-ui-palette-header',
                label:  "Subflow : "+(activeSubflow.name || activeSubflow.id),
                expanded: true,
                children: []
            };
            flows.push(flowMap[activeSubflow.id])
        } else {
            RED.nodes.eachWorkspace(function(ws) {
                flowMap[ws.id] = {
                    id: ws.id,
                    class: 'red-ui-palette-header',
                    label: (ws.label || ws.id)+(node.z===ws.id ? " *":""),
                    expanded: true,
                    children: []
                }
                flows.push(flowMap[ws.id])
            })
        }

        candidateNodes.forEach(function(n) {
            if (flowMap[n.z]) {
                if (targetType === "link out" && n.mode === 'return') {
                    // Link In nodes looking for Link Out nodes should not
                    // include return-mode nodes.
                    return
                }
                var isChecked = false;
                isChecked = (node.links.indexOf(n.id) !== -1) || (n.links||[]).indexOf(node.id) !== -1;
                if (isChecked) {
                    node.oldLinks.push(n.id);
                }
                flowMap[n.z].children.push({
                    id: n.id,
                    node: n,
                    label: n.name||n.id,
                    selected: isChecked,
                    checkbox: node.type !== "link call",
                    radio: node.type === "link call"
                })
                candidateNodesCount++;
            }
        });
        flows = flows.filter(function(f) { return f.children.length > 0 })
        treeList.treeList('data',flows);
        setTimeout(function() {
            treeList.treeList('show',node.z);
        },100);
    }

    function resizeNodeList() {
        var rows = $("#dialog-form>div:not(.node-input-link-row)");
        var height = $("#dialog-form").height();
        for (var i=0;i<rows.length;i++) {
            height -= $(rows[i]).outerHeight(true);
        }
        var editorRow = $("#dialog-form>div.node-input-link-row");
        height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
        $(".node-input-link-row").css("height",height+"px");
    }

    function onEditSave(node) {
        var flows = treeList.treeList('data');
        node.links = [];
        if (node.type !== "link out" || $("#node-input-mode").val() === 'link') {
            flows.forEach(function(f) {
                f.children.forEach(function(n) {
                    if (n.selected) {
                        node.links.push(n.id);
                    }
                })
            })
        }
        node.oldLinks.sort();
        node.links.sort();

        if (node.type === "link call") {
            return
        }

        var nodeMap = {};
        var length = Math.max(node.oldLinks.length,node.links.length);
        for (var i=0;i<length;i++) {
            if (i<node.oldLinks.length) {
                nodeMap[node.oldLinks[i]] = nodeMap[node.oldLinks[i]]||{};
                nodeMap[node.oldLinks[i]].old = true;
            }
            if (i<node.links.length) {
                nodeMap[node.links[i]] = nodeMap[node.links[i]]||{};
                nodeMap[node.links[i]].new = true;
            }
        }
        var n;
        for (var id in nodeMap) {
            if (nodeMap.hasOwnProperty(id)) {
                n = RED.nodes.node(id);
                if (n) {
                    if (nodeMap[id].old && !nodeMap[id].new) {
                        // Removed id
                        i = n.links.indexOf(node.id);
                        if (i > -1) {
                            n.links.splice(i,1);
                        }
                    } else if (!nodeMap[id].old && nodeMap[id].new) {
                        // Added id
                        i = n.links.indexOf(id);
                        if (i === -1) {
                            n.links.push(node.id);
                        }
                    }
                }
            }
        }
    }

    function onAdd() {
        for (var i=0;i<this.links.length;i++) {
            var n = RED.nodes.node(this.links[i]);
            if (n && n.links.indexOf(this.id) === -1) {
                n.links.push(this.id);
            }
        }
    }

    RED.nodes.registerType('link in',{
        category: 'common',
        color:"#ddd",//"#87D8CF",
        defaults: {
            name: {value:""},
            links: { value: [], type:"link out[]" }
        },
        inputs:0,
        outputs:1,
        icon: "link-out.svg",
        outputLabels: function(i) {
            return this.name||this._("link.linkIn");
        },
        showLabel: false,
        label: function() {
            return this.name||this._("link.linkIn");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            onEditPrepare(this,"link out");
        },
        oneditsave: function() {
            onEditSave(this);
            // In case the name has changed, ensure any link call nodes on this
            // tab are redrawn with the updated name
            var localCallNodes = RED.nodes.filterNodes({z:RED.workspaces.active(), type:"link call"});
            localCallNodes.forEach(function(node) {
                node.dirty = true;
            });
        },
        onadd: onAdd,
        oneditresize: resizeNodeList
    });

    RED.nodes.registerType('link call',{
        category: 'common',
        color:"#ddd",//"#87D8CF",
        defaults: {
            name: {value:""},
            links: { value: [], type:"link in[]"},
            timeout: { value: "30", validate:RED.validators.number(true) }
        },
        inputs: 1,
        outputs: 1,
        icon: "link-call.svg",
        inputLabels: function(i) {
            return this.name||this._("link.linkCall");
        },
        label: function() {
            if (this.name) {
                return this.name;
            }
            if (this.links.length > 0) {
                var targetNode = RED.nodes.node(this.links[0]);
                return targetNode && (targetNode.name || this._("link.linkCall"));
            }
            return this._("inject.none");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            onEditPrepare(this,"link in");
        },
        oneditsave: function() {
            onEditSave(this);
        },
        oneditresize: resizeNodeList
    });

    RED.nodes.registerType('link out',{
        category: 'common',
        color:"#ddd",//"#87D8CF",
        defaults: {
            name: {value:""},
            mode: { value: "link" },// link || return
            links: { value: [], type:"link in[]"}
        },
        align:"right",
        inputs:1,
        outputs:0,
        icon: function() {
            if (this.mode === "return") {
                return "link-return.svg";
            } else {
                return "link-out.svg";
            }
        },
        inputLabels: function(i) {
            return this.name||(this.mode === "return" ?this._("link.linkOutReturn"):this._("link.linkOut"));
        },
        showLabel: false,
        label: function() {
            return this.name||(this.mode === "return" ?this._("link.linkOutReturn"):this._("link.linkOut"));
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            onEditPrepare(this,"link in");
            $("#node-input-mode").on("change", function() {
                $(".node-input-link-rows").toggle(this.value === "link")
            })
            if (!this.mode) {
                $("#node-input-mode").val('link').trigger("change");
            }

        },
        oneditsave: function() {
            onEditSave(this);
        },
        onadd: onAdd,
        oneditresize: resizeNodeList
    });



})();
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="link in">
    <p>在流之间创建虚拟连线。</p>
    <h3>详细</h3>
    <p>该节点可以连接到任何标签页上存在的任何<code>link out</code>节点。连接后，它们的行为就像连接在一起。</p>
    <p>仅当选择链接节点时，才会显示链接节点之间的链接。如果有指向另一个选项卡的链接，则显示一个虚拟节点。单击该虚拟节点将带您到相应的选项卡。</p>
    <p><b>注意：</b>无法创建进入或离开子流的链接。</p>
</script>

<script type="text/x-red" data-help-name="link out">
    <p>在流之间创建虚拟连线。</p>
    <h3>详细</h3>
    <p>该节点可以连接到任何标签页上存在的任何<code>link in</code>节点。连接后，它们的行为就像连接在一起。</p>
    <p>仅当选择链接节点时，才会显示链接节点之间的链接。如果有指向另一个选项卡的链接，则显示一个虚拟节点。单击该虚拟节点将带您到相应的选项卡。</p>
    <p><b>注意：</b>无法创建进入或离开子流的链接。</p>
</script>

</div><div><!-- --- [red-module:node-red/comment] --- -->

<script type="text/html" data-template-name="comment">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row node-text-editor-row">
        <input type="hidden" id="node-input-info" autofocus="autofocus">
        <div style="height: 250px; min-height:150px;" class="node-text-editor" id="node-input-info-editor"></div>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('comment',{
        category: 'common',
        color:"#ffffff",
        defaults: {
            name: {value:""},
            info: {value:""}
        },
        inputs:0,
        outputs:0,
        icon: "comment.svg",
        label: function() {
            return this.name||this._("comment.comment");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        info: function() {
            return this.name?"# "+this.name+"\n\n---\n\n":"";
        },
        oneditprepare: function() {
            var that = this;
            this.editor = RED.editor.createEditor({
                id: 'node-input-info-editor',
                mode: 'ace/mode/markdown',
                value: $("#node-input-info").val()
            });
            this.editor.focus();
        },
        oneditsave: function() {
            $("#node-input-info").val(this.editor.getValue());
            this.editor.destroy();
            delete this.editor;
        },
        oneditcancel: function() {
            this.editor.destroy();
            delete this.editor;
        },
        oneditresize: function(size) {
            var rows = $("#dialog-form>div:not(.node-text-editor-row)");
            var height = $("#dialog-form").height();
            for (var i=0; i<rows.length; i++) {
                height -= $(rows[i]).outerHeight(true);
            }
            var editorRow = $("#dialog-form>div.node-text-editor-row");
            height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
            $(".node-text-editor").css("height",height+"px");
            this.editor.resize();
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="comment">
    <p>可用于向流添加注释的节点。</p>
    <h3>详细</h3>
    <p>编辑面板接受Markdown语法。输入的文本将在信息侧面板中显示。</p>
</script>

</div><div><!-- --- [red-module:node-red/unknown] --- -->

<script type="text/html" data-template-name="unknown">
    <div class="form-tips"><span data-i18n="[html]unknown.tip"></span></div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('unknown',{
        category: 'unknown',
        color:"#fff0f0",
        defaults: {
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "",
        label: function() {
            return "("+this.name+")"||this._("unknown.label.unknown");
        },
        labelStyle: function() {
            return "node_label_unknown";
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="unknown">
    <p>您安装的Node-RED无法识别该节点的类型。</p>
    <h3>详细</h3>
    <p><i>如果在此状态下部署节点，其配置会被保存。但是在安装缺少的类型之前，流不会开始。</i></p>
    <p>使用<code> Menu-Manage Palette </code>选项来搜索并安装节点，或者使用<b>npm install &lt;module&gt;</b>来安装所有缺少的节点，并重新启动Node-Red来导入这些节点。</p>
    <p>另一种可能是，您已经安装了此节点类型，但是缺少必须的依赖项。您应检查Node-RED的启动日志中是否有与缺少节点有关的错误消息。</p>
    <p>以上方法都不适用时，您可以联系该流的作者以获取缺少的节点类型的副本。</p>
</script>

</div><div><!-- --- [red-module:node-red/function] --- -->
<script type="text/html" data-template-name="function">
    <style>
        .func-tabs-row {
            margin-bottom: 0;
        }
        #node-input-libs-container-row .red-ui-editableList-container {
            padding: 0px;
        }
        #node-input-libs-container-row .red-ui-editableList-container li {
            padding:0px;
        }
        #node-input-libs-container-row .red-ui-editableList-item-remove {
            right: 5px;
        }

        #node-input-libs-container-row .red-ui-editableList-header {
            display: flex;
            background: var(--red-ui-tertiary-background);
            padding-right: 75px;
        }
        #node-input-libs-container-row .red-ui-editableList-header > div {
            flex-grow: 1;
        }

        .node-libs-entry {
            display: flex;
        }

        .node-libs-entry .red-ui-typedInput-container {
            border-radius: 0;
            border: none;
        }
        .node-libs-entry .red-ui-typedInput-type-select {
            border-radius: 0 !important;
            height: 34px;
        }
        .node-libs-entry > span > input[type=text] {
            border-radius: 0;
            border-top-color: var(--red-ui-form-background);
            border-bottom-color: var(--red-ui-form-background);
            border-right-color: var(--red-ui-form-background);
        }
        .node-libs-entry > span > input[type=text].input-error {
        }
        .node-libs-entry > span {
            flex-grow: 1;
            width: 50%;
            position: relative;
        }
        .node-libs-entry span .node-input-libs-var, .node-libs-entry span .red-ui-typedInput-container {
            width: 100%;
        }
        .node-libs-entry > span > span > i {
            display: none;
        }
        .node-libs-entry > span > span.input-error > i {
            display: inline;
        }

    </style>
    <input type="hidden" id="node-input-func">
    <input type="hidden" id="node-input-noerr">
    <input type="hidden" id="node-input-finalize">
    <input type="hidden" id="node-input-initialize">

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <div style="display: inline-block; width: calc(100% - 105px)"><input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name"></div>
    </div>


    <div class="form-row func-tabs-row">
        <ul style="min-width: 600px; margin-bottom: 20px;" id="func-tabs"></ul>
    </div>
    <div id="func-tabs-content" style="min-height: calc(100% - 95px);">

        <div id="func-tab-config" style="display:none">
            <div class="form-row">
                <label for="node-input-outputs"><i class="fa fa-random"></i> <span data-i18n="function.label.outputs"></span></label>
                <input id="node-input-outputs" style="width: 60px;" value="1">
            </div>

            <div class="form-row node-input-libs-row hide" style="margin-bottom: 0px;">
                <label><i class="fa fa-cubes"></i> <span data-i18n="function.label.modules"></span></label>
            </div>
            <div class="form-row node-input-libs-row hide" id="node-input-libs-container-row">
                <ol id="node-input-libs-container"></ol>
            </div>
        </div>

        <div id="func-tab-init" style="display:none">
            <div class="form-row node-text-editor-row" style="position:relative">
                <div style="height: 250px; min-height:150px;" class="node-text-editor" id="node-input-init-editor" ></div>
                <div style="position: absolute; right:0; bottom: calc(100% - 20px); z-Index: 5;"><button id="node-init-expand-js" class="red-ui-button red-ui-button-small"><i class="fa fa-expand"></i></button></div>
            </div>
        </div>

        <div id="func-tab-body" style="display:none">
            <div class="form-row node-text-editor-row" style="position:relative">
                <div style="height: 220px; min-height:150px;" class="node-text-editor" id="node-input-func-editor" ></div>
                <div style="position: absolute; right:0; bottom: calc(100% - 20px); z-Index: 5;"><button id="node-function-expand-js" class="red-ui-button red-ui-button-small"><i class="fa fa-expand"></i></button></div>
            </div>
        </div>

        <div id="func-tab-finalize" style="display:none">
            <div class="form-row node-text-editor-row" style="position:relative">
                <div style="height: 250px; min-height:150px;" class="node-text-editor" id="node-input-finalize-editor" ></div>
                <div style="position: absolute; right:0; bottom: calc(100% - 20px); z-Index: 5;"><button id="node-finalize-expand-js" class="red-ui-button red-ui-button-small"><i class="fa fa-expand"></i></button></div>
            </div>
        </div>

    </div>
</script>

<script type="text/javascript">

(function() {

    var invalidModuleVNames = [
        'console',
        'util',
        'Buffer',
        'Date',
        'RED',
        'node',
        '__node__',
        'context',
        'flow',
        'global',
        'env',
        'setTimeout',
        'clearTimeout',
        'setInterval',
        'clearInterval',
        'promisify'
    ]

    var knownFunctionNodes = {};
    RED.events.on("nodes:add", function(n) {
        if (n.type === "function") {
            knownFunctionNodes[n.id] = n;
        }
    })
    RED.events.on("nodes:remove", function(n) {
        if (n.type === "function") {
            delete knownFunctionNodes[n.id];
        }
    })

    var missingModules = [];
    var missingModuleReasons = {};
    RED.events.on("runtime-state", function(event) {
        if (event.error === "missing-modules") {
            missingModules = event.modules.map(function(m) { missingModuleReasons[m.module] = m.error; return m.module });
            for (var id in knownFunctionNodes) {
                if (knownFunctionNodes.hasOwnProperty(id) && knownFunctionNodes[id].libs && knownFunctionNodes[id].libs.length > 0) {
                    RED.editor.validateNode(knownFunctionNodes[id])
                }
            }
        } else if (!event.text) {
            missingModuleReasons = {};
            missingModules = [];
            for (var id in knownFunctionNodes) {
                if (knownFunctionNodes.hasOwnProperty(id) && knownFunctionNodes[id].libs && knownFunctionNodes[id].libs.length > 0) {
                    RED.editor.validateNode(knownFunctionNodes[id])
                }
            }
        }
        RED.view.redraw();
    });

    var installAllowList = ['*'];
    var installDenyList = [];

    var modulesEnabled = true;
    if (RED.settings.get('externalModules.modules.allowInstall', true) === false) {
        modulesEnabled = false;
    }
    var settingsAllowList = RED.settings.get("externalModules.modules.allowList")
    var settingsDenyList = RED.settings.get("externalModules.modules.denyList")
    if (settingsAllowList || settingsDenyList) {
        installAllowList = settingsAllowList;
        installDenyList = settingsDenyList
    }
    installAllowList = RED.utils.parseModuleList(installAllowList);
    installDenyList = RED.utils.parseModuleList(installDenyList);


    // object that maps from library name to its descriptor
    var allLibs = [];

    function moduleName(module) {
        var match = /^([^@]+)@(.+)/.exec(module);
        if (match) {
            return [match[1], match[2]];
        }
        return [module, undefined];
    }

    function getAllUsedModules() {
        var moduleSet = new Set();
        for (var id in knownFunctionNodes) {
            if (knownFunctionNodes.hasOwnProperty(id)) {
                if (knownFunctionNodes[id].libs) {
                    for (var i=0, l=knownFunctionNodes[id].libs.length; i<l; i++) {
                        if (RED.utils.checkModuleAllowed(knownFunctionNodes[id].libs[i].module,null,installAllowList,installDenyList)) {
                            moduleSet.add(knownFunctionNodes[id].libs[i].module);
                        }
                    }
                }
            }
        }
        var modules = Array.from(moduleSet);
        modules.sort();
        return modules;
    }

    function prepareLibraryConfig(node) {
        $(".node-input-libs-row").show();
        var usedModules = getAllUsedModules();
        var typedModules = usedModules.map(function(l) {
            return {icon:"fa fa-cube", value:l,label:l,hasValue:false}
        })
        typedModules.push({
            value:"_custom_", label:RED._("editor:subflow.licenseOther"), icon:"red/images/typedInput/az.svg"
        })

        var libList = $("#node-input-libs-container").css('min-height','100px').css('min-width','450px').editableList({
            header: $('<div><div data-i18n="node-red:function.require.moduleName"></div><div data-i18n="node-red:function.require.importAs"></div></div>'),
            addItem: function(container,i,opt) {
                var parent = container.parent();
                var row0 = $("<div/>").addClass("node-libs-entry").appendTo(container);
                var fmoduleSpan = $("<span>").appendTo(row0);
                var fmodule = $("<input/>", {
                    class: "node-input-libs-val",
                    placeholder: RED._("node-red:function.require.module"),
                    type: "text"
                }).css({
                }).appendTo(fmoduleSpan).typedInput({
                    types: typedModules,
                    default: usedModules.indexOf(opt.module) > -1 ? opt.module : "_custom_"
                });
                if (usedModules.indexOf(opt.module) === -1) {
                    fmodule.typedInput('value', opt.module);
                }
                var moduleWarning = $('<span style="position: absolute;right:2px;top:7px; display:inline-block; width: 16px;"><i class="fa fa-warning"></i></span>').appendTo(fmoduleSpan);
                RED.popover.tooltip(moduleWarning.find("i"),function() {
                    var val = fmodule.typedInput("type");
                    if (val === "_custom_") {
                        val = fmodule.val();
                    }
                    var errors = [];

                    if (!RED.utils.checkModuleAllowed(val,null,installAllowList,installDenyList)) {
                        return RED._("node-red:function.error.moduleNotAllowed",{module:val});
                    } else {
                        return RED._("node-red:function.error.moduleLoadError",{module:val,error:missingModuleReasons[val]});
                    }
                })

                var fvarSpan = $("<span>").appendTo(row0);

                var fvar = $("<input/>", {
                    class: "node-input-libs-var red-ui-font-code",
                    placeholder: RED._("node-red:function.require.var"),
                    type: "text"
                }).css({
                }).appendTo(fvarSpan).val(opt.var);
                var vnameWarning = $('<span style="position: absolute; right:2px;top:7px;display:inline-block; width: 16px;"><i class="fa fa-warning"></i></span>').appendTo(fvarSpan);
                RED.popover.tooltip(vnameWarning.find("i"),function() {
                    var val = fvar.val();
                    if (invalidModuleVNames.indexOf(val) !== -1) {
                        return RED._("node-red:function.error.moduleNameReserved",{name:val})
                    } else {
                        return RED._("node-red:function.error.moduleNameError",{name:val})
                    }
                })



                fvar.on("change keyup paste", function (e) {
                    var v = $(this).val().trim();
                    if (v === "" || / /.test(v) || invalidModuleVNames.indexOf(v) !== -1) {
                        fvar.addClass("input-error");
                        vnameWarning.addClass("input-error");
                    } else {
                        fvar.removeClass("input-error");
                        vnameWarning.removeClass("input-error");
                    }
                });

                fmodule.on("change keyup paste", function (e) {
                    var val = $(this).typedInput("type");
                    if (val === "_custom_") {
                        val = $(this).val();
                    }
                    var varName = val.trim().replace(/^@/,"").replace(/@.*$/,"").replace(/[-_/].?/g, function(v) { return v[1]?v[1].toUpperCase():"" });
                    fvar.val(varName);
                    fvar.trigger("change");

                    if (RED.utils.checkModuleAllowed(val,null,installAllowList,installDenyList) && (missingModules.indexOf(val) === -1)) {
                        fmodule.removeClass("input-error");
                        moduleWarning.removeClass("input-error");
                    } else {
                        fmodule.addClass("input-error");
                        moduleWarning.addClass("input-error");
                    }
                });
                if (RED.utils.checkModuleAllowed(opt.module,null,installAllowList,installDenyList) && (missingModules.indexOf(opt.module) === -1)) {
                    fmodule.removeClass("input-error");
                    moduleWarning.removeClass("input-error");
                } else {
                    fmodule.addClass("input-error");
                    moduleWarning.addClass("input-error");
                }
                if (opt.var) {
                    fvar.trigger("change");
                }
            },
            removable: true
        });

        var libs = node.libs || [];
        for (var i=0,l=libs.length;i<l; i++) {
            libList.editableList('addItem',libs[i])
        }

    }

    function getLibsList() {
        var _libs = [];
        if (RED.settings.functionExternalModules !== false) {
            var libs = $("#node-input-libs-container").editableList("items");
            libs.each(function(i) {
                var item = $(this);
                var v = item.find(".node-input-libs-var").val();
                var n = item.find(".node-input-libs-val").typedInput("type");
                if (n === "_custom_") {
                    n = item.find(".node-input-libs-val").val();
                }
                if ((!v || (v === "")) ||
                    (!n || (n === ""))) {
                    return;
                }
                _libs.push({
                    var: v,
                    module: n
                });
            });
        }
        return _libs;
    }

    RED.nodes.registerType('function',{
        color:"#fdd0a2",
        category: 'function',
        defaults: {
            name: {value:""},
            func: {value:"\nreturn msg;"},
            outputs: {value:1},
            noerr: {value:0,required:true,validate:function(v) { return !v; }},
            initialize: {value:""},
            finalize: {value:""},
            libs: {value: [], validate: function(v) {
                if (!v) { return true; }
                for (var i=0,l=v.length;i<l;i++) {
                    var m = v[i];
                    if (!RED.utils.checkModuleAllowed(m.module,null,installAllowList,installDenyList)) {
                        return false
                    }
                    if (m.var === "" || / /.test(m.var)) {
                        return false;
                    }
                    if (missingModules.indexOf(m.module) > -1) {
                        return false;
                    }
                    if (invalidModuleVNames.indexOf(m.var) !== -1){
                        return false;
                    }
                }
                return true;
            }}
        },
        inputs:1,
        outputs:1,
        icon: "function.svg",
        label: function() {
            return this.name||this._("function.function");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var that = this;

            var tabs = RED.tabs.create({
                id: "func-tabs",
                onchange: function(tab) {
                    $("#func-tabs-content").children().hide();
                    $("#" + tab.id).show();
                    let editor = $("#" + tab.id).find('.monaco-editor').first();
                   	if(editor.length) {
                        if(that.editor.nodered && that.editor.type == "monaco") {
                            that.editor.nodered.refreshModuleLibs(getLibsList());
                        }
                        RED.tray.resize();
                    }
                }
            });
            tabs.addTab({
                id: "func-tab-config",
                iconClass: "fa fa-cog",
                label: that._("function.label.setup")
            });

            tabs.addTab({
                id: "func-tab-init",
                label: that._("function.label.initialize")
            });
            tabs.addTab({
                id: "func-tab-body",
                label: that._("function.label.function")
            });
            tabs.addTab({
                id: "func-tab-finalize",
                label: that._("function.label.finalize")
            });

            tabs.activateTab("func-tab-body");

            $( "#node-input-outputs" ).spinner({
                min:0,
                change: function(event, ui) {
                    var value = this.value;
                    if (!value.match(/^\d+$/)) { value = 1;  }
                    else if (value < this.min) { value = this.min; }
                    if (value !== this.value) { $(this).spinner("value", value); }
                }
            });

            var buildEditor = function(id, value, defaultValue, extraLibs) {
                var editor = RED.editor.createEditor({
                    id: id,
                    mode: 'ace/mode/nrjavascript',
                    value: value || defaultValue || "",
                    globals: {
                        msg:true,
                        context:true,
                        RED: true,
                        util: true,
                        flow: true,
                        global: true,
                        console: true,
                        Buffer: true,
                        setTimeout: true,
                        clearTimeout: true,
                        setInterval: true,
                        clearInterval: true
                    },
                    extraLibs: extraLibs
                });
                if (defaultValue && value === "") {
                    editor.moveCursorTo(defaultValue.split("\n").length - 1, 0);
                }
                return editor;
            }
            this.initEditor = buildEditor('node-input-init-editor',$("#node-input-initialize").val(),RED._("node-red:function.text.initialize"))
            this.editor = buildEditor('node-input-func-editor',$("#node-input-func").val(), undefined, that.libs || [])
            this.finalizeEditor = buildEditor('node-input-finalize-editor',$("#node-input-finalize").val(),RED._("node-red:function.text.finalize"))

            RED.library.create({
                url:"functions", // where to get the data from
                type:"function", // the type of object the library is for
                editor:this.editor, // the field name the main text body goes to
                mode:"ace/mode/nrjavascript",
                fields:[
                    'name', 'outputs',
                    {
                        name: 'initialize',
                        get: function() {
                            return that.initEditor.getValue();
                        },
                        set: function(v) {
                            that.initEditor.setValue(v||RED._("node-red:function.text.initialize"), -1);
                        }
                    },
                    {
                        name: 'finalize',
                        get: function() {
                            return that.finalizeEditor.getValue();
                        },
                        set: function(v) {
                            that.finalizeEditor.setValue(v||RED._("node-red:function.text.finalize"), -1);
                        }
                    },
                    {
                        name: 'info',
                        get: function() {
                            return that.infoEditor.getValue();
                        },
                        set: function(v) {
                            that.infoEditor.setValue(v||"", -1);
                        }
                    }
                ],
                ext:"js"
            });
            this.editor.focus();


            var expandButtonClickHandler = function(editor) {
                return function(e) {
                    e.preventDefault();
                    var value = editor.getValue();
                    RED.editor.editJavaScript({
                        value: value,
                        width: "Infinity",
                        cursor: editor.getCursorPosition(),
                        mode: "ace/mode/nrjavascript",
                        complete: function(v,cursor) {
                            editor.setValue(v, -1);
                            editor.gotoLine(cursor.row+1,cursor.column,false);
                            setTimeout(function() {
                                editor.focus();
                            },300);
                        }
                    })
                }
            }
            $("#node-init-expand-js").on("click", expandButtonClickHandler(this.initEditor));
            $("#node-function-expand-js").on("click", expandButtonClickHandler(this.editor));
            $("#node-finalize-expand-js").on("click", expandButtonClickHandler(this.finalizeEditor));

            RED.popover.tooltip($("#node-init-expand-js"), RED._("node-red:common.label.expand"));
            RED.popover.tooltip($("#node-function-expand-js"), RED._("node-red:common.label.expand"));
            RED.popover.tooltip($("#node-finalize-expand-js"), RED._("node-red:common.label.expand"));

            if (RED.settings.functionExternalModules !== false) {
                prepareLibraryConfig(that);
            }
        },
        oneditsave: function() {
            var node = this;
            var noerr = 0;
            $("#node-input-noerr").val(0);

            var disposeEditor = function(editorName,targetName,defaultValue) {
                var editor = node[editorName];
                var annot = editor.getSession().getAnnotations();
                for (var k=0; k < annot.length; k++) {
                    if (annot[k].type === "error") {
                        noerr += annot.length;
                        break;
                    }
                }
                var val = editor.getValue();
                if (defaultValue) {
                    if (val.trim() == defaultValue.trim()) {
                        val = "";
                    }
                }
                editor.destroy();
                delete node[editorName];
                $("#"+targetName).val(val);
            }
            disposeEditor("editor","node-input-func");
            disposeEditor("initEditor","node-input-initialize", RED._("node-red:function.text.initialize"));
            disposeEditor("finalizeEditor","node-input-finalize", RED._("node-red:function.text.finalize"));

            $("#node-input-noerr").val(noerr);
            this.noerr = noerr;
            node.libs = getLibsList();
        },
        oneditcancel: function() {
            var node = this;

            node.editor.destroy();
            delete node.editor;

            node.initEditor.destroy();
            delete node.initEditor;

            node.finalizeEditor.destroy();
            delete node.finalizeEditor;
        },
        oneditresize: function(size) {
            var rows = $("#dialog-form>div:not(.node-text-editor-row)");
            var height = $("#dialog-form").height();
            for (var i=0; i<rows.length; i++) {
                height -= $(rows[i]).outerHeight(true);
            }
            var editorRow = $("#dialog-form>div.node-text-editor-row");
            height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
            $("#dialog-form .node-text-editor").css("height",height+"px");

            var height = size.height;
            $("#node-input-init-editor").css("height", (height - 83)+"px");
            $("#node-input-func-editor").css("height", (height - 83)+"px");
            $("#node-input-finalize-editor").css("height", (height - 83)+"px");

            this.initEditor.resize();
            this.editor.resize();
            this.finalizeEditor.resize();

            $("#node-input-libs-container").css("height", (height - 192)+"px");
        }
    });
})();
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="function">
    <p>定义对接收到的消息进行处理的JavaScript代码（函数的主体）。</p>
    <p>输入消息在名为<code>msg</code>的JavaScript对象中传递。</p>
    <p>通常，<code>msg</code>对象将消息正文保留在<code>msg.payload</code>属性中。</p>
    <p>该函数一般会返回一个消息对象（或多个消息对象），但也可以为了停止流而什么都不返回。</p>
    <h3>详细</h3>
    <p>请参见<a target="_blank" href="http://nodered.org/docs/writing-functions.html">在线文档</a>来获得更多有关编写函数的信息。</p>
    <h4>传送消息</h4>
    <p>要将消息传递到流中的下一个节点，请返回消息或调用<code>node.send(messages)</code>。</p>
    <p>它将返回/send:</p>
    <ul>
      <li>单个消息对象 - 传递给连接到第一个输出的节点</li>
      <li>消息对象数组，传递给连接到相应输出的节点</li>
    </ul>
    <p>如果数组元素是数组，则将多个消息发送到相应的输出。</p>
    <p>无论return方法是单个值还是数组元素，如果返回值为null，则不会发送任何消息。</p>
    <h4>日志输出和错误处理</h4>
    <p>使用以下功能输出日志信息和输出错误：</p>
      <ul>
          <li><code>node.log("Log message")</code></li>
          <li><code>node.warn("Warning")</code></li>
          <li><code>node.error("Error")</code></li>
      </ul>
    </p>
    <p>使用catch节点可以进行错误处理。 要由catch节点处理，请将<code>msg</code>作为<code>node.error</code>的第二个参数传递：</p>
    <pre>node.error("Error",msg);</pre>
    <h4>访问节点信息</h4>
    <p>您可以使用以下属性来在代码中引用节点ID和名称：</p>
    <ul>
        <li><code>node.id</code> - 节点的ID</li>
        <li><code>node.name</code> - 节点的名称</li>
    </ul>
    <h4>使用环境变量</h4>
    <p>环境变量可以通过<code>env.get("MY_ENV_VAR")</code>来进行访问。</p>
</script>

</div><div><!-- --- [red-module:node-red/switch] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="switch">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" style="width: calc(100% - 105px)" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-property"><i class="fa fa-ellipsis-h"></i> <span data-i18n="switch.label.property"></span></label>
        <input type="text" id="node-input-property" style="width: calc(100% - 105px)"/>
        <input type="hidden" id="node-input-outputs"/>
    </div>
    <div class="form-row node-input-rule-container-row">
        <ol id="node-input-rule-container"></ol>
    </div>
    <div class="form-row">
        <select id="node-input-checkall" style="width:100%; margin-right:5px;">
            <option value="true" data-i18n="switch.checkall"></option>
            <option value="false" data-i18n="switch.stopfirst"></option>
        </select>
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-input-repair" style="display: inline-block; width: auto; vertical-align: top;">
        <label style="width: auto;" for="node-input-repair"><span data-i18n="switch.label.repair"></span></label></input>
    </div>
</script>

<script type="text/javascript">
(function() {
    var operators = [
        {v:"eq",t:"==",kind:'V'},
        {v:"neq",t:"!=",kind:'V'},
        {v:"lt",t:"<",kind:'V'},
        {v:"lte",t:"<=",kind:'V'},
        {v:"gt",t:">",kind:'V'},
        {v:"gte",t:">=",kind:'V'},
        {v:"hask",t:"switch.rules.hask",kind:'V'},
        {v:"btwn",t:"switch.rules.btwn",kind:'V'},
        {v:"cont",t:"switch.rules.cont",kind:'V'},
        {v:"regex",t:"switch.rules.regex",kind:'V'},
        {v:"true",t:"switch.rules.true",kind:'V'},
        {v:"false",t:"switch.rules.false",kind:'V'},
        {v:"null",t:"switch.rules.null",kind:'V'},
        {v:"nnull",t:"switch.rules.nnull",kind:'V'},
        {v:"istype",t:"switch.rules.istype",kind:'V'},
        {v:"empty",t:"switch.rules.empty",kind:'V'},
        {v:"nempty",t:"switch.rules.nempty",kind:'V'},
        {v:"head",t:"switch.rules.head",kind:'S'},
        {v:"index",t:"switch.rules.index",kind:'S'},
        {v:"tail",t:"switch.rules.tail",kind:'S'},
        {v:"jsonata_exp",t:"switch.rules.exp",kind:'O'},
        {v:"else",t:"switch.rules.else",kind:'O'}
    ];

    var previousValueType = {value:"prev",label:RED._("node-red:switch.previous"),hasValue:false};
    function clipValueLength(v) {
        if (v.length > 15) {
            return v.substring(0,15)+"...";
        }
        return v;
    }
    function prop2name(key) {
        var result = RED.utils.parseContextKey(key);
        return result.key;
    }
    function getValueLabel(t,v) {
        if (t === 'str') {
            return '"'+clipValueLength(v)+'"';
        } else if (t === 'msg') {
            return t+"."+clipValueLength(v);
        } else if (t === 'flow' || t === 'global') {
            return t+"."+clipValueLength(prop2name(v));
        }
        return clipValueLength(v);
    }

    function exportRule(rule) {
        var type = rule.find("select").val();
        var r = {t:type};
        if (!(type === "true" || type === "false" || type === "null" || type === "nnull" || type === "empty" || type === "nempty" || type === "else")) {
            if ((type === "btwn") || (type === "index")) {
                r.v = rule.find(".node-input-rule-btwn-value").typedInput('value');
                r.vt = rule.find(".node-input-rule-btwn-value").typedInput('type');
                r.v2 = rule.find(".node-input-rule-btwn-value2").typedInput('value');
                r.v2t = rule.find(".node-input-rule-btwn-value2").typedInput('type');
            } else if ((type === "head") || (type === "tail")) {
                r.v = rule.find(".node-input-rule-num-value").typedInput('value');
                r.vt = rule.find(".node-input-rule-num-value").typedInput('type');
            } else if (type === "istype") {
                r.v = rule.find(".node-input-rule-type-value").typedInput('type');
                r.vt = rule.find(".node-input-rule-type-value").typedInput('type');
            } else if (type === "jsonata_exp") {
                r.v = rule.find(".node-input-rule-exp-value").typedInput('value');
                r.vt = rule.find(".node-input-rule-exp-value").typedInput('type');
            } else {
                r.v = rule.find(".node-input-rule-value").typedInput('value');
                r.vt = rule.find(".node-input-rule-value").typedInput('type');
            }
            if (type === "regex") {
                r.case = rule.find(".node-input-rule-case").prop("checked");
            }
        }
        return r;
    }

    function createValueField(row, defaultType){
        return $('<input/>',{class:"node-input-rule-value",type:"text",style:"width: 100%;"}).appendTo(row)
            .typedInput({default:defaultType||'str',types:['msg','flow','global','str','num','jsonata','env',previousValueType]});
    }

    function createNumValueField(row, defaultType){
        return $('<input/>',{class:"node-input-rule-num-value",type:"text",style:"width: 100%;"}).appendTo(row)
            .typedInput({default:defaultType||'num',types:['flow','global','num','jsonata','env']});
    }

    function createExpValueField(row){
        return $('<input/>',{class:"node-input-rule-exp-value",type:"text",style:"width: 100%;"}).appendTo(row)
            .typedInput({default:'jsonata',types:['jsonata']});
    }

    function createBtwnValueField(row, defaultType){
        return $('<input/>',{class:"node-input-rule-btwn-value",type:"text",style:"width: 100%;"}).appendTo(row)
                .typedInput({default:defaultType||'num',types:['msg','flow','global','str','num','jsonata','env',previousValueType]});
    }

    function createBtwnValue2Field(row3, andLabel, defaultType){
        $('<div/>',{class:"node-input-rule-btwn-label", style:"width: 120px; text-align: right;"}).text(" "+andLabel+" ").appendTo(row3);
        var row3InputCell = $('<div/>',{style:"flex-grow:1; margin-left: 5px;"}).appendTo(row3);
        return $('<input/>',{class:"node-input-rule-btwn-value2",type:"text",style:"width: 100%"}).appendTo(row3InputCell)
            .typedInput({default:defaultType||'num',types:['msg','flow','global','str','num','jsonata','env',previousValueType]});
    }

    function createTypeValueField(row, defaultType){
        return $('<input/>',{class:"node-input-rule-type-value",type:"text",style:"width: 100%;"}).appendTo(row).typedInput({default:defaultType || 'string',types:[
            {value:"string",label:RED._("common.type.string"),hasValue:false,icon:"red/images/typedInput/az.png"},
            {value:"number",label:RED._("common.type.number"),hasValue:false,icon:"red/images/typedInput/09.png"},
            {value:"boolean",label:RED._("common.type.boolean"),hasValue:false,icon:"red/images/typedInput/bool.png"},
            {value:"array",label:RED._("common.type.array"),hasValue:false,icon:"red/images/typedInput/json.png"},
            {value:"buffer",label:RED._("common.type.buffer"),hasValue:false,icon:"red/images/typedInput/bin.png"},
            {value:"object",label:RED._("common.type.object"),hasValue:false,icon:"red/images/typedInput/json.png"},
            {value:"json",label:RED._("common.type.jsonString"),hasValue:false,icon:"red/images/typedInput/json.png"},
            {value:"undefined",label:RED._("common.type.undefined"),hasValue:false},
            {value:"null",label:RED._("common.type.null"),hasValue:false}
        ]});
    }

    RED.nodes.registerType('switch', {
        color: "#E2D96E",
        category: 'function',
        defaults: {
            name: {value:""},
            property: {value:"payload", required:true, validate: RED.validators.typedInput("propertyType")},
            propertyType: { value:"msg" },
            rules: {value:[{t:"eq", v:"", vt:"str"}]},
            checkall: {value:"true", required:true},
            repair: {value:false},
            outputs: {value:1}
        },
        inputs: 1,
        outputs: 1,
        outputLabels: function(index) {
            var rule = this.rules[index];
            var label = "";
            if (rule) {
                for (var i=0;i<operators.length;i++) {
                    if (operators[i].v === rule.t) {
                        label = /^switch/.test(operators[i].t)?this._(operators[i].t):operators[i].t;
                        break;
                    }
                }
                if ((rule.t === 'btwn') || (rule.t === 'index')) {
                    label += " "+getValueLabel(rule.vt,rule.v)+" & "+getValueLabel(rule.v2t,rule.v2);
                } else if (rule.t !== 'true' && rule.t !== 'false' && rule.t !== 'null' && rule.t !== 'nnull' && rule.t !== 'empty' && rule.t !== 'nempty' && rule.t !== 'else' ) {
                    label += " "+getValueLabel(rule.vt,rule.v);
                }
                return label;
            }
        },
        icon: "switch.svg",
        label: function() {
            return this.name||this._("switch.switch");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;


            $("#node-input-property").typedInput({default:this.propertyType||'msg',types:['msg','flow','global','jsonata','env']});
            var outputCount = $("#node-input-outputs").val("{}");

            var andLabel = this._("switch.and");
            var caseLabel = this._("switch.ignorecase");

            $("#node-input-rule-container").css('min-height','150px').css('min-width','450px').editableList({
                addItem: function(container,i,opt) {
                    var focusValueField = false;
                    if (!opt.hasOwnProperty('r')) {
                        opt.r = {};
                        if (i > 0) {
                            var lastRule = $("#node-input-rule-container").editableList('getItemAt',i-1);
                            var exportedRule = exportRule(lastRule.element);
                            opt.r.vt = exportedRule.vt;
                            opt.r.v = "";
                            // We could copy the value over as well and preselect it (see the 'activeElement' code below)
                            // But not sure that feels right. Is copying over the last value 'expected' behaviour?
                            // It would make sense for an explicit 'copy' action, but not sure where the copy button would
                            // go for each rule without being wasted space for most users.
                            // opt.r.v = exportedRule.v;
                            focusValueField = true;
                        }
                    }

                    opt.element = container;
                    var rule = opt.r;
                    if (!rule.hasOwnProperty('t')) {
                        rule.t = 'eq';
                    }
                    if (!opt.hasOwnProperty('i')) {
                        opt._i = Math.floor((0x99999-0x10000)*Math.random()).toString();
                    }
                    container.css({
                        overflow: 'hidden',
                        whiteSpace: 'nowrap',
                        display: "flex",
                        "align-items":"center"
                    });
                    var inputRows = $('<div></div>',{style:"flex-grow:1"}).appendTo(container);
                    var row = $('<div></div>',{style:"display: flex;"}).appendTo(inputRows);
                    var row2 = $('<div/>',{style:"display: flex; padding-top: 5px; padding-left: 175px;"}).appendTo(inputRows);
                    var row3 = $('<div/>',{style:"display: flex; padding-top: 5px; align-items: center"}).appendTo(inputRows);

                    var selectField = $('<select/>',{style:"width:120px; text-align: center;"}).appendTo(row);
                    var group0 = $('<optgroup/>', { label: "value rules" }).appendTo(selectField);
                    for (var d in operators) {
                        if(operators[d].kind === 'V') {
                            group0.append($("<option></option>").val(operators[d].v).text(/^switch/.test(operators[d].t)?node._(operators[d].t):operators[d].t));
                        }
                    }
                    var group1 = $('<optgroup/>', { label: "sequence rules" }).appendTo(selectField);
                    for (var d in operators) {
                        if(operators[d].kind === 'S') {
                            group1.append($("<option></option>").val(operators[d].v).text(/^switch/.test(operators[d].t)?node._(operators[d].t):operators[d].t));
                        }
                    }
                    for (var d in operators) {
                        if(operators[d].kind === 'O') {
                            selectField.append($("<option></option>").val(operators[d].v).text(/^switch/.test(operators[d].t)?node._(operators[d].t):operators[d].t));
                        }
                    }

                    var rowInputCell = $('<div>',{style:"flex-grow:1; margin-left: 5px;"}).appendTo(row);


                    var valueField = null;
                    var numValueField = null;
                    var expValueField = null;
                    var btwnAndLabel = null;
                    var btwnValueField = null;
                    var btwnValue2Field = null;
                    var typeValueField = null;

                    var finalspan = $('<span/>',{style:"margin-left: 5px;"}).appendTo(container);
                    finalspan.append(' &#8594; <span class="node-input-rule-index">'+(i+1)+'</span> ');

                    var caseSensitive = $('<input/>',{id:"node-input-rule-case-"+i,class:"node-input-rule-case",type:"checkbox",style:"width:auto;vertical-align:top"}).appendTo(row2);
                    $('<label/>',{for:"node-input-rule-case-"+i,style:"margin-left: 3px;"}).text(caseLabel).appendTo(row2);

                    selectField.on("change", function() {
                        var fieldToFocus;
                        var type = selectField.val();
                        if (valueField) { valueField.typedInput('hide'); }
                        if (expValueField) { expValueField.typedInput('hide'); }
                        if (numValueField) { numValueField.typedInput('hide'); }
                        if (typeValueField) { typeValueField.typedInput('hide'); }
                        if (btwnValueField) { btwnValueField.typedInput('hide'); }
                        if (btwnValue2Field) { btwnValue2Field.typedInput('hide'); }

                        if ((type === "btwn") || (type === "index")) {
                            if (!btwnValueField){
                                btwnValueField = createBtwnValueField(rowInputCell);
                            }
                            btwnValueField.typedInput('show');
                            fieldToFocus = btwnValueField;
                        } else if ((type === "head") || (type === "tail")) {
                            if (!numValueField){
                                numValueField = createNumValueField(rowInputCell);
                            }
                            numValueField.typedInput('show');
                            fieldToFocus = numValueField;
                        } else if (type === "jsonata_exp") {
                            if (!expValueField){
                                expValueField = createExpValueField(rowInputCell);
                            }
                            expValueField.typedInput('show');
                            fieldToFocus = expValueField;

                        } else if (type === "istype") {
                            if (!typeValueField){
                                typeValueField = createTypeValueField(rowInputCell);
                            }
                            typeValueField.typedInput('show');
                            fieldToFocus = typeValueField;
                        } else if (! (type === "true" || type === "false" || type === "null" || type === "nnull" || type === "empty" || type === "nempty" || type === "else" )) {
                                if (!valueField){
                                    valueField = createValueField(rowInputCell);
                                }
                                valueField.typedInput('show');
                                fieldToFocus = valueField;
                        }
                        if (type === "regex") {
                            row2.show();
                            row3.hide();
                        } else if ((type === "btwn") || (type === "index")) {
                            row2.hide();
                            row3.show();
                            if (!btwnValue2Field){
                                btwnValue2Field = createBtwnValue2Field(row3, andLabel);
                            }
                            btwnValue2Field.typedInput('show');
                        } else {
                            row2.hide();
                            row3.hide();
                        }
                        var selectedLabel = selectField.find("option:selected").text();
                        if (selectedLabel.length <= 5) {
                            selectField.outerWidth(60);
                        } else if (selectedLabel.length < 12) {
                            selectField.outerWidth(120);
                        } else {
                            selectField.width("auto")
                        }
                        if (fieldToFocus) {
                            fieldToFocus.typedInput("focus");
                        }
                        // Preselect the contents of the element
                        // if (focusValueField && document.activeElement) {
                        //     document.activeElement.selectionStart = 0;
                        //     document.activeElement.selectionEnd = document.activeElement.value.length;
                        // }
                    });
                    selectField.val(rule.t);

                    if ((rule.t == "btwn") || (rule.t == "index")) {
                        btwnValueField = createBtwnValueField(rowInputCell,rule.vt||'num');
                        btwnValueField.typedInput('value',rule.v);
                        btwnValue2Field = createBtwnValue2Field(row3, andLabel,rule.v2t||'num');
                        btwnValue2Field.typedInput('value',rule.v2);
                    } else if ((rule.t === "head") || (rule.t === "tail")) {
                        numValueField = createNumValueField(rowInputCell,rule.vt||'num');
                        numValueField.typedInput('value',rule.v);
                    } else if (rule.t === "istype") {
                        typeValueField = createTypeValueField(rowInputCell,rule.vt);
                        typeValueField.typedInput('value',rule.vt);
                    } else if (rule.t === "jsonata_exp") {
                        expValueField = createExpValueField(rowInputCell,rule.vt||'jsonata');
                        expValueField.typedInput('value',rule.v);
                    } else if (typeof rule.v != "undefined") {
                        valueField = createValueField(rowInputCell,rule.vt||'str');
                        valueField.typedInput('value',rule.v);
                    }
                    caseSensitive.prop('checked',!!rule.case);
                    selectField.change();

                    var currentOutputs = JSON.parse(outputCount.val()||"{}");
                    currentOutputs[opt.hasOwnProperty('i')?opt.i:opt._i] = i;
                    outputCount.val(JSON.stringify(currentOutputs));
                },
                removeItem: function(opt) {
                    var currentOutputs = JSON.parse(outputCount.val()||"{}");
                    if (opt.hasOwnProperty('i')) {
                        currentOutputs[opt.i] = -1;
                    } else {
                        delete currentOutputs[opt._i];
                    }
                    var rules = $("#node-input-rule-container").editableList('items');
                    rules.each(function(i) {
                        $(this).find(".node-input-rule-index").html(i+1);
                        var data = $(this).data('data');
                        currentOutputs[data.hasOwnProperty('i')?data.i:data._i] = i;
                    });
                    outputCount.val(JSON.stringify(currentOutputs));
                },
                sortItems: function(rules) {
                    var currentOutputs = JSON.parse(outputCount.val()||"{}");
                    var rules = $("#node-input-rule-container").editableList('items');
                    rules.each(function(i) {
                        $(this).find(".node-input-rule-index").html(i+1);
                        var data = $(this).data('data');
                        currentOutputs[data.hasOwnProperty('i')?data.i:data._i] = i;
                    });
                    outputCount.val(JSON.stringify(currentOutputs));
                },
                sortable: true,
                removable: true
            });

            for (var i=0;i<this.rules.length;i++) {
                var rule = this.rules[i];
                $("#node-input-rule-container").editableList('addItem',{r:rule,i:i});
            }
        },
        oneditsave: function() {
            var rules = $("#node-input-rule-container").editableList('items');
            var node = this;
            node.rules = [];
            rules.each(function(i) {
                node.rules.push(exportRule($(this)));
            });
            this.propertyType = $("#node-input-property").typedInput('type');
        },
        oneditresize: function(size) {
            var rows = $("#dialog-form>div:not(.node-input-rule-container-row)");
            var height = size.height;
            for (var i=0;i<rows.length;i++) {
                height -= $(rows[i]).outerHeight(true);
            }
            var editorRow = $("#dialog-form>div.node-input-rule-container-row");
            height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
            height += 16;
            $("#node-input-rule-container").editableList('height',height);
        }
    });
})();
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="switch">
    <p>按属性值来分配消息的传送路线。</p>
    <h3>详细</h3>
    <p>根据接收到的消息评估指定的规则，然后将消息发送到与匹配的规则相对应的输出端口。</p>
    <p>可以将节点设置为一旦发现一个匹配的规则，则停止后续的匹配。</p>
    <p>对于评估规则，可以使用消息属性，流上下文/全局上下文属性，环境变量和JSONata表达式的评估结果。</p>
    <h4>规则</h4>
    <p>有四种规则：</p>
    <ol>
        <li><b>值</b>根据配置的属性评估规则</li>
        <li><b>顺序</b>可用于消息序列的规则，例如由“拆分”节点生成的规则</li>
        <li><b>JSONata表达式</b>评估整个消息，如果结果为真，则匹配。</li>
        <li><b>其他</b>上述规则都不匹配时适用</li>
    </ol>
    <h4>注释</h4>
    <p><code>is true/false</code>与<code>is null</code> 规则将对类型进行严格的匹配。匹配之前的类型转化不会发生。</p>
    <p><code>is empty</code>规则与零字节的字符串，数组，缓冲区或没有属性的对象相匹配。与<code>null</code>或者<code>undefined</code>等不匹配。</p>
    <h4>处理消息序列</h4>
    <p>默认情况下，节点不会修改<code>msg.parts</code>属性。</p>
    <p>可以启用<b>重建消息序列</b>选项来为每条匹配的规则生成新的消息序列。在这种模式下，节点将在发送新序列之前对整个传入序列进行缓存。运行时的设定<code>nodeMessageBufferMaxLength</code>可以用来限制可缓存的消息数目。</p>
</script>

</div><div><!-- --- [red-module:node-red/change] --- -->

<script type="text/html" data-template-name="change">
    <style>
        ol#node-input-rule-container .red-ui-typedInput-container {
            flex:1;
        }
    </style>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" style="width: calc(100% - 105px)"  data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row" style="margin-bottom:0;">
        <label><i class="fa fa-list"></i> <span data-i18n="change.label.rules"></span></label>
    </div>
    <div class="form-row node-input-rule-container-row">
        <ol id="node-input-rule-container"></ol>
    </div>
</script>

<script type="text/javascript">
(function() {
    function validateProperty(v,vt) {
        if (/msg|flow|global/.test(vt)) {
            if (!RED.utils.validatePropertyExpression(v)) {
                return false;
            }
        } else if (vt === "jsonata") {
            try{jsonata(v);}catch(e){return false;}
        } else if (vt === "json") {
            try{JSON.parse(v);}catch(e){return false;}
        }
        return true;
    }
    RED.nodes.registerType('change', {
        color: "#E2D96E",
        category: 'function',
        defaults: {
            name: {value:""},
            rules:{value:[{t:"set",p:"payload",pt:"msg",to:"",tot:"str"}],validate: function(rules) {
                if (!rules || rules.length === 0) { return true }
                for (var i=0;i<rules.length;i++) {
                    var r = rules[i];
                    if (r.t === 'set') {
                        if (!validateProperty(r.p,r.pt) || !validateProperty(r.to,r.tot)) {
                            return false;
                        }
                    } else if (r.t === 'change') {
                        if (!validateProperty(r.p,r.pt) || !validateProperty(r.from,r.fromt) || !validateProperty(r.to,r.tot)) {
                            return false;
                        }
                    } else if (r.t === 'move') {
                        if (!validateProperty(r.p,r.pt)) {
                            return false;
                        }
                    }
                }
                return true;
            }},
            // legacy
            action: {value:""},
            property: {value:""},
            from: {value:""},
            to: {value:""},
            reg: {value:false}
        },
        inputs: 1,
        outputs: 1,
        icon: "swap.svg",
        label: function() {
            function prop2name(type, key) {
                var result = RED.utils.parseContextKey(key);
                return type +"." +result.key;
            }
            if (this.name) {
                return this.name;
            }
            if (!this.rules) {
                if (this.action === "replace") {
                    return this._("change.label.set",{property:"msg."+this.property});
                } else if (this.action === "change") {
                    return this._("change.label.change",{property:"msg."+this.property});
                } else if (this.action === "move") {
                    return this._("change.label.move",{property:"msg."+this.property});
                } else {
                    return this._("change.label.delete",{property:"msg."+this.property});
                }
            } else {
                if (this.rules.length == 1) {
                    if (this.rules[0].t === "set") {
                        return this._("change.label.set",{property:prop2name((this.rules[0].pt||"msg"), this.rules[0].p)});
                    } else if (this.rules[0].t === "change") {
                        return this._("change.label.change",{property:prop2name((this.rules[0].pt||"msg"), this.rules[0].p)});
                    } else if (this.rules[0].t === "move") {
                        return this._("change.label.move",{property:prop2name((this.rules[0].pt||"msg"), this.rules[0].p)});
                    } else {
                        return this._("change.label.delete",{property:prop2name((this.rules[0].pt||"msg"), this.rules[0].p)});
                    }
                } else {
                    return this._("change.label.changeCount",{count:this.rules.length});
                }
            }
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function() {
            var set = this._("change.action.set");
            var change = this._("change.action.change");
            var del = this._("change.action.delete");
            var move = this._("change.action.move");
            var to = this._("change.action.to");
            var toValueLabel = this._("change.action.toValue",to);
            var search = this._("change.action.search");
            var replace = this._("change.action.replace");
            var regex = this._("change.label.regex");
            var deepCopyLabel = this._("change.label.deepCopy");

            function createPropertyValue(row2_1, row2_2, defaultType) {
                var propValInput = $('<input/>',{class:"node-input-rule-property-value",type:"text"})
                    .appendTo(row2_1)
                    .typedInput({default:defaultType||'str',types:['msg','flow','global','str','num','bool','json','bin','date','jsonata','env']});

                var dcLabel = $('<label style="padding-left: 130px;"></label>').appendTo(row2_2);
                var deepCopy = $('<input type="checkbox" class="node-input-rule-property-deepCopy" style="width: auto; margin: 0 6px 0 0">').appendTo(dcLabel)
                $('<span>').text(deepCopyLabel).appendTo(dcLabel)

                propValInput.on("change", function(evt,type,val) {
                    row2_2.toggle(type === "msg" || type === "flow" || type === "global" || type === "env");
                })
                return [propValInput, deepCopy];
            }
            function createFromValue(row3_1, defaultType) {
                return $('<input/>',{class:"node-input-rule-property-search-value",type:"text"})
                .appendTo(row3_1)
                .typedInput({default:defaultType||'str',types:['msg','flow','global','str','re','num','bool','env']});
            }
            function createToValue(row3_2, defaultType) {
                return $('<input/>',{class:"node-input-rule-property-replace-value",type:"text"})
                .appendTo(row3_2)
                .typedInput({default:defaultType||'str',types:['msg','flow','global','str','num','bool','json','bin','env']});
            }
            function createMoveValue(row4, defaultType) {
                return $('<input/>',{class:"node-input-rule-property-move-value",type:"text"})
                .appendTo(row4)
                .typedInput({default:defaultType||'msg',types:['msg','flow','global']});
            }

            $('#node-input-rule-container').css('min-height','150px').css('min-width','450px').editableList({
                addItem: function(container,i,opt) {
                    var rule = opt;
                    if (!rule.hasOwnProperty('t')) {
                        rule = {t:"set",p:"payload",to:"",tot:"str"};
                    }
                    if (rule.t === "change" && rule.re) {
                        rule.fromt = 're';
                        delete rule.re;
                    }
                    if (rule.t === "set" && !rule.tot) {
                        if (rule.to.indexOf("msg.") === 0 && !rule.tot) {
                            rule.to = rule.to.substring(4);
                            rule.tot = "msg";
                        } else {
                            rule.tot = "str";
                        }
                    }
                    if (rule.t === "move" && !rule.tot) {
                        rule.tot = "msg";
                    }
                    container.css({
                        overflow: 'hidden',
                        whiteSpace: 'nowrap'
                    });
                    let fragment = document.createDocumentFragment();
                    var row1 = $('<div/>',{style:"display:flex; align-items: baseline"}).appendTo(fragment);
                    var row2 = $('<div/>',{style:"margin-top:8px;"}).appendTo(fragment);
                    var row3 = $('<div/>',{style:"margin-top:8px;"}).appendTo(fragment);
                    var row4 = $('<div/>',{style:"display:flex;margin-top:8px;align-items: baseline"}).appendTo(fragment);

                    var selectField = $('<select/>',{class:"node-input-rule-type",style:"width:110px; margin-right:10px;"}).appendTo(row1);
                    var selectOptions = [{v:"set",l:set},{v:"change",l:change},{v:"delete",l:del},{v:"move",l:move}];
                    for (var i=0; i<4; i++) {
                        selectField.append($("<option></option>").val(selectOptions[i].v).text(selectOptions[i].l));
                    }

                    var propertyName = $('<input/>',{class:"node-input-rule-property-name",type:"text"})
                        .appendTo(row1)
                        .typedInput({types:['msg','flow','global']});

                    var row2_1 = $('<div/>', {style:"display:flex;align-items: baseline"}).appendTo(row2);
                    $('<div/>',{style:"display:inline-block;text-align:right; width:120px; padding-right:10px; box-sizing:border-box;"})
                        .text(toValueLabel)
                        .appendTo(row2_1);

                    var row2_2 = $('<div/>', {style:"margin-top: 4px;"}).appendTo(row2);

                    var row3_1 = $('<div/>', {style:"display:flex;align-items: baseline"}).appendTo(row3);
                    $('<div/>',{style:"display:inline-block;text-align:right; width:120px; padding-right:10px; box-sizing:border-box;"})
                        .text(search)
                        .appendTo(row3_1);

                    var row3_2 = $('<div/>',{style:"display:flex;margin-top:8px;align-items: baseline"}).appendTo(row3);
                    $('<div/>',{style:"display:inline-block;text-align:right; width:120px; padding-right:10px; box-sizing:border-box;"})
                        .text(replace)
                        .appendTo(row3_2);

                    $('<div/>',{style:"display:inline-block;text-align:right; width:120px; padding-right:10px; box-sizing:border-box;"})
                        .text(to)
                        .appendTo(row4);

                    let propertyValue = null;
                    let fromValue = null;
                    let toValue = null;
                    let moveValue = null;

                    selectField.on("change", function() {
                        var type = $(this).val();
                        if (propertyValue) {
                            propertyValue.typedInput('hide');
                        }
                        if (fromValue) {
                            fromValue.typedInput('hide');
                        }
                        if (toValue) {
                            toValue.typedInput('hide');
                        }
                        if (moveValue) {
                            moveValue.typedInput('hide');
                        }

                        if (type == "set") {
                            if(!propertyValue) {
                                var parts = createPropertyValue(row2_1, row2_2);
                                propertyValue = parts[0];
                                deepCopy = parts[1];
                            }
                            propertyValue.typedInput('show');
                            row2.show();
                            row3.hide();
                            row4.hide();
                        } else if (type == "change") {
                            if(!fromValue) {
                                fromValue = createFromValue(row3_1);
                            }
                            fromValue.typedInput('show');
                            if(!toValue) {
                                toValue = createToValue(row3_2);
                            }
                            toValue.typedInput('show');
                            row2.hide();
                            row3.show();
                            row4.hide();
                        } else if (type == "delete") {
                            row2.hide();
                            row3.hide();
                            row4.hide();
                        } else if (type == "move") {
                            if(!moveValue) {
                                moveValue = createMoveValue(row4);
                            }
                            moveValue.typedInput('show');
                            row2.hide();
                            row3.hide();
                            row4.show();
                        }
                    });

                    selectField.val(rule.t);
                    propertyName.typedInput('value',rule.p);
                    propertyName.typedInput('type',rule.pt);
                    if (rule.t == "set") {
                        var parts = createPropertyValue(row2_1, row2_2, rule.tot);
                        propertyValue = parts[0];
                        deepCopy = parts[1];
                        propertyValue.typedInput('value',rule.to);
                        deepCopy.prop("checked", !!rule.dc);
                    }
                    if (rule.t == "move") {
                        moveValue = createMoveValue(row4,rule.tot);
                        moveValue.typedInput('value',rule.to);
                    }
                    if (rule.t == "change") {
                        fromValue = createFromValue(row3_1, rule.fromt);
                        fromValue.typedInput('value',rule.from);

                        toValue = createToValue(row3_2,rule.tot);
                        toValue.typedInput('value',rule.to);
                    }
                    selectField.change();
                    container[0].appendChild(fragment);
                },
                removable: true,
                sortable: true
            });

            if (!this.rules) {
                var rule = {
                    t:(this.action=="replace"?"set":this.action),
                    p:this.property,
                    pt:"msg"
                };

                if ((rule.t === "set")||(rule.t === "move")) {
                    rule.to = this.to;
                } else if (rule.t === "change") {
                    rule.from = this.from;
                    rule.to = this.to;
                    rule.re = this.reg;
                }

                delete this.to;
                delete this.from;
                delete this.reg;
                delete this.action;
                delete this.property;

                this.rules = [rule];
            }

            for (var i=0; i<this.rules.length; i++) {
                var rule = this.rules[i];
                $("#node-input-rule-container").editableList('addItem',rule);
            }
        },
        oneditsave: function() {
            var rules = $("#node-input-rule-container").editableList('items');
            var node = this;
            node.rules= [];
            rules.each(function(i) {
                var rule = $(this);
                var type = rule.find(".node-input-rule-type").val();
                var r = {
                    t:type,
                    p:rule.find(".node-input-rule-property-name").typedInput('value'),
                    pt:rule.find(".node-input-rule-property-name").typedInput('type')
                };
                if (type === "set") {
                    r.to = rule.find(".node-input-rule-property-value").typedInput('value');
                    r.tot = rule.find(".node-input-rule-property-value").typedInput('type');
                    if (rule.find(".node-input-rule-property-deepCopy").prop("checked")) {
                        r.dc = true;
                    }
                } else if (type === "move") {
                    r.to = rule.find(".node-input-rule-property-move-value").typedInput('value');
                    r.tot = rule.find(".node-input-rule-property-move-value").typedInput('type');
                } else if (type === "change") {
                    r.from = rule.find(".node-input-rule-property-search-value").typedInput('value');
                    r.fromt = rule.find(".node-input-rule-property-search-value").typedInput('type');
                    r.to = rule.find(".node-input-rule-property-replace-value").typedInput('value');
                    r.tot = rule.find(".node-input-rule-property-replace-value").typedInput('type');
                }
                node.rules.push(r);
            });
        },
        oneditresize: function(size) {
            var rows = $("#dialog-form>div:not(.node-input-rule-container-row)");
            var height = size.height;
            for (var i=0; i<rows.length; i++) {
                height -= $(rows[i]).outerHeight(true);
            }
            var editorRow = $("#dialog-form>div.node-input-rule-container-row");
            height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
            height += 16;
            $("#node-input-rule-container").editableList('height',height);
        }
    });
})();
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="change">
    <p>设置，更改，删除或移动消息，流上下文或全局上下文的属性。</p>
    <p>如果指定了多个规则，则将按定义的顺序来应用它们。</p>
    <h3>详细</h3>
    <p>可用的操作有：</p>
    <dl class="message-properties">
    <dt>设置</dt>
    <dd>设置一个属性。该值可以是多种不同类型，也可以从现有消息或上下文属性中获取。</dd>
    <dt>置换</dt>
    <dd>搜索并替换属性。 如果启用了正则表达式，则可以为“replace with”属性指定捕获组，例如<code>$1</code>。 在替换过程中，仅当规则完全匹配时才能更改属性类型。</dd>
    <dt>删除</dt>
    <dd>删除一个属性</dd>
    <dt>移动</dt>
    <dd>移动或者重命名一个属性</dd>
    </dl>
    <p>类型"expression"使用<a href="http://jsonata.org/" target="_new">JSONata</a>语言。</p>
</script>

</div><div><!-- --- [red-module:node-red/range] --- -->

<script type="text/html" data-template-name="range">
    <div class="form-row">
        <label for="node-input-property"><i class="fa fa-ellipsis-h"></i> <span data-i18n="common.label.property"></span></label>
        <input type="text" id="node-input-property" style="width:calc(70% - 1px)"/>
    </div>
    <div class="form-row">
        <label for="node-input-action"><i class="fa fa-dot-circle-o"></i> <span data-i18n="range.label.action"></span></label>
        <select id="node-input-action" style="width:70%;">
            <option value="scale" data-i18n="range.scale.payload"></option>
            <option value="clamp" data-i18n="range.scale.limit"></option>
            <option value="roll" data-i18n="range.scale.wrap"></option>
        </select>
    </div>
    <br/>
    <div class="form-row"><i class="fa fa-sign-in"></i> <span data-i18n="range.label.inputrange"></span>:</div>
    <div class="form-row"><label></label>
        <span data-i18n="range.label.from"></span>: <input type="text" id="node-input-minin" data-i18n="[placeholder]range.placeholder.min" style="width:100px;"/>
        &nbsp;&nbsp;<span data-i18n="range.label.to"></span>: <input type="text" id="node-input-maxin" data-i18n="[placeholder]range.placeholder.maxin" style="width:100px;"/>
    </div>
    <div class="form-row"><i class="fa fa-sign-out"></i> <span data-i18n="range.label.resultrange"></span>:</div>
    <div class="form-row"><label></label>
        <span data-i18n="range.label.from"></span>: <input type="text" id="node-input-minout" data-i18n="[placeholder]range.placeholder.min" style="width:100px;"/>
        &nbsp;&nbsp;<span data-i18n="range.label.to"></span>: <input type="text" id="node-input-maxout" data-i18n="[placeholder]range.placeholder.maxout" style="width:100px;"/>
    </div>
    <br/>
    <div class="form-row"><label></label>
        <input type="checkbox" id="node-input-round" style="display: inline-block; width: auto; vertical-align: top;">
        <label style="width: auto;" for="node-input-round"><span data-i18n="range.label.roundresult"></span></label></input>
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips" id="node-tip"><span data-i18n="range.tip"></span></div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('range', {
        color: "#E2D96E",
        category: 'function',
        defaults: {
            minin: {value:"",required:true,validate:RED.validators.number()},
            maxin: {value:"",required:true,validate:RED.validators.number()},
            minout: {value:"",required:true,validate:RED.validators.number()},
            maxout: {value:"",required:true,validate:RED.validators.number()},
            action: {value:"scale"},
            round: {value:false},
            property: {value:"payload",required:true},
            name: {value:""}
        },
        inputs: 1,
        outputs: 1,
        icon: "range.svg",
        label: function() {
            if (this.minout !== "" && this.maxout !== "") { return this.name||this.minout + " - " + this.maxout; }
            else { return this.name||this._("range.range"); }
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function() {
            if (this.property === undefined) {
                $("#node-input-property").val("payload");
            }
            $("#node-input-property").typedInput({default:'msg',types:['msg']});
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="range">
    <p>将数值映射为另一个区间的数值</p>
    <h3>输入</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">数值</span></dt>
        <dd>有效荷载<i>一定</i>得是一个数值. 否则则会映射失败。</dd>
    </dl>
    <h3>输出</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">数值</span></dt>
        <dd>被映射到新区间的数值。</dd>
    </dl>
    <h3>详细</h3>
    <p>该节点将线性缩放所接收到的数值。在默认情况下，结果不限于节点中定义的范围。</p>
    <p><i>缩放并限制到目标范围</i>表示结果永远不会超出目标范围内指定的范围。</p>
    <p><i>在目标范围内缩放并折叠</i>表示结果将会被限制（折叠）在目标范围内。</p>
    <p>例如，输入0-10映射到0-100。</p>
    <table style="outline-width:#888 solid thin">
        <tr><th width="80px">模式</th><th width="80px">输入</th><th width="80px">输出</th></tr>
        <tr><td><center>scale</center></td><td><center>12</center></td><td><center>120</center></td></tr>
        <tr><td><center>limit</center></td><td><center>12</center></td><td><center>100</center></td></tr>
        <tr><td><center>wrap</center></td><td><center>12</center></td><td><center>20</center></td></tr>
    </table>
</script>

</div><div><!-- --- [red-module:node-red/template] --- -->

<script type="text/html" data-template-name="template">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <div style="display: inline-block; width: calc(100% - 105px)"><input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name"></div>
    </div>
    <div class="form-row">
        <label for="node-input-field"><i class="fa fa-ellipsis-h"></i> <span data-i18n="template.label.property"></span></label>
        <input type="text" id="node-input-field" placeholder="payload" style="width:250px;">
        <input type="hidden" id="node-input-fieldType">
    </div>
    <div class="form-row" style="position: relative; margin-bottom: 0px;">
        <label for="node-input-template"><i class="fa fa-file-code-o"></i> <span data-i18n="template.label.template"></span></label>
        <input type="hidden" id="node-input-template" autofocus="autofocus">
        <div style="position: absolute; right:0;display:inline-block; text-align: right; font-size: 0.8em;">
            <span data-i18n="template.label.format"></span>:
            <select id="node-input-format" style="width:110px; font-size: 10px !important;  height: 24px; padding:0;">
                <option value="handlebars">mustache</option>
                <option value="html">HTML</option>
                <option value="json">JSON</option>
                <option value="javascript">Javascript</option>
                <option value="css">CSS</option>
                <option value="markdown">Markdown</option>
                <option value="python">Python</option>
                <option value="sql">SQL</option>
                <option value="yaml">YAML</option>
                <option value="text" data-i18n="template.label.none"></option>
            </select>
            <button id="node-template-expand-editor" class="red-ui-button red-ui-button-small"><i class="fa fa-expand"></i></button>
        </div>
    </div>
    <div class="form-row node-text-editor-row">
        <div style="height: 250px; min-height:150px;" class="node-text-editor" id="node-input-template-editor" ></div>
    </div>
    <div class="form-row">
        <label for="node-input-syntax"><i class="fa fa-code"></i> <span data-i18n="template.label.syntax"></span></label>
        <select id="node-input-syntax" style="width:180px;">
            <option value="mustache" data-i18n="template.label.mustache"></option>
            <option value="plain" data-i18n="template.label.plain"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-output"><i class="fa fa-long-arrow-right"></i> <span data-i18n="template.label.output"></span></label>
        <select id="node-input-output" style="width:180px;">
            <option value="str" data-i18n="template.label.plain"></option>
            <option value="json" data-i18n="template.label.json"></option>
            <option value="yaml" data-i18n="template.label.yaml"></option>
        </select>
    </div>

</script>

<script type="text/javascript">
    RED.nodes.registerType('template',{
        color:"rgb(243, 181, 103)",
        category: 'function',
        defaults: {
            name: {value:""},
            field: {value:"payload", validate:RED.validators.typedInput("fieldType")},
            fieldType: {value:"msg"},
            format: {value:"handlebars"},
            syntax: {value:"mustache"},
            template: {value:"This is the payload: {{payload}} !"},
            output: {value:"str"}
        },
        inputs:1,
        outputs:1,
        icon: "template.svg",
        label: function() {
            return this.name||this._("template.template");;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var that = this;
            if (!this.field) {
                this.field = 'payload';
                $("#node-input-field").val("payload");
            }
            if (!this.fieldType) {
                this.fieldType = 'msg';
            }
            if (!this.syntax) {
                this.syntax = 'mustache';
                $("#node-input-syntax").val(this.syntax);
            }
            $("#node-input-field").typedInput({
                default: 'msg',
                types: ['msg','flow','global'],
                typeField: $("#node-input-fieldType")
            });

            this.editor = RED.editor.createEditor({
                id: 'node-input-template-editor',
                mode: 'ace/mode/html',
                value: $("#node-input-template").val()
            });
            RED.library.create({
                url:"templates", // where to get the data from
                type:"template", // the type of object the library is for
                editor:that.editor, // the field name the main text body goes to
                fields:['name','format','output','syntax'],
                ext: "txt"
            });
            this.editor.focus();

            $("#node-input-format").on("change", function() {
                var mod = "ace/mode/"+$("#node-input-format").val();
                that.editor.getSession().setMode({
                    path: mod,
                    v: Date.now()
                });
            });
            RED.popover.tooltip($("#node-template-expand-editor"), RED._("node-red:common.label.expand"));
            $("#node-template-expand-editor").on("click", function(e) {
                e.preventDefault();
                var value = that.editor.getValue();
                RED.editor.editText({
                    mode: $("#node-input-format").val(),
                    value: value,
                    width: "Infinity",
                    cursor: that.editor.getCursorPosition(),
                    complete: function(v,cursor) {
                        that.editor.setValue(v, -1);
                        that.editor.gotoLine(cursor.row+1,cursor.column,false);
                        setTimeout(function() {
                            that.editor.focus();
                        },300);
                    }
                })
            })
        },
        oneditsave: function() {
            $("#node-input-template").val(this.editor.getValue());
            this.editor.destroy();
            delete this.editor;
        },
        oneditcancel: function() {
            this.editor.destroy();
            delete this.editor;
        },
        oneditresize: function(size) {
            var rows = $("#dialog-form>div:not(.node-text-editor-row)");
            var height = $("#dialog-form").height();
            for (var i=0; i<rows.length; i++) {
                height -= $(rows[i]).outerHeight(true);
            }
            var editorRow = $("#dialog-form>div.node-text-editor-row");
            height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
            $(".node-text-editor").css("height",height+"px");
            this.editor.resize();
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="template">
    <p>根据提供的模板设置属性。</p>
    <h3>输入</h3>
    <dl class="message-properties">
        <dt>msg <span class="property-type">object</span></dt>
        <dd>一个msg对象，其中包含着用于填充模板的信息。</dd>
        <dt class="optional">template <span class="property-type">string</span></dt>
        <dd>由<code>msg.payload</code>填充的模板。如果未在编辑面板中配置，则可以将设为msg的属性。</dd>
    </dl>
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>msg <span class="property-type">object</span></dt>
        <dd>由来自传入msg的属性来填充已配置的模板后输出的带有属性的msg。</dd>
    </dl>
    <h3>详细</h3>
    <p>默认情况下使用<i><a href="http://mustache.github.io/mustache.5.html" target="_blank">mustache</a></i>格式。如有需要也可以切换其他格式。</p>
    <p>例如:
    <pre>Hello {{payload.name}}. Today is {{date}}</pre>
    <p>receives a message containing:
    <pre>{
  date: "Monday",
  payload: {
    name: "Fred"
  }
}</pre>
    <p>输出的消息将会是:
    <pre>Hello Fred. Today is Monday</pre>
    <p>也可以使用流上下文或全局上下文中的属性：<code>{{flow.name}}</code>或者<code>{{global.name}}</code>，或者为了持久储存<code>store</code>，可以使用<code>{{flow[store].name}}</code>或<code>{{global[store].name}}</code>。
    <p><b>注意：</b>默认情况下，<i>mustache</i>将在其替换的值中转义任何非字母数字或HTML实体。为了防止这种情况，请使用<code>{{{triple}}}</code>大括号。
</script>

</div><div><!-- --- [red-module:node-red/delay] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="delay">
    <div class="form-row">
        <label for="node-input-delay-action"><i class="fa fa-tasks"></i> <span data-i18n="delay.action"></span></label>
        <select id="node-input-delay-action" style="width:270px !important">
            <option value="delay" data-i18n="delay.delaymsg"></option>
            <option value="rate" data-i18n="delay.limitrate"></option>
        </select>
    </div>

    <div id="delay-details">
        <div class="form-row">
            <label></label>
            <select id="node-input-delay-type" style="width:270px !important">
                <option value="delay" data-i18n="delay.delayfixed"></option>
                <option value="random" data-i18n="delay.randomdelay"></option>
                <option value="delayv" data-i18n="delay.delayvarmsg"></option>
            </select>
        </div>
        <div class="form-row" id="delay-details-for">
            <label for="node-input-timeout"><i class="fa fa-clock-o"></i> <span data-i18n="delay.for"></span></label>
            <input type="text" id="node-input-timeout" style="text-align:end; width:50px !important">
            <select id="node-input-timeoutUnits" style="width:200px !important">
              <option value="milliseconds" data-i18n="delay.milisecs"></option>
              <option value="seconds" data-i18n="delay.secs"></option>
              <option value="minutes" data-i18n="delay.mins"></option>
              <option value="hours" data-i18n="delay.hours"></option>
              <option value="days" data-i18n="delay.days"></option>
            </select>
        </div>
        <div id="random-details" class="form-row">
            <label for="node-input-randomFirst"><i class="fa fa-clock-o"></i> <span data-i18n="delay.between"></span></label>
            <input type="text" id="node-input-randomFirst" placeholder="" style="text-align:end; width:50px !important">
            &nbsp;<span data-i18n="delay.and"></span>&nbsp;
            <input type="text" id="node-input-randomLast" placeholder="" style="text-align:end; width:50px !important">
            <select id="node-input-randomUnits" style="width:140px !important">
              <option value="milliseconds" data-i18n="delay.milisecs"></option>
              <option value="seconds" data-i18n="delay.secs"></option>
              <option value="minutes" data-i18n="delay.mins"></option>
              <option value="hours" data-i18n="delay.hours"></option>
              <option value="days" data-i18n="delay.days"></option>
            </select>
        </div>
    </div>

    <div id="rate-details">
        <div class="form-row">
            <label></label>
            <select id="node-input-rate-type" style="width:270px !important">
                <option value="all" data-i18n="delay.limitall"></option>
                <option value="topic" data-i18n="delay.limittopic"></option>
            </select>
        </div>
        <div class="form-row">
            <label for="node-input-rate"><i class="fa fa-clock-o"></i> <span data-i18n="delay.rate"></span></label>
            <input type="text" id="node-input-rate" placeholder="1" style="text-align:end; width:40px !important">
            <label for="node-input-rateUnits"><span data-i18n="delay.msgper"></span></label>
            <input type="text" id="node-input-nbRateUnits" placeholder="1" style="text-align:end; width:40px !important">
            <select id="node-input-rateUnits" style="width:90px !important">
              <option value="second" data-i18n="delay.label.units.second.singular"></option>
              <option value="minute" data-i18n="delay.label.units.minute.singular"></option>
              <option value="hour" data-i18n="delay.label.units.hour.singular"></option>
              <option value="day" data-i18n="delay.label.units.day.singular"></option>
            </select>
        </div>
        <div class="form-row" id="rate-override" style="display: flex; align-items: center">
            <label></label><input style="width:30px; margin:0" type="checkbox" id="node-input-allowrate"><label style="margin:0;width: auto;" for="node-input-allowrate" data-i18n="delay.allowrate"></label>
        </div>
        <div class="form-row" id="rate-details-drop">
            <input type="hidden" id="node-input-outputs" value="1">
            <label></label>
            <select id="node-input-drop-select" style="width: 70%">
                <option id="node-input-drop-select-queue" value="queue" data-i18n="delay.queuemsg"></option>
                <option value="drop" data-i18n="delay.dropmsg"></option>
                <option value="emit" data-i18n="delay.sendmsg"></option>
            </select>
        </div>
        <div class="form-row" id="rate-details-per-topic">
            <label></label>
            <select id="node-input-rate-topic-type" style="width:270px !important">
                <option value="queue" data-i18n="delay.fairqueue"></option>
                <option value="timed" data-i18n="delay.timedqueue"></option>
            </select>
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('delay',{
        category: 'function',
        color:"#E6E0F8",
        defaults: {
            name: {value:""},
            pauseType: {value:"delay", required:true},
            timeout: {value:"5", required:true, validate:function(v) { return RED.validators.number(v) && (v >= 0); }},
            timeoutUnits: {value:"seconds"},
            rate: {value:"1", required:true, validate:function(v) { return RED.validators.number(v) && (v >= 0); }},
            nbRateUnits: {value:"1", required:false, validate:RED.validators.regex(/\d+|/)},
            rateUnits: {value: "second"},
            randomFirst: {value:"1", required:true, validate:function(v) { return RED.validators.number(v) && (v >= 0); }},
            randomLast: {value:"5", required:true, validate:function(v) { return RED.validators.number(v) && (v >= 0); }},
            randomUnits: {value: "seconds"},
            drop: {value:false},
            allowrate: {value:false},
            outputs: { value: 1},
        },
        inputs:1,
        outputs:1,
        icon: "timer.svg",
        label: function() {
            if (this.name) {
                return this.name;
            }
            if (this.pauseType == "delayv") {
                return this._("delay.label.variable");
            } else if (this.pauseType == "delay") {
                var units = this.timeoutUnits ? this.timeoutUnits.charAt(0) : "s";
                if (this.timeoutUnits == "milliseconds") { units = "ms"; }
                return this._("delay.label.delay")+" "+this.timeout+units;
            } else if (this.pauseType == "random") {
                return this._("delay.label.random");
            } else {
                var rate = this.rate+" msg/"+(this.rateUnits ? (this.nbRateUnits > 1 ? this.nbRateUnits : '') + this.rateUnits.charAt(0) : "s");
                if (this.pauseType == "rate") {
                    return this._("delay.label.limit")+" "+rate;
                } else if (this.pauseType == "timed") {
                    return this._("delay.label.limitTopic")+" "+rate;
                } else {
                    return this._("delay.label.limitTopic")+" "+rate;
                }
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;
            $( "#node-input-timeout" ).spinner({min:1});
            $( "#node-input-rate" ).spinner({min:1});
            $( "#node-input-nbRateUnits" ).spinner({min:1});

            $( "#node-input-randomFirst" ).spinner({min:0});
            $( "#node-input-randomLast" ).spinner({min:1});

            $('.ui-spinner-button').on("click", function() {
                $(this).siblings('input').trigger("change");
            });

            $( "#node-input-nbRateUnits" ).on('change keyup', function() {
                var $this = $(this);
                var val = parseInt($this.val());
                var type = "singular";
                if (val > 1) {
                    type = "plural";
                }
                if ($this.attr("data-type") == type) {
                    return;
                }
                $this.attr("data-type", type);
                $("#node-input-rateUnits option").each(function () {
                    var $option = $(this);
                    var key = "delay.label.units." + $option.val() + "." + type;
                    $option.attr('data-i18n', 'node-red:' + key);
                    $option.html(node._(key));
                });
            });

            if (this.pauseType == "delay") {
                $("#node-input-delay-action").val('delay');
                $("#node-input-delay-type").val('delay');
            } else if (this.pauseType == "delayv") {
                $("#node-input-delay-action").val('delay');
                $("#node-input-delay-type").val('delayv');
            } else if (this.pauseType == "random") {
                $("#node-input-delay-action").val('delay');
                $("#node-input-delay-type").val('random');
            } else if (this.pauseType == "rate") {
                $("#node-input-delay-action").val('rate');
                $("#node-input-rate-type").val('all');
            } else if (this.pauseType == "queue") {
                $("#node-input-delay-action").val('rate');
                $("#node-input-rate-type").val('topic');
                $("#node-input-rate-topic-type").val('queue');
            } else if (this.pauseType == "timed") {
                $("#node-input-delay-action").val('rate');
                $("#node-input-rate-type").val('topic');
                $("#node-input-rate-topic-type").val('timed');
            }

            if (!this.timeoutUnits) {
                $("#node-input-timeoutUnits option").filter(function() {
                    return $(this).val() == 'seconds';
                }).attr('selected', true);
            }

            if (!this.randomUnits) {
                $("#node-input-randomUnits option").filter(function() {
                    return $(this).val() == 'seconds';
                }).attr('selected', true);
            }

            $("#node-input-delay-action").on("change",function() {
                if (this.value === "delay") {
                    $("#delay-details").show();
                    $("#rate-details").hide();
                } else if (this.value === "rate") {
                    $("#delay-details").hide();
                    $("#rate-details").show();
                }
            }).trigger("change");

            $("#node-input-delay-type").on("change", function() {
                if (this.value === "delay") {
                    $("#delay-details-for").show();
                    $("#random-details").hide();
                } else if (this.value === "delayv") {
                    $("#delay-details-for").show();
                    $("#random-details").hide();
                } else if (this.value === "random") {
                    $("#delay-details-for").hide();
                    $("#random-details").show();
                }
            }).trigger("change");

            if (this.outputs === 2) {
                $("#node-input-drop-select").val("emit");
            } else if (this.drop) {
                $("#node-input-drop-select").val("drop");
            } else {
                $("#node-input-drop-select").val("queue");
            }

            $("#node-input-rate-type").on("change", function() {
                if (this.value === "all") {
                    $("#rate-details-per-topic").hide();
                    $("#node-input-drop-select-queue").attr('disabled', false);
                } else if (this.value === "topic") {
                    if ($("#node-input-drop-select").val() === "queue") {
                        $("#node-input-drop-select").val("drop");
                    }
                    $("#node-input-drop-select-queue").attr('disabled', true);
                    $("#rate-details-per-topic").show();
                }
            }).trigger("change");
        },
        oneditsave: function() {
            var action = $("#node-input-delay-action").val();
            if (action === "delay") {
                this.pauseType = $("#node-input-delay-type").val();
                $("#node-input-outputs").val(1);
            } else if (action === "rate") {
                action = $("#node-input-rate-type").val();
                if (action === "all") {
                    this.pauseType = "rate";
                } else {
                    this.pauseType = $("#node-input-rate-topic-type").val();
                }
                var dropType = $("#node-input-drop-select").val();
                this.drop = dropType !== "queue";
                $("#node-input-outputs").val(dropType === "emit"?2:1);
            }
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="delay">
    <p>对通过节点的消息进行延迟发送或限制。</p>
    <h3>输入</h3>
    <dl class="message-properties">
        <dt class="optional">delay <span class="property-type">数值</span></dt>
        <dd>设置要应用于消息的延迟（以毫秒为单位）。仅当节点配置为允许消息去覆盖配置的默认延迟间隔时，此选项才适用。</dd>
        <dt class="optional">reset</dt>
        <dd>如果接收到的消息将此属性设置为任何值，则将清空该节点保留的所有的未发送消息。</dd>
        <dt class="optional">flush</dt>
        <dd>如果接收到的消息的此属性设置为任何值，则将立即发送该节点保留的所有未发送消息。</dd>
    </dl>
    <h3>详细</h3>
    <p>当配置为延迟发送消息时，延迟间隔可以是一个固定值，一个范围内的随机值或为每个消息动态设置。</p>
    <p>当配置为对消息进行限制时，它们的传递将分散在配置的时间段内。状态显示队列中当前的消息数。可以选择在中间消息到达时丢弃它们。</p>
    <p>速率限制可以应用于所有消息，也可以根据<code>msg.topic</code>的值来进行分组。分组时，中间消息将会被自动删除。在每个时间间隔，节点可以释放所有主题的最新消息，或释放下一个主题的最新消息。</p>
</script>

</div><div><!-- --- [red-module:node-red/trigger] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="trigger">
    <div class="form-row">
        <label data-i18n="trigger.send" for="node-input-op1"></label>
        <input type="hidden" id="node-input-op1type">
        <input style="width:70%" type="text" id="node-input-op1" placeholder="1">
    </div>
    <div class="form-row">
        <label data-i18n="trigger.then"></label>
        <select id="node-then-type" style="width:70%;">
            <option value="block" data-i18n="trigger.wait-reset"></option>
            <option value="wait" data-i18n="trigger.wait-for"></option>
            <option value="loop" data-i18n="trigger.wait-loop"></option>
        </select>
    </div>
    <div class="form-row node-type-duration">
        <label></label>
        <input type="text" id="node-input-duration" style="text-align:end; width:70px !important">
        <select id="node-input-units" style="width:140px !important">
            <option value="ms" data-i18n="trigger.duration.ms"></option>
            <option value="s" data-i18n="trigger.duration.s"></option>
            <option value="min" data-i18n="trigger.duration.m"></option>
            <option value="hr" data-i18n="trigger.duration.h"></option>
        </select>
    </div>
    <div class="form-row node-type-wait">
    <label></label>
        <input type="checkbox" id="node-input-extend" style="margin-left:0px; vertical-align:top; width:auto !important;"> <label style="width:auto !important;" for="node-input-extend" data-i18n="trigger.extend"></label>
    </div>
    <div class="form-row node-type-override">
    <label></label>
        <input type="checkbox" id="node-input-overrideDelay" style="margin-left:0px; vertical-align:top; width:auto !important;"> <label style="width:auto !important;" for="node-input-overrideDelay" data-i18n="trigger.override"></label>
    </div>
    <div class="form-row node-type-wait">
        <label data-i18n="trigger.then-send"></label>
        <input type="hidden" id="node-input-op2type">
        <input style="width:70%" type="text" id="node-input-op2" placeholder="0">
    </div>
    <div class="form-row" id="node-second-output">
        <label></label>
            <input type="checkbox" id="node-input-second" style="margin-left: 0px; vertical-align: top; width: auto !important;"> <label style="width:auto !important;" for="node-input-second" data-i18n="trigger.second"></label>
        </div>
    <div class="form-row">
        <label data-i18n="trigger.label.reset" style="width:auto"></label>
        <div style="display:inline-block; width:70%;vertical-align:top">
        <ul>
            <li data-i18n="trigger.label.resetMessage"></li>
            <li><span data-i18n="trigger.label.resetPayload"></span> <input type="text" id="node-input-reset" style="width:150px" data-i18n="[placeholder]trigger.label.resetprompt"></li>
        </ul>
    </div>
    <br/>
    <div class="form-row">
        <label data-i18n="trigger.for" for="node-input-bytopic"></label>
        <select id="node-input-bytopic" style="width:120px;">
            <option value="all" data-i18n="trigger.alltopics"></option>
            <option value="topic" data-i18n="trigger.bytopics"></option>
        </select>
        <span class="form-row" id="node-stream-topic">
            <input type="text" id="node-input-topic" style="width:46%;"/>
        </span>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name"></input>
        <input type="hidden" id="node-input-outputs" value="1">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('trigger',{
        category: 'function',
        color:"#E6E0F8",
        defaults: {
            name: {value:""},
            op1: {value:"1", validate: RED.validators.typedInput("op1type")},
            op2: {value:"0", validate: RED.validators.typedInput("op2type")},
            op1type: {value:"val"},
            op2type: {value:"val"},
            duration: {value:"250",required:true,validate:RED.validators.number()},
            extend: {value:"false"},
            overrideDelay: {value:"false"},
            units: {value:"ms"},
            reset: {value:""},
            bytopic: {value:"all"},
            topic: {value:"topic",required:true},
            outputs: {value:1}
        },
        inputs:1,
        outputs:1,
        icon: "trigger.svg",
        label: function() {
            if (this.duration > 0) {
                return this.name|| this._("trigger.label.trigger")+" "+this.duration+this.units;
            }
            if (this.duration < 0) {
                return this.name|| this._("trigger.label.trigger-loop")+" "+(this.duration * -1)+this.units;
            }
            else {
                return this.name|| this._("trigger.label.trigger-block");
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var that = this;
            if (this.topic === undefined) { $("#node-input-topic").val("topic"); }
            $("#node-input-topic").typedInput({default:'msg',types:['msg']});
            $("#node-input-bytopic").on("change", function() {
                if ($("#node-input-bytopic").val() === "all") {
                    $("#node-stream-topic").hide();
                } else {
                    $("#node-stream-topic").show();
                }
            });

            if (this.outputs == 2) { $("#node-input-second").prop('checked', true) }
            else { $("#node-input-second").prop('checked', false) }

            $("#node-input-second").change(function() {
                if ($("#node-input-second").is(":checked")) {
                    $("#node-input-outputs").val(2);
                }
                else  {
                    $("#node-input-outputs").val(1);
                }
            });
            $("#node-then-type").on("change", function() {
                if ($(this).val() == "block") {
                    $(".node-type-wait").hide();
                    $(".node-type-override").hide();
                    $(".node-type-duration").hide();
                    $("#node-second-output").hide();
                    $("#node-input-second").prop('checked', false);
                    $("#node-input-outputs").val(1);
                }
                else if ($(this).val() == "loop") {
                    if ($("#node-input-duration").val() == 0) { $("#node-input-duration").val(250); }
                    $(".node-type-wait").hide();
                    $(".node-type-override").show();
                    $(".node-type-duration").show();
                    $("#node-second-output").hide();
                    $("#node-input-second").prop('checked', false);
                    $("#node-input-outputs").val(1);
                } else {
                    if ($("#node-input-duration").val() == 0) { $("#node-input-duration").val(250); }
                    $(".node-type-wait").show();
                    $(".node-type-override").show();
                    $(".node-type-duration").show();
                    $("#node-second-output").show();
                }
            });

            if (this.op1type === 'val') {
                $("#node-input-op1type").val('str');
            }
            if (this.op2type === 'val') {
                $("#node-input-op2type").val('str');
            }

            var optionNothing = {value:"nul",label:this._("trigger.output.nothing"),hasValue:false};
            var optionPayload = {value:"pay",label:this._("trigger.output.existing"),hasValue:false};
            var optionOriginalPayload = {value:"pay",label:this._("trigger.output.original"),hasValue:false};
            var optionLatestPayload = {value:"payl",label:this._("trigger.output.latest"),hasValue:false};

            $("#node-input-op1").typedInput({
                default: 'str',
                typeField: $("#node-input-op1type"),
                types:['flow','global','str','num','bool','json','bin','date','env',
                    optionPayload,
                    optionNothing
                ]
            });
            $("#node-input-op2").typedInput({
                default: 'str',
                typeField: $("#node-input-op2type"),
                types:['flow','global','str','num','bool','json','bin','date','env',
                    optionOriginalPayload,
                    optionLatestPayload,
                    optionNothing
                ]
            });

            if (this.bytopic === undefined) {
                $("#node-input-bytopic").val("all");
            }

            if (this.duration == "0") {
                $("#node-then-type").val("block");
            }
            else if ((this.duration * 1) < 0) {
                $("#node-then-type").val("loop");
                $("#node-input-duration").val(this.duration*-1);
            } else {
                $("#node-then-type").val("wait");
            }
            $("#node-then-type").trigger("change");

            if (this.extend === "true" || this.extend === true) {
                $("#node-input-extend").prop("checked",true);
            } else {
                $("#node-input-extend").prop("checked",false);
            }
            if (this.overrideDelay === "true" || this.overrideDelay === true) {
                $("#node-input-overrideDelay").prop("checked",true);
            } else {
                $("#node-input-overrideDelay").prop("checked",false);
            }
        },
        oneditsave: function() {
            if ($("#node-then-type").val() == "block") {
                $("#node-input-duration").val("0");
            }
            if ($("#node-then-type").val() == "loop") {
                $("#node-input-duration").val($("#node-input-duration").val() * -1);
            }
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="trigger">
    <p>触发后，将会发送一条消息。如果被拓展或重置，则可以选择发送第二条消息。</p>

    <h3>输入</h3>
    <dl class="message-properties">
        <dt class="optional">delay <span class="property-type">数值</span></dt>
        <dd>设置要应用于消息的延迟(以毫秒为单位)。仅当节点配置为允许消息去覆盖设置的的默认延迟间隔时，此选项才适用。</dd>
        <dt class="optional">reset</dt>
        <dd>如果收到带有此属性的消息，则将清除当前正在进行的任何超时或重复，且不会触发任何消息。</dd>
    </dl>

    <h3>详细</h3>
    <p>该节点可用于在流中创建一个超时。 默认情况下，当它收到一条消息时，它将发送一条带有<code>1</code>的有效荷载的消息。然后它将等待250毫秒，再发送第二条消息，其有效荷载为<code>0</code>。这可以用于使连接到Raspberry Pi GPIO引脚的LED闪烁等例子上。</p>
    <p>可以将发送的每个消息的有效荷载配置为各种值，包括不发送任何内容的选项。例如，将初始消息设置为<i>nothing</i>，然后选择将计时器与每个收到的消息一起扩展的选项，则该节点将充当看门狗计时器；仅在设置的间隔内未收到任何消息时才发送消息。</p>
    <p>如果设置为<i>字符串</i>类型，则该节点支持<i>mustache</i>模板语法。</p>
    <p>如果节点中启用了该选项，则可以通过<code> msg.delay </code>覆盖发送消息之间的延迟。该值必须以毫秒为单位。</p>
    <p>如果节点收到具有<code>reset</code>属性或与节点中配置的匹配的<code>有效荷载</code>的消息，则将清除当前正在进行的任何超时或重复，并且不会触发任何消息。</p>
    <p>可以将节点配置为以固定的时间间隔重新发送消息，直到被收到的消息重置为止。</p>
    <p>（可选）可以将节点配置为将带有<code>msg.topic</code>的消息视为独立的流。</p>
</script>

</div><div><!-- --- [red-module:node-red/exec] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="exec">
    <div class="form-row">
        <label for="node-input-command"><i class="fa fa-file"></i> <span data-i18n="exec.label.command"></span></label>
        <input type="text" id="node-input-command" data-i18n="[placeholder]exec.label.command">
    </div>
    <div class="form-row">
        <label><i class="fa fa-plus"></i> <span data-i18n="exec.label.append"></span></label>
        <input type="checkbox" id="node-input-addpay-cb" style="display:inline-block; width:auto;">
        <input type="text" id="node-input-addpay" style="margin-left: 5px; width:160px;">
    </div>
    <div class="form-row">
        <label for="node-input-append"> </label>
        <input type="text" id="node-input-append" data-i18n="[placeholder]exec.placeholder.extraparams">
    </div>
    <div class="form-row">
        <label><i class="fa fa-sign-out"></i> <span data-i18n="exec.label.return"></span></label>
        <select type="text" id="node-input-useSpawn" style="width:70%">
            <option value="false" data-i18n="exec.opt.exec"></option>
            <option value="true" data-i18n="exec.opt.spawn"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-timer"><i class="fa fa-clock-o"></i> <span data-i18n="exec.label.timeout"></span></label>
        <input type="text" id="node-input-timer" style="width:65px;" data-i18n="[placeholder]exec.label.timeoutplace">
        <span data-i18n="exec.label.seconds"></span>
    </div>
    <div class="form-row">
        <label for="node-input-winHide" style="width: auto !important; padding-right:10px"><i class="fa fa-windows"></i> <span data-i18n="exec.label.winHide"></span></label>
        <input type="checkbox" id="node-input-winHide" style="margin-top: 0; display:inline-block; width:auto;">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('exec',{
        category: 'function',
        color:"darksalmon",
        defaults: {
            command: {value:""},
            addpay: {value:""},
            append: {value:""},
            useSpawn: {value:"false"},
            timer: {value:""},
            winHide: {value:false},
            oldrc: {value:false},
            name: {value:""}
        },
        inputs:1,
        outputs:3,
        outputLabels: function(i) {
            return [
                this._("exec.label.stdout"),
                this._("exec.label.stderr"),
                this._("exec.label.retcode")
            ][i];
        },
        icon: "cog.svg",
        label: function() {
            return this.name||this.command.replace(/\\n /g,"\\\\n ")||(this.useSpawn=="true"?this._("exec.spawn"):this._("exec.exec"));
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if ($("#node-input-useSpawn").val() === null) {
                $("#node-input-useSpawn").val(this.useSpawn.toString());
            }
            $("#node-input-addpay-cb").prop("checked", this.addpay === true || (this.addpay !== false && this.addpay !== ""))
            var addpayValue = (this.addpay === true)?"payload":((this.addpay === false || this.addpay === "")?"payload":this.addpay);
            $("#node-input-addpay-cb").on("change", function(evt) {
                $("#node-input-addpay").typedInput("disable",!$("#node-input-addpay-cb").prop("checked"));
            });

            $("#node-input-addpay").val(addpayValue);
            $("#node-input-addpay").typedInput({
                default: "msg",
                types: ["msg"]
            });

            $("#node-input-addpay-cb").trigger("change")

            if (this.winHide === "true" || this.winHide === true) {
                $("#node-input-winHide").prop("checked",true);
            } else {
                $("#node-input-winHide").prop("checked",false);
            }
        },
        oneditsave: function() {
            if (!$("#node-input-addpay-cb").prop("checked")) {
                $("#node-input-addpay").val("");
            }
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="exec">
    <p>运行系统命令并返回其输出。</p>
    <p>可以将节点配置为等待命令完成，或者在命令生成时发送其输出。</p>
    <p>运行的命令可以在节点中配置，也可以由收到的消息提供。</p>

    <h3>输入</h3>
    <dl class="message-properties">
        <dt class="optional">payload <span class="property-type">字符串</span></dt>
        <dd>如果这样配置，则将被附加到执行命令中。</dd>
        <dt class="optional">kill <span class="property-type">字符串</span></dt>
        <dd>指定发送到现有的exec节点进程的kill信号类型。</dd>
        <dt class="optional">pid <span class="property-type">数值|字符串</span></dt>
        <dd>要杀死的现有exec节点进程的进程ID</dd>
    </dl>

    <h3>输出</h3>
    <ol class="node-ports">
        <li>标准输出(stdout)
            <dl class="message-properties">
                <dt>payload <span class="property-type">字符串</span></dt>
                <dd>命令的标准输出。</dd>
            </dl>
            <dl class="message-properties">
                <dt>rc <span class="property-type">object</span></dt>
                <dd>（仅执行模式）一个返回代码对象的副本（在端口3上也可用）</dd>
            </dl>
        </li>
        <li>标准error输出(stderr)
            <dl class="message-properties">
                <dt>payload <span class="property-type">字符串</span></dt>
                <dd>命令的标准错误输出。</dd>
            </dl>
            <dl class="message-properties">
                <dt>rc <span class="property-type">object</span></dt>
                <dd>（仅执行模式）一个返回代码对象的副本（在端口3上也可用）</dd>
            </dl>
        </li>
        <li>返回代码
            <dl class="message-properties">
                <dt>payload <span class="property-type">object</span></dt>
                <dd>一个包含返回代码以及<code>message</code>，<code>signal</code>属性的对象。</dd>
            </dl>
        </li>
    </ol>
    <h3>详细</h3>
    <p>默认情况下，使用<code>exec</code>系统调用来调用命令，等待命令完成，然后返回输出。例如，成功的命令的返回码应为<code>{code：0}</code>。</p>
    <p>（可选）可以选择使用<code>spawn</code>代替，它会在命令运行时从stdout和stderr返回输出，通常一次一行。完成后，它将在第三个端口上返回一个对象。例如，成功的命令应返回<code>{code：0}</code>。</p>
    <p>错误可能会在第三个端口<code>msg.payload</code>上返回额外的信息，例如<code>message</code>字符串，<code>signal</code>字符串。</p>
    <p>运行的命令是在节点内定义的，带有附加<code>msg.payload</code>的选项和另外一组参数。</p>
    <p>带空格的命令或参数应该用引号引起来：<code>“这是一个参数”</code></p>
    <p>返回的<code>有效荷载</code>通常是<i>字符串</i>类型，除非检测到非UTF8字符，在这种情况下，它会是<i>buffer</i>类型。</p>
    <p>节点处于活动状态时，该节点的状态图标和PID将可见。对此更改可以通过<code>Status</code>节点读取。</p>
    <h4>杀死进程</h4>
    <p>发送<code>msg.kill</code>将杀死一个活动进程。<code>msg.kill</code>应该是包含要发送的信号类型的字符串，例如<code>SIGINT</code>，<code>SIGQUIT</code>或<code>SIGHUP</code>。如果设置为空字符串，则默认为<code>SIGTERM</code>。</p>
    <p>如果节点有多个进程在运行，则还必须设置<code>msg.pid</code>并设置要杀死的PID的值。</p>
    <p>如果<code>超时</code>字段提供了一个值，则如果在指定的秒数过去后进程尚未完成，则该进程将自动终止。</p>
    <p>提示：如果运行Python应用程序，则可能需要使用<code>-u</code>参数来停止对输出进行缓存。</p>
</script>

</div><div><!-- --- [red-module:node-red/rbe] --- -->

<script type="text/html" data-template-name="rbe">
    <div class="form-row">
        <label for="node-input-func"><i class="fa fa-wrench"></i> <span data-i18n="rbe.label.func"></span></label>
        <select type="text" id="node-input-func" style="width:70%;">
            <option value="rbe" data-i18n="rbe.opts.rbe"></option>
            <option value="rbei" data-i18n="rbe.opts.rbei"></option>
            <option value="deadbandEq" data-i18n="rbe.opts.deadbandEq"></option>
            <option value="deadband" data-i18n="rbe.opts.deadband"></option>
            <option value="narrowbandEq" data-i18n="rbe.opts.narrowbandEq"></option>
            <option value="narrowband" data-i18n="rbe.opts.narrowband"></option>
        </select>
    </div>
    <div class="form-row" id="node-bandgap">
        <label for="node-input-gap">&nbsp;</label>
        <input type="text" id="node-input-gap" data-i18n="[placeholder]rbe.placeholder.bandgap" style="width:95px;">
        <select type="text" id="node-input-inout" style="width:54%;">
            <option value="out" data-i18n="rbe.opts.out"></option>
            <option value="in" data-i18n="rbe.opts.in"></option>
        </select>
    </div>
    <div class="form-row" id="node-startvalue">
        <label for="node-input-start"><i class="fa fa-thumb-tack"></i> <span data-i18n="rbe.label.start"></span></label>
        <input type="text" id="node-input-start" data-i18n="[placeholder]rbe.placeholder.start" style="width:70%;">
    </div>
    <div class="form-row">
        <label for="node-input-property"><i class="fa fa-ellipsis-h"></i> <span data-i18n="node-red:common.label.property"></span></label>
        <input type="text" id="node-input-property" style="width:70%;"/>
    </div>
    <div class="form-row" style="margin-bottom: 0px;">
        <label> </label>
        <input type="checkbox" id="node-input-septopics" style="display:inline-block; width:20px; vertical-align:baseline;">
        <label style="width: auto" for="node-input-septopics" data-i18n="rbe.label.septopics"></label>
    </div>
    <div class="form-row">
        <label> </label>
        <input type="text" id="node-input-topi"  style="width:70%;"/>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="rbe.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]rbe.label.name" style="width:70%;">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("rbe", {
        color:"#E2D96E",
        category: 'function',
        defaults: {
            name: {value:""},
            func: {value:"rbe"},
            gap: {value:"",validate:RED.validators.regex(/^(\d*[.]*\d*|)(%|)$/)},
            start: {value:""},
            inout: {value:"out"},
            septopics: {value:true},
            property: {value:"payload",required:true},
            topi: {value:"topic",required:true}
        },
        inputs:1,
        outputs:1,
        icon: "rbe.png",
        paletteLabel: "filter",
        label: function() {
            var ll = (this.func||"").replace("Eq","").replace("rbei",this._("rbe.rbe")).replace("rbe",this._("rbe.rbe"))||this._("rbe.rbe");
            return this.name||ll||this._("rbe.rbe");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.property === undefined) {
                $("#node-input-property").val("payload");
            }
            if (this.septopics === undefined) {
                $("#node-input-septopics").prop('checked', true);
            }
            if (this.topi === undefined) {
                $("#node-input-topi").val("topic");
            }

            $("#node-input-property").typedInput({default:'msg',types:['msg']});
            $("#node-input-topi").typedInput({default:'msg',types:['msg']});
            //$( "#node-input-gap" ).spinner({min:0});
            if ($("#node-input-inout").val() === null) {
                $("#node-input-inout").val("out");
            }
            $("#node-input-func").on("change",function() {
                if (($("#node-input-func").val() === "rbe")||($("#node-input-func").val() === "rbei")) {
                    $("#node-bandgap").hide();
                } else {
                    $("#node-bandgap").show();
                }
                if (($("#node-input-func").val() === "narrowband")||($("#node-input-func").val() === "narrowbandEq")) {
                    $("#node-startvalue").show();
                } else {
                    $("#node-startvalue").hide();
                }
            });
            $("#node-input-septopics").on("change", function() {
                $("#node-input-topi").typedInput("disable",!this.checked);
            })
            $("#node-input-topi").typedInput("disable",!!!this.septopics);

        }
    });
</script>
<script type="text/html" data-help-name="rbe">
    <p>Report by Exception (RBE) node - only passes on data if the payload has changed.
       It can also block unless, or ignore if the value changes by a specified amount (Dead- and Narrowband mode).</p>
    <h3>Inputs</h3>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">number | string | (object)</span>
        </dt>
        <dd>RBE mode will accept numbers, strings, and simple objects.
            Other modes must provide a parseable number.</dd>
        <dt class="optional">topic <span class="property-type">string</span>
        </dt>
        <dd>if specified the function will work on a per topic basis. This property can be set by configuration.</dd>
        <dt class="optional">reset<span class="property-type">any</span></dt>
        <dd>if set clears the stored value for the specified msg.topic, or
            all topics if msg.topic is not specified.</dd>
    </dl>
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">as per input</span>
        </dt>
        <dd>If triggered the output will be the same as the input.</dd>
    </dl>
    <h3>Details</h3>
    <p>In RBE mode this node will block until the <code>msg.payload</code>,
       (or selected property) value is different to the previous one.
       If required it can ignore the intial value, so as not to send anything at start.</p>
    <p>The <a href="https://en.wikipedia.org/wiki/Deadband" target="_blank">Deadband</a> modes will block the incoming value
       <i>unless</i> its change is greater or greater-equal than &plusmn; the band gap away from a previous value.</p>
    <p>The Narrowband modes will block the incoming value,
       <i>if</i> its change is greater or greater-equal than &plusmn; the band gap away from the previous value.
       It is useful for ignoring outliers from a faulty sensor for example.</p>
    <p>Both in Deadband and Narrowband modes the incoming value must contain a parseable number and
       both also supports % - only sends if/unless the input differs by more than x% of the original value.</p>
    <p>Both Deadband and Narrowband allow comparison against either the previous valid output value, thus
    ignoring any values out of range, or the previous input value, which resets the set point, thus allowing
    gradual drift (deadband), or a step change (narrowband).</p>
    <p><b>Note:</b> This works on a per <code>msg.topic</code> basis, though this can be changed to another property if desired.
       This means that a single rbe node can handle multiple different topics at the same time.</p>
</script>

</div><div><!-- --- [red-module:node-red/tls] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="tls-config">
    <div class="form-row" class="hide" id="node-config-row-uselocalfiles">
        <input type="checkbox" id="node-config-input-uselocalfiles" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-config-input-uselocalfiles" style="width: 70%;"><span data-i18n="tls.label.use-local-files"></label>
    </div>
    <div class="form-row">
        <label style="width: 120px;"><i class="fa fa-file-text-o"></i> <span data-i18n="tls.label.cert"></span></label>
        <span class="tls-config-input-data">
            <label class="red-ui-button" for="node-config-input-certfile"><i class="fa fa-upload"></i> <span data-i18n="tls.label.upload"></span></label>
            <input class="hide" type="file" id="node-config-input-certfile">
            <span id="tls-config-certname" style="width: calc(100% - 280px); overflow: hidden; line-height:34px; height:34px; text-overflow: ellipsis; white-space: nowrap; display: inline-block; vertical-align: middle;"> </span>
            <button class="red-ui-button red-ui-button-small" id="tls-config-button-cert-clear" style="margin-left: 10px"><i class="fa fa-times"></i></button>
        </span>
        <input type="hidden" id="node-config-input-certname">
        <input type="hidden" id="node-config-input-certdata">
        <input class="hide tls-config-input-path" style="width: calc(100% - 170px);" type="text" id="node-config-input-cert" data-i18n="[placeholder]tls.placeholder.cert">
    </div>
    <div class="form-row">
        <label style="width: 120px;" for="node-config-input-key"><i class="fa fa-file-text-o"></i> <span data-i18n="tls.label.key"></span></label>
        <span class="tls-config-input-data">
            <label class="red-ui-button" for="node-config-input-keyfile"><i class="fa fa-upload"></i> <span data-i18n="tls.label.upload"></span></label>
            <input class="hide" type="file" id="node-config-input-keyfile">
            <span id="tls-config-keyname" style="width: calc(100% - 280px); overflow: hidden; line-height:34px; height:34px; text-overflow: ellipsis; white-space: nowrap; display: inline-block; vertical-align: middle;"> </span>
            <button class="red-ui-button red-ui-button-small" id="tls-config-button-key-clear" style="margin-left: 10px"><i class="fa fa-times"></i></button>
        </span>
        <input type="hidden" id="node-config-input-keyname">
        <input type="hidden" id="node-config-input-keydata">
        <input class="hide tls-config-input-path" style="width: calc(100% - 170px);" type="text" id="node-config-input-key" data-i18n="[placeholder]tls.placeholder.key">
    </div>
    <div class="form-row">
        <label style="width: 100px; margin-left: 20px;" for="node-config-input-passphrase"> <span data-i18n="tls.label.passphrase"></span></label>
        <input type="password" style="width: calc(100% - 170px);" id="node-config-input-passphrase" data-i18n="[placeholder]tls.placeholder.passphrase">
    </div>
    <div class="form-row">
        <label style="width: 120px;" for="node-config-input-ca"><i class="fa fa-file-text-o"></i> <span data-i18n="tls.label.ca"></span></label>
        <span class="tls-config-input-data">
            <label class="red-ui-button" for="node-config-input-cafile"><i class="fa fa-upload"></i> <span data-i18n="tls.label.upload"></span></label>
            <input class="hide" type="file" title=" " id="node-config-input-cafile">
            <span id="tls-config-caname" style="width: calc(100% - 280px); overflow: hidden; line-height:34px; height:34px; text-overflow: ellipsis; white-space: nowrap; display: inline-block; vertical-align: middle;"> </span>
            <button class="red-ui-button red-ui-button-small" id="tls-config-button-ca-clear" style="margin-left: 10px"><i class="fa fa-times"></i></button>
        </span>
        <input type="hidden" id="node-config-input-caname">
        <input type="hidden" id="node-config-input-cadata">
        <input class="hide tls-config-input-path" style="width: calc(100% - 170px);" type="text" id="node-config-input-ca" data-i18n="[placeholder]tls.placeholder.ca">
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-config-input-verifyservercert" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-config-input-verifyservercert" style="width: calc(100% - 170px);" data-i18n="tls.label.verify-server-cert"></label>
    </div>
    <div class="form-row">
        <label style="width: 126px;" for="node-config-input-servername"><i class="fa fa-server"></i> <span data-i18n="tls.label.servername"></span></label>
        <input style="width: calc(100% - 176px);" type="text" id="node-config-input-servername" data-i18n="[placeholder]tls.placeholder.servername">
    </div>
    <div class="form-row">
        <label style="width: 126px;" for="node-config-input-alpnprotocol"><i class="fa fa-cogs"></i> <span data-i18n="tls.label.alpnprotocol"></span></label>
        <input style="width: calc(100% - 176px);" type="text" id="node-config-input-alpnprotocol" data-i18n="[placeholder]tls.placeholder.alpnprotocol">
    </div>
    <hr>
    <div class="form-row">
        <label style="width: 120px;" for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input style="width: calc(100% - 170px);" type="text" id="node-config-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('tls-config',{
        category: 'config',
        defaults: {
            name: {value:""},
            cert: {value:"", validate: function(v) {
                var currentKey = $("#node-config-input-key").val();
                if (currentKey === undefined) {
                    currentKey = this.key;
                }
                return currentKey === '' || v != '';
            }},
            key: {value:"", validate: function(v) {
                var currentCert = $("#node-config-input-cert").val();
                if (currentCert === undefined) {
                    currentCert = this.cert;
                }
                return currentCert === '' || v != '';
            }},
            ca: {value:""},
            certname: {value:""},
            keyname: {value:""},
            caname: {value:""},
            servername: {value:""},
            verifyservercert: {value: true},
            alpnprotocol: {value: ""}
        },
        credentials: {
            certdata: {type:"text"},
            keydata: {type:"text"},
            cadata: {type:"text"},
            passphrase: {type:"password"}
        },
        label: function() {
            return this.name || this._("tls.tls");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            function updateFileUpload() {
                if ($("#node-config-input-uselocalfiles").is(':checked')) {
                    $(".tls-config-input-path").show();
                    $(".tls-config-input-data").hide();
                } else {
                    $(".tls-config-input-data").show();
                    $(".tls-config-input-path").hide();
                }
            }
            $("#node-config-input-uselocalfiles").on("click",function() {
                updateFileUpload();
            });

            function saveFile(property, file) {
                var dataInputId = "#node-config-input-"+property+"data";
                var filenameInputId = "#node-config-input-"+property+"name";
                var filename = file.name;
                var reader = new FileReader();
                reader.onload = function(event) {
                    $("#tls-config-"+property+"name").text(filename);
                    $(filenameInputId).val(filename);
                    $(dataInputId).val(event.target.result);
                }
                reader.readAsText(file,"UTF-8");
            }
            $("#node-config-input-certfile" ).on("change", function() {
                saveFile("cert", this.files[0]);
            });
            $("#node-config-input-keyfile" ).on("change", function() {
                saveFile("key", this.files[0]);
            });
            $("#node-config-input-cafile" ).on("change", function() {
                saveFile("ca", this.files[0]);
            });

            function clearNameData(prop) {
                $("#tls-config-"+prop+"name").text("");
                $("#node-config-input-"+prop+"data").val("");
                $("#node-config-input-"+prop+"name").val("");
            }
            $("#tls-config-button-cert-clear").on("click", function() {
                clearNameData("cert");
            });
            $("#tls-config-button-key-clear").on("click", function() {
                clearNameData("key");
            });
            $("#tls-config-button-ca-clear").on("click", function() {
                clearNameData("ca");
            });

            if (RED.settings.tlsConfigDisableLocalFiles) {
                $("#node-config-row-uselocalfiles").hide();
            } else {
                $("#node-config-row-uselocalfiles").show();
            }
            // in case paths were set from old TLS config
            if(this.cert || this.key || this.ca) {
                $("#node-config-input-uselocalfiles").prop('checked',true);
            }
            $("#tls-config-certname").text(this.certname);
            $("#tls-config-keyname").text(this.keyname);
            $("#tls-config-caname").text(this.caname);
            updateFileUpload();
        },
        oneditsave: function() {
            if ($("#node-config-input-uselocalfiles").is(':checked')) {
                clearNameData("ca");
                clearNameData("cert");
                clearNameData("key");
            } else {
                $("#node-config-input-ca").val("");
                $("#node-config-input-cert").val("");
                $("#node-config-input-key").val("");
            }
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="tls-config">
    <p>TLS连接的配置选项。</p>
</script>

</div><div><!-- --- [red-module:node-red/httpproxy] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="http proxy">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-config-input-name">
    </div>
    <div class="form-row">
        <label for="node-config-input-url"><i class="fa fa-globe"></i> <span data-i18n="httpin.label.url"></span></label>
        <input type="text" id="node-config-input-url" placeholder="http://hostname:port">
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-config-input-useAuth" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-config-input-useAuth" style="width: 70%;"><span data-i18n="httpin.use-proxyauth"></span></label>
        <div style="margin-left: 20px" class="node-config-input-useAuth-row hide">
            <div class="form-row">
                <label for="node-config-input-username"><i class="fa fa-user"></i> <span data-i18n="common.label.username"></span></label>
                <input type="text" id="node-config-input-username">
            </div>
            <div class="form-row">
                <label for="node-config-input-password"><i class="fa fa-lock"></i> <span data-i18n="common.label.password"></span></label>
                <input type="password" id="node-config-input-password">
            </div>
        </div>
    </div>
    <div class="form-row" style="margin-bottom:0;">
        <label><i class="fa fa-list"></i> <span data-i18n="httpin.noproxy-hosts"></span></label>
    </div>
    <div class="form-row node-config-input-noproxy-container-row">
        <ol id="node-config-input-noproxy-container"></ol>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('http proxy', {
        category: 'config',
        defaults: {
            name: {value:''},
            url: {value:'',validate:function(v) { return (v && (v.indexOf('://') !== -1) && (v.trim().indexOf('http') === 0)); }},
            noproxy: {value:[]}
        },
        credentials: {
            username: {type:'text'},
            password: {type:'password'}
        },
        label: function() {
            return this.name || this.url || ('http proxy:' + this.id);
        },
        oneditprepare: function() {
            $('#node-config-input-useAuth').on("change", function() {
                if ($(this).is(":checked")) {
                    $('.node-config-input-useAuth-row').show();
                } else {
                    $('.node-config-input-useAuth-row').hide();
                    $('#node-config-input-username').val('');
                    $('#node-config-input-password').val('');
                }
            });
            if (this.credentials.username || this.credentials.has_password) {
                $('#node-config-input-useAuth').prop('checked', true);
            } else {
                $('#node-config-input-useAuth').prop('checked', false);
            }
            $('#node-config-input-useAuth').change();

            var hostList = $('#node-config-input-noproxy-container')
                .css({'min-height':'150px','min-width':'450px'})
                .editableList({
                    addItem: function(container, index, data) {
                        var row = $('<div/>')
                            .css({overflow: 'hidden',whiteSpace: 'nowrap'})
                            .appendTo(container);

                        var hostField = $('<input/>',{class:'node-config-input-host',type:'text',placeholder:'hostname'})
                            .css({width:'100%'})
                            .appendTo(row);
                        if (data.host) {
                            hostField.val(data.host);
                        }
                    },
                    removable: true
                });
            if (this.noproxy) {
                for (var i in this.noproxy) {
                    hostList.editableList('addItem', {host:this.noproxy[i]});
                }
            }
            if (hostList.editableList('items').length == 0) {
                hostList.editableList('addItem', {host:''});
            }
        },
        oneditsave: function() {
            var hosts = $('#node-config-input-noproxy-container').editableList('items');
            var node = this;
            node.noproxy = [];
            hosts.each(function(i) {
                var host = $(this).find('.node-config-input-host').val().trim();
                if (host) {
                    node.noproxy.push(host);
                }
            });
        },
        oneditresize: function(size) {
            var rows = $('#node-config-dialog-edit-form>div:not(.node-config-input-noproxy-container-row)');
            var height = size.height;
            for (var i = 0; i < rows.length; i++) {
                height -= $(rows[i]).outerHeight(true);
            }

            var editorRow = $('#node-config-dialog-edit-form>div.node-config-input-noproxy-container-row');
            height -= (parseInt(editorRow.css('margin-top')) + parseInt(editorRow.css('margin-bottom')));
            $('#node-config-input-noproxy-container').editableList('height',height);
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="http proxy">
    <p>HTTP代理的配置选项。</p>

    <h3>详细</h3>
    <p>访问代理例外列表中的主机时，将不使用任何代理。</p>
</script>

</div><div><!-- --- [red-module:node-red/mqtt] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<style>

    .mqtt-form-row-cols2 > input.mqtt-form-row-col1 {
        width: calc(35% - 75px);
    }
    .mqtt-form-row-cols2 > select.mqtt-form-row-col1 {
        width: calc(35% - 75px);
    }

    .mqtt-form-row-cols2 > label.mqtt-form-row-col2 {
        width: 100px;
        margin-left: 42px;
        display: inline-block;
    }
    .mqtt-form-row-cols2 > input.mqtt-form-row-col2 {
        width: calc(35% - 75px);
        display: inline-block;
    }
    .mqtt-form-row-cols2 > select.mqtt-form-row-col2 {
        width: calc(35% - 75px);
        display: inline-block;
    }
    .form-row.mqtt5-out > label {
        width: 130px;
    }
    .form-row.mqtt-flags-row > label {
        vertical-align: top;
    }
    .form-row.mqtt-flags-row > .mqtt-flags {
        display: inline-block;
        width: 70%
    }

    .form-row.mqtt-flags-row > .mqtt-flags > .mqtt-flag > label {
        display: block;
        width: 100%;
    }
    .form-row.mqtt-flags-row > .mqtt-flags > .mqtt-flag > label > input {
        position: relative;
        vertical-align: bottom;
        top: -2px;
        width: 15px;
        height: 15px;
    }
    .form-row-mqtt5 {
        display: none;
    }
    .form-row-mqtt5.form-row-mqtt5-active:not(.form-row-mqtt-static-disabled) {
        display: block
    }
    .form-row-mqtt-static-disabled {
        display: none;
        /* opacity: 0.3;
        pointer-events: none; */
    }

</style>

<script type="text/html" data-template-name="mqtt in">
    <div class="form-row">
        <label for="node-input-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
        <input type="text" id="node-input-broker">
    </div>
    <div class="form-row">
        <label for="node-input-topicType" data-i18n="mqtt.label.action"></label>
        <select id="node-input-topicType" style="width: 70%">
            <option value="topic" data-i18n="mqtt.label.staticTopic"></option>
            <option value="dynamic" data-i18n="mqtt.label.dynamicTopic"></option>
        </select>
        <input type="hidden" id="node-input-inputs">
    </div>
    <div class="form-row form-row-mqtt-static">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
        <input type="text" id="node-input-topic" data-i18n="[placeholder]common.label.topic">
    </div>
    <div class="form-row form-row-mqtt-static">
        <label for="node-input-qos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
        <select id="node-input-qos" style="width:125px !important">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
        </select>
    </div>
    <div class="form-row mqtt-flags-row form-row-mqtt5 form-row-mqtt-static">
        <label for="node-input-nl" ><i class="fa fa-flag"></i> <span data-i18n="mqtt.label.flags">Flags</span></label>
        <div class="mqtt-flags">
            <div class="mqtt-flag">
                <label for="node-input-nl">
                    <input type="checkbox" id="node-input-nl">
                    <span data-i18n="mqtt.label.nl"></span>
                </label>
            </div>
            <div class="mqtt-flag">
                <label for="node-input-rap">
                    <input type="checkbox" id="node-input-rap">
                    <span data-i18n="mqtt.label.rap"></span>
                </label>
            </div>
        </div>
    </div>
    <div class="form-row form-row-mqtt5 form-row-mqtt-static">
        <label for="node-input-rh" style="width:100%"><i class="fa fa-tag"></i> <span data-i18n="mqtt.label.rh"></span></label>
        <select id="node-input-rh" style="margin-left: 104px; width: 70%">
            <option value="0" data-i18n="mqtt.label.rh0"></option>
            <option value="1" data-i18n="mqtt.label.rh1"></option>
            <option value="2" data-i18n="mqtt.label.rh2"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-datatype"><i class="fa fa-sign-out"></i> <span data-i18n="mqtt.label.output"></span></label>
        <select id="node-input-datatype" style="width:70%;">
            <option value="auto" data-i18n="mqtt.output.auto"></option>
            <option value="buffer" data-i18n="mqtt.output.buffer"></option>
            <option value="utf8" data-i18n="mqtt.output.string"></option>
            <option value="json" data-i18n="mqtt.output.json"></option>
            <option value="base64" data-i18n="mqtt.output.base64"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/html" data-template-name="mqtt out">
    <div class="form-row">
        <label for="node-input-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
        <input type="text" id="node-input-broker">
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
        <input type="text" id="node-input-topic" data-i18n="[placeholder]common.label.topic">
    </div>

    <div class="form-row mqtt-form-row-cols2">
        <label for="node-input-qos" class="mqtt-form-row-col1"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
        <select id="node-input-qos" class="mqtt-form-row-col1">
            <option value=""></option>
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
        </select>

        <label for="node-input-retain" class="mqtt-form-row-col2"><i class="fa fa-history"></i> <span data-i18n="mqtt.retain"></span></label>
        <select id="node-input-retain" class="mqtt-form-row-col2" >
            <option value=""></option>
            <option value="false" data-i18n="mqtt.false"></option>
            <option value="true" data-i18n="mqtt.true"></option>
        </select>
    </div>
    <div class="form-row mqtt5 mqtt5-out">
        <label for="node-input-userProps"><span data-i18n="mqtt.label.userProperties"></span></label>
        <input type="text" id="node-input-userProps" style="width: calc(100% - 166px);">
    </div>
    <div class="form-row mqtt5 mqtt5-out">
        <label for="node-input-respTopic"><span data-i18n="mqtt.label.responseTopic"></span></label>
        <input type="text" id="node-input-respTopic" style="width: calc(100% - 166px);">
    </div>
    <div class="form-row mqtt5 mqtt5-out">
        <label for="node-input-correl"><span data-i18n="mqtt.label.correlationData"></span></label>
        <input type="text" id="node-input-correl" style="width: calc(100% - 166px);">
    </div>
    <div class="form-row mqtt5 mqtt5-out">
        <label for="node-input-contentType"><span data-i18n="mqtt.label.contentType"></span></label>
        <input type="text" id="node-input-contentType" style="width: calc(100% - 166px);">
    </div>

    <div class="form-row mqtt-form-row-cols2 mqtt5 mqtt5-out">
        <label for="node-input-expiry" class="mqtt-form-row-col1"><span data-i18n="mqtt.label.expiry"></span></label>
        <input id="node-input-expiry"  style="width: calc(100% - 166px);" class="mqtt-form-row-col1" >
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips"><span data-i18n="mqtt.tip"></span></div>
</script>

<script type="text/html" data-template-name="mqtt-broker">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-config-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row">
        <ul style="min-width: 600px; margin-bottom: 20px;" id="node-config-mqtt-broker-tabs"></ul>
    </div>
    <div id="node-config-mqtt-broker-tabs-content" style="min-height:150px;">
        <div id="mqtt-broker-tab-connection" style="display:none">
            <div class="form-row node-input-broker">
                <label for="node-config-input-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
                <input type="text" id="node-config-input-broker" style="width: calc(100% - 300px);" data-i18n="[placeholder]mqtt.label.example">
                <label for="node-config-input-port" style="margin-left:20px; width:43px; "> <span data-i18n="mqtt.label.port"></span></label>
                <input type="text" id="node-config-input-port" data-i18n="[placeholder]mqtt.label.port" style="width:55px">
            </div>
            <div class="form-row" style="margin-bottom:0">
                <input type="checkbox" id="node-config-input-autoConnect" style="margin: 0 5px 0 104px; display: inline-block; width: auto;">
                <label for="node-config-input-autoConnect" style="width: auto"><span data-i18n="mqtt.label.auto-connect"></span></label>
            </div>
            <div class="form-row" style="height: 34px;">
                <input type="checkbox" id="node-config-input-usetls" style="height: 34px; margin: 0 5px 0 104px; display: inline-block; width: auto; vertical-align: top;">
                <label for="node-config-input-usetls" style="width: 100px; line-height: 34px;"><span data-i18n="mqtt.label.use-tls"></span></label>
                <span id="node-config-row-tls" class="hide"><input style="width: 320px;" type="text" id="node-config-input-tls"></span>
            </div>
            <div class="form-row">
                <label for="node-config-input-protocolVersion"><i class="fa fa-cog"></i> <span data-i18n="mqtt.label.protocolVersion"></span></label>
                <select id="node-config-input-protocolVersion" style="width:70%;">
                    <option value="3" data-i18n="mqtt.label.protocolVersion3"></option>
                    <option value="4" data-i18n="mqtt.label.protocolVersion4"></option>
                    <option value="5" data-i18n="mqtt.label.protocolVersion5"></option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-config-input-clientid"><i class="fa fa-tag"></i> <span data-i18n="mqtt.label.clientid"></span></label>
                <input type="text" id="node-config-input-clientid" data-i18n="[placeholder]mqtt.placeholder.clientid">
            </div>
            <div class="form-row">
                <label for="node-config-input-keepalive"><i class="fa fa-heartbeat"></i> <span data-i18n="mqtt.label.keepalive"></span></label>
                <input type="number" min="0" id="node-config-input-keepalive" style="width: 100px">
            </div>
            <div class="form-row" style="margin-bottom:0">
                <label style="vertical-align:top;"><i class="fa fa-info"></i> <span data-i18n="mqtt.label.session"></span></label>
                <div style="display: inline-block; width:calc(100% - 110px)">
                    <div class="form-row">
                        <label for="node-config-input-cleansession" style="width: auto;">
                            <input type="checkbox" id="node-config-input-cleansession" style="position: relative;vertical-align: bottom; top: -2px; width: 15px;height: 15px;">
                            <span id="node-config-input-cleansession-label" data-i18n="mqtt.label.cleansession"></span>
                        </label>
                    </div>
                    <div class="form-row mqtt5">
                        <label style="width:auto" for="node-config-input-sessionExpiry"><span data-i18n="mqtt.label.sessionExpiry"></span></label>
                        <input type="number" min="0" id="node-config-input-sessionExpiry" style="width: 100px" >
                    </div>
                </div>
            </div>
            <div class="form-row mqtt5">
                <label style="width: 125px;" for="node-config-input-userProps"><span data-i18n="mqtt.label.userProperties"></span></label>
                <input type="text" id="node-config-input-userProps" style="width: calc(100% - 166px);">
            </div>
            <br>
        </div>
        <div id="mqtt-broker-tab-security" style="display:none">
            <div class="form-row">
                <label for="node-config-input-user"><i class="fa fa-user"></i> <span data-i18n="common.label.username"></span></label>
                <input type="text" id="node-config-input-user">
            </div>
            <div class="form-row">
                <label for="node-config-input-password"><i class="fa fa-lock"></i> <span data-i18n="common.label.password"></span></label>
                <input type="password" id="node-config-input-password">
            </div>
        </div>
        <div id="mqtt-broker-tab-messages" style="display:none">
            <div id="mqtt-broker-section-birth">
                <div class="red-ui-palette-header">
                    <i class="fa fa-angle-down"></i><span data-i18n="mqtt.sections-label.birth-message"></span>
                </div>
                <div class="section-content" style="padding:10px 0 0 10px">
                    <div class="form-row">
                        <label style="width: 100px !important;" for="node-config-input-birthTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                        <input style="width: calc(100% - 300px) !important" type="text" id="node-config-input-birthTopic" data-i18n="[placeholder]mqtt.placeholder.birth-topic">
                        <label style="margin-left: 10px; width: 90px !important;" for="node-config-input-birthRetain"><i class="fa fa-history"></i> <span data-i18n="mqtt.label.retain"></span></label>
                        <select id="node-config-input-birthRetain" style="width:75px !important">
                            <option value="false" data-i18n="mqtt.false"></option>
                            <option value="true" data-i18n="mqtt.true"></option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label style="width: 100px !important;" for="node-config-input-birthPayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                        <input style="width: calc(100% - 300px) !important" type="text" id="node-config-input-birthPayload" style="width:300px" data-i18n="[placeholder]common.label.payload">
                        <label style="margin-left: 10px; width: 90px !important;" for="node-config-input-birthQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                        <select id="node-config-input-birthQos" style="width:75px !important">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select>
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-birth-contentType" data-i18n="mqtt.label.contentType"></label>
                        <input type="text" style="width:calc(100% - 200px);" id="node-config-input-birth-contentType">
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-birth-props" data-i18n="mqtt.label.userProperties"></label>
                        <input type="text" style="width:calc(100% - 200px);" id="node-config-input-birth-props">
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-birth-respTopic"><span data-i18n="mqtt.label.responseTopic"></span></label>
                        <input type="text" id="node-config-input-birth-respTopic" style="width: calc(100% - 200px);">
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-birth-correl"><span data-i18n="mqtt.label.correlationData"></span></label>
                        <input type="text" id="node-config-input-birth-correl" style="width: calc(100% - 200px);">
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-birth-expiry"><span data-i18n="mqtt.label.expiry"></span></label>
                        <input id="node-config-input-birth-expiry"  style="width: calc(100% - 200px);">
                    </div>
                </div>
            </div>
            <div id="mqtt-broker-section-close">
                <div class="red-ui-palette-header">
                    <i class="fa fa-angle-down"></i><span data-i18n="mqtt.sections-label.close-message"></span>
                </div>
                <div class="section-content" style="padding:10px 0 0 10px">
                    <div class="form-row">
                        <label style="width: 100px !important;" for="node-config-input-closeTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                        <input style="width: calc(100% - 300px) !important" type="text" id="node-config-input-closeTopic" style="width:300px" data-i18n="[placeholder]mqtt.placeholder.close-topic">
                        <label style="margin-left: 10px; width: 90px !important;" for="node-config-input-closeRetain"><i class="fa fa-history"></i> <span data-i18n="mqtt.label.retain"></span></label>
                        <select id="node-config-input-closeRetain" style="width:75px !important">
                            <option value="false" data-i18n="mqtt.false"></option>
                            <option value="true" data-i18n="mqtt.true"></option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label style="width: 100px !important;" for="node-config-input-closePayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                        <input style="width: calc(100% - 300px) !important" type="text" id="node-config-input-closePayload" style="width:300px" data-i18n="[placeholder]common.label.payload">
                        <label style="margin-left: 10px; width: 90px !important;" for="node-config-input-closeQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                        <select id="node-config-input-closeQos" style="width:75px !important">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select>
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-close-contentType" data-i18n="mqtt.label.contentType"></label>
                        <input type="text" style="width:calc(100% - 200px);" id="node-config-input-close-contentType">
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-close-props" data-i18n="mqtt.label.userProperties"></label>
                        <input type="text" style="width:calc(100% - 200px);" id="node-config-input-close-props">
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-close-respTopic"><span data-i18n="mqtt.label.responseTopic"></span></label>
                        <input type="text" id="node-config-input-close-respTopic" style="width: calc(100% - 200px);">
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-close-correl"><span data-i18n="mqtt.label.correlationData"></span></label>
                        <input type="text" id="node-config-input-close-correl" style="width: calc(100% - 200px);">
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-close-expiry"><span data-i18n="mqtt.label.expiry"></span></label>
                        <input id="node-config-input-close-expiry"  style="width: calc(100% - 200px);">
                    </div>
                </div>
            </div>
            <div id="mqtt-broker-section-will">
                <div class="red-ui-palette-header">
                    <i class="fa fa-angle-down"></i><span data-i18n="mqtt.sections-label.will-message"></span>
                </div>
                <div class="section-content" style="padding:10px 0 0 10px">
                    <div class="form-row">
                        <label style="width: 100px !important;" for="node-config-input-willTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                        <input style="width: calc(100% - 300px) !important" type="text" id="node-config-input-willTopic" style="width:300px" data-i18n="[placeholder]mqtt.placeholder.will-topic">
                        <label style="margin-left: 10px; width: 90px !important;" for="node-config-input-willRetain"><i class="fa fa-history"></i> <span data-i18n="mqtt.label.retain"></span></label>
                        <select id="node-config-input-willRetain" style="width:75px !important">
                            <option value="false" data-i18n="mqtt.false"></option>
                            <option value="true" data-i18n="mqtt.true"></option>
                        </select>
                    </div>
                    <div class="form-row">
                        <label style="width: 100px !important;" for="node-config-input-willPayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                        <input style="width: calc(100% - 300px) !important" type="text" id="node-config-input-willPayload" style="width:300px" data-i18n="[placeholder]common.label.payload">
                        <label style="margin-left: 10px; width: 90px !important;" for="node-config-input-willQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                        <select id="node-config-input-willQos" style="width:75px !important">
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                        </select>
                    </div>
                    <div class="form-row mqtt5">
                        <label><span data-i18n="mqtt.label.delay"></span></label>
                        <input type="number" min="0" id="node-config-input-will-delay" style="width: 100px" >
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-will-contentType" data-i18n="mqtt.label.contentType"></label>
                        <input type="text" style="width:calc(100% - 200px);" id="node-config-input-will-contentType">
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-will-props" data-i18n="mqtt.label.userProperties"></label>
                        <input type="text" style="width:calc(100% - 200px);" id="node-config-input-will-props">
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-will-respTopic"><span data-i18n="mqtt.label.responseTopic"></span></label>
                        <input type="text" id="node-config-input-will-respTopic" style="width: calc(100% - 200px);">
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-will-correl"><span data-i18n="mqtt.label.correlationData"></span></label>
                        <input type="text" id="node-config-input-will-correl" style="width: calc(100% - 200px);">
                    </div>
                    <div class="form-row mqtt5 mqtt5-out">
                        <label for="node-config-input-will-expiry"><span data-i18n="mqtt.label.expiry"></span></label>
                        <input id="node-config-input-will-expiry"  style="width: calc(100% - 200px);">
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/javascript">
(function() {

    var typedInputNoneOpt = { value: 'none', label: '', hasValue: false };
    var makeTypedInputOpt = function(value){
        return {
            value: value,
            label:value,
            hasValue: false
        }
    }
    var contentTypeOpts = [
        typedInputNoneOpt,
        makeTypedInputOpt("application/json"),
        makeTypedInputOpt("application/octet-stream"),
        makeTypedInputOpt("text/csv"),
        makeTypedInputOpt("text/html"),
        makeTypedInputOpt("text/plain"),
        {value:"other", label:""}
    ];

    function getDefaultContentType(value) {
        var defaultContentType;
        var matchedContentType = contentTypeOpts.filter(function(v) {
            return v.value === value;
        })
        if (matchedContentType.length > 0) {
            defaultContentType = matchedContentType[0].value;
        }
        if (value && !defaultContentType) {
            defaultContentType = 'other';
        }
        return defaultContentType || 'none'
    }

    RED.nodes.registerType('mqtt-broker',{
        category: 'config',
        defaults: {
            name: {value:""},
            broker: {value:"",required:true},
            port: {value:1883,required:false,validate:RED.validators.number(true)},
            tls: {type:"tls-config",required: false},
            clientid: {value:"", validate: function(v) {
                if ($("#node-config-input-clientid").length) {
                    // Currently editing the node
                    return $("#node-config-input-cleansession").is(":checked") || (v||"").length > 0;
                } else {
                    return (this.cleansession===undefined || this.cleansession) || (v||"").length > 0;
                }
            }},
            autoConnect: {value: true},
            usetls: {value: false},
            verifyservercert: { value: false},
            compatmode: { value: false},
            protocolVersion: { value: 4},
            keepalive: {value:60,validate:RED.validators.number()},
            cleansession: {value: true},
            birthTopic: {value:""},
            birthQos: {value:"0"},
            birthRetain: {value:false},
            birthPayload: {value:""},
            birthMsg: { value: {}},
            closeTopic: {value:""},
            closeQos: {value:"0"},
            closeRetain: {value:false},
            closePayload: {value:""},
            closeMsg: { value: {}},
            willTopic: {value:""},
            willQos: {value:"0"},
            willRetain: {value:false},
            willPayload: {value:""},
            willMsg: { value: {}},
            sessionExpiry: {value:0}
        },
        credentials: {
            user: {type:"text"},
            password: {type: "password"}
        },
        label: function() {
            if (this.name) {
                return this.name;
            }
            var b = this.broker;
            if (!b) { b = "undefined"; }
            var lab = "";
            lab = (this.clientid?this.clientid+"@":"")+b;
            if (b.indexOf("://") === -1){
                if (!this.port){ lab = lab + ":1883"; }
                else { lab = lab + ":" + this.port; }
            }
            return lab;
        },
        oneditprepare: function () {
            var tabs = RED.tabs.create({
                id: "node-config-mqtt-broker-tabs",
                onchange: function(tab) {
                    $("#node-config-mqtt-broker-tabs-content").children().hide();
                    $("#" + tab.id).show();
                }
            });
            tabs.addTab({
                id: "mqtt-broker-tab-connection",
                label: this._("mqtt.tabs-label.connection")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-security",
                label: this._("mqtt.tabs-label.security")
            });

            tabs.addTab({
                id: "mqtt-broker-tab-messages",
                label: this._("mqtt.tabs-label.messages")
            });

            function setUpSection(sectionId, v5Opts, isExpanded) {
                var birthMessageSection = $("#mqtt-broker-section-"+sectionId);
                var paletteHeader = birthMessageSection.find('.red-ui-palette-header');
                var twistie = paletteHeader.find('i');
                var sectionContent = birthMessageSection.find('.section-content');

                function toggleSection(expanded) {
                    twistie.toggleClass('expanded', expanded);
                    sectionContent.toggle(expanded);
                }
                paletteHeader.on("click", function(e) {
                    e.preventDefault();
                    var isExpanded = twistie.hasClass('expanded');
                    toggleSection(!isExpanded);
                });
                toggleSection(isExpanded);
                $("#node-config-input-"+sectionId+"-contentType").val(v5Opts?v5Opts.contentType:"").typedInput({
                    default: getDefaultContentType(v5Opts?v5Opts.contentType:""),
                    types: contentTypeOpts,
                });

                $("#node-config-input-"+sectionId+"-props").val(v5Opts?v5Opts.userProps:"").typedInput({
                    default:  !(v5Opts?v5Opts.userProps:null)? 'none':'json',
                    types: [typedInputNoneOpt, 'json'],
                });
                $("#node-config-input-"+sectionId+"-respTopic").val(v5Opts?v5Opts.respTopic:"").typedInput({
                    default:  !(v5Opts?v5Opts.respTopic:null)? 'none':'str',
                    types: [typedInputNoneOpt, 'str'],
                });
                $("#node-config-input-"+sectionId+"-correl").val(v5Opts?v5Opts.correl:"").typedInput({
                    default:  !(v5Opts?v5Opts.correl:null)? 'none':'str',
                    types: [typedInputNoneOpt, 'str'],
                });
                $("#node-config-input-"+sectionId+"-expiry").val(v5Opts?v5Opts.expiry:"").typedInput({
                    default:  !(v5Opts?v5Opts.expiry:null)? 'none':'num',
                    types: [typedInputNoneOpt, 'num'],
                });
            }

            // show first section if none are set so the user gets the idea
            var showBirthSection = this.birthTopic !== ""
                || this.willTopic === ""
                && this.birthTopic === ""
                && this.closeTopic == "";
            setUpSection('birth', this.birthMsg, showBirthSection);
            setUpSection('close', this.closeMsg, this.closeTopic !== "");
            setUpSection('will', this.willMsg, this.willTopic !== "");

            if (this.willMsg) {
                $("#node-config-input-will-delay").val(this.willMsg.delay);
            }

            setTimeout(function() { tabs.resize(); },0);
            if (typeof this.cleansession === 'undefined') {
                this.cleansession = true;
                $("#node-config-input-cleansession").prop("checked",true);
            }
            if (typeof this.usetls === 'undefined') {
                this.usetls = false;
                $("#node-config-input-usetls").prop("checked",false);
            }
            if (typeof this.autoConnect === 'undefined') {
                this.autoConnect = true;
                $("#node-config-input-autoConnect").prop("checked",true);
            }
            if (this.compatmode === 'true' || this.compatmode === true) {
                delete this.compatmode;
                this.protocolVersion = 4;
            }
            if (typeof this.protocolVersion === 'undefined') {
                this.protocolVersion = 4;
            }
            $("#node-config-input-protocolVersion").on("change", function() {
                var v5 = $("#node-config-input-protocolVersion").val() == "5";
                if(v5) {
                    $("#node-config-input-cleansession-label").text(RED._("node-red:mqtt.label.cleanstart"))
                    $("div.form-row.mqtt5").show();
                } else {
                    $("#node-config-input-cleansession-label").text(RED._("node-red:mqtt.label.cleansession"))
                    $("div.form-row.mqtt5").hide();
                }
            });
            $("#node-config-input-protocolVersion").val(this.protocolVersion);
            $("#node-config-input-userProps").typedInput({
                default:  !this.userProps ? 'none':'json',
                types: [typedInputNoneOpt, 'json']
            });
            if (typeof this.keepalive === 'undefined') {
                this.keepalive = 15;
                $("#node-config-input-keepalive").val(this.keepalive);
            }
            if (typeof this.birthQos === 'undefined') {
                this.birthQos = "0";
                $("#node-config-input-birthQos").val("0");
            }
            if (typeof this.closeQos === 'undefined') {
                this.willQos = "0";
                $("#node-config-input-willQos").val("0");
            }
            if (typeof this.willQos === 'undefined') {
                this.willQos = "0";
                $("#node-config-input-willQos").val("0");
            }


            function updateTLSOptions() {
                if ($("#node-config-input-usetls").is(':checked')) {
                    $("#node-config-row-tls").show();
                } else {
                    $("#node-config-row-tls").hide();
                }
            }
            updateTLSOptions();
            $("#node-config-input-usetls").on("click",function() {
                updateTLSOptions();
            });
            var node = this;
            function updateClientId() {
                if ($("#node-config-input-cleansession").is(":checked")) {
                    $("#node-config-input-clientid").attr("placeholder",node._("mqtt.placeholder.clientid"));
                } else {
                    $("#node-config-input-clientid").attr("placeholder",node._("mqtt.placeholder.clientid-nonclean"));
                }
                $("#node-config-input-clientid").trigger("change");
            }
            setTimeout(updateClientId,0);
            $("#node-config-input-cleansession").on("click",function() {
                updateClientId();
            });

            function updatePortEntry(){
                var disabled = $("#node-config-input-port").prop("disabled");
                if ($("#node-config-input-broker").val().indexOf("://") === -1){
                    if (disabled){
                        $("#node-config-input-port").prop("disabled", false);
                    }
                }
                else {
                    if (!disabled){
                        $("#node-config-input-port").prop("disabled", true);
                    }
                }
            }
            $("#node-config-input-broker").on("change", function() {
                updatePortEntry();
            });
            $("#node-config-input-broker").on( "keyup", function() {
                updatePortEntry();
            });
            setTimeout(updatePortEntry,50);
            setTimeout(function() {
                $("#node-config-input-protocolVersion").trigger("change");
            },50);

        },
        oneditsave: function() {
            if (!$("#node-config-input-usetls").is(':checked')) {
                $("#node-config-input-tls").val("");
            }

            var v5 = $("#node-config-input-protocolVersion").val() == "5";

            function saveV5Message(section) {
                var msg = {};
                if ($("#node-config-input-"+section+"Topic").val().trim().length > 0) {
                    var contentType = $("#node-config-input-"+section+"-contentType").val().trim();
                    if (contentType === '') {
                        contentType = $("#node-config-input-"+section+"-contentType").typedInput('type');
                        if (contentType === 'none' || contentType === 'other') {
                            contentType = "";
                        }
                    }
                    if (contentType) {
                        msg.contentType = contentType;
                    }
                    var props = $("#node-config-input-"+section+"-props").val().trim();
                    if (props) {
                        msg.userProps = props;
                    }
                    var resp = $("#node-config-input-"+section+"-respTopic").val().trim();
                    if (props) {
                        msg.respTopic = resp;
                    }
                    var correl = $("#node-config-input-"+section+"-correl").val().trim();
                    if (correl) {
                        msg.correl = correl;
                    }
                    var expiry = $("#node-config-input-"+section+"-expiry").val().trim();
                    if (expiry) {
                        msg.expiry = expiry;
                    }
                }
                return msg;
            }

            if (v5) {
                this.birthMsg = saveV5Message("birth");
                this.closeMsg = saveV5Message("close");
                this.willMsg = saveV5Message("will");
                var willDelay = $("#node-config-input-will-delay").val();
                if (willDelay) {
                    this.willMsg.delay = willDelay;
                }
            } else {
                this.willMsg = {};
                this.birthMsg = {};
                this.closeMsg = {};
            }

        }
    });

    RED.nodes.registerType('mqtt in',{
        category: 'network',
        defaults: {
            name: {value:""},
            topic: {
                value:"",
                validate: function(v) {
                    var isDynamic = this.inputs === 1;
                    var topicTypeSelect = $("#node-input-topicType");
                    if (topicTypeSelect.length) {
                        isDynamic = topicTypeSelect.val()==='dynamic'
                    }
                    return isDynamic || ((!!v) && RED.validators.regex(/^(#$|(\+|[^+#]*)(\/(\+|[^+#]*))*(\/(\+|#|[^+#]*))?$)/)(v));
                }
            },
            qos: {value: "2"},
            datatype: {value:"auto",required:true},
            broker: {type:"mqtt-broker", required:true},
            // subscriptionIdentifier: {value:0},
            nl: {value:false},
            rap: {value:true},
            rh: {value:0},
            inputs: {value:0},
        },
        color:"#d8bfd8",
        inputs:0,
        outputs:1,
        icon: "bridge.svg",
        label: function() {
            var label = "mqtt";
            if(this.topicType !== "dynamic" && this.topic) {
                label = this.topic;
            }
            return this.name || label;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            const node = this;
            const isV5Broker = function() {
                var confNode = RED.nodes.node($("#node-input-broker").val());
                return confNode && confNode.protocolVersion === "5";
            }
            const isDynamic = function() {
                return $('#node-input-topicType').val() === "dynamic";
            }
            const updateVisibility = function() {
                var v5 = isV5Broker();
                var dynamic = isDynamic();
                $("div.form-row-mqtt5").toggleClass("form-row-mqtt5-active",!!v5);
                $("div.form-row.form-row-mqtt-static").toggleClass("form-row-mqtt-static-disabled", !!dynamic)
            }
            $("#node-input-broker").on("change",function(d){
                updateVisibility();
            });

            $('#node-input-topicType').on("change", function () {
                $("#node-input-inputs").val(isDynamic() ? 1 : 0);
                updateVisibility();
            });

            if (this.inputs === 1) {
                $('#node-input-topicType').val('dynamic')
            } else {
                $('#node-input-topicType').val('topic')
            }
            $('#node-input-topicType').trigger("change");

            if (this.qos === undefined) {
                $("#node-input-qos").val("2");
            }
            if (this.datatype === undefined) {
                $("#node-input-datatype").val("auto");
            }
        },
        oneditsave: function() {
            if ($('#node-input-topicType').val() === "dynamic") {
                $('#node-input-topic').val("");
            }
        }
    });

    RED.nodes.registerType('mqtt out',{
        category: 'network',
        defaults: {
            name: {value:""},
            topic: {value:""},
            qos: {value:""},
            retain: {value:""},
            respTopic: {value:""},
            contentType: {value:""},
            userProps: {value:''},
            correl: {value:''},
            expiry: {value:''},
            broker: {type:"mqtt-broker", required:true}
        },
        color:"#d8bfd8",
        inputs:1,
        outputs:0,
        icon: "bridge.svg",
        align: "right",
        label: function() {
            return this.name||this.topic||"mqtt";
        },
        oneditprepare: function() {
            var that = this;

            function showHideDynamicFields() {
                var confNode = RED.nodes.node($("#node-input-broker").val());
                var v5 = confNode && confNode.protocolVersion == "5";
                if(v5) {
                    $("div.form-row.mqtt5").show();
                    var t = $("#node-input-respTopic").typedInput("type");
                    if (t == 'none') {
                        $("#node-input-correl").parent().hide();
                    } else {
                        $("#node-input-correl").parent().show();
                    }
                } else {
                    $("div.form-row.mqtt5").hide();
                }
            }

            $("#node-input-broker").on("change",function(d){
                showHideDynamicFields();
            });

            var respTopicTI = $("#node-input-respTopic").typedInput({
                default: !this.respTopic ? 'none':'str',
                types: [typedInputNoneOpt,  'str'],
            });

            var correlTI = $("#node-input-correl").typedInput({
                default: !this.correl ? 'none':'str',
                types: [typedInputNoneOpt,  'str']
            });
            //show / hide correlation data depending on respTopic
            respTopicTI.on("change", showHideDynamicFields);
            respTopicTI.triggerHandler("change");

            $("#node-input-userProps").typedInput({
                default:  !this.userProps ? 'none':'json',
                types: [typedInputNoneOpt, 'json'],
            });
            $("#node-input-expiry").typedInput({
                default: !this.expiry ? 'none':'num',
                types: [typedInputNoneOpt,  'num']
            });
            $("#node-input-contentType").typedInput({
                default: getDefaultContentType(this.contentType),
                types: contentTypeOpts
            })
        },
        oneditsave: function() {

            var contentType = $("#node-input-contentType").val().trim();
            if (contentType === '') {
                contentType = $("#node-input-contentType").typedInput('type');
                if (contentType === 'none' || contentType === 'other') {
                    contentType = "";
                }
            }
            $("#node-input-contentType").val(contentType)

        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
})();
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
  http://www.apache.org/licenses/LICENSE-2.0
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="mqtt in">
<p>连接到MQTT代理并订阅来自指定主题的消息。</p>
    <h3>输出</h3>
    <dl class="message-properties">
       <dt>payload <span class="property-type">字符串 | buffer</span></dt>
       <dd>如果不是二进制buffer的话就是字符串</dd>
       <dt>topic <span class="property-type">字符串</span></dt>
       <dd>MQTT主题，使用<code>/</code>作为层次结构分隔符。</dd>
       <dt>qos <span class="property-type">数值</span> </dt>
       <dd>QoS服务质量：0, 最多一次； 1, 最少一次； 2, 只一次。</dd>
       <dt>retain <span class="property-type">布尔值</span></dt>
       <dd>值为true时表示消息已保留且可能是旧的。</dd>
    </dl>
    <h3>详细</h3>
    <p>订阅主题可以包括MQTT通配符（+：一个级别，＃：多个级别）。</p>
    <p>使用该节点您首先需要建立与MQTT代理的连接。通过单击铅笔图标来进行配置。</p>
    <p>如有需要，几个MQTT节点（输入或输出）可以共享相同的代理连接。</p>
</script>

<script type="text/x-red" data-help-name="mqtt out">
    <p>连接到MQTT代理并发布消息。</p>
    <h3>输入</h3>
    <dl class="message-properties">
       <dt>payload <span class="property-type">字符串 | buffer</span></dt>
       <dd>要发布的有效负载。如果未设置此属性，则不会发送任何消息。要发送空白消息，请将此属性设置为空字符串。</dd>

       <dt class="optional">topic <span class="property-type">字符串</span></dt>
       <dd>要发布的MQTT主题。</dd>

       <dt class="optional">qos <span class="property-type">number</span></dt>
       <dd>QoS服务质量：0, 最多一次； 1, 最少一次； 2, 只一次。默认值为0。</dd>

       <dt class="optional">retain <span class="property-type">布尔值</span></dt>
       <dd>设置为<code>true</code>来将消息保留在代理上。默认值为<code>false</code>。</dd>
    </dl>
    <h3>详细</h3>
    <p><code>msg.payload</code>用作已发布消息的有效载荷。如果包含Object，则会在发送之前将其转换为JSON字符串。如果它包含二进制buffer，则消息将按原样发布。</p>
    <p>可以在节点中配置所使用的主题，或者如果留为空白，则可以通过<code>msg.topic</code>进行设置。</p>
    <p>同样，可以在节点中配置QoS和保留值，或者如果保留空白，则分别由<code>msg.qos</code>和<code>msg.retain</code>设置。要清除先前存储在代理中的主题，请设置保留标志并向该主题发布空消息。</p>
    <p>该节点需要与要配置的MQTT代理的连接。通过单击铅笔图标进行配置。</p>
    <p>如果需要，几个MQTT节点（输入或输出）可以共享相同的代理连接。</p>
</script>

<script type="text/x-red" data-help-name="mqtt-broker">
    <p>与MQTT代理的连接设置。</p>
    <p>创建与代理的连接设置。可以在<code>MQTT In</code>和<code>MQTT Out</code>节点中重复利用这些设置。</p>
    <p>如果未为该节点设置客户端ID，并且设置了会话初始化，则将生成一个随机客户端ID。设置客户端ID时，请确保它对于连接目标处的代理是唯一的。</p>
    <h4>Birth Message</h4>
    <p>建立连接后发布在以配置主题中的消息。</p>
    <h4>Close Message</h4>
    <p>在连接正常结束之前重新部署或者关闭了节点时，发布在以配置主题中的消息。</p>
    <h4>Will Message</h4>
    <p>当节点意外丢失连接时由代理发布的消息</p>
    <h4>WebSockets</h4>
    <p>可以将节点配置成使用WebSocket连接。使用WebSocket时，请在服务器字段中以完整格式描述连接目标的URI。 例如：</p>
    <pre>ws://example.com:4000/mqtt</pre>

</script>

</div><div><!-- --- [red-module:node-red/httpin] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="http in">
    <div class="form-row">
        <label for="node-input-method"><i class="fa fa-tasks"></i> <span data-i18n="httpin.label.method"></span></label>
        <select type="text" id="node-input-method" style="width:70%;">
        <option value="get">GET</option>
        <option value="post">POST</option>
        <option value="put">PUT</option>
        <option value="delete">DELETE</option>
        <option value="patch">PATCH</option>
        </select>
    </div>
    <div class="form-row form-row-http-in-upload hide">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-upload" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-upload" style="width: 70%;" data-i18n="httpin.label.upload"></label>
    </div>
    <div class="form-row">
        <label for="node-input-url"><i class="fa fa-globe"></i> <span data-i18n="httpin.label.url"></span></label>
        <input id="node-input-url" type="text" placeholder="/url">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row row-swagger-doc">
        <label for="node-input-swaggerDoc"><i class="fa fa-file-text-o"></i> <span data-i18n="httpin.label.doc"></span></label>
        <input type="text" id="node-input-swaggerDoc">
    </div>
    <div id="node-input-tip" class="form-tips"><span data-i18n="httpin.tip.in"></span><code><span id="node-input-path"></span></code>.</div>
</script>

<script type="text/html" data-template-name="http response">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-statusCode"><i class="fa fa-long-arrow-left"></i> <span data-i18n="httpin.label.status"></span></label>
        <input type="text" id="node-input-statusCode" placeholder="msg.statusCode">
    </div>
    <div class="form-row" style="margin-bottom:0;">
        <label><i class="fa fa-list"></i> <span data-i18n="httpin.label.headers"></span></label>
    </div>
    <div class="form-row node-input-headers-container-row">
        <ol id="node-input-headers-container"></ol>
    </div>
    <div class="form-tips"><span data-i18n="[html]httpin.tip.res"></span></div>
</script>

<script type="text/javascript">
(function() {
    RED.nodes.registerType('http in',{
        category: 'network',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""},
            url: {value:"",required:true},
            method: {value:"get",required:true},
            upload: {value:false},
            swaggerDoc: {type:"swagger-doc", required:false}
        },
        inputs:0,
        outputs:1,
        icon: "white-globe.svg",
        label: function() {
            if (this.name) {
                return this.name;
            } else if (this.url) {
                var root = RED.settings.httpNodeRoot;
                if (root.slice(-1) != "/") {
                    root = root+"/";
                }
                if (this.url.charAt(0) == "/") {
                    root += this.url.slice(1);
                } else {
                    root += this.url;
                }
                return "["+this.method+"] "+root;
            } else {
                return "http";
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var root = RED.settings.httpNodeRoot;
            if (root.slice(-1) == "/") {
                root = root.slice(0,-1);
            }
            if (root == "") {
                $("#node-input-tip").hide();
            } else {
                $("#node-input-path").html(root);
                $("#node-input-tip").show();
            }
            if(!RED.nodes.getType("swagger-doc")){
                $('.row-swagger-doc').hide();
            }
            $("#node-input-method").on("change", function() {
                if ($(this).val() === "post") {
                    $(".form-row-http-in-upload").show();
                } else {
                    $(".form-row-http-in-upload").hide();
                }
            }).change();


        }

    });
    var headerTypes = [
        {value:"content-type",label:"Content-Type",hasValue: false},
        {value:"location",label:"Location",hasValue: false},
        {value:"other",label:RED._("node-red:httpin.label.other"),icon:"red/images/typedInput/az.png"}
       ]
    var contentTypes = [
        {value:"application/json",label:"application/json",hasValue: false},
        {value:"application/xml",label:"application/xml",hasValue: false},
        {value:"text/css",label:"text/css",hasValue: false},
        {value:"text/html",label:"text/html",hasValue: false},
        {value:"text/plain",label:"text/plain",hasValue: false},
        {value:"image/gif",label:"image/gif",hasValue: false},
        {value:"image/png",label:"image/png",hasValue: false},
        {value:"other",label:RED._("node-red:httpin.label.other"),icon:"red/images/typedInput/az.png"}
    ];

    RED.nodes.registerType('http response',{
        category: 'network',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""},
            statusCode: {value:"",validate: RED.validators.number(true)},
            headers: {value:{}}
        },
        inputs:1,
        outputs:0,
        align: "right",
        icon: "white-globe.svg",
        label: function() {
            return this.name||("http"+(this.statusCode?" ("+this.statusCode+")":""));
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var headerList = $("#node-input-headers-container").css('min-height','150px').css('min-width','450px').editableList({
                addItem: function(container,i,header) {
                    var row = $('<div/>').css({
                        overflow: 'hidden',
                        whiteSpace: 'nowrap',
                        display: 'flex'
                    }).appendTo(container);
                    var propertNameCell = $('<div/>').css({'flex-grow':1}).appendTo(row);
                    var propertyName = $('<input/>',{class:"node-input-header-name",type:"text", style:"width: 100%"})
                        .appendTo(propertNameCell)
                        .typedInput({types:headerTypes});

                    var propertyValueCell = $('<div/>').css({'flex-grow':1,'margin-left':'10px'}).appendTo(row);
                    var propertyValue = $('<input/>',{class:"node-input-header-value",type:"text",style:"width: 100%"})
                        .appendTo(propertyValueCell)
                        .typedInput({types:
                            header.h === 'content-type'?contentTypes:[{value:"other",label:"other",icon:"red/images/typedInput/az.png"}]
                        });

                    var matchedType = headerTypes.filter(function(ht) {
                        return ht.value === header.h
                    });
                    if (matchedType.length === 0) {
                        propertyName.typedInput('type','other');
                        propertyName.typedInput('value',header.h);
                        propertyValue.typedInput('value',header.v);
                    } else {
                        propertyName.typedInput('type',header.h);

                        if (header.h === "content-type") {
                            matchedType = contentTypes.filter(function(ct) {
                                return ct.value === header.v;
                            });
                            if (matchedType.length === 0) {
                                propertyValue.typedInput('type','other');
                                propertyValue.typedInput('value',header.v);
                            } else {
                                propertyValue.typedInput('type',header.v);
                            }
                        } else {
                            propertyValue.typedInput('value',header.v);
                        }
                    }

                    matchedType = headerTypes.filter(function(ht) {
                        return ht.value === header.h
                    });
                    if (matchedType.length === 0) {
                        propertyName.typedInput('type','other');
                        propertyName.typedInput('value',header.h);
                    } else {
                        propertyName.typedInput('type',header.h);
                    }

                    propertyName.on('change',function(event) {
                        var type = propertyName.typedInput('type');
                        if (type === 'content-type') {
                            propertyValue.typedInput('types',contentTypes);
                        } else {
                            propertyValue.typedInput('types',[{value:"other",label:"other",icon:"red/images/typedInput/az.png"}]);
                        }
                    });
                },
                removable: true
            });

            if (this.headers) {
                for (var key in this.headers) {
                    if (this.headers.hasOwnProperty(key)) {
                        headerList.editableList('addItem',{h:key,v:this.headers[key]});
                    }
                }
            }
        },
        oneditsave: function() {
            var headers = $("#node-input-headers-container").editableList('items');
            var node = this;
            node.headers = {};
            headers.each(function(i) {
                var header = $(this);
                var keyType = header.find(".node-input-header-name").typedInput('type');
                var keyValue = header.find(".node-input-header-name").typedInput('value');
                var valueType = header.find(".node-input-header-value").typedInput('type');
                var valueValue = header.find(".node-input-header-value").typedInput('value');
                var key = keyType;
                var value = valueType;
                if (keyType === 'other') {
                    key = keyValue;
                }
                if (valueType === 'other') {
                    value = valueValue;
                }
                if (key !== '') {
                    node.headers[key] = value;
                }
            });
        },
        oneditresize: function(size) {
            var rows = $("#dialog-form>div:not(.node-input-headers-container-row)");
            var height = size.height;
            for (var i=0; i<rows.length; i++) {
                height -= $(rows[i]).outerHeight(true);
            }
            var editorRow = $("#dialog-form>div.node-input-headers-container-row");
            height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));

            $("#node-input-headers-container").editableList('height',height);
        }
    });
})();
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="http in">
    <p>创建用于创建Web服务的HTTP端点。</p>
    <h3>输出</h3>
    <dl class="message-properties">
        <dt>payload</dt>
        <dd>GET请求包含任何查询字符串参数的对象。或者包含HTTP请求正文。</dd>
        <dt>req<span class="property-type">object</span></dt>
        <dd>HTTP请求对象。该对象包含有关请求信息的多个属性。
            <ul>
             <li><code>body</code> - 传入请求的正文。格式将取决于请求。</li>
             <li><code>headers</code> - 包含HTTP请求标头的对象。</li>
             <li><code>query</code> - 包含任何查询字符串参数的对象。</li>
             <li><code>params</code> - 包含任何路由参数的对象。</li>
             <li><code>cookies</code> - 包含请求cookie的对象。</li>
             <li><code>files</code> - 如果节点启用了文件上传，则为包含了上传的文件的对象。</li>
            </ul>
        </dd>
        <dt>res<span class="property-type">object</span></dt>
        <dd>HTTP响应对象。此属性不应直接使用；<code>HTTP Response</code>节点记录了如何响应请求。该属性必须保留在传递给响应节点的消息上。</dd>
    </dl>
    <h3>详细</h3>
    <p>节点将在配置的路径上监听特定类型的请求。路径可以完全指定，例如<code>/user</code>，或包括可以接受任何值的命名参数，例如<code>/user/:name</code>。 使用命名参数时，可以在<code>msg.req.params</code>下访问其在请求中的实际值。</p>
    <p>对于包含正文的请求（例如POST或PUT），请求的内容将作为<code>msg.payload</code>提供。</p>
    <p>如果可以确定请求的内容类型，则正文将被解析为任何适当的类型。例如，<code>application/json</code>将被解析为其JavaScript对象表示。</p>
    <p><b>注意：</b>该节点不发送对请求的任何响应。该流必须包含HTTP响应节点才能完成请求。</p>
</script>

<script type="text/x-red" data-help-name="http response">
    <p>将响应发送回从HTTP输入节点接收的请求。</p>

    <h3>输入</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">string</span></dt>
        <dd>响应的正文。</dd>
        <dt class="optional">statusCode <span class="property-type">数值</span></dt>
        <dd>如果设置，则用作响应状态代码。默认值：200。</dd>
        <dt class="optional">headers <span class="property-type">object</span></dt>
        <dd>如果设置，则提供HTTP头以包含在响应中。</dd>
        <dt class="optional">cookies <span class="property-type">object</span></dt>
        <dd>如果设置，则可用于设置或删除cookie。</dd>
    </dl>
    <h3>详细</h3>
    <p>还可以在节点本身内设置<code>statusCode</code>和<code>headers</code>。如果在节点内设置了属性，则不能被相应的message属性覆盖。</p>
    <h4>Cookie处理</h4>
    <p><code>cookies</code>属性必须是名称/值对的对象。该值可以是使用默认选项设置cookie值的字符串，也可以是options对象。<p>
    <p>下面的示例设置两个cookie-一个名为<code>name</code>的值为<code>nick</code>，另一个名为<code>session</code>的值为<code>1234</code>，并且有效期设置为15分钟。</p>
    <pre>
msg.cookies = {
    name: 'nick',
    session: {
        value: '1234',
        maxAge: 900000
    }
}</pre>
    <p>有效选项包括：</p>
    <ul>
    <li><code>domain</code> - (字符串) Cookie的域名</li>
    <li><code>expires</code> - (日期) GMT标准时间的到期日。如果未指定或设置为0，则创建会话cookie</li>
    <li><code>maxAge</code> - (字符串) 相对于当前时间的到期日期（以毫秒为单位）</li>
    <li><code>path</code> - (字符串) Cookie的路径。默认为/</li>
    <li><code>value</code> - (字符串) Cookie使用的值</li>
    </ul>
    <p>要删除Cookie，请将其<code>value</code>设置为<code>null</code>。</p>

</script>

</div><div><!-- --- [red-module:node-red/httprequest] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="http request">
    <div class="form-row">
        <label for="node-input-method"><i class="fa fa-tasks"></i> <span data-i18n="httpin.label.method"></span></label>
        <select type="text" id="node-input-method" style="width:70%;">
        <option value="GET">GET</option>
        <option value="POST">POST</option>
        <option value="PUT">PUT</option>
        <option value="DELETE">DELETE</option>
        <option value="HEAD">HEAD</option>
        <option value="use" data-i18n="httpin.setby"></option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-url"><i class="fa fa-globe"></i> <span data-i18n="httpin.label.url"></span></label>
        <input id="node-input-url" type="text" placeholder="http://">
    </div>

    <div class="form-row node-input-paytoqs-row">
        <label for="node-input-paytoqs"><span data-i18n="common.label.payload"></span></label>
        <select id="node-input-paytoqs" style="width: 70%;">
            <option value="ignore" data-i18n="httpin.label.paytoqs.ignore"></option>
            <option value="query" data-i18n="httpin.label.paytoqs.query"></option>
            <option value="body" data-i18n="httpin.label.paytoqs.body"></option>
        </select>
    </div>

    <div class="form-row">
        <input type="checkbox" id="node-input-usetls" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-usetls" style="width: auto" data-i18n="httpin.use-tls"></label>
        <div id="node-row-tls" class="hide">
            <label style="width: auto; margin-left: 20px; margin-right: 10px;" for="node-input-tls"><span data-i18n="httpin.tls-config"></span></label><input type="text" style="width: 300px" id="node-input-tls">
        </div>
    </div>

    <div class="form-row">
        <input type="checkbox" id="node-input-useAuth" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-useAuth" style="width: 70%;"><span data-i18n="httpin.basicauth"></span></label>
        <div style="margin-left: 20px" class="node-input-useAuth-row hide">
            <div class="form-row">
                <label for="node-input-authType-select"><i class="fa fa-user-secret "></i> <span data-i18n="httpin.label.authType"></span></label>
                <select type="text" id="node-input-authType-select" style="width:70%;">
                    <option value="basic"  data-i18n="httpin.basic"></option>
                    <option value="digest" data-i18n="httpin.digest"></option>
                    <option value="bearer" data-i18n="httpin.bearer"></option>
                </select>
                <input type="hidden" id="node-input-authType">
            </div>
            <div class="form-row node-input-basic-row">
                <label for="node-input-user"><i class="fa fa-user"></i> <span data-i18n="common.label.username"></span></label>
                <input type="text" id="node-input-user">
            </div>
            <div class="form-row">
                <label for="node-input-password"> <i class="fa fa-lock"></i> <span data-i18n="common.label.password" id="node-span-password"></span><span data-i18n="httpin.label.bearerToken" id="node-span-token" style="display:none"></span></label>
                <input type="password" id="node-input-password">
            </div>
        </div>
    </div>

    <div class="form-row">
        <input type="checkbox" id="node-input-persist" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-persist" style="width: auto" data-i18n="httpin.persist"></label>
    </div>

    <div class="form-row">
        <input type="checkbox" id="node-input-useProxy" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-useProxy" style="width: auto;"><span data-i18n="httpin.use-proxy"></span></label>
        <div id="node-input-useProxy-row" class="hide">
            <label style="width: auto; margin-left: 20px; margin-right: 10px;" for="node-input-proxy"><i class="fa fa-globe"></i> <span data-i18n="httpin.proxy-config"></span></label><input type="text" style="width: 270px" id="node-input-proxy">
        </div>
    </div>

    <div class="form-row">
        <input type="checkbox" id="node-input-senderr" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-senderr" style="width: auto" data-i18n="httpin.senderr"></label>
    </div>


    <div class="form-row">
        <label for="node-input-ret"><i class="fa fa-arrow-left"></i> <span data-i18n="httpin.label.return"></span></label>
        <select type="text" id="node-input-ret" style="width:70%;">
        <option value="txt" data-i18n="httpin.utf8"></option>
        <option value="bin" data-i18n="httpin.binary"></option>
        <option value="obj" data-i18n="httpin.json"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips" id="tip-json" hidden><span data-i18n="httpin.tip.req"></span></div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('http request',{
        category: 'network',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""},
            method:{value:"GET"},
            ret: {value:"txt"},
            paytoqs: {value: false},
            url:{value:"",validate:function(v) { return (v.trim().length === 0) || (v.indexOf("://") === -1) || (v.trim().indexOf("http") === 0)} },
            tls: {type:"tls-config",required: false},
            persist: {value:false},
            proxy: {type:"http proxy",required: false},
            authType: {value: ""},
            senderr: {value: false}
        },
        credentials: {
            user: {type:"text"},
            password: {type: "password"}
        },
        inputs:1,
        outputs:1,
        outputLabels: function(i) {
            return ({
                txt: this._("httpin.label.utf8String"),
                bin: this._("httpin.label.binaryBuffer"),
                obj: this._("httpin.label.jsonObject")
            }[this.ret]);
        },
        icon: "white-globe.svg",
        label: function() {
            return this.name||this._("httpin.httpreq");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $("#node-input-useAuth").on("change", function() {
                if ($(this).is(":checked")) {
                    $(".node-input-useAuth-row").show();
                    // Nodes (< version 0.20.x) with credentials but without authentication type, need type 'basic'
                    if (!$('#node-input-authType').val()) {
                        $("#node-input-authType-select").val('basic').trigger("change");
                    }
                } else {
                    $(".node-input-useAuth-row").hide();
                    $('#node-input-authType').val('');
                    $('#node-input-user').val('');
                    $('#node-input-password').val('');
                }
            });
            $("#node-input-authType-select").on("change", function() {
                var val = $(this).val();
                $("#node-input-authType").val(val);
                if (val === "basic" || val === "digest") {
                    $(".node-input-basic-row").show();
                    $('#node-span-password').show();
                    $('#node-span-token').hide();
                } else if (val === "bearer") {
                    $(".node-input-basic-row").hide();
                    $('#node-span-password').hide();
                    $('#node-span-token').show();
                    $('#node-input-user').val('');
                }
            });
            $("#node-input-method").on("change", function() {
                if ($(this).val() == "GET") {
                    $(".node-input-paytoqs-row").show();
                } else {
                    $(".node-input-paytoqs-row").hide();
                }
            });
            if (this.paytoqs === true || this.paytoqs == "query") {
                $("#node-input-paytoqs").val("query");
            } else if (this.paytoqs === "body") {
                $("#node-input-paytoqs").val("body");
            } else {
                $("#node-input-paytoqs").val("ignore");
            }
            if (this.authType) {
                $('#node-input-useAuth').prop('checked', true);
                $("#node-input-authType-select").val(this.authType);
                $("#node-input-authType-select").change();
            } else {
                $('#node-input-useAuth').prop('checked', false);
            }
            $("#node-input-useAuth").change();

            function updateTLSOptions() {
                if ($("#node-input-usetls").is(':checked')) {
                    $("#node-row-tls").show();
                } else {
                    $("#node-row-tls").hide();
                }
            }
            if (this.tls) {
                $('#node-input-usetls').prop('checked', true);
            } else {
                $('#node-input-usetls').prop('checked', false);
            }
            updateTLSOptions();
            $("#node-input-usetls").on("click",function() {
                updateTLSOptions();
            });

            function updateProxyOptions() {
                if ($("#node-input-useProxy").is(":checked")) {
                    $("#node-input-useProxy-row").show();
                } else {
                    $("#node-input-useProxy-row").hide();
                }
            }
            if (this.proxy) {
                $("#node-input-useProxy").prop("checked", true);
            } else {
                $("#node-input-useProxy").prop("checked", false);
            }
            updateProxyOptions();
            $("#node-input-useProxy").on("click", function() {
                updateProxyOptions();
            });

            $("#node-input-ret").on("change", function() {
                if ($("#node-input-ret").val() === "obj") {
                    $("#tip-json").show();
                } else {
                    $("#tip-json").hide();
                }
            });
        },
        oneditsave: function() {
            if (!$("#node-input-usetls").is(':checked')) {
                $("#node-input-tls").val("_ADD_");
            }
            if (!$("#node-input-useProxy").is(":checked")) {
                $("#node-input-proxy").val("_ADD_");
            }
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="http request">
    <p>发送HTTP请求并返回响应。</p>

    <h3>输入</h3>
    <dl class="message-properties">
        <dt class="optional">url <span class="property-type">字符串</span></dt>
        <dd>如果未在节点中配置，则此可选属性设置请求的url。</dd>
        <dt class="optional">method <span class="property-type">字符串</span></dt>
        <dd>如果未在节点中配置，则此可选属性设置请求的HTTP方法。必须是<code>GET</code>,<code>PUT</code>,<code>POST</code>,<code>PATCH</code>或<code>DELETE</code>之一。</dd>
        <dt class="optional">headers <span class="property-type">object</span></dt>
        <dd>设置请求的HTTP头。</dd>
        <dt class="optional">cookies <span class="property-type">object</span></dt>
        <dd>如果设置，则可用于发送带有请求的cookie。</dd>
        <dt class="optional">payload</dt>
        <dd>发送为请求的正文。</dd>
        <dt class="optional">rejectUnauthorized</dt>
        <dd>如果设置为<code>false</code>，则允许对使用自签名证书的https站点进行请求。</dd>
        <dt class="optional">followRedirects</dt>
        <dd>如果设置为<code>false</code>，则阻止遵循重定向（HTTP 301）。默认情况下为<code>true</code></dd>
        <dt class="optional">requestTimeout</dt>
        <dd>如果设置为正数毫秒，将覆盖全局设置的<code>httpRequestTimeout</code>参数。</dd>
    </dl>
    <h3>输出</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">字符串 | object | buffer</span></dt>
        <dd>响应的正文。可以将节点配置为以字符串形式返回主体，尝试将其解析为JSON字符串或将其保留为二进制buffer。</dd>
        <dt>statusCode <span class="property-type">数值</span></dt>
        <dd>响应的状态码，如果请求无法完成，则返回错误码。</dd>
        <dt>headers <span class="property-type">object</span></dt>
        <dd>包含响应头的对象。</dd>
        <dt>responseUrl <span class="property-type">字符串</span></dt>
        <dd>如果在处理请求时发生任何重定向，则此属性为最终重定向的URL。否则则为原始请求的URL。</dd>
        <dt>responseCookies <span class="property-type">object</span></dt>
        <dd>如果响应包含cookie，则此属性是每个cookie的‘名称/值’键值对的对象。</dd>
        <dt>redirectList <span class="property-type">数组</span></dt>
        <dd>如果请求被重定向了一次或多次，则累积的信息将被添加到此属性。“location”是下一个重定向目标。cookie是从重定向源返回的cookie。</dd>
    </dl>
    <h3>详细</h3>
    <p>在节点内配置后，URL属性可以包含<a href="http://mustache.github.io/mustache.5.html" target="_blank">mustache样式</a>标签。 这些标签允许使用传入消息的值来构造url。例如，如果url设置为<code>example.com/{{{{topic}}}</code>，它将自动插入<code>msg.topic</code>的值。使用{{{...}}}可以防止mustache转义/ &等字符。</p>
    <p>节点可以选择自动将<code>msg.payload</code>编码为GET请求的查询字符串参数，在这种情况下，<code>msg.payload</code>必须是一个对象。</p>
    <p><b>注意：</b>如果使用了代理，则应设置<code>http_proxy=...</code>环境变量并重新启动Node-RED，或使用“代理配置”。如果设置了代理配置，则配置优先于环境变量。</p>
    <h4>使用多个HTTP请求节点</h4>
    <p>为了在一个流程中多次使用该节点，必须要注意<code>msg.headers</code>属性的处理。通常在第一个节点在响应头中设置此属性，而不期望在下一个节点的请求头中使用此属性。如果节点之间的<code>msg.headers</code>属性保持不变，则第二个节点将忽略它。要设置自定义标题，首先应删除<code>msg.headers</code>或将其重置为空对象：<code>{}</code>。</p>
    <h4>Cookie处理</h4>
    <p>传递给节点的<code>cookies</code>属性必须是‘名称/值’键值对的对象。该值可以是设置cookie值的字符串，也可以是具有单个<code>value</code>属性的对象。</p>
    <p>请求返回的所有cookie都将在<code>responseCookies</code>属性下传递回去。</p>
    <h4>内容类型处理</h4>
    <p>如果<code>msg.payload</code>是一个对象，则节点将自动将请求的内容类型设置为<code>application/json</code>并对其进行编码。</p>
    <p>要将请求编码为表单数据，应将<code>msg.headers[“content-type”]</code>设置为<code>application/x-www-form-urlencoded</code>。</p>
    <h4>文件上传</h4>
    <p>要执行文件上传，应将<code>msg.headers["content-type"]</code>设置为<code>multipart/form-data</code>和<code>msg.payload</code>传递给节点的必须是具有以下结构的对象：</p>
    <pre><code>{
    "KEY": {
        "value": FILE_CONTENTS,
        "options": {
            "filename": "FILENAME"
        }
    }
}</code></pre>
    <p><code>KEY</code>,<code>FILE_CONTENTS</code>和<code>FILENAME</code>的值应设置为适当的值。</p>
    
</script>

</div><div><!-- --- [red-module:node-red/websocket] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<!-- WebSocket Input Node -->
<script type="text/html" data-template-name="websocket in">
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-dot-circle-o"></i> <span data-i18n="websocket.label.type"></span></label>
        <select id="node-input-mode">
            <option value="server" data-i18n="websocket.listenon"></option>
            <option value="client" data-i18n="websocket.connectto"></option>
        </select>
    </div>
    <div class="form-row" id="websocket-server-row">
        <label for="node-input-server"><i class="fa fa-bookmark"></i> <span data-i18n="websocket.label.path"></span></label>
        <input type="text" id="node-input-server">
    </div>
    <div class="form-row" id="websocket-client-row">
        <label for="node-input-client"><i class="fa fa-bookmark"></i> <span data-i18n="websocket.label.url"></span></label>
        <input type="text" id="node-input-client">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/javascript">

(function() {

    function ws_oneditprepare() {
        $("#websocket-client-row").hide();
        $("#node-input-mode").on("change", function() {
            if ( $("#node-input-mode").val() === 'client') {
                $("#websocket-server-row").hide();
                $("#websocket-client-row").show();
            }
            else {
                $("#websocket-server-row").show();
                $("#websocket-client-row").hide();
            }
        });

        if (this.client) {
            $("#node-input-mode").val('client').change();
        }
        else {
            $("#node-input-mode").val('server').change();
        }
    }

    function ws_oneditsave() {
        if ($("#node-input-mode").val() === 'client') {
            $("#node-input-server").append('<option value="">Dummy</option>');
            $("#node-input-server").val('');
        }
        else {
            $("#node-input-client").append('<option value="">Dummy</option>');
            $("#node-input-client").val('');
        }
    }

    function ws_label() {
        var nodeid = (this.client)?this.client:this.server;
        var wsNode = RED.nodes.node(nodeid);
        return this.name||(wsNode?"[ws] "+wsNode.label():"websocket");
    }

    function ws_validateserver() {
        if ($("#node-input-mode").val() === 'client' || (this.client && !this.server)) {
            return true;
        }
        else {
            return RED.nodes.node(this.server) != null;
        }
    }

    function ws_validateclient() {
        if ($("#node-input-mode").val() === 'client' || (this.client && !this.server)) {
            return RED.nodes.node(this.client) != null;
        }
        else {
            return true;
        }
    }

    RED.nodes.registerType('websocket in',{
        category: 'network',
        defaults: {
            name: {value:""},
            server: {type:"websocket-listener", validate: ws_validateserver},
            client: {type:"websocket-client", validate: ws_validateclient}
        },
        color:"rgb(215, 215, 160)",
        inputs:0,
        outputs:1,
        icon: "white-globe.svg",
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        label: ws_label,
        oneditsave: ws_oneditsave,
        oneditprepare: ws_oneditprepare
    });

    RED.nodes.registerType('websocket out',{
        category: 'network',
        defaults: {
            name: {value:""},
            server: {type:"websocket-listener", validate: ws_validateserver},
            client: {type:"websocket-client", validate: ws_validateclient}
        },
        color:"rgb(215, 215, 160)",
        inputs:1,
        outputs:0,
        icon: "white-globe.svg",
        align: "right",
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        label: ws_label,
        oneditsave: ws_oneditsave,
        oneditprepare: ws_oneditprepare
    });

    RED.nodes.registerType('websocket-listener',{
        category: 'config',
        defaults: {
            path: {value:"",required:true,validate:RED.validators.regex(/^((?!\/debug\/ws).)*$/)},
            wholemsg: {value:"false"}
        },
        inputs:0,
        outputs:0,
        label: function() {
            var root = RED.settings.httpNodeRoot;
            if (root.slice(-1) != "/") {
                root = root+"/";
            }
            if (this.path) {
                if (this.path.charAt(0) == "/") {
                    root += this.path.slice(1);
                } else {
                    root += this.path;
                }
            }
            return root;
        },
        oneditprepare: function() {
            var root = RED.settings.httpNodeRoot;
            if (root.slice(-1) == "/") {
                root = root.slice(0,-1);
            }
            if (root === "") {
                $("#node-config-ws-tip").hide();
            } else {
                $("#node-config-ws-path").html(RED._("node-red:websocket.tip.path2", { path: root }));
                $("#node-config-ws-tip").show();
            }
        }
    });

    RED.nodes.registerType('websocket-client',{
        category: 'config',
        defaults: {
            path: {value:"",required:true,validate:RED.validators.regex(/^((?!\/debug\/ws).)*$/)},
            tls: {type:"tls-config",required: false},
            wholemsg: {value:"false"},
            hb: {value: "", validate: RED.validators.number(/*blank allowed*/true) }
        },
        inputs:0,
        outputs:0,
        label: function() {
            return this.path;
        },
        oneditprepare: function() {
            $("#node-config-input-path").on("change keyup paste",function() {
                $(".node-config-row-tls").toggle(/^wss:/i.test($(this).val()))
            });
            $("#node-config-input-path").change();

            var heartbeatActive = (this.hb && this.hb != "0");
            $("#node-config-input-hb-cb").prop("checked",heartbeatActive);
            $("#node-config-input-hb-cb").on("change", function(evt) {
                $("#node-config-input-hb-row").toggle(this.checked);
            })
            $("#node-config-input-hb-cb").trigger("change");
            if (!heartbeatActive) {
                $("#node-config-input-hb").val("");
            }
        },
        oneditsave: function() {
            if (!/^wss:/i.test($("#node-config-input-path").val())) {
                $("#node-config-input-tls").val("_ADD_");
            }
            if (!$("#node-config-input-hb-cb").prop("checked")) {
                $("#node-config-input-hb").val("0");
            }
        }
    });

})();
</script>

<!-- WebSocket out Node -->
<script type="text/html" data-template-name="websocket out">
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-dot-circle-o"></i> <span data-i18n="websocket.label.type"></span></label>
        <select id="node-input-mode">
            <option value="server" data-i18n="websocket.listenon"></option>
            <option value="client" data-i18n="websocket.connectto"></option>
        </select>
    </div>
    <div class="form-row" id="websocket-server-row">
        <label for="node-input-server"><i class="fa fa-bookmark"></i> <span data-i18n="websocket.label.path"></span></label>
        <input type="text" id="node-input-server">
    </div>
    <div class="form-row" id="websocket-client-row">
        <label for="node-input-client"><i class="fa fa-bookmark"></i> <span data-i18n="websocket.label.url"></span></label>
        <input type="text" id="node-input-client">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<!-- WebSocket Server configuration node -->
<script type="text/html" data-template-name="websocket-listener">
    <div class="form-row">
        <label for="node-config-input-path"><i class="fa fa-bookmark"></i> <span data-i18n="websocket.label.path"></span></label>
        <input id="node-config-input-path" type="text" placeholder="/ws/example">
    </div>
    <div class="form-row">
        <label for="node-config-input-wholemsg" data-i18n="websocket.sendrec"></label>
        <select type="text" id="node-config-input-wholemsg" style="width: 70%;">
            <option value="false" data-i18n="websocket.payload"></option>
            <option value="true" data-i18n="websocket.message"></option>
        </select>
    </div>
    <div class="form-tips">
        <span data-i18n="[html]websocket.tip.path1"></span>
        <p id="node-config-ws-tip"><span id="node-config-ws-path"></span></p>
    </div>
</script>

<!-- WebSocket Client configuration node -->
<script type="text/html" data-template-name="websocket-client">
    <div class="form-row">
        <label for="node-config-input-path"><i class="fa fa-bookmark"></i> <span data-i18n="websocket.label.url"></span></label>
        <input id="node-config-input-path" type="text" placeholder="ws://example.com/ws">
    </div>
    <div class="form-row node-config-row-tls hide">
        <label for="node-config-input-tls" data-i18n="httpin.tls-config"></label>
        <input type="text" id="node-config-input-tls">
    </div>

    <div class="form-row">
        <label for="node-config-input-wholemsg" data-i18n="websocket.sendrec"></label>
        <select type="text" id="node-config-input-wholemsg" style="width: 70%;">
            <option value="false" data-i18n="websocket.payload"></option>
            <option value="true" data-i18n="websocket.message"></option>
        </select>
    </div>
    <div class="form-row" style="display: flex; align-items: center; min-height: 34px">
        <label for="node-config-input-hb-cb" data-i18n="websocket.sendheartbeat"></label>
        <input type="checkbox" style="margin: 0 8px; width:auto" id="node-config-input-hb-cb">
        <span id="node-config-input-hb-row" class="hide" >
            <input type="text" style="width: 70px; margin-right: 3px" id="node-config-input-hb">
            <span  data-i18n="inject.seconds"></span>
        </span>
    </div>
    <div class="form-tips">
        <p><span data-i18n="[html]websocket.tip.url1"></span></p>
        <span data-i18n="[html]websocket.tip.url2"></span>
    </div>
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="websocket in">
    <p>WebSocket输入节点。</p>
    <p>默认情况下，从WebSocket接收的数据将位于<code>msg.payload</code>中。可以将套接字配置为期望格式正确的JSON字符串，在这种情况下，它将解析JSON并将结果对象作为整个消息发送。</p>
</script>

<script type="text/x-red" data-help-name="websocket out">
    <p>WebSocket输出节点。</p>
    <p>默认情况下，<code>msg.payload</code>将通过WebSocket发送。可以将套接字配置为将整个<code>msg</code>对象编码为JSON字符串，然后通过WebSocket发送。</p>
    <p>如果到达此节点的消息是从WebSocket In节点开始的，则该消息将发送回触发流程的客户端。否则，消息将广播给所有连接的客户端。</p>
    <p>如果要广播从“WebSocket输入”节点开始的消息，则可以应该删除流中的<code>msg._session</code>属性。</p>
</script>

<script type="text/x-red" data-help-name="websocket-listener">
   <p>此配置节点使用指定的路径创建WebSocket服务器端点。</p>
</script>

<script type="text/x-red" data-help-name="websocket-client">
   <p>此配置节点将WebSocket客户端连接到指定的URL。</p>
</script>

</div><div><!-- --- [red-module:node-red/tcpin] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="tcp in">
    <div class="form-row">
        <label for="node-input-server"><i class="fa fa-dot-circle-o"></i> <span data-i18n="tcpin.label.type"></span></label>
        <select id="node-input-server" style="width:120px; margin-right:5px;">
            <option value="server" data-i18n="tcpin.type.listen"></option>
            <option value="client" data-i18n="tcpin.type.connect"></option>
        </select>
        <span data-i18n="tcpin.label.port"></span> <input type="text" id="node-input-port" style="width:65px">
    </div>
    <div class="form-row hidden" id="node-input-host-row" style="padding-left: 110px;">
        <span data-i18n="tcpin.label.host"></span> <input type="text" id="node-input-host" placeholder="localhost" style="width: 60%;">
    </div>

    <div class="form-row">
        <label><i class="fa fa-sign-out"></i> <span data-i18n="tcpin.label.output"></span></label>
        <select id="node-input-datamode" style="width:110px;">
            <option value="stream" data-i18n="tcpin.output.stream"></option>
            <option value="single" data-i18n="tcpin.output.single"></option>
        </select>
        <select id="node-input-datatype" style="width:140px;">
            <option value="buffer" data-i18n="tcpin.output.buffer"></option>
            <option value="utf8" data-i18n="tcpin.output.string"></option>
            <option value="base64" data-i18n="tcpin.output.base64"></option>
        </select>
        <span data-i18n="tcpin.label.payload"></span>
    </div>

    <div id="node-row-newline" class="form-row hidden" style="padding-left:110px;">
        <span data-i18n="tcpin.label.delimited"></span> <input type="text" id="node-input-newline" style="width:110px;">
    </div>

    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
        <input type="text" id="node-input-topic" data-i18n="[placeholder]common.label.topic">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('tcp in',{
        category: 'network',
        color:"Silver",
        defaults: {
            name: {value:""},
            server: {value:"server",required:true},
            host: {value:"",validate:function(v) { return (this.server == "server")||v.length > 0;} },
            port: {value:"",required:true,validate:RED.validators.number()},
            datamode:{value:"stream"},
            datatype:{value:"buffer"},
            newline:{value:""},
            topic: {value:""},
            base64: {/*deprecated*/ value:false,required:true}
        },
        inputs:0,
        outputs:1,
        icon: "bridge-dash.svg",
        label: function() {
            return this.name || "tcp:"+(this.host?this.host+":":"")+this.port;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var updateOptions = function() {
                var sockettype = $("#node-input-server").val();
                if (sockettype == "client") {
                    $("#node-input-host-row").show();
                } else {
                    $("#node-input-host-row").hide();
                }
                var datamode = $("#node-input-datamode").val();
                var datatype = $("#node-input-datatype").val();
                if (datamode == "stream") {
                    if (datatype == "utf8") {
                        $("#node-row-newline").show();
                    } else {
                        $("#node-row-newline").hide();
                    }
                } else {
                    $("#node-row-newline").hide();
                }
            };
            updateOptions();
            $("#node-input-server").change(updateOptions);
            $("#node-input-datatype").change(updateOptions);
            $("#node-input-datamode").change(updateOptions);
        }
    });
</script>


<script type="text/html" data-template-name="tcp out">
    <div class="form-row">
        <label for="node-input-beserver"><i class="fa fa-dot-circle-o"></i> <span data-i18n="tcpin.label.type"></span></label>
        <select id="node-input-beserver" style="width:150px; margin-right:5px;">
            <option value="server" data-i18n="tcpin.type.listen"></option>
            <option value="client" data-i18n="tcpin.type.connect"></option>
            <option value="reply" data-i18n="tcpin.type.reply"></option>
        </select>
        <span id="node-input-port-row"><span data-i18n="tcpin.label.port"></span> <input type="text" id="node-input-port" style="width: 65px"></span>
    </div>

    <div class="form-row hidden" id="node-input-host-row" style="padding-left: 110px;">
        <span data-i18n="tcpin.label.host"></span> <input type="text" id="node-input-host" style="width: 60%;">
    </div>

    <div class="form-row hidden" id="node-input-end-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-end" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-end" style="width: 70%;"><span data-i18n="tcpin.label.close-connection"></span></label>
    </div>

    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-base64" placeholder="base64" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-base64" style="width: 70%;"><span data-i18n="tcpin.label.decode-base64"></span></label>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('tcp out',{
        category: 'network',
        color:"Silver",
        defaults: {
            host: {value:"",validate:function(v) { return (this.beserver != "client")||v.length > 0;} },
            port: {value:"",validate:function(v) { return (this.beserver == "reply")||RED.validators.number()(v); } },
            beserver: {value:"client",required:true},
            base64: {value:false,required:true},
            end: {value:false,required:true},
            name: {value:""}
        },
        inputs:1,
        outputs:0,
        icon: "bridge-dash.svg",
        align: "right",
        label: function() {
            return this.name || "tcp:"+(this.host?this.host+":":"")+this.port;
        },
        labelStyle: function() {
            return (this.name)?"node_label_italic":"";
        },
        oneditprepare: function() {
            var updateOptions = function() {
                var sockettype = $("#node-input-beserver").val();
                if (sockettype == "reply") {
                    $("#node-input-port-row").hide();
                    $("#node-input-host-row").hide();
                    $("#node-input-end-row").hide();
                } else if (sockettype == "client"){
                    $("#node-input-port-row").show();
                    $("#node-input-host-row").show();
                    $("#node-input-end-row").show();
                } else {
                    $("#node-input-port-row").show();
                    $("#node-input-host-row").hide();
                    $("#node-input-end-row").show();
                }
            };
            updateOptions();
            $("#node-input-beserver").change(updateOptions);
        }
    });
</script>


<script type="text/html" data-template-name="tcp request">
    <div class="form-row">
        <label for="node-input-server"><i class="fa fa-globe"></i> <span data-i18n="tcpin.label.server"></span></label>
        <input type="text" id="node-input-server" placeholder="ip.address" style="width:45%">
        <span data-i18n="tcpin.label.port"></span>
        <input type="text" id="node-input-port" style="width:60px">
    </div>
    <div class="form-row">
        <label for="node-input-out"><i class="fa fa-sign-out"></i> <span data-i18n="tcpin.label.return"></span></label>
        <select type="text" id="node-input-ret" style="width:54%;">
            <option value="buffer" data-i18n="tcpin.output.buffer"></option>
            <option value="string" data-i18n="tcpin.output.string"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-out"> </label>
        <select type="text" id="node-input-out" style="width:54%;">
            <option value="time" data-i18n="tcpin.return.timeout"></option>
            <option value="char" data-i18n="tcpin.return.character"></option>
            <option value="count" data-i18n="tcpin.return.number"></option>
            <option value="sit" data-i18n="tcpin.return.never"></option>
            <option value="immed" data-i18n="tcpin.return.immed"></option>
        </select>
        <input type="text" id="node-input-splitc" style="width:50px;">
        <span id="node-units"></span>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('tcp request',{
        category: 'network',
        color:"Silver",
        defaults: {
            server: {value:""},
            port: {value:"",validate:RED.validators.regex(/^(\d*|)$/)},
            out: {value:"time",required:true},
            ret: {value:"buffer"},
            splitc: {value:"0",required:true},
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "bridge-dash.svg",
        label: function() {
            return this.name || "tcp:"+(this.server?this.server+":":"")+this.port;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var previous = null;
            if ($("#node-input-ret").val() == undefined) {
                $("#node-input-ret").val("buffer");
                this.ret = "buffer";
            }
            $("#node-input-out").on('focus', function () { previous = this.value; }).on("change", function() {
                $("#node-input-splitc").show();
                if (previous === null) { previous = $("#node-input-out").val(); }
                if ($("#node-input-out").val() == "char") {
                    if (previous != "char") { $("#node-input-splitc").val("\\n"); }
                    $("#node-units").text("");
                }
                else if ($("#node-input-out").val() == "time") {
                    if (previous != "time") { $("#node-input-splitc").val("0"); }
                    $("#node-units").text(RED._("node-red:tcpin.label.ms"));
                }
                else if ($("#node-input-out").val() == "immed") {
                    if (previous != "immed") { $("#node-input-splitc").val(" "); }
                    $("#node-units").text("");
                    $("#node-input-splitc").hide();
                }
                else if ($("#node-input-out").val() == "count") {
                    if (previous != "count") { $("#node-input-splitc").val("12"); }
                    $("#node-units").text(RED._("node-red:tcpin.label.chars"));
                }
                else {
                    if (previous != "sit") { $("#node-input-splitc").val(" "); }
                    $("#node-units").text("");
                    $("#node-input-splitc").hide();
                }
            });
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="tcp in">
    <p>提供TCP输入选择。可以连接到远程TCP端口，或接受传入连接。</p>
    <p><b>注意：</b>在某些系统上，您可能需要root或管理员权限来访问低于1024的端口。</p>
</script>

<script type="text/x-red" data-help-name="tcp out">
    <p>提供TCP输出的选择。可以连接到远程TCP端口，接受传入的连接，或回复从TCP In节点收到的消息。</p>
    <p>仅发送<code>msg.payload</code>。</p>
    <p>如果<code>msg.payload</code>是包含二进制数据的Base64编码的字符串，则Base64解码选项将导致它在发送之前先转换回二进制。</p>
    <p>如果不存在<code>msg._session</code>，则有效负载将发送到<b>所有</b>连接的客户端。</p>
    <p><b>注意：</b>在某些系统上，您可能需要root或管理员权限来访问低于1024的端口。</p>
</script>

<script type="text/x-red" data-help-name="tcp request">
    <p>一个简单的TCP请求节点。将<code>msg.payload</code>发送到服务器tcp端口，并期望得到响应。</p>
    <p>连接到服务器，发送“请求”并接收“响应”。 可以从固定数量的字符，与指定字符匹配的字符中选择操作，从第一个答复到达起等待指定的时间，等待数据到达，发送数据并立即取消连接而无需等待答复等操作中进行选择。</p>
    <p>响应将在<code>msg.payload</code>中作为buffer输出，因此您可能需要对它进行<code>.toString()</code>操作。</p>
    <p>如果将tcp主机或端口留空，则必须使用<code>msg.host</code>和<code>msg.port</code>属性进行设置。</p>
</script>

</div><div><!-- --- [red-module:node-red/udp] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!--  The Input Node  -->
<script type="text/html" data-template-name="udp in">
    <div class="form-row">
        <label for="node-input-port"><i class="fa fa-sign-in"></i> <span data-i18n="udp.label.listen"></span></label>
        <select id="node-input-multicast" style='width:70%'>
          <option value="false" data-i18n="udp.udpmsgs"></option>
          <option value="true" data-i18n="udp.mcmsgs"></option>
        </select>
    </div>
    <div class="form-row node-input-group">
        <label for="node-input-group"><i class="fa fa-list"></i> <span data-i18n="udp.label.group"></span></label>
        <input type="text" id="node-input-group" placeholder="225.0.18.83">
    </div>
    <div class="form-row node-input-iface">
        <label for="node-input-iface"><i class="fa fa-random"></i> <span data-i18n="udp.label.interface"></span></label>
        <input type="text" id="node-input-iface" data-i18n="[placeholder]udp.placeholder.interfaceprompt">
    </div>
    <div class="form-row">
        <label for="node-input-port"><i class="fa fa-sign-in"></i> <span data-i18n="udp.label.onport"></span></label>
        <input type="text" id="node-input-port" style="width:80px">
        &nbsp;&nbsp;<span data-i18n="udp.label.using"></span> <select id="node-input-ipv" style="width:80px">
          <option value="udp4">ipv4</option>
          <option value="udp6">ipv6</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-datatype"><i class="fa fa-sign-out"></i> <span data-i18n="udp.label.output"></span></label>
        <select id="node-input-datatype" style="width:70%;">
            <option value="buffer" data-i18n="udp.output.buffer"></option>
            <option value="utf8" data-i18n="udp.output.string"></option>
            <option value="base64" data-i18n="udp.output.base64"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips"><span data-i18n="udp.tip.in"></span></div>
    <div class="form-tips" id="udpporttip"><span data-i18n="[html]udp.tip.port"></span></div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('udp in',{
        category: 'network',
        color:"Silver",
        defaults: {
            name: {value:""},
            iface: {value:""},
            port: {value:"",required:true,validate:RED.validators.number()},
            ipv: {value:"udp4"},
            multicast: {value:"false"},
            group: {value:"",validate:function(v) { return (this.multicast !== "true")||v.length > 0;} },
            datatype: {value:"buffer",required:true}
        },
        inputs:0,
        outputs:1,
        icon: "bridge-dash.svg",
        label: function() {
            if (this.multicast=="false") {
                return this.name||"udp "+this.port;
            }
            else {
                return this.name||"udp "+(this.group+":"+this.port);
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $("#node-input-multicast").on("change", function() {
                var id = $("#node-input-multicast").val();
                if (id == "false") {
                    $(".node-input-group").hide();
                    $(".node-input-iface").hide();
                }
                else {
                    $(".node-input-group").show();
                    $(".node-input-iface").show();
                }
            });
            $("#node-input-multicast").change();

            var porttip = this._("udp.tip.port");
            var alreadyused = this._("udp.errors.alreadyused");
            var portsInUse = {};
            $.getJSON('udp-ports/'+this.id,function(data) {
                portsInUse = data || {};
                $('#udpporttip').html(porttip + data);
            });
            $("#node-input-port").on("change", function() {
                var portnew = $("#node-input-port").val();
                if (portsInUse.hasOwnProperty($("#node-input-port").val())) {
                    RED.notify(alreadyused+" "+$("#node-input-port").val(),"warn");
                }
            });
        }
    });
</script>


<!--  The Output Node  -->
<script type="text/html" data-template-name="udp out">
    <div class="form-row">
        <label for="node-input-port"><i class="fa fa-envelope"></i> <span data-i18n="udp.label.send"></span></label>
        <select id="node-input-multicast" style="width:40%">
          <option value="false" data-i18n="udp.udpmsg"></option>
          <option value="broad" data-i18n="udp.bcmsg"></option>
          <option value="multi" data-i18n="udp.mcmsg"></option>
        </select>
        <span data-i18n="udp.label.toport"></span> <input type="text" id="node-input-port" style="width:70px">
    </div>
    <div class="form-row node-input-addr">
        <label for="node-input-addr" id="node-input-addr-label"><i class="fa fa-list"></i> <span data-i18n="udp.label.address"></span></label>
        <input type="text" id="node-input-addr" data-i18n="[placeholder]udp.placeholder.address" style="width:50%;">
        <select id="node-input-ipv" style="width:70px">
          <option value="udp4">ipv4</option>
          <option value="udp6">ipv6</option>
        </select>
    </div>
    <div class="form-row node-input-iface">
        <label for="node-input-iface"><i class="fa fa-random"></i> <span data-i18n="udp.label.interface"></span></label>
        <input type="text" id="node-input-iface" data-i18n="[placeholder]udp.placeholder.interface">
    </div>
    <div class="form-row">
        <label for="node-input-outport-type">&nbsp;</label>
        <select id="node-input-outport-type">
          <option id="node-input-outport-type-random" value="random" data-i18n="udp.bind.random"></option>
          <option value="fixed" data-i18n="udp.bind.local"></option>
        </select>
        <input type="text" id="node-input-outport" style="width:70px;">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-base64" style="display:inline-block; width:auto; vertical-align:top;">
        <label for="node-input-base64" style="width:70%;"><span data-i18n="udp.label.decode-base64"></span></label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips"><span data-i18n="[html]udp.tip.out"></span></div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('udp out',{
        category: 'network',
        color:"Silver",
        defaults: {
            name: {value:""},
            addr: {value:""},
            iface: {value:""},
            port: {value:""},
            ipv: {value:"udp4"},
            outport: {value:""},
            base64: {value:false,required:true},
            multicast: {value:"false"}
        },
        inputs:1,
        outputs:0,
        icon: "bridge-dash.svg",
        align: "right",
        label: function() {
            return this.name||"udp "+(this.addr+":"+this.port);
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var addresslabel = this._("udp.label.address");
            var addressph = this._("udp.placeholder.address");
            var grouplabel = this._("udp.label.group");
            var bindrandom = this._("udp.bind.random");
            var bindtarget = this._("udp.bind.target");

            var type = this.outport===""?"random":"fixed";
            $("#node-input-outport-type").val(type);

            $("#node-input-outport-type").on("change", function() {
                var type = $(this).val();
                if (type == "random") {
                    $("#node-input-outport").val("").hide();
                } else {
                    $("#node-input-outport").show();
                }
            });
            $("#node-input-outport-type").change();

            $("#node-input-multicast").on("change", function() {
                var id = $("#node-input-multicast").val();
                if (id === "multi") {
                    $(".node-input-iface").show();
                    $("#node-input-addr-label").html('<i class="fa fa-list"></i> ' + grouplabel);
                    $("#node-input-addr")[0].placeholder = '225.0.18.83';
                }
                else if (id === "broad") {
                    $(".node-input-iface").hide();
                    $("#node-input-addr-label").html('<i class="fa fa-list"></i> ' + addresslabel);
                    $("#node-input-addr")[0].placeholder = '255.255.255.255';
                }
                else {
                    $(".node-input-iface").hide();
                    $("#node-input-addr-label").html('<i class="fa fa-list"></i> ' + addresslabel);
                    $("#node-input-addr")[0].placeholder = addressph;
                }
                var type = $(this).val();
                if (type == "false") {
                    $("#node-input-outport-type-random").html(bindrandom);
                } else {
                    $("#node-input-outport-type-random").html(bindtarget);
                }
            });
            $("#node-input-multicast").change();
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="udp in">
    <p>UDP输入节点。在<code>msg.payload</code>中生成Buffer，字符串或Base64编码的字符串。支持组播。</p>
    <p>在<code>msg.ip</code>和<code>msg.port</code>中设置接收到的消息的IP地址和端口。</p>
    <p><b>注意：</b>在某些系统上，您可能需要root或管理员权限才能使用低于1024的端口或广播。</p>
</script>

<script type="text/x-red" data-help-name="udp out">
    <p>该节点将<code>msg.payload</code>发送到指定的UDP主机和端口。支持组播。</p>
    <p>您也可以使用<code>msg.ip</code>和<code>msg.port</code>设置目标值，但是静态配置的值具有优先权。</p>
    <p>如果选择广播，则将地址设置为本地广播IP地址。或者也可以尝试使用全局广播地址255.255.255.255。</p>
    <p><b>注意：</b>在某些系统上，您可能需要root或管理员权限才能使用低于1024的端口或广播。</p>
</script>

</div><div><!-- --- [red-module:node-red/CSV] --- -->

<script type="text/html" data-template-name="csv">
    <div class="form-row">
        <label for="node-input-temp"><i class="fa fa-list"></i> <span data-i18n="csv.label.columns"></span></label>
        <input type="text" id="node-input-temp" data-i18n="[placeholder]csv.placeholder.columns">
    </div>
    <div class="form-row">
        <label for="node-input-select-sep"><i class="fa fa-text-width"></i> <span data-i18n="csv.label.separator"></span></label>
            <select style="width:150px" id="node-input-select-sep">
                <option value="," data-i18n="csv.separator.comma"></option>
                <option value="\t" data-i18n="csv.separator.tab"></option>
                <option value=" " data-i18n="csv.separator.space"></option>
                <option value=";" data-i18n="csv.separator.semicolon"></option>
                <option value=":" data-i18n="csv.separator.colon"></option>
                <option value="#" data-i18n="csv.separator.hashtag"></option>
                <option value="" data-i18n="csv.separator.other"></option>
           </select>
           <input style="width:40px;" type="text" id="node-input-sep" pattern=".">
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <hr align="middle"/>
    <div class="form-row">
        <label style="width:100%;"><span data-i18n="csv.label.c2o"></span></label>
    </div>
    <div class="form-row" style="padding-left:20px;">
        <label><i class="fa fa-sign-in"></i> <span data-i18n="csv.label.input"></span></label>
        <span data-i18n="csv.label.skip-s"></span>&nbsp;<input type="text" id="node-input-skip" style="width:40px; height:25px;"/>&nbsp;<span data-i18n="csv.label.skip-e"></span><br/>
        <label>&nbsp;</label>
        <input style="width:20px; vertical-align:baseline; margin-right:5px;" type="checkbox" id="node-input-hdrin"><label style="width:auto; margin-top:7px;" for="node-input-hdrin"><span data-i18n="csv.label.firstrow"></span></label><br/>
        <label>&nbsp;</label>
        <input style="width:20px; vertical-align:baseline; margin-right:5px;" type="checkbox" id="node-input-strings"><label style="width:auto; margin-top:7px;" for="node-input-strings"><span data-i18n="csv.label.usestrings"></span></label><br/>
        <label>&nbsp;</label>
        <input style="width:20px; vertical-align:baseline; margin-right:5px;" type="checkbox" id="node-input-include_empty_strings"><label style="width:auto; margin-top:7px;" for="node-input-include_empty_strings"><span data-i18n="csv.label.include_empty_strings"></span></label><br/>
        <label>&nbsp;</label>
        <input style="width:20px; vertical-align:baseline; margin-right:5px;" type="checkbox" id="node-input-include_null_values"><label style="width:auto; margin-top:7px;" for="node-input-include_null_values"><span data-i18n="csv.label.include_null_values"></span></label><br/>
    </div>
    <div class="form-row" style="padding-left:20px;">
        <label><i class="fa fa-sign-out"></i> <span data-i18n="csv.label.output"></span></label>
        <select type="text" id="node-input-multi" style="width:250px;">
            <option value="one" data-i18n="csv.output.row"></option>
            <option value="mult" data-i18n="csv.output.array"></option>
        </select>
    </div>
    <div class="form-row" style="margin-top:20px">
        <label style="width:100%;"><span data-i18n="csv.label.o2c"></span></label>
    </div>
    <div class="form-row" style="padding-left:20px;">
        <label><i class="fa fa-sign-out"></i> <span data-i18n="csv.label.output"></span></label>
        <!-- <input style="width:20px; vertical-align:top; margin-right:5px;" type="checkbox" id="node-input-hdrout"><label style="width:auto;" for="node-input-hdrout"><span data-i18n="csv.label.includerow"></span></span> -->
        <select style="width:60%" id="node-input-hdrout">
            <option value="none" data-i18n="csv.hdrout.none"></option>
            <option value="all" data-i18n="csv.hdrout.all"></option>
            <option value="once" data-i18n="csv.hdrout.once"></option>
        </select>
    </div>
    <div class="form-row" style="padding-left:20px;">
        <label></label>
        <label style="width:auto; margin-right:10px;" for="node-input-ret"><span data-i18n="csv.label.newline"></span></label>
        <select style="width:150px;" id="node-input-ret">
            <option value='\n' data-i18n="csv.newline.linux"></option>
            <option value='\r' data-i18n="csv.newline.mac"></option>
            <option value='\r\n' data-i18n="csv.newline.windows"></option>
       </select>
    </div>
</script>


<script type="text/javascript">
    RED.nodes.registerType('csv',{
        category: 'parser',
        color:"#DEBD5C",
        defaults: {
            name: {value:""},
            sep: {value:',',required:true,validate:RED.validators.regex(/^.{1,2}$/)},
            //quo: {value:'"',required:true},
            hdrin: {value:""},
            hdrout: {value:"none"},
            multi: {value:"one",required:true},
            ret: {value:'\\n'},
            temp: {value:""},
            skip: {value:"0"},
            strings: {value:true},
            include_empty_strings: {value:""},
            include_null_values: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "parser-csv.svg",
        label: function() {
            return this.name||"csv";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.hdrout === false) { this.hdrout = "none"; $("#node-input-hdrout").val("none"); }
            if (this.hdrout === true) { this.hdrout = "all"; $("#node-input-hdrout").val("all");}
            if (this.strings === undefined) { this.strings = true; $("#node-input-strings").prop('checked', true); }
            if (this.skip === undefined) { this.skip = 0; $("#node-input-skip").val("0");}
            $("#node-input-skip").spinner({ min:0 });
            if (this.sep == "," || this.sep == "\\t" || this.sep == ";" || this.sep == ":" || this.sep == " " || this.sep == "#") {
                $("#node-input-select-sep").val(this.sep);
                $("#node-input-sep").hide();
            } else {
                $("#node-input-select-sep").val("");
                $("#node-input-sep").val(this.sep);
                $("#node-input-sep").show();
            }
            $("#node-input-select-sep").on("change", function() {
                var v = $("#node-input-select-sep").val();
                $("#node-input-sep").val(v);
                if (v == "") {
                    $("#node-input-sep").val("");
                    $("#node-input-sep").show().focus();
                } else {
                    $("#node-input-sep").hide();
                }
            });
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="csv">
    <p>在CSV格式的字符串及其JavaScript对象表示形式之间进行相互转换。</p>
    <h3>输入</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object | 数组 | 字符串</span></dt>
        <dd>JavaScript对象，数组或CSV字符串。</dd>
    </dl>
    <h3>输出</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object | 数组 | 字符串</span></dt>
        <dd>
        <ul>
            <li>如果输入是字符串，它将尝试将其解析为CSV，并为每行创建键/值对的JavaScript对象。然后该节点将为每行发送一条消息，或者发送一条包含对象数组的消息。</li>
            <li>如果输入是JavaScript对象，它将尝试构建CSV字符串。</li>
            <li>如果输入是简单值的数组，则将构建单行CSV字符串。</li>
            <li>如果输入是数组数组或对象数组，则会创建多行CSV字符串。</li>
        </ul>
        </dd>
    </dl>
    <h3>详细</h3>
    <p>列模板可以包含列名称的有序列表。将CSV转换为对象时，列名将用作属性名称。或者也可以从CSV的第一行中获取列名称。</p>
    <p>转换为CSV时，列模板用于标识从对象中提取的属性以及提取的顺序。</p>
    <p>如果输入是数组，则列模板仅用于有选择地生成一行列标题。</p>
    <p>只要正确设置<code>parts</code>属性，该节点就可以接受多部分输入。</p>
    <p>如果输出多个消息，则将设置其<code>parts</code>属性并形成完整的消息序列。</p>
    <p><b>注意：</b>列模板必须用逗号分隔，即使数据中已有了其他分隔符。</p>
</script>

</div><div><!-- --- [red-module:node-red/HTML] --- -->

<script type="text/html" data-template-name="html">
    <div class="form-row">
        <label for="node-input-property"><i class="fa fa-ellipsis-h"></i> <span data-i18n="common.label.property"></span></label>
        <input type="text" id="node-input-property" style="width:70%">
    </div>
    <div class="form-row">
        <label for="node-input-tag"><i class="fa fa-filter"></i> <span data-i18n="html.label.select"></span></label>
        <input type="text" id="node-input-tag" placeholder="h1">
    </div>
    <div class="form-row">
        <label for="node-input-ret"><i class="fa fa-sign-out"></i> <span data-i18n="html.label.output"></span></label>
        <select id="node-input-ret" style="width:70%">
            <option value="html" data-i18n="html.output.html"></option>
            <option value="text" data-i18n="html.output.text"></option>
            <option value="attr" data-i18n="html.output.attr"></option>
            <!-- <option value="val">return the value from a form element</option> -->
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-as">&nbsp;</label>
        <select id="node-input-as" style="width:70%">
            <option value="single" data-i18n="html.format.single"></option>
            <option value="multi" data-i18n="html.format.multi"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-outproperty">&nbsp;</label>
        <span data-i18n="html.label.in" style="padding-left:8px; padding-right:2px; vertical-align:-1px;"></span> <input type="text" id="node-input-outproperty" style="width:64%">
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" style="width:70%" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('html',{
        category: 'parser',
        color:"#DEBD5C",
        defaults: {
            name: {value:""},
            property: {value:"payload"},
            outproperty: {value:"payload"},
            tag: {value:""},
            ret: {value:"html"},
            as: {value:"single"}
        },
        inputs:1,
        outputs:1,
        icon: "parser-html.svg",
        label: function() {
            return this.name||this.tag||"html";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $("#node-input-property").typedInput({default:'msg',types:['msg']});
            $("#node-input-outproperty").typedInput({default:'msg',types:['msg']});
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="html">
    <p>使用CSS选择器从<code>msg.payload</code>中保存的html文档中提取元素。</p>
    <h3>输入</h3>
    <dl class="message-properties">
    <dt>payload <span class="property-type">字符串</span></dt>
    <dd>从中提取元素的html字符串。</dd>
    <dt class="optional">select <span class="property-type">字符串</span></dt>
    <dd>如果未在编辑面板中配置，则可以将选择器设置为msg的属性。</dd>
</dl>
    <h3>Output</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">数组 | 字符串</span></dt>
        <dd>结果可以是有效载荷中包含匹配元素的数组的单个消息；也可以是多条消息，每条消息都包含匹配元素。发送多条消息时，需要为消息设置<code>parts</code>。</dd>
    </dl>
    <h3>详细</h3>
    <p>该节点支持CSS和jQuery选择器的组合。查看<a href="https://github.com/fb55/CSSselect#user-content-supported-selectors" target="_blank">css-select documentation</a> 来获得更多信息。</p>
</script>

</div><div><!-- --- [red-module:node-red/JSON] --- -->

<script type="text/html" data-template-name="json">
    <div class="form-row">
        <label for="node-input-action"><i class="fa fa-dot-circle-o"></i> <span data-i18n="json.label.action"></span></label>
        <select style="width:70%" id="node-input-action">
            <option value=""    data-i18n="json.label.actions.toggle"></option>
            <option value="str" data-i18n="json.label.actions.str"></option>
            <option value="obj" data-i18n="json.label.actions.obj"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-property"><i class="fa fa-ellipsis-h"></i> <span data-i18n="json.label.property"></span></label>
        <input type="text" id="node-input-property" style="width:70%;"/>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <hr align="middle"/>
    <div class="form-row node-json-to-json-options">
        <label style="width:100%;"><span data-i18n="json.label.o2j"></span></label>
    </div>
    <div class="form-row node-json-to-json-options" style="padding-left: 20px;">
        <input style="width:20px; vertical-align:top; margin-right: 5px;" type="checkbox" id="node-input-pretty"><label style="width: auto;" for="node-input-pretty" data-i18n="json.label.pretty"></span>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('json',{
        category: 'parser',
        color:"#DEBD5C",
        defaults: {
            name: {value:""},
            property: {value:"payload",required:true},
            action: {value:""},
            pretty: {value:false}
        },
        inputs:1,
        outputs:1,
        icon: "parser-json.svg",
        label: function() {
            return this.name||"json";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.property === undefined) {
                $("#node-input-property").val("payload");
            }
            $("#node-input-property").typedInput({default:'msg',types:['msg']});
            $("#node-input-action").on("change", function() {
                if (this.value === "" || this.value === "str") {
                    $(".node-json-to-json-options").show();
                } else {
                    $(".node-json-to-json-options").hide();
                }
            });
            $("#node-input-action").change();
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="json">
    <p>在JSON字符串及其JavaScript对象表示形式之间相互转换。</p>
    <h3>输入</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object | 字符串</span></dt>
        <dd>JavaScript对象或JSON字符串。</dd>
        <dt>schema<span class="property-type">object</span></dt>
        <dd>可选的JSON Schema对象用于验证有效负载。在将<code>msg</code>发送到下一个节点之前，将删除该属性。</dd>
    </dl>
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object | 字符串</span></dt>
        <dd>
            <ul>
                <li>如果输入是JSON字符串，它将尝试将其解析为JavaScript对象。</li>
                <li>如果输入是JavaScript对象，它将创建一个JSON字符串。并可以选择对此JSON字符串进行整形。</li>
            </ul>
        </dd>
        <dt>schemaError<span class="property-type">数组</span></dt>
        <dd>如果JSON模式验证失败，则catch节点将具有包含错误数组的<code>schemaError</code>属性。</dd>
    </dl>
    <h3>详细</h3>
    <p>默认的转换目标是<code>msg.payload</code>，但是也可以转换消息的其它属性。</p>
    <p>您可以将其设置为仅执行特定的转换，而不是自动选择双向转换。例如，即使对<code>HTTP In</code>节点的请求未正确设置‘content-type’，也可以使用它来确保JSON节点的转换结果是JavaScript对象</p>
    <p>如果指定了转换为JSON字符串，则不会对收到的字符串进行进一步的检查。也就是说，即使指定了格式化选项，它也不会检查字符串是否正确为JSON或对JSON执行整形。</p>
    <p>有关JSON模式的更多详细信息，请查阅<a href="http://json-schema.org/latest/json-schema-validation.html">规范</a>.</p>
</script>

</div><div><!-- --- [red-module:node-red/XML] --- -->

<script type="text/html" data-template-name="xml">
    <div class="form-row">
        <label for="node-input-property"><i class="fa fa-ellipsis-h"></i> <span data-i18n="common.label.property"></span></label>
        <input type="text" id="node-input-property" style="width:70%;"/>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <hr align="middle"/>
    <div class="form-row">
        <label style="width:100%;"><span data-i18n="xml.label.x2o"></span></label>
    </div>
    <div class="form-row" style="padding-left: 20px;">
        <label style="width:250px;" for="node-input-attr" data-i18n="xml.label.represent"></label> <input type="text" id="node-input-attr" style="text-align:center; width:40px" placeholder="$">
    </div>
    <div class="form-row" style="padding-left: 20px;">
        <label style="width:250px;" for="node-input-chr" data-i18n="xml.label.prefix"></label> <input type="text" id="node-input-chr" style="text-align:center; width:40px" placeholder="_">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('xml',{
        category: 'parser',
        color:"#DEBD5C",
        defaults: {
            name: {value:""},
            property: {value:"payload",required:true},
            attr: {value:""},
            chr: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "parser-xml.svg",
        label: function() {
            return this.name||"xml";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.property === undefined) {
                $("#node-input-property").val("payload");
            }
            $("#node-input-property").typedInput({default:'msg',types:['msg']});
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="xml">
    <p>在XML字符串及其JavaScript对象表示形式之间进行相互转换。</p>
    <h3>输入</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object | 字符串</span></dt>
        <dd>JavaScript对象或XML字符串。</dd>
        <dt class="optional">options <span class="property-type">object</span></dt>
        <dd>可以将选项传递给内部使用的XML转换库。请参见<a href="https://github.com/Leonidas-from-XIV/node-xml2js/blob/master/README.md#options" target="_blank"> xml2js文档</a> 来获取更多信息。</dd>
    </dl>
    <h3>输出</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object | 字符串</span></dt>
        <dd>
            <ul>
                <li>如果输入是字符串，它将尝试将其解析为XML并创建一个JavaScript对象。</li>
                <li>如果输入是JavaScript对象，它将尝试构建XML字符串。</li>
            </ul>
        </dd>
    </dl>
    <h3>详细</h3>
    <p>在XML和对象之间进行转换时，默认情况下XML属性会添加到名为<code>$</code>的属性中。将文本内容添加到名为<code>_</code>的属性中。这些属性名称可以在节点设置中更改。</p>
    <p>例如，将如下所示转换以下XML：</p>
    <pre>&lt;p class="tag"&gt;Hello World&lt;/p&gt;</pre>
    <pre>{
  "p": {
    "$": {
      "class": "tag"
    },
    "_": "Hello World"
  }
}</pre>
</script>

</div><div><!-- --- [red-module:node-red/YAML] --- -->

<script type="text/html" data-template-name="yaml">
    <div class="form-row">
        <label for="node-input-property"><i class="fa fa-ellipsis-h"></i> <span data-i18n="common.label.property"></span></label>
        <input type="text" id="node-input-property" style="width:70%;"/>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('yaml',{
        category: 'parser',
        color:"#DEBD5C",
        defaults: {
            property: {value:"payload",required:true},
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "parser-yaml.svg",
        label: function() {
            return this.name||"yaml";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.property === undefined) {
                $("#node-input-property").val("payload");
            }
            $("#node-input-property").typedInput({default:'msg',types:['msg']});
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="yaml">
    <p>在YAML格式的字符串及其JavaScript对象表示形式之间相互转换。</p>
    <h3>输入</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object | 字符串</span></dt>
        <dd>JavaScript对象或YAML字符串。</dd>
    </dl>
    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object | 字符串</span></dt>
        <dd>
            <ul>
                <li>如果输入是YAML字符串，它将尝试将其解析为JavaScript对象。</li>
                <li>如果输入是JavaScript对象，它将创建一个YAML字符串。</li>
            </ul>
        </dd>
    </dl>
</script>

</div><div><!-- --- [red-module:node-red/split] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="split">
    <div class="form-row"><span data-i18n="[html]split.intro"></span></div>
    <div class="form-row"><span data-i18n="[html]split.strBuff"></span></div>
    <div class="form-row">
        <label for="node-input-splt" style="padding-left:10px; margin-right:-10px;" data-i18n="split.splitUsing"></label>
        <input type="text" id="node-input-splt" style="width:70%">
        <input type="hidden" id="node-input-spltType">
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-input-stream" style="margin-left:10px; vertical-align:top; width:auto;">
        <label for="node-input-stream" style="width:auto;" data-i18n="split.stream"></label>
    </div>
    <div class="form-row"><span data-i18n="[html]split.array"></span></div>
    <div class="form-row">
        <label for="node-input-arraySplt" style="padding-left:10px; margin-right:-10px;" data-i18n="split.splitUsing"></label>
        <input type="text" id="node-input-arraySplt" style="width:70%">
        <input type="hidden" id="node-input-arraySpltType">
    </div>
    <div class="form-row"><span data-i18n="[html]split.object"></span></div>
    <div class="form-row" style="padding-left: 10px"><span data-i18n="[html]split.objectSend"></span></div>
    <div class="form-row">
        <input type="checkbox" id="node-input-addname-cb" style="margin-left:10px; vertical-align:baseline; width:auto;">
        <label for="node-input-addname-cb" style="width:auto;" data-i18n="split.addname"></label>
        <input type="text" id="node-input-addname" style="width:70%">
    </div>
    <hr/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('split',{
        category: 'sequence',
        color:"#E2D96E",
        defaults: {
            name: {value:""},
            splt: {value:"\\n"},
            spltType: {value:"str"},
            arraySplt: {value:1},
            arraySpltType: {value:"len"},
            stream: {value:false},
            addname: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "split.svg",
        label: function() {
            return this.name||this._("split.split");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $("#node-input-splt").typedInput({
                default: 'str',
                typeField: $("#node-input-spltType"),
                types:[
                    'str',
                    'bin',
                    {value:"len", label:RED._("node-red:split.splitLength"),validate:/^\d+$/}
                ]
            });
            if (this.arraySplt === undefined) {
                $("#node-input-arraySplt").val(1);
            }
            $("#node-input-arraySplt").typedInput({
                default: 'len',
                typeField: $("#node-input-arraySpltType"),
                types:[
                    {value:"len", label:RED._("node-red:split.splitLength"),validate:/^\d+$/}
                ]
            });
            $("#node-input-addname").typedInput({
                typeField: $("#node-input-fnameType"),
                types:['msg']
            });

            $("#node-input-addname-cb").on("change", function() {
                $("#node-input-addname").prop('disabled',!this.checked);
            })
            if (this.addname === "") {
                $("#node-input-addname-cb").prop('checked',false);
                $("#node-input-addname").val('topic');
            } else {
                $("#node-input-addname-cb").prop('checked',true);
            }
            $("#node-input-addname-cb").change();
        },
        oneditsave: function() {
            if (!$("#node-input-addname-cb").prop('checked')) {
                $("#node-input-addname").val('');
            }
        }
    });
</script>


<script type="text/html" data-template-name="join">
    <div class="form-row">
        <label data-i18n="join.mode.mode"></label>
        <select id="node-input-mode" style="width:200px;">
            <option value="auto" data-i18n="join.mode.auto"></option>
            <option value="custom" data-i18n="join.mode.custom"></option>
            <option value="reduce" data-i18n="join.mode.reduce"></option>
        </select>
    </div>
    <div class="node-row-custom">
        <div class="form-row node-row-property">
            <label data-i18n="join.combine"> </label>
            <input type="text" id="node-input-property" style="width:70%;">
            <input type="hidden" id="node-input-propertyType">
        </div>
        <div class="form-row">
            <label data-i18n="join.create"></label>
            <select id="node-input-build" style="width:70%;">
                <option value="string" data-i18n="join.type.string"></option>
                <option value="buffer" data-i18n="join.type.buffer"></option>
                <option value="array" data-i18n="join.type.array"></option>
                <option value="object" data-i18n="join.type.object"></option>
                <option value="merged" data-i18n="join.type.merged"></option>
            </select>
        </div>
        <div class="form-row node-row-key">
            <label style="vertical-align:top; margin-top:7px; width:auto; margin-right: 5px;" data-i18n="join.using"></label>
            <div style="display:inline-block">
                <input type="text" id="node-input-key" style="width:220px;"> <span data-i18n="join.key"></span>
            </div>
        </div>
        <div class="form-row node-row-joiner">
            <label for="node-input-joiner" data-i18n="join.joinedUsing"></label>
            <input type="text" id="node-input-joiner" style="width:70%">
            <input type="hidden" id="node-input-joinerType">
        </div>
        <div class="form-row node-row-trigger" id="trigger-row">
            <label style="width:auto;" data-i18n="join.send"></label>
            <ul>
                <li>
                    <label style="width:280px;" for="node-input-count" data-i18n="join.afterCount"></label> <input id="node-input-count" data-i18n="[placeholder]join.count" type="text" style="width:75px;">
                </li>
                <li class="node-row-accumulate" style="list-style-type:none;">
                    <input type="checkbox" id="node-input-accumulate" style="display:inline-block; width:20px; margin-left:20px; vertical-align:top;">  <label style="width: auto" for="node-input-accumulate" data-i18n="join.subsequent"></label>
                </li>
                <li>
                    <label style="width:280px;" for="node-input-timeout" data-i18n="join.afterTimeout"></label> <input id="node-input-timeout" data-i18n="[placeholder]join.seconds" type="text" style="width:75px;">
                </li>
                <li>
                    <label style="width:auto; padding-top:6px;" data-i18n="[html]join.complete"></label>
                </li>
            </ul>
        </div>
    </div>
    <div class="node-row-reduce">
        <div class="form-row">
            <label for="node-input-reduceExp" data-i18n="join.reduce.exp" style="margin-left:10px;"></label>
            <input type="text" id="node-input-reduceExp" data-i18n="[placeholder]join.reduce.exp-value" style="width:65%">
        </div>
        <div class="form-row">
            <label for="node-input-reduceInit" data-i18n="join.reduce.init" style="margin-left:10px;"></label>
            <input type="text" id="node-input-reduceInit" data-i18n="[placeholder]join.reduce.init" style="width:65%">
            <input type="hidden" id="node-input-reduceInitType">
        </div>
        <div class="form-row">
            <label for="node-input-reduceFixup" data-i18n="join.reduce.fixup" style="margin-left:10px;"></label>
            <input type="text" id="node-input-reduceFixup" data-i18n="[placeholder]join.reduce.exp-value" style="width:65%">
        </div>
        <div class="form-row">
            <label>&nbsp;</label>
            <input type="checkbox" id="node-input-reduceRight" style="display:inline-block; width:auto; vertical-align:top; margin-left:10px;">
            <label for="node-input-reduceRight" style="width:70%;" data-i18n="join.reduce.right" style="margin-left:10px;"/>
        </div>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips form-tips-auto hide" data-i18n="[html]join.tip"></div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('join',{
        category: 'sequence',
        color:"#E2D96E",
        defaults: {
            name: {value:""},
            mode: {value:"auto"},
            build: { value:"object"},
            property: { value:"payload", validate:RED.validators.typedInput("propertyType")},
            propertyType: { value:"msg"},
            key: {value:"topic"},
            joiner: { value:"\\n"},
            joinerType: { value:"str"},
            accumulate: { value:"false" },
            timeout: {value:""},
            count: {value:""},
            reduceRight: {value:false},
            reduceExp: {value:undefined},
            reduceInit: {value:undefined},
            reduceInitType: {value:undefined},
            reduceFixup: {value:undefined}
        },
        inputs:1,
        outputs:1,
        icon: "join.svg",
        label: function() {
            return this.name||this._("join.join");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;

            $("#node-input-mode").on("change", function(e) {
                var val = $(this).val();
                $(".node-row-custom").toggle(val==='custom');
                $(".node-row-reduce").toggle(val==='reduce');
                $(".form-tips-auto").toggle((val==='auto') || (val==='reduce'));
                if (val === "auto") {
                    $("#node-input-accumulate").attr('checked', false);
                }
                else if (val === "custom") {
                    $("#node-input-build").change();
                }
                else if (val === "reduce") {
                    var jsonata_or_empty = {
                        value: "jsonata",
                        label: "expression",
                        icon: "red/images/typedInput/expr.png",
                        validate: function(v) {
                            try{
                                if(v !== "") {
                                    jsonata(v);
                                }
                                return true;
                            }
                            catch(e){
                                return false;
                            }
                        },
                        expand:function() {
                            var that = this;
                            RED.editor.editExpression({
                                value: this.value().replace(/\t/g,"\n"),
                                complete: function(v) {
                                    that.value(v.replace(/\n/g,"\t"));
                                }
                            })
                        }
                    };
                    $("#node-input-reduceExp").typedInput({types:[jsonata_or_empty]});
                    $("#node-input-reduceInit").typedInput({
                        default: 'num',
                        types:['flow','global','str','num','bool','json','bin','date','jsonata','env'],
                        typeField: $("#node-input-reduceInitType")
                    });
                    $("#node-input-reduceFixup").typedInput({types:[jsonata_or_empty]});
                }
            });

            $("#node-input-build").on("change", function(e) {
                var val = $(this).val();
                $(".node-row-key").toggle(val==='object');
                $(".node-row-accumulate").toggle(val==='object' || val==='merged');
                $(".node-row-joiner").toggle(val==='string' || val==='buffer');
                $(".node-row-trigger").toggle(val!=='auto');
                if (val === 'string' || val==='buffer') {
                    $("#node-input-property").typedInput('types',['msg']);
                    $("#node-input-joiner").typedInput("show");
                } else {
                    $("#node-input-property").typedInput('types', ['msg', {
                        value: "full",
                        label: RED._("node-red:join.completeMessage"),
                        hasValue: false
                    }]);
                }
            });

            $("#node-input-joiner").typedInput({
                default: 'str',
                typeField: $("#node-input-joinerType"),
                types:['str', 'bin']
            });

            $("#node-input-property").typedInput({
                typeField: $("#node-input-propertyType"),
                types: ['msg', {
                    value: "full",
                    label: RED._("node-red:join.completeMessage"),
                    hasValue: false
                }]
            });

            $("#node-input-key").typedInput({
                types:['msg']
            });

            $("#node-input-build").change();
            $("#node-input-mode").change();
        },
        oneditsave: function() {
            var build = $("#node-input-build").val();
            if (build !== 'object' && build !== 'merged') {
                $("#node-input-accumulate").prop("checked",false);
            }
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="split">
    <p>将一条消息拆分为一系列消息。</p>

    <h3>输入</h3>
    <dl class="message-properties">
        <dt>payload<span class="property-type">object | 字符串 | 数组 | buffer</span></dt>
        <dd>节点的行为由<code>msg.payload</code>的类型决定:
            <ul>
                <li><b>字符串</b>/<b>buffer</b> - 使用指定的字符（默认值：<code>\n</code>），缓冲区序列或固定长度将消息拆分。</li>
                <li><b>数组</b> - 消息被拆分为单个数组元素或固定长度的数组。</li>
                <li><b>object</b> - 将为对象的每个键/值对发送一条消息。</li>
            </ul>
        </dd>
    </dl>
    <h3>输出</h3>
    <dl class="message-properties">
        <dt>parts<span class="property-type">object</span></dt>
        <dd>此属性包含有关如何将消息与原始消息分开的信息。如果传递给<b>join</b>节点，则可以将序列重组为单个消息。该属性具有以下属性：
        <ul>
            <li><code>id</code> - 一组消息的标识符</li>
            <li><code>index</code> - 组中的位置</li>
            <li><code>count</code> - 如果已知组中的邮件总数。请参阅下面的“流媒体模式”</li>
            <li><code>type</code> - 消息的类型-字符串/数组/对象/buffer</li>
            <li><code>ch</code> - 对于字符串或buffer，用于将消息拆分为字符串或字节数组的数据</li>
            <li><code>key</code> - 对于对象，创建此消息的属性的键。可以将节点配置为也将此值复制到另一个消息属性，例如<code>msg.topic</code></li>
            <li><code>len</code> - 使用固定长度值拆分消息时，每段子消息的长度</li>
        </ul>
        </dd>
    </dl>
    <h3>详细</h3>
    <p>在使用<b>join</b>节点将序列重新组合为单个消息之前，推荐使用此节点来轻松地创建跨消息序列，执行通用操作的流。</p>
    <p>它使用<code>msg.parts</code>属性跟踪序列的各个部分。</p>
    <h4>流媒体模式</h4>
    <p>该节点还可以用于重排消息流。例如，发送换行符终止命令的串行设备可能会传递一条消息，并在其末尾带有部分命令。 在“流模式”下，此节点将拆分一条消息并发送每个完整的段。如果末尾有部分片段，则该节点将保留该片段，并将其添加到收到的下一条消息之前。</p>
    <p>在此模式下运行时，该节点将不会设置<code>msg.parts.count</code>属性，因为流中期望的消息数还是未知的。这意味着它不能在自动模式下与<b>join</b>节点一起使用。</p>
</script>

<script type="text/x-red" data-help-name="join">
    <p>将消息序列合并为一条消息.</p>
    <p>共有三种模式：</p>
    <dl>
        <dt>自动模式</dt>
        <dd>与<b>split</b>节点配对时，它将自动将已被拆分的消息进行合并。</dd>
        <dt>手动模式</dt>
        <dd>手动地以各种方式合并消息序列。</dd>
        <dt>列聚合模式</dt>
        <dd>对消息列中的所有消息应用表达式以将其简化为单个消息。</dd>
    </dl>
    <h3>输入</h3>
    <dl class="message-properties">
        <dt class="optional">parts<span class="property-type">object</span></dt>
        <dd>使用自动模式时，所有的消息都应包含此属性。<b>split</b>节点会生成此属性，但也可以手动进行设置。该属性具有以下属性：
        <ul>
            <li><code>id</code> - 消息组的标识符</li>
            <li><code>index</code> - 组中的位置</li>
            <li><code>count</code> - 如果已知组中的邮件总数。请参阅下面的“流媒体模式”</li>
            <li><code>type</code> - 消息的类型-字符串/数组/对象/buffer</li>
            <li><code>ch</code> - 对于字符串或buffer，用于将消息拆分为字符串或字节数组的数据</li>
            <li><code>key</code> - 对于对象，创建此消息的属性的键。可以将节点配置为也将此值复制到另一个消息属性，例如<code>msg.topic</code>/li>
            <li><code>len</code> - 使用固定长度值拆分消息时，每段子消息的长度</li>
        </ul>
        </dd>
        <dt class="optional">complete</dt>
        <dd>如果设置，则节点将以其当前状态发送其输出消息。</dd>
    </dl>
    <h3>详细</h3>

    <h4>自动模式</h4>
    <p>自动模式使用传入消息的<code>parts</code>属性来确定应如何连接序列。这使它可以自动逆转<b>split</b>节点的操作。</p>

    <h4>手动模式</h4>
    <p>设置为以手动模式时，该节点能以各种不同的方法来处理消息：</p>
    <ul>
        <li><b>字符串</b>或<b>缓冲区</b>-通过将每条消息的选定属性与指定的连接字符或缓冲区连接起来。</li>
        <li><b>数组</b> - 通过将每个选定的属性或整个消息添加到输出数组</li>
        <li><b>键/值对象</b> - 通过使用每个消息的属性来确定存储所需值的键。</li>
        <li><b>merged object</b> - 通过将每个消息的属性合并到一个对象下。</li>
    </ul>
    <p>输出消息的其他属性都取自发送结果前的最后一条消息。</p>
    <p>可以用<i>计数</i>来确定应接收多少条消息来进行合并。对于对象输出，可以设置为达到此计数后的每条后续消息都发送一条输出。</p>
    <p>可以用<i>超时</i>来设置发送新消息之前的等待时间。</p>
    <p>如果收到设置了<code>msg.complete</code>属性的消息时发送输出消息并重置消息列数。</p>
    <p>如果收到设置了<code>msg.reset</code>属性的消息，则部分收到的消息将被删除而不发送，同时重置消息列数。</p>

    <h4>列聚合模式</h4>
    <p>选择列聚合模式时，将表达式应用于组成消息列的每条消息，并使用聚合值组成一条消息。</p>

    <dl class="message-properties">
        <dt>初始值</dt>
        <dd>累积值的初始值(<code>$A</code>)。</dd>
        <dt>聚合表达式</dt>
        <dd>序列中的每个消息调用的JSONata表达式。结果将作为累加值传递到表达式的下一个调用。在表达式中，可以使用以下特殊变量：
            <ul>
                <li><code>$A</code>: 累计值 </li>
                <li><code>$I</code>: 消息在序列中的索引</li>
                <li><code>$N</code>: 序列中的消息数</li>
            </ul>
        </dd>
        <dt>最终调整式子</dt>
        <dd>可选的JSONata表达式，在将聚合表达式应用于序列中的所有消息之后应用。在表达式中，可以使用以下特殊变量：
            <ul>
                <li><code>$A</code>: 累计值</li>
                <li><code>$N</code>: 消息在序列中的索引</li>
            </ul>
        </dd>
        <p>默认情况下，按顺序从序列的第一条消息到最后一条消息应用聚合表达式。也可以选择以相反的顺序应用聚合表达式。</p>
    </dl>
    <p><b>例子：</b>给定一系列数字值，以下设置将计算平均值：
        <ul>
            <li><b>聚合表达式</b>: <code>$A+payload</code></li>
            <li><b>初始值</b>: <code>0</code></li>
            <li><b>最终调整式</b>: <code>$A/$N</code></li>
        </ul>
    </p>
    <h4>储存讯息</h4>
    <p>该节点将在内部缓存消息，以便跨序列工作。运行时设置<code>nodeMessageBufferMaxLength</code>可用于设定缓存的消息数。</p>
</script>

</div><div><!-- --- [red-module:node-red/sort] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="sort">

    <div class="form-row">
        <label for="node-input-target"><i class="fa fa-dot-circle-o"></i> <span data-i18n="sort.target"></span></label>
        <input type="text" id="node-input-target" style="width:70%;">
        <input type="hidden" id="node-input-targetType">
    </div>

    <div class="node-row-sort-msg-key">
        <div class="form-row">
            <label for="node-input-msgKey"><i class="fa fa-filter"></i> <span data-i18n="sort.key"></span></label>
            <input type="text" id="node-input-msgKey" style="width:70%;">
            <input type="hidden" id="node-input-msgKeyType">
        </div>
    </div>

    <div class="node-row-sort-seq-key">
        <div class="form-row">
            <label for="node-input-seqKey"><i class="fa fa-filter"></i> <span data-i18n="sort.key"></span></label>
            <input type="text" id="node-input-seqKey" style="width:70%;">
            <input type="hidden" id="node-input-seqKeyType">
        </div>
    </div>

    <div class="form-row">
        <label><i class="fa fa-random"></i>  <span data-i18n="sort.order"></span></label>
        <select id="node-input-order" style="width:200px;">
            <option value="ascending" data-i18n="sort.ascending"></option>
            <option value="descending" data-i18n="sort.descending"></option>
        </select>
    </div>

    <div class="form-row" id="node-as_num">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-as_num" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-as_num" style="width: 70%;" data-i18n="sort.as-number"></label>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('sort',{
        category: 'sequence',
        color:"#E2D96E",
        defaults: {
            name: { value:"" },
            order: { value:"ascending" },
            as_num: { value:false },
            target: { value:"payload" },
            targetType: { value:"msg" },
            msgKey: { value:"payload" },
            msgKeyType: { value:"elem" },
            seqKey: { value:"payload" },
            seqKeyType: { value:"msg" }
        },
        inputs:1,
        outputs:1,
        icon: "sort.svg",
        label: function() {
            return this.name||this._("sort.sort");
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function() {
            var seq = {
                value: "seq",
                label: RED._("node-red:sort.seq"),
                hasValue: false
            };
            var elem = {
                value: "elem",
                label: RED._("node-red:sort.elem"),
                hasValue: false
            };
            $("#node-input-target").typedInput({
                default:'msg',
                typeField: $("#node-input-targetType"),
                types:['msg', seq]
            });
            $("#node-input-msgKey").typedInput({
                default:'elem',
                typeField: $("#node-input-msgKeyType"),
                types:[elem, 'jsonata']
            });
            $("#node-input-seqKey").typedInput({
                default:'msg',
                typeField: $("#node-input-seqKeyType"),
                types:['msg', 'jsonata']
            });
            $("#node-input-target").on("change", function(e) {
                var val = $("#node-input-target").typedInput('type');
                $(".node-row-sort-msg-key").toggle(val === "msg");
                $(".node-row-sort-seq-key").toggle(val === "seq");
            });
            $("#node-input-target").change();
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="sort">
    <p>对消息属性或消息序列进行排序的函数。</p>
    <p>当配置为对消息属性进行排序时，节点将对指定消息属性所指向的数组数据进行排序。</p>
    <p>当配置为对消息序列排序时，它将对消息重新排序。</p>
    <p>排序顺序可以是：</p>
    <ul>
        <li><b>升序</b></li>
        <li><b>降序</b></li>
    </ul>
    <p>对于数字，可以通过复选框指定数字顺序。</p>
    <p>排序键可以是元素值，也可以是JSONata表达式来对属性值进行排序，还可以是message属性或JSONata表达式来对消息序列进行排序。<p>
    <p>在对消息序列进行排序时，排序节点依赖于接收到的消息来设置<code>msg.parts</code>。拆分节点将生成此属性，但也可以手动创建。它具有以下属性：</p>
    <p>
        <ul>
            <li><code>id</code> - 消息组的标识符</li>
            <li><code>index</code> - 组中的位置</li>
            <li><code>count</code> - 群组中的邮件总数</li>
        </ul>
    </p>
    <p><b>注意：</b>在此节点的处理中，消息在内部存储。通过指定要累积的最大消息数，可以防止意外的高内存使用。默认设置是不限制消息数量。
        <ul>
            <li><code>nodeMessageBufferMaxLength</code>属性在<b>settings.js</b>中设置。</li>
        </ul>
    </p>
</script>

</div><div><!-- --- [red-module:node-red/batch] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="batch">
    <div class="form-row">
        <label for="node-input-mode"><span data-i18n="batch.mode.label"></span></label>
        <select type="text" id="node-input-mode" style="width: 300px;">
            <option value="count" data-i18n="batch.mode.num-msgs"></option>
            <option value="interval" data-i18n="batch.mode.interval"></option>
            <option value="concat" data-i18n="batch.mode.concat"></option>
        </select>
    </div>

    <div class="node-row-msg-count">
        <div class="form-row node-row-count">
            <label style="margin-left: 10px; width: 175px;" for="node-input-count" data-i18n="batch.count.label"></label>
            <input type="text" id="node-input-count" style="width: 50px;">
        </div>
    </div>

    <div class="node-row-msg-overlap">
        <div class="form-row node-row-overlap">
            <label style="margin-left: 10px; width: 175px;" for="node-input-overlap" data-i18n="batch.count.overlap"></label>
            <input type="text" id="node-input-overlap" style="width: 50px;">
        </div>
    </div>

    <div class="node-row-msg-interval">
        <div class="form-row node-row-interval">
            <label style="margin-left: 10px; width: 175px;" for="node-input-interval"> <span data-i18n="batch.interval.label"></span></label>
            <input type="text" id="node-input-interval" style="width: 50px;">
            <span data-i18n="batch.interval.seconds"></span>
        </div>
        <div class="form-row">
            <input type="checkbox" id="node-input-allowEmptySequence" style="margin-left:20px; margin-right: 10px; vertical-align:top; width:auto;">
            <label for="node-input-allowEmptySequence" style="width:auto;" data-i18n="batch.interval.empty"></label>
	</div>
    </div>

    <div class="node-row-msg-concat">
        <div class="form-row">
            <label data-i18n="batch.concat.topics-label"></label>
            <div class="form-row node-input-topics-container-row">
                <ol id="node-input-topics-container"></ol>
            </div>
        </div>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>

</script>

<script type="text/javascript">
    RED.nodes.registerType("batch",{
        category: "sequence",
        color:"#E2D96E",
        defaults: {
            name: {value:""},
            mode: {value:"count"},
            count: {value:10,validate:function(v) { return RED.validators.number(v) && (v >= 1); }},
            overlap: {value:0,validate:function(v) { return RED.validators.number(v) && (v >= 0); }},
            interval: {value:10,validate:function(v) { return RED.validators.number(v) && (v >= 1); }},
            allowEmptySequence: {value:false},
            topics: {value:[{topic:""}]}
        },
        inputs:1,
        outputs:1,
        icon: "batch.svg",
        label: function() {
            return this.name||this._("batch.batch");;
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function() {
            var node = this;
            var topic_str = node._("batch.concat.topic");

            function resizeTopics(topic) {
                var newWidth = topic.width();
                topic.find('.red-ui-typedInput')
                     .typedInput("width",newWidth-15);
            }

            $("#node-input-topics-container")
                .css('min-height','150px').css('min-width','430px')
                .editableList({
                    addItem: function(container, i, opt) {
                        if (!opt.hasOwnProperty('topic')) {
                            opt.topic = "";
                        }
                        var row = $('<div/>').appendTo(container);
                        var valueField = $('<input/>',{
                            class:"node-input-topic-value",
                            type:"text",
                            style:"margin-left: 5px;"
                        }).appendTo(row)
                        .typedInput({default:'str', types:['str']});
                        valueField.typedInput('value', opt.topic);
                        valueField.typedInput('type', 'str');
                        valueField.attr('placeholder', topic_str);
                        resizeTopics(container);
                    },
                    resizeItem: resizeTopics,
                    sortable: true,
                    removable: true
                });

            $("#node-input-count").spinner({min:1});
            $("#node-input-overlap").spinner({min:0});
            $("#node-input-interval").spinner({min:1});
            $("#node-input-mode").on("change", function(e) {
                var val = $(this).val();
                $(".node-row-msg-count").toggle(val==="count");
                $(".node-row-msg-overlap").toggle(val==="count");
                $(".node-row-msg-interval").toggle(val==="interval");
                $(".node-row-msg-concat").toggle(val==="concat");
                if (val==="concat") {
                    var topics = node.topics;
                    var container = $("#node-input-topics-container");
                    container.editableList('empty');
                    for (var i = 0; i < topics.length; i++) {
                        var topic = topics[i];
                        container.editableList('addItem', topic);
                    }
                }
            });
        },
        oneditsave: function() {
            var topics = $("#node-input-topics-container").editableList('items');
            var node = this;
            node.topics = [];
            topics.each(function(i) {
                var topicData = $(this).data('data');
                var topic = $(this);
                var vf = topic.find(".node-input-topic-value");
                var value = vf.typedInput('value');
                var type = vf.typedInput('type');
                var r = {topic:value};
                node.topics.push(r);
            });
        },
        oneditresize: function(size) {
            var rows = $("#dialog-form>div:not(.node-input-topics-container-row)");
            var height = size.height;
            for (var i = 0; i < rows.length; i++) {
                height -= $(rows[i]).outerHeight(true);
            }
            var editorRow = $("#dialog-form>div.node-input-topics-container-row");
            height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
            $("#node-input-topics-container").editableList('height',height);
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="batch">
    <p>根据各种规则创建消息序列。</p>
    <h3>详细</h3>
    <p>有三种创建消息序列的模式：</p>
    <dl>
        <dt>讯息数</dt>
        <dd>将消息分组为给定长度的序列。 <b>overlap</b>（重叠）选项指定在一个序列的末尾应重复多少消息。</dd>

        <dt>时间间隔</dt>
        <dd>对在指定时间间隔内到达的邮件进行分组。如果在该时间间隔内没有消息到达，则该节点可以选择发送空消息。</dd>

        <dt>串联序列</dt>
        <dd>通过串联输入序列来创建消息序列。每条消息必须具有<code>msg.topic</code>属性和标识其序列的<code>msg.parts</code>属性。该节点配置有<code>topic</code>值列表，以标识所连接的顺序序列。
        </dd>
    </dl>
    <h4>储存讯息</h4>
    <p>该节点将在内部缓冲消息，以便跨序列工作。运行时设置<code>nodeMessageBufferMaxLength</code>可用于限制节点将缓存多少消息。</p>
</script>

</div><div><!-- --- [red-module:node-red/file] --- -->

<script type="text/html" data-template-name="file">
    <div class="form-row node-input-filename">
         <label for="node-input-filename"><i class="fa fa-file"></i> <span data-i18n="file.label.filename"></span></label>
         <input id="node-input-filename" type="text">
    </div>
    <div class="form-row">
        <label for="node-input-overwriteFile"><i class="fa fa-random"></i> <span data-i18n="file.label.action"></span></label>
        <select type="text" id="node-input-overwriteFile" style="width: 250px;">
            <option value="false" data-i18n="file.action.append"></option>
            <option value="true" data-i18n="file.action.overwrite"></option>
            <option value="delete" data-i18n="file.action.delete"></option>
        </select>
    </div>
    <div class="form-row form-row-file-write-options">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-appendNewline" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-appendNewline" style="width: 70%;"><span data-i18n="file.label.addnewline"></span></label>
    </div>
    <div class="form-row form-row-file-write-options">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-createDir" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-createDir" style="width: 70%;"><span data-i18n="file.label.createdir"></span></label>
    </div>
    <div class="form-row form-row-file-encoding">
        <label for="node-input-encoding"><i class="fa fa-flag"></i> <span data-i18n="file.label.encoding"></span></label>
        <select type="text" id="node-input-encoding" style="width: 250px;">
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips"><span data-i18n="file.tip"></span></div>
</script>

<script type="text/html" data-template-name="file in">
    <div class="form-row">
         <label for="node-input-filename"><i class="fa fa-file"></i> <span data-i18n="file.label.filename"></span></label>
         <input id="node-input-filename" type="text" data-i18n="[placeholder]file.label.filename">
    </div>
    <div class="form-row">
        <label for="node-input-format"><i class="fa fa-sign-out"></i> <span data-i18n="file.label.outputas"></span></label>
        <select id="node-input-format" style="width: 250px;">
            <option value="utf8" data-i18n="file.output.utf8"></option>
            <option value="lines" data-i18n="file.output.lines"></option>
            <option value="" data-i18n="file.output.buffer"></option>
            <option value="stream" data-i18n="file.output.stream"></option>
        </select>
    </div>
    <div class="form-row" id="file-allprops">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-allProps" style="display:inline-block; width:auto; vertical-align:top;">
        <label for="node-input-allProps" style="width: 70%;"><span data-i18n="file.label.allProps"></span></label>
    </div>
    <div class="form-row" id="encoding-spec">
        <label for="node-input-encoding"><i class="fa fa-flag"></i> <span data-i18n="file.label.encoding"></span></label>
        <select type="text" id="node-input-encoding" style="width:250px;">
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips"><span data-i18n="file.tip"></span></div>
</script>

<script type="text/javascript">
(function(){
    var encodings = [
        [ "file.encoding.native",
          "utf8",
          "ucs2",
          "utf-16le",
          "ascii",
          "binary",
          "base64",
          "hex"
        ],
        [ "file.encoding.unicode",
          "utf-16be",
        ],
        [ "file.encoding.japanese",
          "Shift_JIS",
          "Windows-31j",
          "Windows932",
          "EUC-JP"
        ],
        [ "file.encoding.chinese",
          "GB2312",
          "GBK",
          "GB18030",
          "Windows936",
          "EUC-CN"
        ],
        [ "file.encoding.korean",
          "KS_C_5601",
          "Windows949",
          "EUC-KR"
        ],
        [ "file.encoding.taiwan",
          "Big5",
          "Big5-HKSCS",
          "Windows950"
        ],
        [ "file.encoding.windows",
          "cp874",
          "cp1250",
          "cp1251",
          "cp1252",
          "cp1253",
          "cp1254",
          "cp1255",
          "cp1256",
          "cp1257",
          "cp1258"
        ],
        [ "file.encoding.iso",
          "ISO-8859-1",
          "ISO-8859-2",
          "ISO-8859-3",
          "ISO-8859-4",
          "ISO-8859-5",
          "ISO-8859-6",
          "ISO-8859-7",
          "ISO-8859-8",
          "ISO-8859-9",
          "ISO-8859-10",
          "ISO-8859-11",
          "ISO-8859-12",
          "ISO-8859-13",
          "ISO-8859-14",
          "ISO-8859-15",
          "ISO-8859-16"
        ],
        [ "file.encoding.ibm",
          "cp437",
          "cp737",
          "cp775",
          "cp808",
          "cp850",
          "cp852",
          "cp855",
          "cp856",
          "cp857",
          "cp858",
          "cp860",
          "cp861",
          "cp866",
          "cp869",
          "cp922",
          "cp1046",
          "cp1124",
          "cp1125",
          "cp1129",
          "cp1133",
          "cp1161",
          "cp1162",
          "cp1163"
        ],
        [ "file.encoding.mac",
          "maccroatian",
          "maccyrillic",
          "macgreek",
          "maciceland",
          "macroman",
          "macromania",
          "macthai",
          "macturkish",
          "macukraine",
          "maccenteuro",
          "macintosh"
        ],
        [ "file.encoding.koi8",
          "koi8-r",
          "koi8-u",
          "koi8-ru",
          "koi8-t"
        ],
        [ "file.encoding.misc",
          "armscii8",
          "rk1048",
          "tcvn",
          "georgianacademy",
          "georgianps",
          "pt154",
          "viscii",
          "iso646cn",
          "iso646jp",
          "hproman8",
          "tis620"
        ]
    ];

    RED.nodes.registerType('file',{
        category: 'storage',
        defaults: {
            name: {value:""},
            filename: {value:""},
            appendNewline: {value:true},
            createDir: {value:false},
            overwriteFile: {value:"false"},
            encoding: {value:"none"}
        },
        color:"BurlyWood",
        inputs:1,
        outputs:1,
        icon: "file-out.svg",
        label: function() {
            if (this.overwriteFile === "delete") {
                return this.name||this._("file.label.deletelabel",{file:this.filename});
            } else {
                return this.name||this.filename||this._("file.label.write");
            }
        },
        paletteLabel: RED._("node-red:file.label.write"),
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;
            var encSel = $("#node-input-encoding");
            var label = node._("file.encoding.none");
            $("<option/>", {
                value: "none",
                label: label
            }).text(label).appendTo(encSel);
            $("<option/>", {
                value: "setbymsg",
                label: node._("file.encoding.setbymsg")
            }).text(label).appendTo(encSel);
            encodings.forEach(function(item) {
                if(Array.isArray(item)) {
                    var group = $("<optgroup/>", {
                        label: node._(item[0])
                    }).appendTo(encSel);
                    for (var i = 1; i < item.length; i++) {
                        var enc = item[i];
                        $("<option/>", {
                            value: enc,
                            label: enc
                        }).text(enc).appendTo(group);
                    }
                }
                else {
                    $("<option/>", {
                        value: item,
                        label: item
                    }).text(item).appendTo(encSel);
                }
            });
            encSel.val(node.encoding);
            $("#node-input-overwriteFile").on("change",function() {
                if (this.value === "delete") {
                    $(".form-row-file-write-options").hide();
                    $(".form-row-file-encoding").hide();
                } else {
                    $(".form-row-file-write-options").show();
                    $(".form-row-file-encoding").show();
                }
            });
        }
    });

    RED.nodes.registerType('file in',{
        category: 'storage',
        defaults: {
            name: {value:""},
            filename: {value:""},
            format: {value:"utf8"},
            chunk: {value:false},
            sendError: {value: false},
            encoding: {value: "none"},
            allProps: {value: false}
        },
        color:"BurlyWood",
        inputs:1,
        outputs:1,
        outputLabels: function(i) {
            var l;
            if (this.format === "utf8") {
                l = "file.label.utf8String";
            } else if (this.format === "lines") {
                l = "file.label.utf8String_plural";
            } else if (this.format === "stream") {
                l = "file.label.binaryBuffer_plural";
            } else {
                l = "file.label.binaryBuffer";
            }
            return this._(l);
        },
        icon: "file-in.svg",
        label: function() {
            return this.name||this.filename||this._("file.label.read");
        },
        paletteLabel: RED._("node-red:file.label.read"),
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;
            var encSel = $("#node-input-encoding");
            var label = node._("file.encoding.none");
            $("<option/>", {
                value: "none",
                label: label
            }).text(label).appendTo(encSel);
            encodings.forEach(function(item) {
                if(Array.isArray(item)) {
                    var group = $("<optgroup/>", {
                        label: node._(item[0])
                    }).appendTo(encSel);
                    for (var i = 1; i < item.length; i++) {
                        var enc = item[i];
                        $("<option/>", {
                            value: enc,
                            label: enc
                        }).text(enc).appendTo(group);
                    }
                }
                else {
                    $("<option/>", {
                        value: item,
                        label: item
                    }).text(item).appendTo(encSel);
                }
            });
            encSel.val(node.encoding);
            $("#node-input-format").on("change",function() {
                var format = $("#node-input-format").val();
                if ((format === "utf8") || (format === "lines")) {
                    $("#encoding-spec").show();
                }
                else {
                    $("#encoding-spec").hide();
                }
                if ((format === "lines") || (format === "stream")) {
                    $("#file-allprops").show();
                }
                else {
                    $("#file-allprops").hide();
                }
            });
        }
    });
})();
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-help-name="file">
    <p>将<code>msg.payload</code>写入文件，添加到末尾或替换现有内容。或者，它也可以删除文件。</p>
    <h3>输入</h3>
    <dl class="message-properties">
        <dt class="optional">filename<span class="property-type">字符串</span></dt>
        <dd>如果未在节点中配置，则此可选属性可以设置文件名。</dd>
    </dl>
    <h3>输出</h3>
    <p>写入完成后，输入消息将发送到输出端口。</p>
    <h3>详细</h3>
    <p>每个消息的有效荷载将添加到文件的末尾，可以选择在每个消息之间添加一个换行符（\n）。</p>
    <p>如果使用<code>msg.filename</code>，则每次写入后文件都会关闭。为了获得最佳体验，请使用固定的文件名。</p>
    <p>可以将其配置为覆盖整个文件，而不是在文件后添加段落。例如，在将二进制数据写入文件（例如图像）时，应使用此选项，并且应禁用添加换行符的选项。</p>
    <p>可以从编码列表中指定写入文件的数据的编码。</p>
    <p>您可以将此节点配置为删除文件。</p>
</script>

<script type="text/html" data-help-name="file in">
    <p>以字符串或二进制缓冲区的形式读取文件的内容。</p>
    <h3>输入</h3>
    <dl class="message-properties">
        <dt class="optional">filename<span class="property-type">字符串</span></dt>
        <dd>如果未在节点配置中设置，该属性可以选择要读取的文件名。</dd>
    </dl>
    <h3>输出</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">字符串 | buffer</span></dt>
        <dd>文件的内容可以是字符串，也可以是二进制的buffer。</dd>
        <dt class="optional">filename <span class="property-type">字符串</span></dt>
        <dd>如果未在节点配置中设置，该属性可以选择要读取的文件名。</dd>
    </dl>
    <h3>详细</h3>
    <p>文件名应该是绝对路径，否则将相对于Node-RED进程的工作目录。</p>
    <p>在Windows上，可能需要使用转义路径分隔符，例如：<code>\\Users\\myUser</code>。</p>
    <p>可以选择将文本文件拆分为几行，每行输出一条消息，或者将二进制文件拆分为较小的buffer块-块大小取决于操作系统，但通常为64k（Linux/Mac）或41k（Windows）。</p>
    <p>当拆分为多条消息时，每条消息将具有<code>parts</code>属性集，从而形成完整的消息序列。</p>
    <p>如果输出格式为字符串，则可以从编码列表中指定输入数据的编码。</p>
    <p>应该使用Catch节点来捕获并处理错误。</p>
</script>

</div><div><!-- --- [red-module:node-red/watch] --- -->
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/html" data-template-name="watch">
    <div class="form-row node-input-filename">
         <label for="node-input-files"><i class="fa fa-file"></i> <span data-i18n="watch.label.files"></span></label>
         <input id="node-input-files" type="text" tabindex="1" data-i18n="[placeholder]watch.placeholder.files">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-recursive" style="display:inline-block; width:auto; vertical-align:top;">
        <label for="node-input-recursive" style="width:70%;"> <span data-i18n="watch.label.recursive"></span></label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
     <div id="node-input-tip" class="form-tips"><span data-i18n="watch.tip"></span></div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('watch',{
        category: 'storage',
        defaults: {
            name: {value:""},
            files: {value:"",required:true},
            recursive: {value:""}
        },
        color:"BurlyWood",
        inputs:0,
        outputs:1,
        icon: "watch.svg",
        label: function() {
            return this.name||this.files||this._("watch.watch");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>
<!--
  Copyright JS Foundation and other contributors, http://js.foundation

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-help-name="watch">
    <p>监视目录或文件中的更改。</p>
    <p>您可以输入用逗号分隔的目录和/或文件的列表。您需要在所有带有空格的地方加上引号“...”。</p>
    <p>在Windows上，必须在任何目录名称中使用双反斜杠<code>\\</code>。</p>
    <p>实际更改的文件的完整文件名将放入<code>msg.payload</code>和<code>msg.filename</code>中，而监视列表的字符串化版本将在<code>msg.topic</code>中返回。</p>
    <p><code>msg.file</code>仅包含已更改文件的短文件名。<code>msg.type</code>更改了事物的类型，通常是<i>file</i>或<i>directory</i>，而<code>msg.size</code>保留了文件的大小（以字节为单位）。</p>
    <p>当然，在Linux中，<i>everything</i>也是一个文件，因此可以监视</p>
    <p><b>注意：</b>该目录或文件必须存在才能被监视。如果文件或目录被删除，即使重新创建它也可能不再被监视。</p>
</script>

</div><div><!-- --- [red-module:node-red-contrib-chronos/chronos-config] --- -->
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-template-name="chronos-config">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.name"></span></label>
        <input type="text" id="node-config-input-name" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.name">
    </div>
    <div class="form-row">
        <label for="node-config-input-latitude"><i class="fa fa-map-marker"></i> <span data-i18n="config.label.latitude"></span></label>
        <input id="node-config-input-latitude" data-i18n="[placeholder]config.label.latitude">
    </div>
    <div class="form-row">
        <label for="node-config-input-longitude"><i class="fa fa-map-marker"></i> <span data-i18n="config.label.longitude"></span></label>
        <input id="node-config-input-longitude" data-i18n="[placeholder]config.label.longitude">
    </div>
    <div class="form-row">
        <iframe id="node-config-input-map" width="100%" height="200" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" style="border: 1px solid #CCCCCC; border-radius: 4px;"></iframe>
    </div>
    <div class="form-row node-input-sunPositionList-row" style="padding-top: 10px">
        <label for="node-input-sunPositionList" style="width: auto;"><i class="fa fa-calendar-o"></i> <span data-i18n="config.label.sunPositions"></span></label>
        <div class="form-row">
            <ol id="node-input-sunPositionList"></ol>
        </div>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("chronos-config",
    {
        category: "config",
        icon:     "chronos_config.svg",
        label:    function()
        {
            return (this.name || ((this.credentials && this.credentials.latitude && this.credentials.longitude) ? (this.credentials.latitude + ", " + this.credentials.longitude) : this._("config.label.node")));
        },
        defaults:
        {
            name:
            {
                value: ""
            },
            sunPositions:
            {
                value: [],
                validate: function(v)
                {
                    if (v && (v.length > 0))
                    {
                        const EXP = /^[0-9a-zA-Z_]+$/;
                        let valid = true;
                        let names = [];

                        // check for invalid names
                        for (let i=0; i<v.length; ++i)
                        {
                            if (!EXP.test(v[i].riseName) || !EXP.test(v[i].setName))
                            {
                                valid = false;
                                break;
                            }

                            names.push(v[i].riseName);
                            names.push(v[i].setName);
                            if (hasDuplicates(names))
                            {
                                valid = false;
                                break;
                            }
                        }

                        return valid;
                    }
                    else
                    {
                        return true;
                    }

                    function hasDuplicates(arr)
                    {
                        return arr.some(item =>
                        {
                            return (arr.indexOf(item) !== arr.lastIndexOf(item));
                        });
                    }
                }
            }
        },
        credentials:
        {
            latitude:
            {
                type: "text",
                value: "",
                required: true
            },
            longitude:
            {
                type: "text",
                value: "",
                required: true
            }
        },
        oneditprepare: function()
        {
            let node = this;

            const updateMap = function()
            {
                let latitude = parseFloat($("#node-config-input-latitude").spinner("value"));
                let longitude = parseFloat($("#node-config-input-longitude").spinner("value"));

                if (!Number.isNaN(latitude) && !Number.isNaN(longitude))
                {
                    $("#node-config-input-map").attr("src", "https://www.openstreetmap.org/export/embed.html?bbox="
                                                            + (longitude - 0.001) + ","
                                                            + (latitude - 0.001) + ","
                                                            + (longitude + 0.001) + ","
                                                            + (latitude + 0.001)
                                                            + "&layer=mapnik&marker="
                                                            + latitude + ","
                                                            + longitude);
                }
            };

            const validateCoords = function(event, ui)
            {
                if (/^(\+|-)?\d+(\.\d+)?$/.test($(this).spinner("value")))
                {
                    let value = parseFloat($(this).spinner("value"));
                    let min = $(this).spinner("option", "min");
                    let max = $(this).spinner("option", "max");

                    if (value < min)
                    {
                        $(this).spinner("value", min);
                    }
                    else if (value > max)
                    {
                        $(this).spinner("value", max);
                    }
                }
                else
                {
                    $(this).spinner("value", 0);
                }

                updateMap();
            };

            const latitudeInput =
            {
                min: -90,
                max: 90,
                step: 1,
                numberFormat: "n",
                change: validateCoords
            };

            const longitudeInput =
            {
                min: -180,
                max: 180,
                step: 1,
                numberFormat: "n",
                change: validateCoords
            };

            const sunAngleInput =
            {
                min: -90,
                max: 90,
                step: 1,
                numberFormat: "n",
                change: validateCoords
            };

            $("#node-config-input-latitude").spinner(latitudeInput);
            $("#node-config-input-longitude").spinner(longitudeInput);
            updateMap();

            let sunPositionList = $("#node-input-sunPositionList").css("min-width", "500px").css("min-height", "150px").editableList(
            {
                removable: true,
                sortable: true,
                addItem: function(item, index, data)
                {
                    let fragment = document.createDocumentFragment();

                    let angleLabel = $("<label/>", {style: "width: auto; margin-left: 5px; margin-bottom: 0px;"})
                                        //.html("<i class='fa fa-sun-o' aria-hidden='true'></i> " + node._("config.label.angle") + " ")
                                        .text(node._("config.label.angle") + " ")
                                        .appendTo(fragment);
                    let angle = $("<input/>", {class: "node-input-angle", style: "width: 60px; margin-left: 4px;"})
                                        .appendTo(angleLabel)
                                        .spinner(sunAngleInput);
                    let riseLabel = $("<label/>", {title: node._("config.label.riseName"), style: "width: auto; margin-left: 12px; margin-bottom: 0px;"})
                                        .html("<i class='fa fa-arrow-up' aria-hidden='true'></i>")
                                        .appendTo(fragment);
                    let riseName = $("<input/>", {type: "text", class: "node-input-riseName", placeholder: node._("config.label.riseName"), style: "width: 110px; margin-left: 4px;"})
                                        .appendTo(riseLabel);
                    let setLabel = $("<label/>", {title: node._("config.label.setName"), style: "width: auto; margin-left: 12px; margin-bottom: 0px;"})
                                        .html("<i class='fa fa-arrow-down' aria-hidden='true'></i>")
                                        .appendTo(fragment);
                    let setName = $("<input/>", {type: "text", class: "node-input-setName", placeholder: node._("config.label.setName"), style: "width: 110px; margin-left: 4px;"})
                                        .appendTo(setLabel);

                    if (!("angle" in data))
                    {
                        data = {angle: 0, riseName: "", setName: ""};
                    }

                    angle.spinner("value", data.angle);
                    riseName.val(data.riseName);
                    setName.val(data.setName);

                    item[0].appendChild(fragment);
                }
            });

            if (!node.sunPositions)  // backward compatibility to v1.1.0
            {
                node.sunPositions = [];
            }

            node.sunPositions.forEach(data =>
            {
                sunPositionList.editableList("addItem", data);
            });
        },
        oneditsave: function()
        {
            let node = this;
            let sunPositionList = $("#node-input-sunPositionList").editableList("items");

            node.sunPositions = [];
            sunPositionList.each(function(index)
            {
                let data = {};

                let angle = $(this).find(".node-input-angle");
                let riseName = $(this).find(".node-input-riseName");
                let setName = $(this).find(".node-input-setName");

                data.angle = angle.spinner("value");
                data.riseName = riseName.val();
                data.setName = setName.val();

                node.sunPositions.push(data);
            });
        },
        oneditresize: function(size)
        {
            let height = size.height;
            let sunPositionListRow = $("#node-config-dialog-edit-form>div.node-input-sunPositionList-row");
            let otherRows = $("#node-config-dialog-edit-form>div:not(.node-input-sunPositionList-row)");

            for (let i=0; i<otherRows.length; ++i)
            {
                height -= $(otherRows[i]).outerHeight(true);
            }

            height -= (parseInt(sunPositionListRow.css("marginTop")) + parseInt(sunPositionListRow.css("marginBottom")));
            height -= $("#node-config-dialog-edit-form>div.node-input-sunPositionList-row>label").outerHeight(true);

            $("#node-input-sunPositionList").editableList("height", height);
        }
    });
</script>
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-help-name="chronos-config">
    <p>
        Configuration of the geographical location and custom sun positions.
    </p>
    <h3>Details</h3>
    <p>
        This configuration holds the geographical location in form of latitude
        and longitude. That is required for the calculation of times based on
        sun and moon position. For privacy protection reasons, the coordinates
        are stored as credentials and therefore are not exported with the flows.
        The map can be used to validate the entered coordinates.
        Additionally custom sun positions can be defined in this node. They can
        be used in the other nodes in a similar way as the predefined sun
        positions.
    </p>
    <p>
        For more information, please refer to the detailed documentation in the
        <a href="https://github.com/jensrossbach/node-red-contrib-chronos/wiki/Configuration-Node">repository wiki</a>.
    </p>
    <h3>Configuration</h3>
    <dt>Name</dt>
    <dd>
        The name of the configuration (optional).
    </dd>
    <dt>Latitude</dt>
    <dd>
        The latitude as floating point value between -90° and 90°.
    </dd>
    <dt>Longitude</dt>
    <dd>
        The longitude as floating point value between -180° and 180°.
    </dd>
    <dt>Custom Sun Positions</dt>
    <dd>
        List of user-defined sun positions. New entries can be added using the
        button below the list. Existing entries can be reordered or deleted.
        Each entry in the list can be configured as follows:
        <ul>
            <li>
                The solar zenith angle above (positive value) or below (negative
                value) the horizon in degrees.
            </li>
            <li>
                The name of the position for rising sun.
            </li>
            <li>
                The name of the position for setting sun.
            </li>
        </ul>
        Names can be composed of letters, digits and underscores and must be
        unique.
    </dd>
</script>

</div><div><!-- --- [red-module:node-red-contrib-chronos/chronos-scheduler] --- -->
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-template-name="chronos-scheduler">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-config"><i class="fa fa-cog"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.config"></span></label>
        <input type="text" id="node-input-config" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.config">
    </div>
    <div class="form-row node-input-scheduleList-row" style="padding-top: 10px">
        <label for="node-input-scheduleList"><i class="fa fa-calendar-o"></i> <span data-i18n="scheduler.label.schedule"></span></label>
        <div class="form-row">
            <ol id="node-input-scheduleList"></ol>
        </div>
    </div>
    <div class="form-row">
        <input id="node-input-multiPort" type="checkbox" style="margin-top: 0px; margin-bottom: 1px; width: auto;">
        <label for="node-input-multiPort" style="margin-bottom: 0px; width: auto;" data-i18n="scheduler.label.multiPort"></label>
    </div>
    <div class="form-row">
        <input id="node-input-disabled" type="checkbox" style="margin-top: 0px; margin-bottom: 1px; width: auto;">
        <label for="node-input-disabled" style="margin-bottom: 0px; width: auto;" data-i18n="scheduler.label.disabled"></label>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("chronos-scheduler",
    {
        category:     "chronos",
        color:        "#DEB887",
        icon:         "chronos_scheduler.svg",
        inputs:       1,
        outputs:      1,
        paletteLabel: "scheduler",
        label: function()
        {
            return (this.name || this._("scheduler.label.node"));
        },
        labelStyle: function()
        {
            return (this.name ? "node_label_italic" : "");
        },
        inputLabels: function()
        {
            return this._("scheduler.label.inputPort");
        },
        outputLabels: function(index)
        {
            return (this.schedule[index] ? this.schedule[index].label : this._("scheduler.status.noSchedule")) || this._("scheduler.label.outputPort");
        },
        defaults:
        {
            name:
            {
                value: ""
            },
            config:
            {
                value:    "",
                type:     "chronos-config",
                required: true
            },
            schedule:
            {
                value: [{trigger: {type: "time", value: "", offset: 0, random: false},
                         output: {type: "msg", property: {name: "payload", type: "str", value: ""}}}],
                validate: function(v)
                {
                    // just a simple check if there are any events, no detailed check of the content
                    return v.length > 0;
                }
            },
            multiPort:
            {
                value: false
            },
            disabled:
            {
                value: false
            },
            outputs:
            {
                value: 1
            }
        },
        oneditprepare: function()
        {
            let node = this;

            let scheduleList = $("#node-input-scheduleList").css("min-width", "500px").css("min-height", "150px").editableList(
            {
                removable: true,
                sortable: true,
                addItem: function(item, index, data)
                {
                    const sunTimes =
                    [
                        {
                            value: "nightEnd",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nightEnd")
                        },
                        {
                            value: "nauticalDawn",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nauticalDawn")
                        },
                        {
                            value: "dawn",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.dawn")
                        },
                        {
                            value: "sunrise",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunrise")
                        },
                        {
                            value: "sunriseEnd",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunriseEnd")
                        },
                        {
                            value: "goldenHourEnd",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.goldenHourEnd")
                        },
                        {
                            value: "solarNoon",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.solarNoon")
                        },
                        {
                            value: "goldenHour",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.goldenHour")
                        },
                        {
                            value: "sunsetStart",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunsetStart")
                        },
                        {
                            value: "sunset",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunset")
                        },
                        {
                            value: "dusk",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.dusk")
                        },
                        {
                            value: "nauticalDusk",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nauticalDusk")
                        },
                        {
                            value: "night",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.night")
                        },
                        {
                            value: "nadir",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nadir")
                        }
                    ];

                    const moonTimes =
                    [
                        {
                            value: "rise",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.moon.rise")
                        },
                        {
                            value: "set",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.moon.set")
                        }
                    ];

                    const timeInput =
                    {
                        value: "time",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.time"),
                        icon: "fa fa-clock-o",
                        hasValue: true,
                        validate: /^(\d|0\d|1\d|2[0-3]):([0-5]\d)(:([0-5]\d))?\s*(am|AM|pm|PM)?$/
                    };

                    const sunTimeInput =
                    {
                        value: "sun",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.sun"),
                        icon: "fa fa-sun-o",
                        options: sunTimes
                    };

                    const moonTimeInput =
                    {
                        value: "moon",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.moon"),
                        icon: "fa fa-moon-o",
                        options: moonTimes
                    };

                    const customInput =
                    {
                        value: "custom",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.custom"),
                        icon: "fa fa-wrench",
                        hasValue: true,
                        validate: /^[a-zA-Z][0-9a-zA-Z_]+$/
                    };

                    const cronInput =
                    {
                        value: "crontab",
                        label: node._("scheduler.label.crontab"),
                        icon: "fa fa-table",
                        hasValue: true,
                        validate: /^[0-9a-zA-Z ,#@*/?-]+$/
                    };

                    const fullMessageInput =
                    {
                        value: "fullMsg",
                        label: node._("scheduler.label.fullMessage"),
                        hasValue: false
                    };

                    const offsetInput =
                    {
                        min: -300,
                        max: 300,
                        step: 5,
                        change: function(event, ui)
                        {
                            var value = parseInt($(this).spinner("value"), 10);
                            var min = $(this).spinner("option", "min");
                            var max = $(this).spinner("option", "max");
                            if (isNaN(value) ||
                                (value < min))
                            {
                                $(this).spinner("value", min);
                            }
                            else if (value > max)
                            {
                                $(this).spinner("value", max);
                            }
                        }
                    };

                    let fragment = document.createDocumentFragment();
                    let triggerRow = $("<div/>").appendTo(fragment);
                    let outputRow = $("<div/>", {style: "margin-top: 5px; "}).appendTo(fragment);

                    let triggerType = $("<input/>", {type: "text", class: "node-input-triggerType"})
                                        .appendTo(triggerRow)
                                        .typedInput({types: [timeInput, sunTimeInput, moonTimeInput, customInput, cronInput, "global", "flow"]});
                    triggerType.typedInput("width", "280px");
                    triggerType._prevType = "time";

                    let offsetBox = $("<div/>", {style: "display: inline-block;"}).appendTo(triggerRow);
                    let offsetLabel = $("<label/>", {title: node._("node-red-contrib-chronos/chronos-config:common.label.offset"), style: "display: inline-block; width: auto; margin-bottom: 0px;"})
                                        .html("<span style='margin-left: 6px; margin-right: 6px;'>&#8597;</span>")
                                        .appendTo(offsetBox);
                    let triggerOffset = $("<input/>", {class: "node-input-triggerOffset", style: "width: 50px !important;"})
                                        .appendTo(offsetLabel)
                                        .spinner(offsetInput);
                    let randomLabel = $("<label/>", {title: node._("node-red-contrib-chronos/chronos-config:common.label.random"), style: "width: auto; margin-left: 10px; margin-bottom: 0px;"})
                                        .html("<i class='fa fa-random' aria-hidden='true'></i>")
                                        .appendTo(offsetBox);
                    let triggerRandom = $("<input/>", {type: "checkbox", class: "node-input-triggerRandom", style: "width: auto; margin-left: 4px; margin-top: 0px; margin-bottom: 3px;"})
                                        .appendTo(randomLabel);

                    $("<div/>", {style: "display: inline-block; width: auto; margin-left: 20px;"})
                                        .text(node._("scheduler.label.output"))
                                        .appendTo(outputRow);

                    let outputBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 8px;"}).appendTo(outputRow);
                    let outTypeRow = $("<div/>").appendTo(outputBox);
                    let outValueRow = $("<div/>", {style: "margin-top: 5px; "}).appendTo(outputBox);

                    let outType = $("<input/>", {type: "text", class: "node-input-outType"})
                                        .appendTo(outTypeRow)
                                        .typedInput({types: ["global", "flow", "msg", fullMessageInput]});
                    outType.typedInput("width", "280px");
                    outType._prevType = "global";
                    let propValue = $("<input/>", {type: "text", class: "node-input-propValue"})
                                        .appendTo(outValueRow)
                                        .typedInput({types: ["str", "num", "bool", "json", "jsonata", "bin", "date"]});
                    propValue.typedInput("width", "280px");
                    let msgValue = $("<input/>", {type: "text", class: "node-input-msgValue"})
                                        .appendTo(outValueRow)
                                        .typedInput({types: ["json", "jsonata"]});
                    msgValue.typedInput("width", "280px");

                    triggerType.on("change", function()
                    {
                        let type = triggerType.typedInput("type");
                        if ((type === "crontab") || (type === "global") || (type === "flow"))
                        {
                            offsetBox.hide();
                        }
                        else
                        {
                            offsetBox.show();
                        }

                        if (type != triggerType._prevType)
                        {
                            triggerType._prevType = type;
                            if ((type != "sun") && (type != "moon"))
                            {
                                triggerType.typedInput("value", "");
                            }
                        }
                    });

                    outType.on("change", function()
                    {
                        let type = outType.typedInput("type");
                        if (type === "fullMsg")
                        {
                            propValue.typedInput("hide");
                            msgValue.typedInput("show");
                        }
                        else
                        {
                            propValue.typedInput("show");
                            msgValue.typedInput("hide");
                        }

                        if (type != outType._prevType)
                        {
                            outType._prevType = type;
                            outType.typedInput("value", "");
                        }
                    });

                    if (!("trigger" in data))
                    {
                        data = {trigger: {type: "time", value: "", offset: 0, random: false},
                                output: {type: "msg", property: {name: "payload", type: "str", value: ""}}};
                    }
                    else if (!("type" in data.output))  // backward compatibility to v1.8.1
                    {
                        data.output = {type: "msg", property: {name: "payload", type: "str", value: ""}};
                    }

                    triggerType.typedInput("value", data.trigger.value);
                    triggerType._prevType = data.trigger.type;
                    triggerType.typedInput("type", data.trigger.type);

                    if ((data.trigger.type != "crontab") && (data.trigger.type != "global") && (data.trigger.type != "flow"))
                    {
                        triggerOffset.spinner("value", data.trigger.offset);
                        triggerRandom.prop("checked", data.trigger.random);
                    }
                    else
                    {
                        triggerOffset.spinner("value", 0);
                        triggerRandom.prop("checked", false);
                    }

                    if (data.output.type == "fullMsg")
                    {
                        msgValue.typedInput("type", data.output.contentType ? data.output.contentType : "json");
                        msgValue.typedInput("value", data.output.value);
                    }
                    else
                    {
                        outType.typedInput("value", data.output.property.name);
                        propValue.typedInput("type", data.output.property.type);
                        propValue.typedInput("value", data.output.property.value);
                    }
                    outType._prevType = data.output.type;
                    outType.typedInput("type", data.output.type);

                    item[0].appendChild(fragment);
                }
            });

            node.schedule.forEach(data =>
            {
                scheduleList.editableList("addItem", data);
            });
        },
        oneditsave: function()
        {
            let node = this;
            let scheduleList = $("#node-input-scheduleList").editableList("items");
            let multiPort = $("#node-input-multiPort").prop("checked");

            node.schedule = [];
            node.outputs = 0;

            scheduleList.each(function(index)
            {
                let data = {trigger: {}, output: {}};

                let triggerType = $(this).find(".node-input-triggerType");
                let triggerOffset = $(this).find(".node-input-triggerOffset");
                let triggerRandom = $(this).find(".node-input-triggerRandom");
                let outType = $(this).find(".node-input-outType");
                let propValue = $(this).find(".node-input-propValue");
                let msgValue = $(this).find(".node-input-msgValue");

                data.trigger.type = triggerType.typedInput("type");
                data.trigger.value = triggerType.typedInput("value");

                if ((data.trigger.type != "crontab") && (data.trigger.type != "global") && (data.trigger.type != "flow"))
                {
                    data.trigger.offset = triggerOffset.spinner("value");
                    data.trigger.random = triggerRandom.prop("checked");
                }

                data.output.type = outType.typedInput("type");
                if (data.output.type == "fullMsg")
                {
                    data.output.contentType = msgValue.typedInput("type");
                    data.output.value = msgValue.typedInput("value");
                }
                else
                {
                    data.output.property = {name: outType.typedInput("value"),
                                            type: propValue.typedInput("type"),
                                            value: propValue.typedInput("value")};
                }

                if ((data.output.type == "msg") || (data.output.type == "fullMsg"))
                {
                    if (multiPort)
                    {
                        data.port = node.outputs++;

                        if ((data.trigger.type == "global") || (data.trigger.type == "flow"))
                        {
                            let ctx = RED.utils.parseContextKey(data.trigger.value);
                            data.label = data.trigger.type + "." + ctx.key + (ctx.store ? " (" + ctx.store + ")" : "");
                        }
                        else
                        {
                            if ((data.trigger.type == "time") || (data.trigger.type == "custom") || (data.trigger.type == "crontab"))
                            {
                                data.label = data.trigger.value;
                            }
                            else
                            {
                                data.label = node._("node-red-contrib-chronos/chronos-config:common.list." + data.trigger.type + "." + data.trigger.value);
                            }

                            if (data.trigger.offset != 0)
                            {
                                data.label += ((data.trigger.offset > 0) ? " + " : " - ");

                                if (data.trigger.random)
                                {
                                    data.label += "~";
                                }

                                data.label += Math.abs(data.trigger.offset) + " " + node._("node-red-contrib-chronos/chronos-config:common.label.min");
                            }
                        }
                    }
                    else
                    {
                        node.outputs = 1;
                    }
                }

                node.schedule.push(data);
            });
        },
        oneditresize: function(size)
        {
            let height = size.height;
            let scheduleListRow = $("#dialog-form>div.node-input-scheduleList-row");
            let otherRows = $("#dialog-form>div:not(.node-input-scheduleList-row)");

            for (let i=0; i<otherRows.length; ++i)
            {
                height -= $(otherRows[i]).outerHeight(true);
            }

            height -= (parseInt(scheduleListRow.css("marginTop")) + parseInt(scheduleListRow.css("marginBottom")));
            height -= $("#dialog-form>div.node-input-scheduleList-row>label").outerHeight(true);

            $("#node-input-scheduleList").editableList("height", height);
        }
    });
</script>
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-help-name="chronos-scheduler">
    <p>
        Schedules the transmission of messages or setting of global/flow variables
        at specific times.
    </p>
    <h3>Details</h3>
    <p>
        This node can send messages or set global or flow variables at specific
        times which are either manually entered or based on sun or moon position.
        Multiple events can be planned and each can have a different trigger
        time and produce a different kind of output.
    </p>
    <p>
        For more information, please refer to the detailed documentation in the
        <a href="https://github.com/jensrossbach/node-red-contrib-chronos/wiki/Scheduler-Node">repository wiki</a>.
    </p>
    <h3>Configuration</h3>
    <dl>
        <dt>Name</dt>
        <dd>The name of the node (optional).</dd>
        <dt>Configuration</dt>
        <dd>
            A reference to the configuration node to be used.
        </dd>
        <dt>Schedule</dt>
        <dd>
            The list containing the scheduled events. New entries can be added
            using the button below the list. Existing entries can be reordered
            or deleted. For each entry, a schedule time and an output can be
            configured:
            <ul>
                <li>
                    The trigger time can be specified depending on the selection
                    on the left side with the following possibilities:
                    <ul>
                        <li>
                            <i>time of day</i>: A specific time can be entered
                            directly in the form <code>hh:mm[:ss] [am|pm]</code>.
                        </li>
                        <li>
                            <i>sun position</i>: The sun position can be
                            selected from a list of predefined values.
                        </li>
                        <li>
                            <i>moon position</i>: The moon position can be
                            selected from a list of predefined values.
                        </li>
                        <li>
                            <i>custom sun position</i>: One of the user-defined sun position
                            names can be entered.
                        </li>
                        <li>
                            <i>cron table</i>: A cron table can be entered
                            according to <a href="https://github.com/jaclarke/cronosjs#supported-expression-syntax">CronosJS expression syntax</a>.
                        </li>
                        <li>
                            <i>global</i>: Trigger configuration will be loaded
                            from the specified global context variable, see
                            chapter <i>Input</i> below for details.
                        </li>
                        <li>
                            <i>flow</i>: Trigger configuration will be loaded
                            from the specified flow context variable, see chapter
                            <i>Input</i> below for details.
                        </li>
                    </ul>
                </li>
                <li>
                    An offset between -300 and +300 can be specified in minutes.
                    The offset will be added to or subtracted from the event
                    time.
                </li>
                <li>
                    If the checkbox on the right side is selected, the offset
                    will be randomized between 0 and the specified value.
                </li>
                <li>
                    The output can either be a full message, expressed in JSON
                    form or as JSONata expression, a single message property of
                    different types, a flow variable or a global variable.
                </li>
            </ul>
        </dd>
        <dt>Dedicated output ports for schedule events</dt>
        <dd>
            If selected, for each event which produces a message as output, a
            dedicated output port will be created and the output message of the
            event will be sent to the assigned output port. For dynamically
            programmed schedule events via context variables, an output port
            will always be created as it is not known at configuration time, if
            the event will produce an output message or not.
        </dd>
        <dt>Start with disabled schedule</dt>
        <dd>
            If selected, the configured schedule will be initially disabled when
            the node starts.
        </dd>
    </dl>
    <h3>Input</h3>
    <dt>Enable/disable schedule</dt>
    <dd>
        To either disable or re-enable the schedule or parts of it, a message
        must be sent to the node. Enabling the schedule will also reload any
        programmed schedule events from context variables.
    </dd>
    <dl class="message-properties">
        <dt>payload<span class="property-type">boolean | array</span></dt>
        <dd>Switch(es) for enabling or disabling schedule events</dd>
    </dl>
    <dd>
        If <code>msg.payload</code> is a boolean value, whole schedule is enabled
        if true and disabled otherwise. If <code>msg.payload</code> is an array,
        each element must be a boolean value and corresponds to the event in the
        schedule at the same index. If the value is true, the matching event is
        enabled, otherwise it is disabled.
    </dd>
    <dt>Control scheduler node</dt>
    <dd>
        The scheduler node can be dynamically controlled in various ways using
        an input message.
    </dd>
    <dl class="message-properties">
        <dt>payload<span class="property-type">string | array</span></dt>
        <dd>Controls the node depending on the passed command(s)</dd>
    </dl>
    <dd>
        If <code>msg.payload</code> is a string value, the passed command
        affects the whole schedule. If <code>msg.payload</code> is an array,
        each element must be a string value and corresponds to the event in the
        schedule at the same index affecting only this one.
    </dd>
    <dd>
        Hint: You can also mix boolean values and string values in the array
        in order to enable/disable certain events and apply control commands
        to other events at the same time. It is also possible to set single
        elements in the array to <code>null</code> in order to ignore the
        corresponding events.
    </dd>
    <dd>
        The following commands are currently supported:
        <ul>
            <li>
                <code>toggle</code>: Toggles the activation state (i.e., enabled
                events become disabled and vice versa).
            </li>
            <li>
                <code>reload</code>: Forces enabled events to be recalculated
                (also reloads programmed data from context variables).
            </li>
            <li>
                <code>trigger</code>: Triggers enabled events, i.e., the output
                is applied as if the scheduled time has been reached. This does
                not change the regular schedule time.
            </li>
            <li>
                <code>trigger:forced</code>: Same as above, but triggers all events,
                not just enabled ones.
            </li>
        </ul>
    </dd>
    <dt>Dynamically program schedule</dt>
    <dd>
        The trigger configuration can be dynamically overridden via the input message
        or loaded from a context variable.
    </dd>
    <dl class="message-properties">
        <dt>payload<span class="property-type">array</span></dt>
        <dd>Overrides a single or multiple schedule events</dd>
    </dl>
    <dd>
        The context variables and the elements of the <code>msg.payload</code>
        array must be objects containing the following properties:
    </dd>
    <dl class="message-properties">
        <dt>type<span class="property-type">string</span></dt>
        <dd>Trigger type; one of "time", "sun", "moon", "custom" or "crontab"</dd>
        <dt>value<span class="property-type">string | number</span></dt>
        <dd>Trigger value; content is depending on trigger type</dd>
        <dt class="optional">offset<span class="property-type">number</span></dt>
        <dd>Offset to the trigger time (not applicable to type "crontab")</dd>
        <dt class="optional">random<span class="property-type">boolean</span></dt>
        <dd>Randomized offset (not applicable to type "crontab")</dd>
    </dl>
    <dd>
        Additionally it is possible to override the output of the schedule. In
        this case, an extended format must be used for the objects where the
        trigger configuration (see above) is encapsulated by an object property
        called <code>trigger</code> and the following properties are present:
    </dd>
    <dl class="message-properties">
        <dt>output.type<span class="property-type">string</span></dt>
        <dd>Output type; one of "global", "flow", "msg" or "fullMsg"</dd>
        <dt class="optional">output.value<span class="property-type">object</span></dt>
        <dd>Only if output type is "fullMsg"; defines output message content</dd>
        <dt class="optional">output.property.name<span class="property-type">string</span></dt>
        <dd>Only if output type is not "fullMsg"; name of output property/variable</dd>
        <dt class="optional">output.property.type<span class="property-type">string</span></dt>
        <dd>Optionally set to "date" and leave <code>output.property.value</code> undefined to have same behavior as if selecting timestamp type in UI</dd>
        <dt class="optional">output.property.value<span class="property-type">any</span></dt>
        <dd>Only if output type is not "fullMsg"; value of output property/variable</dd>
    </dl>
    <h3>Outputs</h3>
    <p>
        Scheduled messages are sent to the output of this node. The structure and
        content of the message can be statically defined through the configuration
        or dynamically programmed via input message and context variables.
    </p>
</script>

</div><div><!-- --- [red-module:node-red-contrib-chronos/chronos-repeat] --- -->
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-template-name="chronos-repeat">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-config"><i class="fa fa-cog"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.config"></span></label>
        <input type="text" id="node-input-config" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.config">
    </div>
    <div class="form-row" style="padding-top: 4px;">
        <label for="node-input-mode"><i class="fa fa-sliders"></i> <span data-i18n="repeat.label.mode"></span></label>
        <select id="node-input-mode" style="width: auto;">
            <option value="simple" data-i18n="repeat.list.mode.simple"></option>
            <option value="advanced" data-i18n="repeat.list.mode.advanced"></option>
            <option value="custom" data-i18n="repeat.list.mode.custom"></option>
        </select>
    </div>
    <div id="form-row-simple" class="form-row">
        <label for="node-input-interval"><i class="fa fa-clock-o"></i> <span data-i18n="repeat.label.interval"></span></label>
        <input id="node-input-interval" style="width: 60px !important; float: left;" value="1">
        <select id="node-input-intervalUnit" style="width: auto;">
            <option value="seconds" data-i18n="repeat.list.interval.seconds"></option>
            <option value="minutes" data-i18n="repeat.list.interval.minutes"></option>
            <option value="hours" data-i18n="repeat.list.interval.hours"></option>
        </select>
    </div>
    <div id="form-row-advanced" class="form-row">
        <label for="node-input-crontab"><i class="fa fa-table"></i> <span data-i18n="repeat.label.crontab"></span></label>
        <input type="text" id="node-input-crontab" placeholder="* * * * * * *">
    </div>
    <div id="form-row-custom" class="form-row">
        <label for="node-input-expressionField"><i class="fa fa-code"></i> <span data-i18n="repeat.label.expression"></span></label>
        <input type="text" id="node-input-expressionField" style="width: 70%;">
        <input id="node-input-expression" type="hidden">
    </div>
    <div class="form-row">
        <label for="node-input-until"><i class="fa fa-step-forward"></i> <span data-i18n="repeat.label.until"></span></label>
        <input type="text" id="node-input-until" style="width: 70%;">
        <input id="node-input-untilType" type="hidden">
        <input id="node-input-untilValue" type="hidden">
    </div>
    <div class="form-row" id="form-row-untilDate">
        <label for="node-input-untilDate"><i class="fa fa-calendar"></i> <span data-i18n="repeat.label.date"></span></label>
        <input type="text" id="node-input-untilDate" style="width: 70%;" data-i18n="[placeholder]repeat.label.datePlaceholder">
    </div>
    <div class="form-row" id="form-row-offsetBox">
        <label for="node-input-untilOffset"><i class="fa fa-arrows-h"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.offset"></span></label>
        <input id="node-input-untilOffset" style="width: 60px !important;">
        <span style="padding-left: 10px;">
            <input id="node-input-untilRandom" type="checkbox" style="width: auto; margin-top: 0px; margin-bottom: 1px;">
            <label for="node-input-untilRandom" style="width: auto; margin-bottom: 0px;" data-i18n="node-red-contrib-chronos/chronos-config:common.label.random"></label>
        </span>
    </div>
    <div class="form-row" style="margin-bottom: 4px; padding-top: 10px">
        <label for="node-input-msgIngress" style="width: auto;"><i class="fa fa-sign-in"></i> <span data-i18n="repeat.label.msgIngress"></span></label>
    </div>
    <div class="form-row">
        <select id="node-input-msgIngress" style="margin-left: 104px; width: auto;">
            <option value="noop" data-i18n="repeat.list.msgIngress.noop"></option>
            <option value="forward" data-i18n="repeat.list.msgIngress.forward"></option>
            <option value="forward:forced" data-i18n="repeat.list.msgIngress.forcedForward"></option>
        </select>
    </div>
    <div class="form-row" style="padding-top: 10px">
        <input id="node-input-preserveCtrlProps" type="checkbox" style="margin-top: 0px; margin-bottom: 1px; width: auto;">
        <label for="node-input-preserveCtrlProps" style="margin-bottom: 0px; width: auto;" data-i18n="node-red-contrib-chronos/chronos-config:common.label.preserveCtrlProps"></label>
    </div>
    <div class="form-row">
        <input id="node-input-ignoreCtrlProps" type="checkbox" style="margin-top: 0px; margin-bottom: 1px; width: auto;">
        <label for="node-input-ignoreCtrlProps" style="margin-bottom: 0px; width: auto;" data-i18n="node-red-contrib-chronos/chronos-config:common.label.ignoreCtrlProps"></label>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("chronos-repeat",
    {
        category:     "chronos",
        color:        "#DEB887",
        icon:         "chronos_repeat.svg",
        inputs:       1,
        outputs:      1,
        paletteLabel: "repeat",
        label: function()
        {
            if (this.name)
            {
                return this.name;
            }
            else if ((this.mode == "simple") && this.interval && this.intervalUnit)
            {
                return this._("repeat.label.every") + " " + this.interval + " " + this._("repeat.list.interval." + this.intervalUnit);
            }
            else if ((this.mode == "advanced") && this.crontab)
            {
                return this.crontab;
            }
            else if ((this.mode == "custom") && this.expression)
            {
                if (this.expression.length <= 20)
                {
                    return this.expression;
                }
                else
                {
                    return this.expression.substring(0, 19) + "...";
                }
            }
            else
            {
                return this._("repeat.label.node");
            }
        },
        labelStyle: function()
        {
            return (this.name ? "node_label_italic" : "");
        },
        inputLabels: function()
        {
            return this._("node-red-contrib-chronos/chronos-config:common.label.inputPort");
        },
        outputLabels: function(index)
        {
            return this._("repeat.label.outputPort");
        },
        defaults:
        {
            name:
            {
                value: ""
            },
            config:
            {
                value:    "",
                type:     "chronos-config",
                required: true
            },
            mode:
            {
                value: "simple"
            },
            interval:
            {
                value: 1
            },
            intervalUnit:
            {
                value: "minutes"
            },
            crontab:
            {
                value: "",
                validate: function(v)
                {
                    if (this.mode == "advanced")
                    {
                        return /^[0-9a-zA-Z ,#@*/?-]+$/.test(v);
                    }
                    else
                    {
                        return true;
                    }
                }
            },
            expression:
            {
                value: "",
                validate: function(v)
                {
                    if (this.mode == "expression")
                    {
                        return (v.length > 0);
                    }
                    else
                    {
                        return true;
                    }
                }
            },
            untilType:
            {
                value: "nextMsg"
            },
            untilValue:
            {
                value: ""
            },
            untilDate:
            {
                value: "",
                validate: function(v)
                {
                    if (!v)
                    {
                        return true;
                    }
                    else
                    {
                        return /^([2-9]\d\d\d)-([1-9]|0[1-9]|1[0-2])-([1-9]|0[1-9]|[12]\d|3[01])$/.test(v);
                    }
                }
            },
            untilOffset:
            {
                value: 0
            },
            untilRandom:
            {
                value: false
            },
            msgIngress:
            {
                value: "forward"
            },
            preserveCtrlProps:
            {
                value: false
            },
            ignoreCtrlProps:
            {
                value: false
            }
        },
        oneditprepare: function()
        {
            let node = this;

            const sunTimes =
            [
                {
                    value: "nightEnd",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nightEnd")
                },
                {
                    value: "nauticalDawn",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nauticalDawn")
                },
                {
                    value: "dawn",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.dawn")
                },
                {
                    value: "sunrise",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunrise")
                },
                {
                    value: "sunriseEnd",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunriseEnd")
                },
                {
                    value: "goldenHourEnd",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.goldenHourEnd")
                },
                {
                    value: "solarNoon",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.solarNoon")
                },
                {
                    value: "goldenHour",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.goldenHour")
                },
                {
                    value: "sunsetStart",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunsetStart")
                },
                {
                    value: "sunset",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunset")
                },
                {
                    value: "dusk",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.dusk")
                },
                {
                    value: "nauticalDusk",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nauticalDusk")
                },
                {
                    value: "night",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.night")
                },
                {
                    value: "nadir",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nadir")
                }
            ];

            const moonTimes =
            [
                {
                    value: "rise",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.moon.rise")
                },
                {
                    value: "set",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.moon.set")
                }
            ];

            const timeInput =
            {
                value: "time",
                label: node._("node-red-contrib-chronos/chronos-config:common.label.time"),
                icon: "fa fa-clock-o",
                hasValue: true,
                validate: /^(\d|0\d|1\d|2[0-3]):([0-5]\d)(:([0-5]\d))?\s*(am|AM|pm|PM)?$/
            };

            const sunTimeInput =
            {
                value: "sun",
                label: node._("node-red-contrib-chronos/chronos-config:common.label.sun"),
                icon: "fa fa-sun-o",
                options: sunTimes
            };

            const moonTimeInput =
            {
                value: "moon",
                label: node._("node-red-contrib-chronos/chronos-config:common.label.moon"),
                icon: "fa fa-moon-o",
                options: moonTimes
            };

            const customInput =
            {
                value: "custom",
                label: node._("node-red-contrib-chronos/chronos-config:common.label.custom"),
                icon: "fa fa-wrench",
                hasValue: true,
                validate: /^[a-zA-Z][0-9a-zA-Z_]*$/
            };

            const nextMsgInput =
            {
                value: "nextMsg",
                label: node._("repeat.label.nextMsg"),
                hasValue: false
            };

            const validateInput = function(event, ui)
            {
                var value = parseInt($(this).spinner("value"), 10);
                var min = $(this).spinner("option", "min");
                var max = $(this).spinner("option", "max");
                if (isNaN(value) || (value < min))
                {
                    $(this).spinner("value", min);
                }
                else if (value > max)
                {
                    $(this).spinner("value", max);
                }
            };

            let interval = $("#node-input-interval")
                            .spinner({min: 1, max: 59, step: 1, change: validateInput});
            let expression = $("#node-input-expressionField")
                            .typedInput({types: ["jsonata"]});
            let untilDate = $("#node-input-untilDate")
                            .datepicker({dateFormat: "yy-mm-dd",
                                         minDate: "2000-01-01",
                                         maxDate: "9999-12-31",
                                         changeYear: true,
                                         firstDay: 1});
            let until = $("#node-input-until")
                            .typedInput({types: [nextMsgInput, timeInput, sunTimeInput, moonTimeInput, customInput, "jsonata"], typeField: $("#node-input-untilType")});
            let untilOffset = $("#node-input-untilOffset")
                            .spinner({min: -300, max: 300, step: 5, change: validateInput});

            $("#node-input-intervalUnit").change(function()
            {
                let value = $(this).val();
                switch (value)
                {
                    case "seconds":
                    {
                        interval.spinner("option", "max", 59);
                        break;
                    }
                    case "minutes":
                    {
                        interval.spinner("option", "max", 59);
                        break;
                    }
                    case "hours":
                    {
                        interval.spinner("option", "max", 24);
                        break;
                    }
                }

                validateInput.call(interval);
            });

            $("#node-input-mode").change(function()
            {
                let value = $(this).val();
                switch (value)
                {
                    case "simple":
                    {
                        $("#form-row-simple").show();
                        $("#form-row-advanced").hide();
                        $("#form-row-custom").hide();
                        break;
                    }
                    case "advanced":
                    {
                        $("#form-row-simple").hide();
                        $("#form-row-advanced").show();
                        $("#form-row-custom").hide();
                        break;
                    }
                    case "custom":
                    {
                        $("#form-row-simple").hide();
                        $("#form-row-advanced").hide();
                        $("#form-row-custom").show();
                        break;
                    }
                }
            });

            until.on("change", function()
            {
                let type = until.typedInput("type");
                if ((type === "nextMsg") || (type === "jsonata"))
                {
                    $("#form-row-untilDate").hide();
                    $("#form-row-offsetBox").hide();
                }
                else
                {
                    $("#form-row-untilDate").show();
                    $("#form-row-offsetBox").show();
                }
            });

            // backward compatibility to v1.14.x and earlier
            if (typeof node.mode == "undefined")
            {
                node.mode = "simple";
                $("#node-input-mode").val(node.mode);
            }
            if (typeof node.msgIngress == "undefined")
            {
                node.msgIngress = "forward:forced";
                $("#node-input-msgIngress").val(node.msgIngress);
            }

            $("#node-input-mode").change();
            expression.typedInput("value", $("#node-input-expression").val());
            until.typedInput("value", $("#node-input-untilValue").val());
        },
        oneditsave: function()
        {
            $("#node-input-expression").val($("#node-input-expressionField").typedInput("value"));
            $("#node-input-untilValue").val($("#node-input-until").typedInput("value"));
        }
    });
</script>
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-help-name="chronos-repeat">
    <p>
        Repeats each message passing through the node based on a configurable
        interval.
    </p>
    <h3>Details</h3>
    <p>
        This node forwards an incoming message upon reception and then periodically
        sends this messages according to the configured interval or cron-like
        schedule. The repetition ends when a new message is received and optionally
        at a specific time.
    </p>
    <p>
        For more information, please refer to the detailed documentation in the
        <a href="https://github.com/jensrossbach/node-red-contrib-chronos/wiki/Repeat-Node">repository wiki</a>.
    </p>
    <h3>Configuration</h3>
    <dl>
        <dt>Name</dt>
        <dd>The name of the node (optional).</dd>
        <dt>Configuration</dt>
        <dd>
            A reference to the configuration node to be used.
        </dd>
        <dt>Mode</dt>
        <dd>
            The repetition mode which can be either simple (see "Interval" below),
            advanced (see "Cron Table" below) or custom (see "Expression" below).
        </dd>
        <dt>Interval</dt>
        <dd>
            In simple mode, this specifies the interval for message sending repetition
            which can be expressed in seconds, minutes or hours.
        </dd>
        <dt>Cron Table</dt>
        <dd>
            In advanced mode, this specifies the cron-based schedule for message
            repetition which must be entered according to
            <a href="https://github.com/jaclarke/cronosjs#supported-expression-syntax">CronosJS expression syntax</a>.
        </dd>
        <dt>Expression</dt>
        <dd>
            In custom mode, this specifies a JSONata expression that is evaluated
            on each iteration and must result in a time value for the next iteration.
            The time value can either be a number containing the amount of
            milliseconds until the next trigger or the amount of milliseconds elapsed
            since the UNIX epoch representing the absolute time of the next trigger.
            Or it is a valid datetime string representing the absolute time of the
            next trigger. The string must be parseable according to
            <a href="https://momentjs.com/docs/#/parsing/string/">Moment.js documentation</a>.
        </dd>
        <dt>Until</dt>
        <dd>
            The condition when periodic message sending should stop. A subsequently
            received message always stops the repetition of the previous message.
            Additonally a time-based or custom ending condition can be configured
            for message sending repetition. Depending on the selection, the following
            possibilities are available:
            <ul>
                <li>
                    <i>next message</i>: Repetition is only stopped when receiving
                    another message.
                </li>
                <li>
                    <i>time of day</i>: A specific ending time can be entered directly
                    in the form <code>hh:mm[:ss] [am|pm]</code>.
                </li>
                <li>
                    <i>sun position</i>: The sun position can be selected from a list
                    of predefined values.
                </li>
                <li>
                    <i>moon position</i>: The moon position can be selected from a list
                    of predefined values.
                </li>
                <li>
                    <i>custom sun position</i>: One of the user-defined sun position names can be
                    entered.
                </li>
                <li>
                    <i>expression</i>: A JSONata expression can be entered which should
                    evaluate to either <code>false</code> (ending condition not reached)
                    or <code>true</code> (ending condition reached). The time of the
                    next trigger can be accessed via expression variable <code>$next</code>.
                </li>
            </ul>
        </dd>
        <dt>Date</dt>
        <dd>
            A date can be provided in the form <code>YYYY-MM-DD</code> for the
            ending time. If omitted, the date of the message ingress is used.
        </dd>
        <dt>Offset</dt>
        <dd>
            An offset between -300 and +300 can be specified in minutes. The offset
            will be added to or subtracted from the repetition ending time.
        </dd>
        <dt>Randomized</dt>
        <dd>
            When selected, the offset will be randomized between 0 and the
            specified value.
        </dd>
        <dt>When message arrives on input</dt>
        <dd>
            Specifies the behavior upon message ingress.
            <ul>
                <li>
                    <i>do nothing</i>: The message is not forwarded on ingress,
                    next sending of the message happens after the first interval
                    has passed (provided that the end condition is not reached).
                </li>
                <li>
                    <i>forward message</i>: The message is immediately forwarded
                    provided that the end time is not exceeded or no end time has
                    been set.
                </li>
                <li>
                    <i>forced forward message</i>: The message is immediately
                    forwarded regardless if the end time has been exceeded or
                    not.
                </li>
            </ul>
        </dd>
        <dt>Preserve control properties in messages</dt>
        <dd>
            If selected, control properties as described below in chapter
            <i>Input</i> are not deleted from input messages and hence are still
            present in the messages when they are sent to the output port.
        </dd>
        <dt>Ignore control properties in messages</dt>
        <dd>
            If selected, control properties as described below in chapter
            <i>Input</i> are ignored. This is useful if messages to be repeated
            contain properties with the same names as the control properties
            and hence prevents their misinterpretation.
        </dd>
    </dl>
    <h3>Input</h3>
    <p>
        The input message is forwarded as is but can also control the
        behavior of the node for that message if the following properties are
        existing.
    </p>
    <dl class="message-properties">
        <dt class="optional">stop<span class="property-type">any</span></dt>
        <dd>
            If present, message sending repetition is immediately stopped.
            The message containing this property is discarded.
        </dd>
        <dt class="optional">interval<span class="property-type">object</span></dt>
        <dd>
            Overrides the interval for message sending repetition, see below
            for details.
        </dd>
        <dt class="optional">until<span class="property-type">object</span></dt>
        <dd>
            Overrides the condition when message sending repetition should end,
            see below for details.
        </dd>
        <dt class="optional">ingress<span class="property-type">string</span></dt>
        <dd>
            Overrides the behavior upon message ingress. Possible values are
            "noop", "forward" and "forward:forced".
        </dd>
    </dl>
    <p>
        If a property called <code>interval</code> is present in the input
        message, the interval for repetition is overridden. The property must
        have the following content:
    </p>
    <dl class="message-properties">
        <dt>value<span class="property-type">number</span></dt>
        <dd>The duration of the interval</dd>
        <dt>unit<span class="property-type">string</span></dt>
        <dd>The unit for the interval duration, one of "seconds", "minutes" or "hours"</dd>
    </dl>
    <p>
        If a property called <code>until</code> is present in the input message,
        the condition when message sending repetition should end is overridden.
        The property may be <code>null</code>, in this case the repetition ends
        only upon reception of the next message. Otherwise the property must
        have the following content:
    </p>
    <dl class="message-properties">
        <dt>type<span class="property-type">string</span></dt>
        <dd>Ending time type; one of "time", "sun", "moon" or "custom"</dd>
        <dt>value<span class="property-type">string | number</span></dt>
        <dd>Ending time value; content is depending on ending time type</dd>
        <dt class="optional">date<span class="property-type">string</span></dt>
        <dd>Ending date in the form <code>YYYY-MM-DD</code></dd>
        <dt>offset<span class="property-type">number</span></dt>
        <dd>Offset to the ending time</dd>
        <dt>random<span class="property-type">boolean</span></dt>
        <dd>Randomized offset</dd>
    </dl>
    <h3>Outputs</h3>
    <p>
        Messages are sent to the output upon reception and periodically until
        the next message or a message with the property <code>stop</code> has
        been received. If configured, message sending repetition also ends when
        the ending time has been reached.
    </p>
</script>

</div><div><!-- --- [red-module:node-red-contrib-chronos/chronos-delay] --- -->
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-template-name="chronos-delay">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-config"><i class="fa fa-cog"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.config"></span></label>
        <input type="text" id="node-input-config" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.config">
    </div>
    <div class="form-row" style="padding-top: 4px;">
        <label for="node-input-when"><i class="fa fa-clock-o"></i> <span data-i18n="delay.label.when"></span></label>
        <input type="text" id="node-input-when" style="width: 70%;">
        <input id="node-input-whenType" type="hidden">
        <input id="node-input-whenValue" type="hidden">
    </div>
    <div class="form-row">
        <label for="node-input-offset"><i class="fa fa-arrows-h"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.offset"></span></label>
        <input id="node-input-offset" style="width: 60px !important;">
        <span style="padding-left: 10px;">
            <input id="node-input-random" type="checkbox" style="width: auto; margin-top: 0px; margin-bottom: 1px;">
            <label for="node-input-random" style="width: auto; margin-bottom: 0px;" data-i18n="node-red-contrib-chronos/chronos-config:common.label.random"></label>
        </span>
    </div>
    <div class="form-row" style="padding-top: 10px">
        <input id="node-input-preserveCtrlProps" type="checkbox" style="margin-top: 0px; margin-bottom: 1px; width: auto;">
        <label for="node-input-preserveCtrlProps" style="margin-bottom: 0px; width: auto;" data-i18n="node-red-contrib-chronos/chronos-config:common.label.preserveCtrlProps"></label>
    </div>
    <div class="form-row">
        <input id="node-input-ignoreCtrlProps" type="checkbox" style="margin-top: 0px; margin-bottom: 1px; width: auto;">
        <label for="node-input-ignoreCtrlProps" style="margin-bottom: 0px; width: auto;" data-i18n="node-red-contrib-chronos/chronos-config:common.label.ignoreCtrlProps"></label>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("chronos-delay",
    {
        category:     "chronos",
        color:        "#DEB887",
        icon:         "chronos_delay.svg",
        inputs:       1,
        outputs:      1,
        paletteLabel: "delay until",
        label: function()
        {
            let label = this._("delay.label.node");

            if (this.name)
            {
                label = this.name;
            }
            else if (this.whenType && this.whenValue)
            {
                if ((this.whenType == "time") || (this.whenType == "custom"))
                {
                    label = this.whenValue;
                }
                else
                {
                    label = this._("node-red-contrib-chronos/chronos-config:common.list." + this.whenType + "." + this.whenValue);
                }

                if (this.offset != 0)
                {
                    label += ((this.offset > 0) ? " + " : " - ");

                    if (this.random)
                    {
                        label += "~";
                    }

                    label += Math.abs(this.offset) + " " + this._("node-red-contrib-chronos/chronos-config:common.label.min");
                }
            }

            return label;
        },
        labelStyle: function()
        {
            return (this.name ? "node_label_italic" : "");
        },
        inputLabels: function()
        {
            return this._("node-red-contrib-chronos/chronos-config:common.label.inputPort");
        },
        outputLabels: function(index)
        {
            return this._("delay.label.outputPort");
        },
        defaults:
        {
            name:
            {
                value: ""
            },
            config:
            {
                value:    "",
                type:     "chronos-config",
                required: true
            },
            whenType:
            {
                value: "time"
            },
            whenValue:
            {
                value: ""
            },
            offset:
            {
                value: 0
            },
            random:
            {
                value: false
            },
            preserveCtrlProps:
            {
                value: false
            },
            ignoreCtrlProps:
            {
                value: false
            }
        },
        oneditprepare: function()
        {
            let node = this;

            const sunTimes =
            [
                {
                    value: "nightEnd",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nightEnd")
                },
                {
                    value: "nauticalDawn",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nauticalDawn")
                },
                {
                    value: "dawn",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.dawn")
                },
                {
                    value: "sunrise",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunrise")
                },
                {
                    value: "sunriseEnd",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunriseEnd")
                },
                {
                    value: "goldenHourEnd",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.goldenHourEnd")
                },
                {
                    value: "solarNoon",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.solarNoon")
                },
                {
                    value: "goldenHour",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.goldenHour")
                },
                {
                    value: "sunsetStart",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunsetStart")
                },
                {
                    value: "sunset",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunset")
                },
                {
                    value: "dusk",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.dusk")
                },
                {
                    value: "nauticalDusk",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nauticalDusk")
                },
                {
                    value: "night",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.night")
                },
                {
                    value: "nadir",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nadir")
                }
            ];

            const moonTimes =
            [
                {
                    value: "rise",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.moon.rise")
                },
                {
                    value: "set",
                    label: node._("node-red-contrib-chronos/chronos-config:common.list.moon.set")
                }
            ];

            const timeInput =
            {
                value: "time",
                label: node._("node-red-contrib-chronos/chronos-config:common.label.time"),
                icon: "fa fa-clock-o",
                hasValue: true,
                validate: /^(\d|0\d|1\d|2[0-3]):([0-5]\d)(:([0-5]\d))?\s*(am|AM|pm|PM)?$/
            };

            const sunTimeInput =
            {
                value: "sun",
                label: node._("node-red-contrib-chronos/chronos-config:common.label.sun"),
                icon: "fa fa-sun-o",
                options: sunTimes
            };

            const moonTimeInput =
            {
                value: "moon",
                label: node._("node-red-contrib-chronos/chronos-config:common.label.moon"),
                icon: "fa fa-moon-o",
                options: moonTimes
            };

            const customInput =
            {
                value: "custom",
                label: node._("node-red-contrib-chronos/chronos-config:common.label.custom"),
                icon: "fa fa-wrench",
                hasValue: true,
                validate: /^[a-zA-Z][0-9a-zA-Z_]*$/
            };

            const offsetInput =
            {
                min: -300,
                max: 300,
                step: 5,
                change: function(event, ui)
                {
                    var value = parseInt($(this).spinner("value"), 10);
                    var min = $(this).spinner("option", "min");
                    var max = $(this).spinner("option", "max");
                    if (isNaN(value) ||
                        (value < min))
                    {
                        $(this).spinner("value", min);
                    }
                    else if (value > max)
                    {
                        $(this).spinner("value", max);
                    }
                }
            };

            let when = $("#node-input-when")
                            .typedInput({types: [timeInput, sunTimeInput, moonTimeInput, customInput], typeField: $("#node-input-whenType")});
            let offset = $("#node-input-offset")
                            .spinner(offsetInput);

            when.typedInput("value", $("#node-input-whenValue").val());
        },
        oneditsave: function()
        {
            $("#node-input-whenValue").val($("#node-input-when").typedInput("value"));
        }
    });
</script>
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-help-name="chronos-delay">
    <p>
        Delays each message passing through the node until a specific time
        is reached.
    </p>
    <h3>Details</h3>
    <p>
        This node queues incoming messages until a specific time is reached,
        which can be either manually entered or based on sun or moon position.
        When that time has been reached, all messages in the queue are forwarded
        to the output of the node.
    </p>
    <p>
        For more information, please refer to the detailed documentation in the
        <a href="https://github.com/jensrossbach/node-red-contrib-chronos/wiki/Delay-Until-Node">repository wiki</a>.
    </p>
    <h3>Configuration</h3>
    <dl>
        <dt>Name</dt>
        <dd>The name of the node (optional).</dd>
        <dt>Configuration</dt>
        <dd>
            A reference to the configuration node to be used.
        </dd>
        <dt>When</dt>
        <dd>
            The target time when queued messages should be forwarded. Depending
            on the selection on the left side, the following possibilities are
            available:
            <ul>
                <li>
                    <i>time of day</i>: A specific time can be entered directly in the
                    form <code>hh:mm[:ss] [am|pm]</code>.
                </li>
                <li>
                    <i>sun position</i>: The sun position can be selected from a list
                    of predefined values.
                </li>
                <li>
                    <i>moon position</i>: The moon position can be selected from a list
                    of predefined values.
                </li>
                <li>
                    <i>custom sun position</i>: One of the user-defined sun position names can be
                    entered.
                </li>
            </ul>
        </dd>
        <dt>Offset</dt>
        <dd>
            An offset between -300 and +300 can be specified in minutes. The offset
            will be added to or subtracted from the target time.
        </dd>
        <dt>Randomized</dt>
        <dd>
            When selected, the offset will be randomized between 0 and the
            specified value.
        </dd>
        <dt>Preserve control properties in messages</dt>
        <dd>
            If selected, control properties as described below in chapter
            <i>Input</i> are not deleted from input messages and hence still
            be present in the messages when they are sent to the output port.
        </dd>
        <dt>Ignore control properties in messages</dt>
        <dd>
            If selected, control properties as described below in chapter
            <i>Input</i> are ignored. This is useful if messages to be delayed
            contain properties with the same names as the control properties
            and hence prevents their misinterpretation.
        </dd>
    </dl>
    <h3>Input</h3>
    <p>
        The input message is forwarded as is but can also control the queueing
        behavior of the node if the following properties are existing.
    </p>
    <dl class="message-properties">
        <dt class="optional">drop<span class="property-type">any</span></dt>
        <dd>
            If present, all message in the queue are dropped without being
            sent out.
        </dd>
        <dt class="optional">flush<span class="property-type">any</span></dt>
        <dd>
            If present, all message in the queue are immediately being sent
            out.
        </dd>
        <dt class="optional">enqueue<span class="property-type">any</span></dt>
        <dd>
            Can be combined with either of the above properties. If present,
            this message will be enqueued after dropping/flushing.
        </dd>
        <dt class="optional">when<span class="property-type">object</span></dt>
        <dd>
            Overrides the target time when queued messages should be forwarded,
            see below for details.
        </dd>
    </dl>
    <p>
        If a property called <code>when</code> is present in the input message,
        the target time for forwarding all currently and later enqueued messages
        is overridden. The property must have the following content:
    </p>
    <dl class="message-properties">
        <dt>type<span class="property-type">string</span></dt>
        <dd>Target time type; one of "time", "sun", "moon" or "custom"</dd>
        <dt>value<span class="property-type">string | number</span></dt>
        <dd>Target time value; content is depending on target time type</dd>
        <dt>offset<span class="property-type">number</span></dt>
        <dd>Offset to the target time</dd>
        <dt>random<span class="property-type">boolean</span></dt>
        <dd>Randomized offset</dd>
    </dl>
    <h3>Outputs</h3>
    <p>
        Delayed messages are sent to the output when the target time has been
        reached or when a message with the <code>flush</code> property is
        received. If a message with the <code>drop</code> property is received,
        the messages are discarded.
    </p>
</script>

</div><div><!-- --- [red-module:node-red-contrib-chronos/chronos-switch] --- -->
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-template-name="chronos-switch">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-config"><i class="fa fa-cog"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.config"></span></label>
        <input type="text" id="node-input-config" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.config">
    </div>
    <div class="form-row" style="padding-top: 4px;">
        <label for="node-input-baseTime"><i class="fa fa-clock-o"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.baseTime"></span></label>
        <input type="text" id="node-input-baseTime" style="width: 70%;">
        <input id="node-input-baseTimeType" type="hidden">
    </div>
    <div class="form-row node-input-conditionList-row" style="padding-top: 10px">
        <label for="node-input-conditionList"><i class="fa fa-sliders"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.conditions"></span></label>
        <div class="form-row">
            <ol id="node-input-conditionList"></ol>
        </div>
    </div>
    <div class="form-row">
        <input id="node-input-stopOnFirstMatch" type="checkbox" style="margin-top: 0px; margin-bottom: 1px; width: auto;">
        <label for="node-input-stopOnFirstMatch" style="margin-bottom: 0px; width: auto;" data-i18n="switch.label.stopOnFirstMatch"></label>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("chronos-switch",
    {
        category:     "chronos",
        color:        "#DEB887",
        icon:         "chronos_switch.svg",
        inputs:       1,
        outputs:      1,
        paletteLabel: "time switch",
        label: function()
        {
            return (this.name || this._("switch.label.node"));
        },
        labelStyle: function()
        {
            return (this.name ? "node_label_italic" : "");
        },
        inputLabels: function()
        {
            return this._("node-red-contrib-chronos/chronos-config:common.label.inputPort");
        },
        outputLabels: function(index)
        {
            return this.conditions[index].label;
        },
        defaults:
        {
            name:
            {
                value: ""
            },
            config:
            {
                value:    "",
                type:     "chronos-config",
                required: true
            },
            baseTime:
            {
                value:    "",
                validate: RED.validators.typedInput("baseTimeType")
            },
            baseTimeType:
            {
                value: "msgIngress"
            },
            conditions:
            {
                value: [{operator: "before", operands: {type: "time", value: "", offset: 0, random: false}, label: ""}],
                validate: function(v)
                {
                    // just a simple check if there are any conditions, no detailed check of the content
                    return v.length > 0;
                }
            },
            stopOnFirstMatch:
            {
                value: false
            },
            outputs:
            {
                value: 1
            }
        },
        oneditprepare: function()
        {
            let node = this;

            const msgIngressInput =
            {
                value: "msgIngress",
                label: node._("node-red-contrib-chronos/chronos-config:common.label.msgIngress"),
                hasValue: false
            };

            let baseTime = $("#node-input-baseTime")
                            .typedInput({types: [msgIngressInput, "global", "flow", "msg"], typeField: "#node-input-baseTimeType"});

            let conditionList = $("#node-input-conditionList").css("min-width", "510px").css("min-height", "150px").editableList(
            {
                removable: true,
                sortable: true,
                addItem: function(item, index, data)
                {
                    const sunTimes =
                    [
                        {
                            value: "nightEnd",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nightEnd")
                        },
                        {
                            value: "nauticalDawn",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nauticalDawn")
                        },
                        {
                            value: "dawn",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.dawn")
                        },
                        {
                            value: "sunrise",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunrise")
                        },
                        {
                            value: "sunriseEnd",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunriseEnd")
                        },
                        {
                            value: "goldenHourEnd",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.goldenHourEnd")
                        },
                        {
                            value: "solarNoon",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.solarNoon")
                        },
                        {
                            value: "goldenHour",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.goldenHour")
                        },
                        {
                            value: "sunsetStart",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunsetStart")
                        },
                        {
                            value: "sunset",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunset")
                        },
                        {
                            value: "dusk",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.dusk")
                        },
                        {
                            value: "nauticalDusk",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nauticalDusk")
                        },
                        {
                            value: "night",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.night")
                        },
                        {
                            value: "nadir",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nadir")
                        }
                    ];

                    const moonTimes =
                    [
                        {
                            value: "rise",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.moon.rise")
                        },
                        {
                            value: "set",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.moon.set")
                        }
                    ];

                    const timeInput =
                    {
                        value: "time",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.time"),
                        icon: "fa fa-clock-o",
                        hasValue: true,
                        validate: /^(\d|0\d|1\d|2[0-3]):([0-5]\d)(:([0-5]\d))?\s*(am|AM|pm|PM)?$/
                    };

                    const sunTimeInput =
                    {
                        value: "sun",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.sun"),
                        icon: "fa fa-sun-o",
                        options: sunTimes
                    };

                    const moonTimeInput =
                    {
                        value: "moon",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.moon"),
                        icon: "fa fa-moon-o",
                        options: moonTimes
                    };

                    const customInput =
                    {
                        value: "custom",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.custom"),
                        icon: "fa fa-wrench",
                        hasValue: true,
                        validate: /^[a-zA-Z][0-9a-zA-Z_]*$/
                    };

                    const validateInput = function(event, ui)
                    {
                        var value = parseInt($(this).spinner("value"), 10);
                        var min = $(this).spinner("option", "min");
                        var max = $(this).spinner("option", "max");
                        if (isNaN(value) ||
                            (value < min))
                        {
                            $(this).spinner("value", min);
                        }
                        else if (value > max)
                        {
                            $(this).spinner("value", max);
                        }
                    };

                    const offsetInput =
                    {
                        min: -300,
                        max: 300,
                        step: 5,
                        change: validateInput
                    };

                    const fixedDayInput =
                    {
                        min: 1,
                        max: 31,
                        step: 1,
                        change: validateInput
                    };

                    let fragment = document.createDocumentFragment();
                    let operatorBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto;"}).appendTo(fragment);
                    let timeBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 2px;"}).appendTo(fragment);
                    let daysBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 2px;"}).appendTo(fragment);
                    let weekdaysBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 2px;"}).appendTo(fragment);
                    let monthsBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 2px;"}).appendTo(fragment);
                    let expressionBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 6px;"}).appendTo(fragment);
                    let contextBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 6px;"}).appendTo(fragment);
                    $("<div/>", {class: "node-input-index", style: "position: absolute; width: auto; top: 50%; right: 26px; margin-top: -9px;"})
                                        .html("&#8594; " + (index + 1))
                                        .appendTo(fragment);

                    let operator = $("<select/>", {class: "node-input-operator", style: "width: 120px;"})
                                        .appendTo(operatorBox);
                    let operGrp = $("<optgroup></optgroup>").attr("label", node._("node-red-contrib-chronos/chronos-config:common.list.condition.operators"))
                                        .append($("<option></option>").val("before").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.before")))
                                        .append($("<option></option>").val("after").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.after")))
                                        .append($("<option></option>").val("between").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.between")))
                                        .append($("<option></option>").val("outside").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.outside")))
                                        .append($("<option></option>").val("days").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.days")))
                                        .append($("<option></option>").val("weekdays").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.weekdays")))
                                        .append($("<option></option>").val("months").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.months")))
                                        .append($("<option></option>").val("otherwise").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.otherwise")))
                                        .appendTo(operator);
                    let fromGrp = $("<optgroup></optgroup>").attr("label", node._("node-red-contrib-chronos/chronos-config:common.list.condition.sources"))
                                        .append($("<option></option>").val("expression").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.source.expression")))
                                        .append($("<option></option>").val("context").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.source.context")))
                                        .appendTo(operator);

                    let time1Box = $("<div/>", {style: "margin-left: 4px;"}).appendTo(timeBox);
                    let time2Box = $("<div/>", {style: "margin-left: 4px; margin-top: 5px;"}).appendTo(timeBox);
                    let time1Row1 = $("<div/>").appendTo(time1Box);
                    let time1Row2 = $("<div/>", {style: "margin-top: 5px;"}).appendTo(time1Box);
                    let time2Row1 = $("<div/>").appendTo(time2Box);
                    let time2Row2 = $("<div/>", {style: "margin-top: 5px;"}).appendTo(time2Box);
                    let monthsRow1 = $("<div/>").appendTo(monthsBox);
                    let monthsRow2 = $("<div/>", {style: "margin-top: 5px;"}).appendTo(monthsBox);
                    let monthsRow3 = $("<div/>", {style: "margin-top: 5px;"}).appendTo(monthsBox);

                    let time1 = $("<input/>", {type: "text", class: "node-input-time1"})
                                        .appendTo(time1Row1)
                                        .typedInput({types: [timeInput, sunTimeInput, moonTimeInput, customInput]});
                    time1.typedInput("width", "280px");
                    time1._prevType = "time";
                    let extend1 = $("<a/>", {href: "#", style: "margin-left: 6px;"})
                                        .html("<i class='fa fa-angle-double-down' aria-hidden='true'></i>")
                                        .appendTo(time1Row1);

                    let time2 = $("<input/>", {type: "text", class: "node-input-time2"})
                                        .appendTo(time2Row1)
                                        .typedInput({types: [timeInput, sunTimeInput, moonTimeInput, customInput]});
                    time2.typedInput("width", "280px");
                    time2._prevType = "time";
                    let extend2 = $("<a/>", {href: "#", style: "margin-left: 6px;"})
                                        .html("<i class='fa fa-angle-double-down' aria-hidden='true'></i>")
                                        .appendTo(time2Row1);

                    $("<label/>", {style: "width: auto; margin-right: 6px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.label.offset"))
                                        .appendTo(time1Row2);
                    let offset1 = $("<input/>", {class: "node-input-offset1", style: "width: 50px !important;"})
                                        .appendTo(time1Row2)
                                        .spinner(offsetInput);
                    let random1 = $("<input/>", {type: "checkbox", class: "node-input-random1", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(time1Row2);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.label.random"))
                                        .appendTo(time1Row2);

                    $("<label/>", {style: "width: auto; margin-right: 6px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.label.offset"))
                                        .appendTo(time2Row2);
                    let offset2 = $("<input/>", {class: "node-input-offset2", style: "width: 50px !important;"})
                                        .appendTo(time2Row2)
                                        .spinner(offsetInput);
                    let random2 = $("<input/>", {type: "checkbox", class: "node-input-random2", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(time2Row2);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.label.random"))
                                        .appendTo(time2Row2);

                    let dayType = $("<select/>", {class: "node-input-dayType", style: "width: auto; margin-left: 4px;"})
                                        .append($("<option></option>").val("first").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.first")))
                                        .append($("<option></option>").val("second").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.second")))
                                        .append($("<option></option>").val("third").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.third")))
                                        .append($("<option></option>").val("fourth").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.fourth")))
                                        .append($("<option></option>").val("fifth").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.fifth")))
                                        .append($("<option></option>").val("last").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.last")))
                                        .append($("<option></option>").val("even").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.even")))
                                        .append($("<option></option>").val("specific").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.specific")))
                                        .appendTo(daysBox);
                    let nthDaysBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 6px;"}).appendTo(daysBox);
                    let specificDaysBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 6px;"}).appendTo(daysBox);
                    let day = $("<select/>", {class: "node-input-day", style: "width: auto;"})
                                        .append($("<option></option>").val("monday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.monday")))
                                        .append($("<option></option>").val("tuesday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.tuesday")))
                                        .append($("<option></option>").val("wednesday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.wednesday")))
                                        .append($("<option></option>").val("thursday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.thursday")))
                                        .append($("<option></option>").val("friday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.friday")))
                                        .append($("<option></option>").val("saturday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.saturday")))
                                        .append($("<option></option>").val("sunday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.sunday")))
                                        .append($("<option></option>").val("day").text(node._("node-red-contrib-chronos/chronos-config:common.list.day.day")))
                                        .append($("<option></option>").val("workday").text(node._("node-red-contrib-chronos/chronos-config:common.list.day.workday")))
                                        .append($("<option></option>").val("weekend").text(node._("node-red-contrib-chronos/chronos-config:common.list.day.weekend")))
                                        .appendTo(nthDaysBox);
                    let fixedDay = $("<input/>", {class: "node-input-fixedDay", style: "width: 30px !important;"})
                                        .appendTo(specificDaysBox)
                                        .spinner(fixedDayInput);
                    let fixedMonth = $("<select/>", {class: "node-input-fixedMonth", style: "width: auto; margin-left: 6px;"})
                                        .append($("<option></option>").val("january").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.january")))
                                        .append($("<option></option>").val("february").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.february")))
                                        .append($("<option></option>").val("march").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.march")))
                                        .append($("<option></option>").val("april").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.april")))
                                        .append($("<option></option>").val("may").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.may")))
                                        .append($("<option></option>").val("june").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.june")))
                                        .append($("<option></option>").val("july").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.july")))
                                        .append($("<option></option>").val("august").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.august")))
                                        .append($("<option></option>").val("september").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.september")))
                                        .append($("<option></option>").val("october").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.october")))
                                        .append($("<option></option>").val("november").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.november")))
                                        .append($("<option></option>").val("december").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.december")))
                                        .append($("<option></option>").val("any").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.any")))
                                        .appendTo(specificDaysBox);
                    let excludeLabel = $("<label/>", {title: node._("node-red-contrib-chronos/chronos-config:common.label.exclude"), style: "width: auto; margin-left: 10px; margin-bottom: 0px;"})
                                        .html("<i class='fa fa-ban' aria-hidden='true'></i>")
                                        .appendTo(daysBox);
                    let exclude = $("<input/>", {type: "checkbox", class: "node-input-exclude", style: "width: auto; margin-left: 4px; margin-top: 0px; margin-bottom: 3px;"})
                                        .appendTo(excludeLabel);

                    let monday = $("<input/>", {type: "checkbox", class: "node-input-monday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.monday")).appendTo(weekdaysBox);
                    let tuesday = $("<input/>", {type: "checkbox", class: "node-input-tuesday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.tuesday")).appendTo(weekdaysBox);
                    let wednesday = $("<input/>", {type: "checkbox", class: "node-input-wednesday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.wednesday")).appendTo(weekdaysBox);
                    let thursday = $("<input/>", {type: "checkbox", class: "node-input-thursday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.thursday")).appendTo(weekdaysBox);
                    let friday = $("<input/>", {type: "checkbox", class: "node-input-friday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.friday")).appendTo(weekdaysBox);
                    let saturday = $("<input/>", {type: "checkbox", class: "node-input-saturday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.saturday")).appendTo(weekdaysBox);
                    let sunday = $("<input/>", {type: "checkbox", class: "node-input-sunday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.sunday")).appendTo(weekdaysBox);

                    let january = $("<input/>", {type: "checkbox", class: "node-input-january", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow1);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.january")).appendTo(monthsRow1);
                    let february = $("<input/>", {type: "checkbox", class: "node-input-february", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow1);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.february")).appendTo(monthsRow1);
                    let march = $("<input/>", {type: "checkbox", class: "node-input-march", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow1);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.march")).appendTo(monthsRow1);
                    let april = $("<input/>", {type: "checkbox", class: "node-input-april", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow1);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.april")).appendTo(monthsRow1);
                    let may = $("<input/>", {type: "checkbox", class: "node-input-may", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow2);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.may")).appendTo(monthsRow2);
                    let june = $("<input/>", {type: "checkbox", class: "node-input-june", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow2);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.june")).appendTo(monthsRow2);
                    let july = $("<input/>", {type: "checkbox", class: "node-input-july", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow2);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.july")).appendTo(monthsRow2);
                    let august = $("<input/>", {type: "checkbox", class: "node-input-august", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow2);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.august")).appendTo(monthsRow2);
                    let september = $("<input/>", {type: "checkbox", class: "node-input-september", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow3);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.september")).appendTo(monthsRow3);
                    let october = $("<input/>", {type: "checkbox", class: "node-input-october", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow3);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.october")).appendTo(monthsRow3);
                    let november = $("<input/>", {type: "checkbox", class: "node-input-november", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow3);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.november")).appendTo(monthsRow3);
                    let december = $("<input/>", {type: "checkbox", class: "node-input-december", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow3);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.december")).appendTo(monthsRow3);

                    let expression = $("<input/>", {type: "text", class: "node-input-expression"})
                                        .appendTo(expressionBox)
                                        .typedInput({types: ["jsonata"]});
                    expression.typedInput("width", "280px");

                    let context = $("<input/>", {type: "text", class: "node-input-context"})
                                        .appendTo(contextBox)
                                        .typedInput({types: ["global", "flow"]});
                    context.typedInput("width", "280px");

                    operator.change(function()
                    {
                        timeBox.hide();
                        time2Box.hide();
                        daysBox.hide();
                        weekdaysBox.hide();
                        monthsBox.hide();
                        expressionBox.hide();
                        contextBox.hide();

                        var value = $(this).val();
                        switch (value)
                        {
                            case "before":
                            case "after":
                            {
                                timeBox.show();
                                break;
                            }
                            case "between":
                            case "outside":
                            {
                                timeBox.show();
                                time2Box.show();
                                break;
                            }
                            case "days":
                            {
                                daysBox.show();
                                break;
                            }
                            case "weekdays":
                            {
                                weekdaysBox.show();
                                break;
                            }
                            case "months":
                            {
                                monthsBox.show();
                                break;
                            }
                            case "expression":
                            {
                                expressionBox.show();
                                break;
                            }
                            case "context":
                            {
                                contextBox.show();
                                break;
                            }
                        }
                    });

                    time1.on("change", function()
                    {
                        let type = time1.typedInput("type");

                        if (type != time1._prevType)
                        {
                            time1._prevType = type;
                            if ((type != "sun") && (type != "moon"))
                            {
                                time1.typedInput("value", "");
                            }
                        }
                    });

                    time2.on("change", function()
                    {
                        let type = time2.typedInput("type");

                        if (type != time2._prevType)
                        {
                            time2._prevType = type;
                            if ((type != "sun") && (type != "moon"))
                            {
                                time2.typedInput("value", "");
                            }
                        }
                    });

                    function showExtensionRow1()
                    {
                        time1Row2.show();
                        extend1.html("<i class='fa fa-angle-double-up' aria-hidden='true'></i>");
                    }

                    function hideExtensionRow1()
                    {
                        time1Row2.hide();
                        extend1.html("<i class='fa fa-angle-double-down' aria-hidden='true'></i>");

                        offset1.spinner("value", 0);
                        random1.prop("checked", false);
                    }

                    function showExtensionRow2()
                    {
                        time2Row2.show();
                        extend2.html("<i class='fa fa-angle-double-up' aria-hidden='true'></i>");
                    }

                    function hideExtensionRow2()
                    {
                        time2Row2.hide();
                        extend2.html("<i class='fa fa-angle-double-down' aria-hidden='true'></i>");

                        offset2.spinner("value", 0);
                        random2.prop("checked", false);
                    }

                    extend1.click(function()
                    {
                        if (time1Row2.is(":hidden"))
                        {
                            showExtensionRow1();
                        }
                        else
                        {
                            hideExtensionRow1();
                        }
                    });

                    extend2.click(function()
                    {
                        if (time2Row2.is(":hidden"))
                        {
                            showExtensionRow2();
                        }
                        else
                        {
                            hideExtensionRow2();
                        }
                    });

                    hideExtensionRow1();
                    hideExtensionRow2();

                    dayType.change(function()
                    {
                        nthDaysBox.hide();
                        specificDaysBox.hide();

                        let value = $(this).val();
                        if (value == "specific")
                        {
                            specificDaysBox.show();
                        }
                        else if (value != "even")
                        {
                            let val = day.val();
                            day.children("option[value='day']").remove();
                            day.children("option[value='workday']").remove();
                            day.children("option[value='weekend']").remove();

                            if ((value == "first") || (value == "last"))
                            {
                                day.append($("<option></option>").val("day").text(node._("node-red-contrib-chronos/chronos-config:common.list.day.day")));
                                day.append($("<option></option>").val("workday").text(node._("node-red-contrib-chronos/chronos-config:common.list.day.workday")));
                                day.append($("<option></option>").val("weekend").text(node._("node-red-contrib-chronos/chronos-config:common.list.day.weekend")));
                                day.val(val);
                            }

                            nthDaysBox.show();
                        }
                    });

                    fixedMonth.change(function()
                    {
                        let value = $(this).val();
                        switch (value)
                        {
                            case "january":
                            case "march":
                            case "may":
                            case "july":
                            case "august":
                            case "october":
                            case "december":
                            case "any":
                            {
                                fixedDay.spinner("option", "max", 31);
                                break;
                            }
                            case "february":
                            {
                                fixedDay.spinner("option", "max", 29);
                                break;
                            }
                            case "april":
                            case "june":
                            case "september":
                            case "november":
                            {
                                fixedDay.spinner("option", "max", 30);
                                break;
                            }
                        }

                        validateInput.call(fixedDay);
                    });

                    if (!("operator" in data))
                    {
                        data = {operator: "before", operands: {type: "time", value: "", offset: 0, random: false}, label: ""};
                    }

                    // initial value
                    fixedDay.spinner("value", 1);

                    operator.val(data.operator);

                    if ((data.operator == "before") || (data.operator == "after"))
                    {
                        time1._prevType = data.operands.type;
                        time1.typedInput("type", data.operands.type);
                        time1.typedInput("value", data.operands.value);
                        if (data.operands.offset &&  // backwards compatibility to v1.0.2
                            (data.operands.offset != 0))
                        {
                            offset1.spinner("value", data.operands.offset);
                            random1.prop("checked", data.operands.random);
                            showExtensionRow1();
                        }
                    }
                    else if ((data.operator == "between") || (data.operator == "outside"))
                    {
                        time1._prevType = data.operands[0].type;
                        time1.typedInput("type", data.operands[0].type);
                        time1.typedInput("value", data.operands[0].value);
                        time2._prevType = data.operands[1].type;
                        time2.typedInput("type", data.operands[1].type);
                        time2.typedInput("value", data.operands[1].value);
                        if (data.operands[0].offset &&  // backwards compatibility to v1.0.2
                            (data.operands[0].offset != 0))
                        {
                            offset1.spinner("value", data.operands[0].offset);
                            random1.prop("checked", data.operands[0].random);
                            showExtensionRow1();
                        }
                        if (data.operands[1].offset &&  // backwards compatibility to v1.0.2
                            (data.operands[1].offset != 0))
                        {
                            offset2.spinner("value", data.operands[1].offset);
                            random2.prop("checked", data.operands[1].random);
                            showExtensionRow2();
                        }
                    }
                    else if (data.operator == "days")
                    {
                        dayType.val(data.operands.type);

                        if (data.operands.type == "specific")
                        {
                            fixedDay.spinner("value", data.operands.day);
                            fixedMonth.val(data.operands.month);
                        }
                        else if (data.operands.type != "even")
                        {
                            day.val(data.operands.day);
                        }

                        exclude.prop("checked", data.operands.exclude);
                    }
                    else if (data.operator == "weekdays")
                    {
                        sunday.prop("checked", data.operands[0]);
                        monday.prop("checked", data.operands[1]);
                        tuesday.prop("checked", data.operands[2]);
                        wednesday.prop("checked", data.operands[3]);
                        thursday.prop("checked", data.operands[4]);
                        friday.prop("checked", data.operands[5]);
                        saturday.prop("checked", data.operands[6]);
                    }
                    else if (data.operator == "months")
                    {
                        january.prop("checked", data.operands[0]);
                        february.prop("checked", data.operands[1]);
                        march.prop("checked", data.operands[2]);
                        april.prop("checked", data.operands[3]);
                        may.prop("checked", data.operands[4]);
                        june.prop("checked", data.operands[5]);
                        july.prop("checked", data.operands[6]);
                        august.prop("checked", data.operands[7]);
                        september.prop("checked", data.operands[8]);
                        october.prop("checked", data.operands[9]);
                        november.prop("checked", data.operands[10]);
                        december.prop("checked", data.operands[11]);
                    }
                    else if (data.operator == "expression")
                    {
                        expression.typedInput("value", data.expression);
                        expression.typedInput("type", "jsonata");
                    }
                    else if (data.operator == "context")
                    {
                        context.typedInput("value", data.context.value);
                        context.typedInput("type", data.context.type);
                    }

                    operator.change();
                    dayType.change();
                    item[0].appendChild(fragment);
                },
                removeItem: function(item)
                {
                    let conditionList = $("#node-input-conditionList").editableList("items");
                    conditionList.each(function(index)
                    {
                        $(this).find(".node-input-index").html("&#8594; " + (index + 1));
                    });
                },
                sortItems: function(items)
                {
                    items.each(function(index)
                    {
                        $(this).find(".node-input-index").html("&#8594; " + (index + 1));
                    });
                }
            });

            node.conditions.forEach(data =>
            {
                conditionList.editableList("addItem", data);
            });
        },
        oneditsave: function()
        {
            let node = this;

            const WEEKDAYS =
            [
                node._("node-red-contrib-chronos/chronos-config:common.list.weekday.sunday"),
                node._("node-red-contrib-chronos/chronos-config:common.list.weekday.monday"),
                node._("node-red-contrib-chronos/chronos-config:common.list.weekday.tuesday"),
                node._("node-red-contrib-chronos/chronos-config:common.list.weekday.wednesday"),
                node._("node-red-contrib-chronos/chronos-config:common.list.weekday.thursday"),
                node._("node-red-contrib-chronos/chronos-config:common.list.weekday.friday"),
                node._("node-red-contrib-chronos/chronos-config:common.list.weekday.saturday")
            ];

            const MONTHS =
            [
                node._("node-red-contrib-chronos/chronos-config:common.list.month.january"),
                node._("node-red-contrib-chronos/chronos-config:common.list.month.february"),
                node._("node-red-contrib-chronos/chronos-config:common.list.month.march"),
                node._("node-red-contrib-chronos/chronos-config:common.list.month.april"),
                node._("node-red-contrib-chronos/chronos-config:common.list.month.may"),
                node._("node-red-contrib-chronos/chronos-config:common.list.month.june"),
                node._("node-red-contrib-chronos/chronos-config:common.list.month.july"),
                node._("node-red-contrib-chronos/chronos-config:common.list.month.august"),
                node._("node-red-contrib-chronos/chronos-config:common.list.month.september"),
                node._("node-red-contrib-chronos/chronos-config:common.list.month.october"),
                node._("node-red-contrib-chronos/chronos-config:common.list.month.november"),
                node._("node-red-contrib-chronos/chronos-config:common.list.month.december")
            ];

            let conditionList = $("#node-input-conditionList").editableList("items");
            node.conditions = [];
            node.outputs = 0;

            conditionList.each(function(index)
            {
                let data = {};

                let operator = $(this).find(".node-input-operator");
                let time1 = $(this).find(".node-input-time1");
                let time2 = $(this).find(".node-input-time2");
                let offset1 = $(this).find(".node-input-offset1");
                let offset2 = $(this).find(".node-input-offset2");
                let random1 = $(this).find(".node-input-random1");
                let random2 = $(this).find(".node-input-random2");
                let dayType = $(this).find(".node-input-dayType");
                let day = $(this).find(".node-input-day");
                let fixedDay = $(this).find(".node-input-fixedDay");
                let fixedMonth = $(this).find(".node-input-fixedMonth");
                let exclude = $(this).find(".node-input-exclude");
                let monday = $(this).find(".node-input-monday");
                let tuesday = $(this).find(".node-input-tuesday");
                let wednesday = $(this).find(".node-input-wednesday");
                let thursday = $(this).find(".node-input-thursday");
                let friday = $(this).find(".node-input-friday");
                let saturday = $(this).find(".node-input-saturday");
                let sunday = $(this).find(".node-input-sunday");
                let january = $(this).find(".node-input-january");
                let february = $(this).find(".node-input-february");
                let march = $(this).find(".node-input-march");
                let april = $(this).find(".node-input-april");
                let may = $(this).find(".node-input-may");
                let june = $(this).find(".node-input-june");
                let july = $(this).find(".node-input-july");
                let august = $(this).find(".node-input-august");
                let september = $(this).find(".node-input-september");
                let october = $(this).find(".node-input-october");
                let november = $(this).find(".node-input-november");
                let december = $(this).find(".node-input-december");
                let expression = $(this).find(".node-input-expression");
                let context = $(this).find(".node-input-context");

                data.operator = operator.val();
                data.label = node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator." + data.operator);

                if ((data.operator == "before") || (data.operator == "after"))
                {
                    data.operands = {};
                    data.operands.type = time1.typedInput("type");
                    data.operands.value = time1.typedInput("value");
                    data.operands.offset = offset1.spinner("value");
                    data.operands.random = random1.prop("checked");

                    if ((data.operands.type == "time") || (data.operands.type == "custom"))
                    {
                        data.label += " " + data.operands.value;
                    }
                    else
                    {
                        data.label += " " + node._("node-red-contrib-chronos/chronos-config:common.list." + data.operands.type + "." + data.operands.value);
                    }
                }
                else if ((data.operator == "between") || (data.operator == "outside"))
                {
                    data.operands = [{}, {}];
                    data.operands[0].type = time1.typedInput("type");
                    data.operands[0].value = time1.typedInput("value");
                    data.operands[0].offset = offset1.spinner("value");
                    data.operands[0].random = random1.prop("checked");
                    data.operands[1].type = time2.typedInput("type");
                    data.operands[1].value = time2.typedInput("value");
                    data.operands[1].offset = offset2.spinner("value");
                    data.operands[1].random = random2.prop("checked");

                    data.label += " ";
                    if ((data.operands[0].type == "time") || (data.operands[0].type == "custom"))
                    {
                        data.label += data.operands[0].value;
                    }
                    else
                    {
                        data.label += node._("node-red-contrib-chronos/chronos-config:common.list." + data.operands[0].type + "." + data.operands[0].value);
                    }
                    data.label += " " + node._("switch.label.and") + " ";
                    if ((data.operands[1].type == "time") || (data.operands[1].type == "custom"))
                    {
                        data.label += data.operands[1].value;
                    }
                    else
                    {
                        data.label += node._("node-red-contrib-chronos/chronos-config:common.list." + data.operands[1].type + "." + data.operands[1].value);
                    }
                }
                else if (data.operator == "days")
                {
                    data.operands = {};
                    data.operands.type = dayType.val();

                    data.label = exclude.prop("checked") ? node._("switch.label.not") + " " : "";

                    if (data.operands.type == "specific")
                    {
                        data.operands.day = fixedDay.spinner("value");
                        data.operands.month = fixedMonth.val();

                        data.label += data.operands.day + ". ";
                        if (data.operands.month == "any")
                        {
                            data.label += node._("switch.label.everyMonth");
                        }
                        else
                        {
                            data.label += node._("node-red-contrib-chronos/chronos-config:common.list.month." + data.operands.month);
                        }
                    }
                    else if (data.operands.type == "even")
                    {
                        data.label += node._("node-red-contrib-chronos/chronos-config:common.list.dayType.even");
                    }
                    else
                    {
                        data.operands.day = day.val();

                        data.label += node._("node-red-contrib-chronos/chronos-config:common.list.dayType." + data.operands.type) + " ";
                        if ((data.operands.day == "day") || (data.operands.day == "workday") || (data.operands.day == "weekend"))
                        {
                            data.label += node._("node-red-contrib-chronos/chronos-config:common.list.day." + data.operands.day);
                        }
                        else
                        {
                            data.label += node._("node-red-contrib-chronos/chronos-config:common.list.weekday." + data.operands.day);
                        }
                    }

                    data.operands.exclude = exclude.prop("checked");
                }
                else if (data.operator == "weekdays")
                {
                    data.operands = [false, false, false, false, false, false, false];
                    data.operands[0] = sunday.prop("checked");
                    data.operands[1] = monday.prop("checked");
                    data.operands[2] = tuesday.prop("checked");
                    data.operands[3] = wednesday.prop("checked");
                    data.operands[4] = thursday.prop("checked");
                    data.operands[5] = friday.prop("checked");
                    data.operands[6] = saturday.prop("checked");

                    for (let i=0; i<7; ++i)
                    {
                        if (data.operands[i])
                        {
                            data.label += " " + WEEKDAYS[i];
                        }
                    }
                }
                else if (data.operator == "months")
                {
                    data.operands = [false, false, false, false, false, false, false, false, false, false, false, false];
                    data.operands[0] = january.prop("checked");
                    data.operands[1] = february.prop("checked");
                    data.operands[2] = march.prop("checked");
                    data.operands[3] = april.prop("checked");
                    data.operands[4] = may.prop("checked");
                    data.operands[5] = june.prop("checked");
                    data.operands[6] = july.prop("checked");
                    data.operands[7] = august.prop("checked");
                    data.operands[8] = september.prop("checked");
                    data.operands[9] = october.prop("checked");
                    data.operands[10] = november.prop("checked");
                    data.operands[11] = december.prop("checked");

                    for (let i=0; i<12; ++i)
                    {
                        if (data.operands[i])
                        {
                            data.label += " " + MONTHS[i];
                        }
                    }
                }
                else if (data.operator == "expression")
                {
                    data.expression = expression.typedInput("value");
                    if (data.expression.length <= 50)
                    {
                        data.label = data.expression;
                    }
                    else
                    {
                        data.label = data.expression.substring(0, 49) + "...";
                    }
                }
                else if (data.operator == "context")
                {
                    data.context = {};
                    data.context.value = context.typedInput("value");
                    data.context.type = context.typedInput("type");

                    let ctx = RED.utils.parseContextKey(data.context.value);
                    data.label = data.context.type + "." + ctx.key + (ctx.store ? " (" + ctx.store + ")" : "");
                }

                node.conditions.push(data);
                node.outputs++;
            });
        },
        oneditresize: function(size)
        {
            let height = size.height;
            let conditionListRow = $("#dialog-form>div.node-input-conditionList-row");
            let otherRows = $("#dialog-form>div:not(.node-input-conditionList-row)");

            for (let i=0; i<otherRows.length; ++i)
            {
                height -= $(otherRows[i]).outerHeight(true);
            }

            height -= (parseInt(conditionListRow.css("marginTop")) + parseInt(conditionListRow.css("marginBottom")));
            height -= $("#dialog-form>div.node-input-conditionList-row>label").outerHeight(true);

            $("#node-input-conditionList").editableList("height", height);
        }
    });
</script>
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-help-name="chronos-switch">
    <p>
        Routes messages based on specific times.
    </p>
    <h3>Details</h3>
    <p>
        This node routes incoming messages to output ports based on the time
        of arrival or a timestamp specified via a message property, global
        variable or flow variable.
    </p>
    <p>
        For more information, please refer to the detailed documentation in the
        <a href="https://github.com/jensrossbach/node-red-contrib-chronos/wiki/Time-Switch-Node">repository wiki</a>.
    </p>
    <h3>Configuration</h3>
    <dl>
        <dt>Name</dt>
        <dd>The name of the node (optional).</dd>
        <dt>Configuration</dt>
        <dd>
            A reference to the configuration node to be used.
        </dd>
        <dt>Base Time</dt>
        <dd>
            The base time is used for comparison with the operands of the
            conditions. This can be one of:
            <ul>
                <li>
                    <i>message ingress</i>: Ingress time of the input message.
                </li>
                <li>
                    <i>global</i>: Timestamp from a global variable as number
                    of milliseconds elapsed since the UNIX epoch.
                </li>
                <li>
                    <i>flow</i>: Timestamp from a flow variable as number of
                    milliseconds elapsed since the UNIX epoch.
                </li>
                <li>
                    <i>msg</i>: Timestamp from a message property as number of
                    milliseconds elapsed since the UNIX epoch.
                </li>
            </ul>
        </dd>
        <dt>Conditions</dt>
        <dd>
            The list containing the conditions for routing messages to output
            ports. New entries can be added using the button below the list.
            Existing entries can be reordered or deleted. Depending on the
            selected operator or source on the left side, the following
            possibilities are available:
            <ul>
                <li>
                    Operator <i>before</i>: Checks if the base time is earlier than the
                    specified time.
                </li>
                <li>
                    Operator <i>after</i>: Checks if the base time is equal to or later
                    than the specified time.
                </li>
                <li>
                    Operator <i>between</i>: Checks if the base time is equal to or later
                    than the first and earlier than the second specified time.
                </li>
                <li>
                    Operator <i>outside</i>: Checks if the base time is earlier than the
                    first or later than the second specified time.
                </li>
                <li>
                    Operator <i>days</i>: Checks if the base time matches special days
                    of a month. This can be the first, second, third, fourth, fifth or
                    last day, day of a week, workday or weekend day. Or it can be an
                    even day or a specific day of a specific month or every month. All
                    operands can be negated by activating the <i>Exclude</i> checkbox.
                </li>
                <li>
                    Operator <i>week days</i>: Checks if the base time matches one of
                    the selected week days.
                </li>
                <li>
                    Operator <i>months</i>: Checks if the base time matches one of the
                    selected months.
                </li>
                <li>
                    Operator <i>otherwise</i>: Evaluates to true if all other conditions
                    do not match.
                </li>
                <li>
                    Source <i>expression</i>: The condition result is taken from the
                    provided JSONata expression. Additional time calculation functions
                    are supported and the base time can be accessed through variable
                    <code>$baseTime</code>.
                </li>
                <li>
                    Source <i>context</i>: Loads the condition from the specified
                    context variable. See chapter <i>Input</i> below for a description
                    of the required structure for the global or flow variable.
                </li>
            </ul>
            For the time input, depending on the selection on the left side, the
            following possibilities are available:
            <ul>
                <li>
                    <i>time of day</i>: A specific time can be entered directly
                    in the form <code>hh:mm[:ss] [am|pm]</code>.
                </li>
                <li>
                    <i>sun position</i>: The sun position can be selected from
                    a list of predefined values.
                </li>
                <li>
                    <i>moon position</i>: The moon position can be selected from
                    a list of predefined values.
                </li>
                <li>
                    <i>custom sun position</i>: One of the user-defined sun position names
                    can be entered.
                </li>
            </ul>
            The specified times can additionally be shifted by an (optionally
            randomized) offset, accessible through the double down arrow on the
            right side.
        </dd>
        <dt>Stop on first match</dt>
        <dd>
            If selected, evaluation of conditions is stopped on the first match,
            i.e. message are never routed to more than one output port.
        </dd>
    </dl>
    <h3>Input</h3>
    <p>
        Incoming messages are routed to none, one or multiple of the configured
        output ports. If the message is delivered to more than one port, it will
        be cloned at each but the first port.
    </p>
    <p>
        Conditions can be dynamically programmed by configuring the corresponding
        condition to be loaded from a context variable (see chapter <i>Configuration</i>
        above). The appropriate variables must be objects containing the following
        properties:
    </p>
    <dl class="message-properties">
        <dt>operator<span class="property-type">string</span></dt>
        <dd>Operator for comparison; one of "before", "after", "between", "outside", "days", "weekdays", "months" or "otherwise"</dd>
        <dt class="optional">operands<span class="property-type">object | array</span></dt>
        <dd>Operands for comparison; content is depending on operator</dd>
    </dl>
    <p>
        If <code>operator</code> is:
        <ul>
            <li>"before" or "after", <code>operands</code> must be an object</li>
            <li>"between" or "outside", <code>operands</code> must be an array containing two objects corresponding to the first and second operand</li>
        </ul>
        The objects must each include the following properties:
    </p>
    <dl class="message-properties">
        <dt>type<span class="property-type">string</span></dt>
        <dd>Operand type; one of "time", "sun", "moon" or "custom"</dd>
        <dt>value<span class="property-type">string</span></dt>
        <dd>Operand value; content is depending on operand type</dd>
        <dt>offset<span class="property-type">number</span></dt>
        <dd>Offset to the operand time</dd>
        <dt>random<span class="property-type">boolean</span></dt>
        <dd>Randomized offset</dd>
    </dl>
    <p>
        If <code>operator</code> is "days", <code>operands</code> must be
        an object containing the following properties:
    </p>
    <dl class="message-properties">
        <dt>type<span class="property-type">string</span></dt>
        <dd>
            Operand type; one of "first", "second", "third", "fourth",
            "fifth", "last", "even" or "specific"
        </dd>
        <dt class="optional">day<span class="property-type">string | number</span></dt>
        <dd>
            Depending on the operand type the name of a day or the day
            of the month as number; not applicable for type "even"
        </dd>
        <dt class="optional">month<span class="property-type">string</span></dt>
        <dd>Name of the month; only applicable for type "specific"</dd>
        <dt>exclude<span class="property-type">boolean</span></dt>
        <dd>Negated result</dd>
    </dl>
    <p>
        If <code>operator</code> is "weekdays", <code>operands</code>
        must be an object. It may contain boolean properties with names of
        days of the week. If <code>true</code>, the condition is fullfilled
        for base times on that day or not fulfilled if the property is
        <code>false</code> or not present.
    </p>
    <p>
        If <code>operator</code> is "months", <code>operands</code>
        must be an object. It may contain boolean properties with names of
        months of the year. If <code>true</code>, the condition is fullfilled
        for base times in that month or not fulfilled if the property is
        <code>false</code> or not present.
    </p>
    <p>
        If <code>operator</code> is "otherwise", <code>operands</code>
        is not required.
    </p>
    <h3>Outputs</h3>
    <p>
        Each output port is dedicated to a specific condition which is evaluated
        against the base time.
    </p>
</script>

</div><div><!-- --- [red-module:node-red-contrib-chronos/chronos-filter] --- -->
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-template-name="chronos-filter">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-config"><i class="fa fa-cog"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.config"></span></label>
        <input type="text" id="node-input-config" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.config">
    </div>
    <div class="form-row" style="padding-top: 4px;">
        <label for="node-input-baseTime"><i class="fa fa-clock-o"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.baseTime"></span></label>
        <input type="text" id="node-input-baseTime" style="width: 70%;">
        <input id="node-input-baseTimeType" type="hidden">
    </div>
    <div class="form-row">
        <label for="node-input-evaluation"><i class="fa fa-filter"></i> <span data-i18n="filter.label.evaluation"></span></label>
        <input type="text" id="node-input-evaluation" style="width: 70%;">
        <input id="node-input-evaluationType" type="hidden">
    </div>
    <div class="form-row node-input-conditionList-row" style="padding-top: 10px">
        <label for="node-input-conditionList"><i class="fa fa-sliders"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.conditions"></span></label>
        <div class="form-row">
            <ol id="node-input-conditionList"></ol>
        </div>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("chronos-filter",
    {
        category:     "chronos",
        color:        "#DEB887",
        icon:         "chronos_filter.svg",
        inputs:       1,
        outputs:      1,
        paletteLabel: "time filter",
        label: function()
        {
            return (this.name || this._("filter.label.node"));
        },
        labelStyle: function()
        {
            return (this.name ? "node_label_italic" : "");
        },
        inputLabels: function()
        {
            return this._("node-red-contrib-chronos/chronos-config:common.label.inputPort");
        },
        outputLabels: function(index)
        {
            return this._("filter.label.outputPort");
        },
        defaults:
        {
            name:
            {
                value: ""
            },
            config:
            {
                value:    "",
                type:     "chronos-config",
                required: true
            },
            baseTime:
            {
                value:    "",
                validate: RED.validators.typedInput("baseTimeType")
            },
            baseTimeType:
            {
                value: "msgIngress"
            },
            evaluation:
            {
                value:    "",
                validate: RED.validators.typedInput("evaluationType")
            },
            evaluationType:
            {
                value: "or"
            },
            conditions:
            {
                value: [{operator: "before", operands: {type: "time", value: ""}}],
                validate: function(v)
                {
                    // just a simple check if there are any conditions, no detailed check of the content
                    return v.length > 0;
                }
            }
            /* allMustMatch:
            {
                value: false
            },
            annotateOnly:
            {
                value: false
            } */
        },
        oneditprepare: function()
        {
            let node = this;

            const msgIngressInput =
            {
                value: "msgIngress",
                label: node._("node-red-contrib-chronos/chronos-config:common.label.msgIngress"),
                hasValue: false
            };

            const logicalOrInput =
            {
                value: "or",
                label: node._("filter.label.logicalOr"),
                hasValue: false
            };

            const logicalAndInput =
            {
                value: "and",
                label: node._("filter.label.logicalAnd"),
                hasValue: false
            };

            const annotationInput =
            {
                value: "annotation",
                label: node._("filter.label.annotation"),
                hasValue: false
            };

            let baseTime = $("#node-input-baseTime")
                            .typedInput({types: [msgIngressInput, "global", "flow", "msg"], typeField: "#node-input-baseTimeType"});

            let evaluation = $("#node-input-evaluation")
                            .typedInput({types: [logicalOrInput, logicalAndInput, annotationInput, "jsonata"], typeField: "#node-input-evaluationType"});

            let conditionList = $("#node-input-conditionList").css("min-width", "500px").css("min-height", "150px").editableList(
            {
                removable: true,
                sortable: true,
                addItem: function(item, index, data)
                {
                    const sunTimes =
                    [
                        {
                            value: "nightEnd",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nightEnd")
                        },
                        {
                            value: "nauticalDawn",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nauticalDawn")
                        },
                        {
                            value: "dawn",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.dawn")
                        },
                        {
                            value: "sunrise",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunrise")
                        },
                        {
                            value: "sunriseEnd",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunriseEnd")
                        },
                        {
                            value: "goldenHourEnd",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.goldenHourEnd")
                        },
                        {
                            value: "solarNoon",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.solarNoon")
                        },
                        {
                            value: "goldenHour",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.goldenHour")
                        },
                        {
                            value: "sunsetStart",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunsetStart")
                        },
                        {
                            value: "sunset",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunset")
                        },
                        {
                            value: "dusk",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.dusk")
                        },
                        {
                            value: "nauticalDusk",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nauticalDusk")
                        },
                        {
                            value: "night",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.night")
                        },
                        {
                            value: "nadir",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nadir")
                        }
                    ];

                    const moonTimes =
                    [
                        {
                            value: "rise",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.moon.rise")
                        },
                        {
                            value: "set",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.moon.set")
                        }
                    ];

                    const timeInput =
                    {
                        value: "time",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.time"),
                        icon: "fa fa-clock-o",
                        hasValue: true,
                        validate: /^(\d|0\d|1\d|2[0-3]):([0-5]\d)(:([0-5]\d))?\s*(am|AM|pm|PM)?$/
                    };

                    const sunTimeInput =
                    {
                        value: "sun",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.sun"),
                        icon: "fa fa-sun-o",
                        options: sunTimes
                    };

                    const moonTimeInput =
                    {
                        value: "moon",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.moon"),
                        icon: "fa fa-moon-o",
                        options: moonTimes
                    };

                    const customInput =
                    {
                        value: "custom",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.custom"),
                        icon: "fa fa-wrench",
                        hasValue: true,
                        validate: /^[a-zA-Z][0-9a-zA-Z_]*$/
                    };

                    const validateInput = function(event, ui)
                    {
                        var value = parseInt($(this).spinner("value"), 10);
                        var min = $(this).spinner("option", "min");
                        var max = $(this).spinner("option", "max");
                        if (isNaN(value) ||
                            (value < min))
                        {
                            $(this).spinner("value", min);
                        }
                        else if (value > max)
                        {
                            $(this).spinner("value", max);
                        }
                    };

                    const offsetInput =
                    {
                        min: -300,
                        max: 300,
                        step: 5,
                        change: validateInput
                    };

                    const fixedDayInput =
                    {
                        min: 1,
                        max: 31,
                        step: 1,
                        change: validateInput
                    };

                    let fragment = document.createDocumentFragment();
                    let operatorBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto;"}).appendTo(fragment);
                    let timeBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 2px;"}).appendTo(fragment);
                    let daysBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 2px;"}).appendTo(fragment);
                    let weekdaysBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 2px;"}).appendTo(fragment);
                    let monthsBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 2px;"}).appendTo(fragment);
                    let expressionBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 6px;"}).appendTo(fragment);
                    let contextBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 6px;"}).appendTo(fragment);

                    let operator = $("<select/>", {class: "node-input-operator", style: "width: 120px;"})
                                        .appendTo(operatorBox);
                    let operGrp = $("<optgroup></optgroup>").attr("label", node._("node-red-contrib-chronos/chronos-config:common.list.condition.operators"))
                                        .append($("<option></option>").val("before").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.before")))
                                        .append($("<option></option>").val("after").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.after")))
                                        .append($("<option></option>").val("between").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.between")))
                                        .append($("<option></option>").val("outside").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.outside")))
                                        .append($("<option></option>").val("days").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.days")))
                                        .append($("<option></option>").val("weekdays").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.weekdays")))
                                        .append($("<option></option>").val("months").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.operator.months")))
                                        .appendTo(operator);
                    let fromGrp = $("<optgroup></optgroup>").attr("label", node._("node-red-contrib-chronos/chronos-config:common.list.condition.sources"))
                                        .append($("<option></option>").val("expression").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.source.expression")))
                                        .append($("<option></option>").val("context").text(node._("node-red-contrib-chronos/chronos-config:common.list.condition.source.context")))
                                        .appendTo(operator);

                    let time1Box = $("<div/>", {style: "margin-left: 4px;"}).appendTo(timeBox);
                    let time2Box = $("<div/>", {style: "margin-left: 4px; margin-top: 5px;"}).appendTo(timeBox);
                    let time1Row1 = $("<div/>").appendTo(time1Box);
                    let time1Row2 = $("<div/>", {style: "margin-top: 5px;"}).appendTo(time1Box);
                    let time2Row1 = $("<div/>").appendTo(time2Box);
                    let time2Row2 = $("<div/>", {style: "margin-top: 5px;"}).appendTo(time2Box);
                    let monthsRow1 = $("<div/>").appendTo(monthsBox);
                    let monthsRow2 = $("<div/>", {style: "margin-top: 5px;"}).appendTo(monthsBox);
                    let monthsRow3 = $("<div/>", {style: "margin-top: 5px;"}).appendTo(monthsBox);

                    let time1 = $("<input/>", {type: "text", class: "node-input-time1"})
                                        .appendTo(time1Row1)
                                        .typedInput({types: [timeInput, sunTimeInput, moonTimeInput, customInput]});
                    time1.typedInput("width", "280px");
                    time1._prevType = "time";
                    let extend1 = $("<a/>", {href: "#", style: "margin-left: 6px;"})
                                        .html("<i class='fa fa-angle-double-down' aria-hidden='true'></i>")
                                        .appendTo(time1Row1);

                    let time2 = $("<input/>", {type: "text", class: "node-input-time2"})
                                        .appendTo(time2Row1)
                                        .typedInput({types: [timeInput, sunTimeInput, moonTimeInput, customInput]});
                    time2.typedInput("width", "280px");
                    time2._prevType = "time";
                    let extend2 = $("<a/>", {href: "#", style: "margin-left: 6px;"})
                                        .html("<i class='fa fa-angle-double-down' aria-hidden='true'></i>")
                                        .appendTo(time2Row1);

                    $("<label/>", {style: "width: auto; margin-right: 6px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.label.offset"))
                                        .appendTo(time1Row2);
                    let offset1 = $("<input/>", {class: "node-input-offset1", style: "width: 50px !important;"})
                                        .appendTo(time1Row2)
                                        .spinner(offsetInput);
                    let random1 = $("<input/>", {type: "checkbox", class: "node-input-random1", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(time1Row2);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.label.random"))
                                        .appendTo(time1Row2);

                    $("<label/>", {style: "width: auto; margin-right: 6px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.label.offset"))
                                        .appendTo(time2Row2);
                    let offset2 = $("<input/>", {class: "node-input-offset2", style: "width: 50px !important;"})
                                        .appendTo(time2Row2)
                                        .spinner(offsetInput);
                    let random2 = $("<input/>", {type: "checkbox", class: "node-input-random2", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(time2Row2);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.label.random"))
                                        .appendTo(time2Row2);

                    let dayType = $("<select/>", {class: "node-input-dayType", style: "width: auto; margin-left: 4px;"})
                                        .append($("<option></option>").val("first").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.first")))
                                        .append($("<option></option>").val("second").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.second")))
                                        .append($("<option></option>").val("third").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.third")))
                                        .append($("<option></option>").val("fourth").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.fourth")))
                                        .append($("<option></option>").val("fifth").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.fifth")))
                                        .append($("<option></option>").val("last").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.last")))
                                        .append($("<option></option>").val("even").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.even")))
                                        .append($("<option></option>").val("specific").text(node._("node-red-contrib-chronos/chronos-config:common.list.dayType.specific")))
                                        .appendTo(daysBox);
                    let nthDaysBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 6px;"}).appendTo(daysBox);
                    let specificDaysBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 6px;"}).appendTo(daysBox);
                    let day = $("<select/>", {class: "node-input-day", style: "width: auto;"})
                                        .append($("<option></option>").val("monday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.monday")))
                                        .append($("<option></option>").val("tuesday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.tuesday")))
                                        .append($("<option></option>").val("wednesday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.wednesday")))
                                        .append($("<option></option>").val("thursday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.thursday")))
                                        .append($("<option></option>").val("friday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.friday")))
                                        .append($("<option></option>").val("saturday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.saturday")))
                                        .append($("<option></option>").val("sunday").text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.sunday")))
                                        .append($("<option></option>").val("day").text(node._("node-red-contrib-chronos/chronos-config:common.list.day.day")))
                                        .append($("<option></option>").val("workday").text(node._("node-red-contrib-chronos/chronos-config:common.list.day.workday")))
                                        .append($("<option></option>").val("weekend").text(node._("node-red-contrib-chronos/chronos-config:common.list.day.weekend")))
                                        .appendTo(nthDaysBox);
                    let fixedDay = $("<input/>", {class: "node-input-fixedDay", style: "width: 30px !important;"})
                                        .appendTo(specificDaysBox)
                                        .spinner(fixedDayInput);
                    let fixedMonth = $("<select/>", {class: "node-input-fixedMonth", style: "width: auto; margin-left: 6px;"})
                                        .append($("<option></option>").val("january").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.january")))
                                        .append($("<option></option>").val("february").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.february")))
                                        .append($("<option></option>").val("march").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.march")))
                                        .append($("<option></option>").val("april").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.april")))
                                        .append($("<option></option>").val("may").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.may")))
                                        .append($("<option></option>").val("june").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.june")))
                                        .append($("<option></option>").val("july").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.july")))
                                        .append($("<option></option>").val("august").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.august")))
                                        .append($("<option></option>").val("september").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.september")))
                                        .append($("<option></option>").val("october").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.october")))
                                        .append($("<option></option>").val("november").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.november")))
                                        .append($("<option></option>").val("december").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.december")))
                                        .append($("<option></option>").val("any").text(node._("node-red-contrib-chronos/chronos-config:common.list.month.any")))
                                        .appendTo(specificDaysBox);
                    let excludeLabel = $("<label/>", {title: node._("node-red-contrib-chronos/chronos-config:common.label.exclude"), style: "width: auto; margin-left: 10px; margin-bottom: 0px;"})
                                        .html("<i class='fa fa-ban' aria-hidden='true'></i>")
                                        .appendTo(daysBox);
                    let exclude = $("<input/>", {type: "checkbox", class: "node-input-exclude", style: "width: auto; margin-left: 4px; margin-top: 0px; margin-bottom: 3px;"})
                                        .appendTo(excludeLabel);

                    let monday = $("<input/>", {type: "checkbox", class: "node-input-monday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.monday")).appendTo(weekdaysBox);
                    let tuesday = $("<input/>", {type: "checkbox", class: "node-input-tuesday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.tuesday")).appendTo(weekdaysBox);
                    let wednesday = $("<input/>", {type: "checkbox", class: "node-input-wednesday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.wednesday")).appendTo(weekdaysBox);
                    let thursday = $("<input/>", {type: "checkbox", class: "node-input-thursday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.thursday")).appendTo(weekdaysBox);
                    let friday = $("<input/>", {type: "checkbox", class: "node-input-friday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.friday")).appendTo(weekdaysBox);
                    let saturday = $("<input/>", {type: "checkbox", class: "node-input-saturday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.saturday")).appendTo(weekdaysBox);
                    let sunday = $("<input/>", {type: "checkbox", class: "node-input-sunday", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(weekdaysBox);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: auto;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.weekday.sunday")).appendTo(weekdaysBox);

                    let january = $("<input/>", {type: "checkbox", class: "node-input-january", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow1);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.january")).appendTo(monthsRow1);
                    let february = $("<input/>", {type: "checkbox", class: "node-input-february", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow1);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.february")).appendTo(monthsRow1);
                    let march = $("<input/>", {type: "checkbox", class: "node-input-march", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow1);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.march")).appendTo(monthsRow1);
                    let april = $("<input/>", {type: "checkbox", class: "node-input-april", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow1);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.april")).appendTo(monthsRow1);
                    let may = $("<input/>", {type: "checkbox", class: "node-input-may", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow2);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.may")).appendTo(monthsRow2);
                    let june = $("<input/>", {type: "checkbox", class: "node-input-june", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow2);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.june")).appendTo(monthsRow2);
                    let july = $("<input/>", {type: "checkbox", class: "node-input-july", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow2);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.july")).appendTo(monthsRow2);
                    let august = $("<input/>", {type: "checkbox", class: "node-input-august", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow2);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.august")).appendTo(monthsRow2);
                    let september = $("<input/>", {type: "checkbox", class: "node-input-september", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow3);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.september")).appendTo(monthsRow3);
                    let october = $("<input/>", {type: "checkbox", class: "node-input-october", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow3);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.october")).appendTo(monthsRow3);
                    let november = $("<input/>", {type: "checkbox", class: "node-input-november", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow3);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.november")).appendTo(monthsRow3);
                    let december = $("<input/>", {type: "checkbox", class: "node-input-december", style: "width: auto; margin-top: 0px; margin-bottom: 1px; margin-left: 6px;"})
                                        .appendTo(monthsRow3);
                    $("<label/>", {style: "margin-left: 4px; margin-bottom: 0px; width: 40px;"})
                                        .text(node._("node-red-contrib-chronos/chronos-config:common.list.month.december")).appendTo(monthsRow3);

                    let expression = $("<input/>", {type: "text", class: "node-input-expression"})
                                        .appendTo(expressionBox)
                                        .typedInput({types: ["jsonata"]});
                    expression.typedInput("width", "280px");

                    let context = $("<input/>", {type: "text", class: "node-input-context"})
                                        .appendTo(contextBox)
                                        .typedInput({types: ["global", "flow"]});
                    context.typedInput("width", "280px");

                    operator.change(function()
                    {
                        timeBox.hide();
                        time2Box.hide();
                        daysBox.hide();
                        weekdaysBox.hide();
                        monthsBox.hide();
                        expressionBox.hide();
                        contextBox.hide();

                        var value = $(this).val();
                        switch (value)
                        {
                            case "before":
                            case "after":
                            {
                                timeBox.show();
                                break;
                            }
                            case "between":
                            case "outside":
                            {
                                timeBox.show();
                                time2Box.show();
                                break;
                            }
                            case "days":
                            {
                                daysBox.show();
                                break;
                            }
                            case "weekdays":
                            {
                                weekdaysBox.show();
                                break;
                            }
                            case "months":
                            {
                                monthsBox.show();
                                break;
                            }
                            case "expression":
                            {
                                expressionBox.show();
                                break;
                            }
                            case "context":
                            {
                                contextBox.show();
                                break;
                            }
                        }
                    });

                    time1.on("change", function()
                    {
                        let type = time1.typedInput("type");

                        if (type != time1._prevType)
                        {
                            time1._prevType = type;
                            if ((type != "sun") && (type != "moon"))
                            {
                                time1.typedInput("value", "");
                            }
                        }
                    });

                    time2.on("change", function()
                    {
                        let type = time2.typedInput("type");

                        if (type != time2._prevType)
                        {
                            time2._prevType = type;
                            if ((type != "sun") && (type != "moon"))
                            {
                                time2.typedInput("value", "");
                            }
                        }
                    });

                    function showExtensionRow1()
                    {
                        time1Row2.show();
                        extend1.html("<i class='fa fa-angle-double-up' aria-hidden='true'></i>");
                    }

                    function hideExtensionRow1()
                    {
                        time1Row2.hide();
                        extend1.html("<i class='fa fa-angle-double-down' aria-hidden='true'></i>");

                        offset1.spinner("value", 0);
                        random1.prop("checked", false);
                    }

                    function showExtensionRow2()
                    {
                        time2Row2.show();
                        extend2.html("<i class='fa fa-angle-double-up' aria-hidden='true'></i>");
                    }

                    function hideExtensionRow2()
                    {
                        time2Row2.hide();
                        extend2.html("<i class='fa fa-angle-double-down' aria-hidden='true'></i>");

                        offset2.spinner("value", 0);
                        random2.prop("checked", false);
                    }

                    extend1.click(function()
                    {
                        if (time1Row2.is(":hidden"))
                        {
                            showExtensionRow1();
                        }
                        else
                        {
                            hideExtensionRow1();
                        }
                    });

                    extend2.click(function()
                    {
                        if (time2Row2.is(":hidden"))
                        {
                            showExtensionRow2();
                        }
                        else
                        {
                            hideExtensionRow2();
                        }
                    });

                    hideExtensionRow1();
                    hideExtensionRow2();

                    dayType.change(function()
                    {
                        nthDaysBox.hide();
                        specificDaysBox.hide();

                        let value = $(this).val();
                        if (value == "specific")
                        {
                            specificDaysBox.show();
                        }
                        else if (value != "even")
                        {
                            let val = day.val();
                            day.children("option[value='day']").remove();
                            day.children("option[value='workday']").remove();
                            day.children("option[value='weekend']").remove();

                            if ((value == "first") || (value == "last"))
                            {
                                day.append($("<option></option>").val("day").text(node._("node-red-contrib-chronos/chronos-config:common.list.day.day")));
                                day.append($("<option></option>").val("workday").text(node._("node-red-contrib-chronos/chronos-config:common.list.day.workday")));
                                day.append($("<option></option>").val("weekend").text(node._("node-red-contrib-chronos/chronos-config:common.list.day.weekend")));
                                day.val(val);
                            }

                            nthDaysBox.show();
                        }
                    });

                    fixedMonth.change(function()
                    {
                        let value = $(this).val();
                        switch (value)
                        {
                            case "january":
                            case "march":
                            case "may":
                            case "july":
                            case "august":
                            case "october":
                            case "december":
                            case "any":
                            {
                                fixedDay.spinner("option", "max", 31);
                                break;
                            }
                            case "february":
                            {
                                fixedDay.spinner("option", "max", 29);
                                break;
                            }
                            case "april":
                            case "june":
                            case "september":
                            case "november":
                            {
                                fixedDay.spinner("option", "max", 30);
                                break;
                            }
                        }

                        validateInput.call(fixedDay);
                    });

                    if (!("operator" in data))
                    {
                        data = {operator: "before", operands: {type: "time", value: "", offset: 0, random: false}};
                    }

                    // initial value
                    fixedDay.spinner("value", 1);

                    operator.val(data.operator);

                    if ((data.operator == "before") || (data.operator == "after"))
                    {
                        time1._prevType = data.operands.type;
                        time1.typedInput("type", data.operands.type);
                        time1.typedInput("value", data.operands.value);
                        if (data.operands.offset &&  // backwards compatibility to v1.0.2
                            (data.operands.offset != 0))
                        {
                            offset1.spinner("value", data.operands.offset);
                            random1.prop("checked", data.operands.random);
                            showExtensionRow1();
                        }
                    }
                    else if ((data.operator == "between") || (data.operator == "outside"))
                    {
                        time1._prevType = data.operands[0].type;
                        time1.typedInput("type", data.operands[0].type);
                        time1.typedInput("value", data.operands[0].value);
                        time2._prevType = data.operands[1].type;
                        time2.typedInput("type", data.operands[1].type);
                        time2.typedInput("value", data.operands[1].value);
                        if (data.operands[0].offset &&  // backwards compatibility to v1.0.2
                            (data.operands[0].offset != 0))
                        {
                            offset1.spinner("value", data.operands[0].offset);
                            random1.prop("checked", data.operands[0].random);
                            showExtensionRow1();
                        }
                        if (data.operands[1].offset &&  // backwards compatibility to v1.0.2
                            (data.operands[1].offset != 0))
                        {
                            offset2.spinner("value", data.operands[1].offset);
                            random2.prop("checked", data.operands[1].random);
                            showExtensionRow2();
                        }
                    }
                    else if (data.operator == "days")
                    {
                        dayType.val(data.operands.type);

                        if (data.operands.type == "specific")
                        {
                            fixedDay.spinner("value", data.operands.day);
                            fixedMonth.val(data.operands.month);
                        }
                        else if (data.operands.type != "even")
                        {
                            day.val(data.operands.day);
                        }

                        exclude.prop("checked", data.operands.exclude);
                    }
                    else if (data.operator == "weekdays")
                    {
                        sunday.prop("checked", data.operands[0]);
                        monday.prop("checked", data.operands[1]);
                        tuesday.prop("checked", data.operands[2]);
                        wednesday.prop("checked", data.operands[3]);
                        thursday.prop("checked", data.operands[4]);
                        friday.prop("checked", data.operands[5]);
                        saturday.prop("checked", data.operands[6]);
                    }
                    else if (data.operator == "months")
                    {
                        january.prop("checked", data.operands[0]);
                        february.prop("checked", data.operands[1]);
                        march.prop("checked", data.operands[2]);
                        april.prop("checked", data.operands[3]);
                        may.prop("checked", data.operands[4]);
                        june.prop("checked", data.operands[5]);
                        july.prop("checked", data.operands[6]);
                        august.prop("checked", data.operands[7]);
                        september.prop("checked", data.operands[8]);
                        october.prop("checked", data.operands[9]);
                        november.prop("checked", data.operands[10]);
                        december.prop("checked", data.operands[11]);
                    }
                    else if (data.operator == "expression")
                    {
                        expression.typedInput("value", data.expression);
                        expression.typedInput("type", "jsonata");
                    }
                    else if (data.operator == "context")
                    {
                        context.typedInput("value", data.context.value);
                        context.typedInput("type", data.context.type);
                    }

                    operator.change();
                    dayType.change();
                    item[0].appendChild(fragment);
                }
            });

            node.conditions.forEach(data =>
            {
                conditionList.editableList("addItem", data);
            });
        },
        oneditsave: function()
        {
            let node = this;

            let conditionList = $("#node-input-conditionList").editableList("items");
            node.conditions = [];

            conditionList.each(function(index)
            {
                let data = {};

                let operator = $(this).find(".node-input-operator");
                let time1 = $(this).find(".node-input-time1");
                let time2 = $(this).find(".node-input-time2");
                let offset1 = $(this).find(".node-input-offset1");
                let offset2 = $(this).find(".node-input-offset2");
                let random1 = $(this).find(".node-input-random1");
                let random2 = $(this).find(".node-input-random2");
                let dayType = $(this).find(".node-input-dayType");
                let day = $(this).find(".node-input-day");
                let fixedDay = $(this).find(".node-input-fixedDay");
                let fixedMonth = $(this).find(".node-input-fixedMonth");
                let exclude = $(this).find(".node-input-exclude");
                let monday = $(this).find(".node-input-monday");
                let tuesday = $(this).find(".node-input-tuesday");
                let wednesday = $(this).find(".node-input-wednesday");
                let thursday = $(this).find(".node-input-thursday");
                let friday = $(this).find(".node-input-friday");
                let saturday = $(this).find(".node-input-saturday");
                let sunday = $(this).find(".node-input-sunday");
                let january = $(this).find(".node-input-january");
                let february = $(this).find(".node-input-february");
                let march = $(this).find(".node-input-march");
                let april = $(this).find(".node-input-april");
                let may = $(this).find(".node-input-may");
                let june = $(this).find(".node-input-june");
                let july = $(this).find(".node-input-july");
                let august = $(this).find(".node-input-august");
                let september = $(this).find(".node-input-september");
                let october = $(this).find(".node-input-october");
                let november = $(this).find(".node-input-november");
                let december = $(this).find(".node-input-december");
                let expression = $(this).find(".node-input-expression");
                let context = $(this).find(".node-input-context");

                data.operator = operator.val();

                if ((data.operator == "before") || (data.operator == "after"))
                {
                    data.operands = {};
                    data.operands.type = time1.typedInput("type");
                    data.operands.value = time1.typedInput("value");
                    data.operands.offset = offset1.spinner("value");
                    data.operands.random = random1.prop("checked");
                }
                else if ((data.operator == "between") || (data.operator == "outside"))
                {
                    data.operands = [{}, {}];
                    data.operands[0].type = time1.typedInput("type");
                    data.operands[0].value = time1.typedInput("value");
                    data.operands[0].offset = offset1.spinner("value");
                    data.operands[0].random = random1.prop("checked");
                    data.operands[1].type = time2.typedInput("type");
                    data.operands[1].value = time2.typedInput("value");
                    data.operands[1].offset = offset2.spinner("value");
                    data.operands[1].random = random2.prop("checked");
                }
                else if (data.operator == "days")
                {
                    data.operands = {};
                    data.operands.type = dayType.val();

                    if (data.operands.type == "specific")
                    {
                        data.operands.day = fixedDay.spinner("value");
                        data.operands.month = fixedMonth.val();
                    }
                    else if (data.operands.type != "even")
                    {
                        data.operands.day = day.val();
                    }

                    data.operands.exclude = exclude.prop("checked");
                }
                else if (data.operator == "weekdays")
                {
                    data.operands = [false, false, false, false, false, false, false];
                    data.operands[0] = sunday.prop("checked");
                    data.operands[1] = monday.prop("checked");
                    data.operands[2] = tuesday.prop("checked");
                    data.operands[3] = wednesday.prop("checked");
                    data.operands[4] = thursday.prop("checked");
                    data.operands[5] = friday.prop("checked");
                    data.operands[6] = saturday.prop("checked");
                }
                else if (data.operator == "months")
                {
                    data.operands = [false, false, false, false, false, false, false, false, false, false, false, false];
                    data.operands[0] = january.prop("checked");
                    data.operands[1] = february.prop("checked");
                    data.operands[2] = march.prop("checked");
                    data.operands[3] = april.prop("checked");
                    data.operands[4] = may.prop("checked");
                    data.operands[5] = june.prop("checked");
                    data.operands[6] = july.prop("checked");
                    data.operands[7] = august.prop("checked");
                    data.operands[8] = september.prop("checked");
                    data.operands[9] = october.prop("checked");
                    data.operands[10] = november.prop("checked");
                    data.operands[11] = december.prop("checked");
                }
                else if (data.operator == "expression")
                {
                    data.expression = expression.typedInput("value");
                }
                else if (data.operator == "context")
                {
                    data.context = {};
                    data.context.value = context.typedInput("value");
                    data.context.type = context.typedInput("type");
                }

                node.conditions.push(data);
            });
        },
        oneditresize: function(size)
        {
            let height = size.height;
            let conditionListRow = $("#dialog-form>div.node-input-conditionList-row");
            let otherRows = $("#dialog-form>div:not(.node-input-conditionList-row)");

            for (let i=0; i<otherRows.length; ++i)
            {
                height -= $(otherRows[i]).outerHeight(true);
            }

            height -= (parseInt(conditionListRow.css("marginTop")) + parseInt(conditionListRow.css("marginBottom")));
            height -= $("#dialog-form>div.node-input-conditionList-row>label").outerHeight(true);

            $("#node-input-conditionList").editableList("height", height);
        }
    });
</script>
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-help-name="chronos-filter">
    <p>
        Filters messages based on specific times.
    </p>
   <h3>Details</h3>
    <p>
        This node is similar to the time switch node but instead of routing
        messages to different output ports, it hands over or discards messages
        depending on different conditions.
    </p>
    <p>
        For more information, please refer to the detailed documentation in the
        <a href="https://github.com/jensrossbach/node-red-contrib-chronos/wiki/Time-Filter-Node">repository wiki</a>.
    </p>
    <h3>Configuration</h3>
    <dl>
        <dt>Name</dt>
        <dd>The name of the node (optional).</dd>
        <dt>Configuration</dt>
        <dd>
            A reference to the configuration node to be used.
        </dd>
        <dt>Base Time</dt>
        <dd>
            The base time is used for comparison with the operands of the
            conditions. This can be one of:
            <ul>
                <li>
                    <i>message ingress</i>: Ingress time of the input message.
                </li>
                <li>
                    <i>global</i>: Timestamp from a global variable as number
                    of milliseconds elapsed since the UNIX epoch.
                </li>
                <li>
                    <i>flow</i>: Timestamp from a flow variable as number of
                    milliseconds elapsed since the UNIX epoch.
                </li>
                <li>
                    <i>msg</i>: Timestamp from a message property as number of
                    milliseconds elapsed since the UNIX epoch.
                </li>
            </ul>
        </dd>
        <dt>Evaluation</dt>
        <dd>
            Specifies the evaluation method for forwarding messages based on the
            results of the conditions. This can be one of:
            <ul>
                <li>
                    <i>logical OR</i>: The message is forwarded if at least one
                    of the conditions evaluates to true.
                </li>
                <li>
                    <i>logical AND</i>: The message is forwarded only if all
                    conditions evaluate to true.
                </li>
                <li>
                    <i>annotation</i>: The message is always forwarded and
                    the results of the conditions are stored as array of boolean
                    values in the property <code>msg.evaluation</code>.
                </li>
                <li>
                    <i>expression</i>: The message is forwarded if the specified
                    JSONata expression evaluates to true. The results of the
                    conditions can be accessed through the variable <code>$condition</code>
                    which is an array of boolean values.
                </li>
            </ul>
        </dd>
        <dt>Conditions</dt>
        <dd>
            The list containing the conditions for filtering messages. New entries
            can be added using the button below the list. Existing entries can be
            reordered or deleted. Depending on the selected operator or source on
            the left side, the following possibilities are available:
            <ul>
                <li>
                    Operator <i>before</i>: Checks if the base time is earlier than the
                    specified time.
                </li>
                <li>
                    Operator <i>after</i>: Checks if the base time is equal to or later
                    than the specified time.
                </li>
                <li>
                    Operator <i>between</i>: Checks if the base time is equal to or later
                    than the first and earlier than the second specified time.
                </li>
                <li>
                    Operator <i>outside</i>: Checks if the base time is earlier than the
                    first or later than the second specified time.
                </li>
                <li>
                    Operator <i>days</i>: Checks if the base time matches special days
                    of a month. This can be the first, second, third, fourth, fifth or
                    last day, day of a week, workday or weekend day. Or it can be an
                    even day or a specific day of a specific month or every month. All
                    operands can be negated by activating the <i>Exclude</i> checkbox.
                </li>
                <li>
                    Operator <i>week days</i>: Checks if the base time matches one of
                    the selected week days.
                </li>
                <li>
                    Operator <i>months</i>: Checks if the base time matches one of the
                    selected months.
                </li>
                <li>
                    Source <i>expression</i>: The condition result is taken from the
                    provided JSONata expression. Additional time calculation functions
                    are supported and the base time can be accessed through variable
                    <code>$baseTime</code>.
                </li>
                <li>
                    Source <i>context</i>: Loads the condition from the specified
                    context variable. See chapter <i>Input</i> below for a description
                    of the required structure for the global or flow variable.
                </li>
            </ul>
            For the time input, depending on the selection on the left side, the
            following possibilities are available:
            <ul>
                <li>
                    <i>time of day</i>: A specific time can be entered directly
                    in the form <code>hh:mm[:ss] [am|pm]</code>.
                </li>
                <li>
                    <i>sun position</i>: The sun position can be selected from
                    a list of predefined values.
                </li>
                <li>
                    <i>moon position</i>: The moon position can be selected from
                    a list of predefined values.
                </li>
                <li>
                    <i>custom sun position</i>: One of the user-defined sun position names
                    can be entered.
                </li>
            </ul>
            The specified times can additionally be shifted by an (optionally
            randomized) offset, accessible through the double down arrow on the
            right side.
        </dd>
    </dl>
    <h3>Input</h3>
    <p>
        Incoming messages are either handed over to the output or discarded.
    </p>
    <p>
        Conditions can be dynamically programmed by configuring the corresponding
        condition to be loaded from a context variable (see chapter <i>Configuration</i>
        above). The appropriate variables must be objects containing the following
        properties:
    </p>
    <dl class="message-properties">
        <dt>operator<span class="property-type">string</span></dt>
        <dd>Operator for comparison; one of "before", "after", "between", "outside", "days", "weekdays" or "months"</dd>
        <dt class="optional">operands<span class="property-type">object | array</span></dt>
        <dd>Operands for comparison; content is depending on operator</dd>
    </dl>
    <p>
        If <code>operator</code> is:
        <ul>
            <li>"before" or "after", <code>operands</code> must be an object</li>
            <li>"between" or "outside", <code>operands</code> must be an array containing two objects corresponding to the first and second operand</li>
        </ul>
        The objects must each include the following properties:
    </p>
    <dl class="message-properties">
        <dt>type<span class="property-type">string</span></dt>
        <dd>Operand type; one of "time", "sun", "moon" or "custom"</dd>
        <dt>value<span class="property-type">string</span></dt>
        <dd>Operand value; content is depending on operand type</dd>
        <dt>offset<span class="property-type">number</span></dt>
        <dd>Offset to the operand time</dd>
        <dt>random<span class="property-type">boolean</span></dt>
        <dd>Randomized offset</dd>
    </dl>
    <p>
        If <code>operator</code> is "days", <code>operands</code> must be
        an object containing the following properties:
    </p>
    <dl class="message-properties">
        <dt>type<span class="property-type">string</span></dt>
        <dd>
            Operand type; one of "first", "second", "third", "fourth",
            "fifth", "last", "even" or "specific"
        </dd>
        <dt class="optional">day<span class="property-type">string | number</span></dt>
        <dd>
            Depending on the operand type the name of a day or the day
            of the month as number; not applicable for type "even"
        </dd>
        <dt class="optional">month<span class="property-type">string</span></dt>
        <dd>Name of the month; only applicable for type "specific"</dd>
        <dt>exclude<span class="property-type">boolean</span></dt>
        <dd>Negated result</dd>
    </dl>
    <p>
        If <code>operator</code> is "weekdays", <code>operands</code>
        must be an object. It may contain boolean properties with names of
        days of the week. If <code>true</code>, the condition is fullfilled
        for base times on that day or not fulfilled if the property is
        <code>false</code> or not present.
    </p>
    <p>
        If <code>operator</code> is "months", <code>operands</code>
        must be an object. It may contain boolean properties with names of
        months of the year. If <code>true</code>, the condition is fullfilled
        for base times in that month or not fulfilled if the property is
        <code>false</code> or not present.
    </p>
    <h3>Outputs</h3>
    <p>
        If one or multiple conditions match the configured base time according
        to the specified evaluation method, the message is sent out.
    </p>
    <p>
        Only if evaluation method <i>annotation</i> is activated:
    </p>
    <dl class="message-properties">
        <dt>evaluation<span class="property-type">array</span></dt>
        <dd>Contains evaluation results of every condition</dd>
    </dl>
</script>

</div><div><!-- --- [red-module:node-red-contrib-chronos/chronos-change] --- -->
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-template-name="chronos-change">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.name">
    </div>
    <div class="form-row">
        <label for="node-input-config"><i class="fa fa-cog"></i> <span data-i18n="node-red-contrib-chronos/chronos-config:common.label.config"></span></label>
        <input type="text" id="node-input-config" data-i18n="[placeholder]node-red-contrib-chronos/chronos-config:common.label.config">
    </div>
    <div class="form-row node-input-taskList-row" style="padding-top: 10px">
        <label for="node-input-taskList" style="width: auto;"><i class="fa fa-random"></i> <span data-i18n="change.label.rules"></span></label>
        <div class="form-row">
            <ol id="node-input-taskList"></ol>
        </div>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType("chronos-change",
    {
        category:     "chronos",
        color:        "#DEB887",
        icon:         "chronos_change.svg",
        inputs:       1,
        outputs:      1,
        paletteLabel: "time change",
        label: function()
        {
            return (this.name || this._("change.label.node"));
        },
        labelStyle: function()
        {
            return (this.name ? "node_label_italic" : "");
        },
        inputLabels: function()
        {
            return this._("node-red-contrib-chronos/chronos-config:common.label.inputPort");
        },
        outputLabels: function(index)
        {
            return this.conditions[index].label;
        },
        defaults:
        {
            name:
            {
                value: ""
            },
            config:
            {
                value:    "",
                type:     "chronos-config",
                required: true
            },
            rules:
            {
                value: [{action: "set", target: {type: "msg", name: "payload"}, type: "now"}],
                validate: function(v)
                {
                    // just a simple check if there are any conditions, no detailed check of the content
                    return v.length > 0;
                }
            }
        },
        oneditprepare: function()
        {
            let node = this;

            let taskList = $("#node-input-taskList").css("min-width", "510px").css("min-height", "150px").editableList(
            {
                removable: true,
                sortable: true,
                addItem: function(item, index, data)
                {
                    const sunTimes =
                    [
                        {
                            value: "nightEnd",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nightEnd")
                        },
                        {
                            value: "nauticalDawn",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nauticalDawn")
                        },
                        {
                            value: "dawn",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.dawn")
                        },
                        {
                            value: "sunrise",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunrise")
                        },
                        {
                            value: "sunriseEnd",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunriseEnd")
                        },
                        {
                            value: "goldenHourEnd",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.goldenHourEnd")
                        },
                        {
                            value: "solarNoon",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.solarNoon")
                        },
                        {
                            value: "goldenHour",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.goldenHour")
                        },
                        {
                            value: "sunsetStart",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunsetStart")
                        },
                        {
                            value: "sunset",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.sunset")
                        },
                        {
                            value: "dusk",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.dusk")
                        },
                        {
                            value: "nauticalDusk",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nauticalDusk")
                        },
                        {
                            value: "night",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.night")
                        },
                        {
                            value: "nadir",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.sun.nadir")
                        }
                    ];

                    const moonTimes =
                    [
                        {
                            value: "rise",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.moon.rise")
                        },
                        {
                            value: "set",
                            label: node._("node-red-contrib-chronos/chronos-config:common.list.moon.set")
                        }
                    ];

                    const numericValidator = function(event, ui)
                    {
                        var value = parseInt($(this).spinner("value"), 10);
                        var min = $(this).spinner("option", "min");
                        var max = $(this).spinner("option", "max");
                        if (isNaN(value) ||
                            (value < min))
                        {
                            $(this).spinner("value", min);
                        }
                        else if (value > max)
                        {
                            $(this).spinner("value", max);
                        }
                    };

                    const nowInput =
                    {
                        value: "now",
                        label: node._("change.label.now"),
                        icon: "fa fa-clock-o",
                        hasValue: false
                    };

                    const dateInput =
                    {
                        value: "date",
                        label: node._("change.label.date"),
                        icon: "fa fa-calendar",
                        hasValue: true,
                        validate: /^([2-9]\d\d\d)-([1-9]|0[1-9]|1[0-2])-([1-9]|0[1-9]|[12]\d|3[01])$/
                    };

                    const timeInput =
                    {
                        value: "time",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.time"),
                        icon: "fa fa-clock-o",
                        hasValue: true,
                        validate: /^(\d|0\d|1\d|2[0-3]):([0-5]\d)(:([0-5]\d))?\s*(am|AM|pm|PM)?$/
                    };

                    const sunTimeInput =
                    {
                        value: "sun",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.sun"),
                        icon: "fa fa-sun-o",
                        options: sunTimes
                    };

                    const moonTimeInput =
                    {
                        value: "moon",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.moon"),
                        icon: "fa fa-moon-o",
                        options: moonTimes
                    };

                    const customInput =
                    {
                        value: "custom",
                        label: node._("node-red-contrib-chronos/chronos-config:common.label.custom"),
                        icon: "fa fa-wrench",
                        hasValue: true,
                        validate: /^[a-zA-Z][0-9a-zA-Z_]*$/
                    };

                    const formatInput =
                    {
                        value: "format",
                        label: node._("change.label.format"),
                        icon: "fa fa-gears",
                        hasValue: true,
                        validate: /^.+$/
                    };

                    const partInput =
                    {
                        min: -270000,
                        max: 270000,
                        step: 1,
                        change: numericValidator
                    };

                    const addsubInput =
                    {
                        min: 1,
                        max: 1000000,
                        step: 1,
                        change: numericValidator
                    };

                    let fragment = document.createDocumentFragment();
                    let actionBox = $("<div/>").appendTo(fragment);
                    let setBox = $("<div/>", {style: "margin-top: 5px;"}).appendTo(fragment);
                    let changeBox = $("<div/>", {style: "margin-top: 5px;"}).appendTo(fragment);

                    let action = $("<select/>", {class: "node-input-action", style: "width: 120px;"})
                                        .append($("<option></option>").val("set").text(node._("change.list.action.set")))
                                        .append($("<option></option>").val("change").text(node._("change.list.action.change")))
                                        .appendTo(actionBox);

                    $("<label/>", {style: "margin-bottom: 0px; width: 120px; text-align: right;"})
                                        .text(node._("change.label.to"))
                                        .appendTo(setBox);
                    let setToBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 8px;"}).appendTo(setBox);
                    let setRow1 = $("<div/>").appendTo(setToBox);
                    let setRow2 = $("<div/>", {style: "margin-top: 5px;"}).appendTo(setToBox);

                    let property = $("<input/>", {type: "text", class: "node-input-property", style: "margin-left: 8px;"})
                                        .appendTo(actionBox)
                                        .typedInput({types: ["global", "flow", "msg"]});
                    property.typedInput("width", "280px");

                    let date = $("<input/>", {type: "text", class: "node-input-date"})
                                        .appendTo(setRow1)
                                        .typedInput({types: [nowInput, dateInput, "jsonata"]});
                    date.typedInput("width", "280px");
                    let time = $("<input/>", {type: "text", class: "node-input-time"})
                                        .appendTo(setRow2)
                                        .typedInput({types: [timeInput, sunTimeInput, moonTimeInput, customInput]});
                    time.typedInput("width", "280px");

                    let changeType = $("<select/>", {class: "node-input-changeType", style: "width: 120px;"})
                                        .append($("<option></option>").val("set").text(node._("change.list.changeType.set")))
                                        .append($("<option></option>").val("add").text(node._("change.list.changeType.add")))
                                        .append($("<option></option>").val("subtract").text(node._("change.list.changeType.subtract")))
                                        .append($("<option></option>").val("startOf").text(node._("change.list.changeType.startOf")))
                                        .append($("<option></option>").val("endOf").text(node._("change.list.changeType.endOf")))
                                        .append($("<option></option>").val("toString").text(node._("change.list.changeType.toString")))
                                        .appendTo(changeBox);

                    let setPartBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 8px;"}).appendTo(changeBox);
                    let addsubBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 8px;"}).appendTo(changeBox);
                    let startEndOfBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 8px;"}).appendTo(changeBox);
                    let toStringBox = $("<div/>", {style: "display: inline-block; vertical-align: middle; width: auto; margin-left: 8px;"}).appendTo(changeBox);

                    let setPartType = $("<select/>", {class: "node-input-setPartType", style: "width: auto;"})
                                        .append($("<option></option>").val("year").text(node._("change.list.unit.year")))
                                        .append($("<option></option>").val("quarter").text(node._("change.list.unit.quarter")))
                                        .append($("<option></option>").val("month").text(node._("change.list.unit.month")))
                                        .append($("<option></option>").val("week").text(node._("change.list.unit.week")))
                                        .append($("<option></option>").val("weekday").text(node._("change.list.unit.weekday")))
                                        .append($("<option></option>").val("day").text(node._("change.list.unit.day")))
                                        .append($("<option></option>").val("hour").text(node._("change.list.unit.hour")))
                                        .append($("<option></option>").val("minute").text(node._("change.list.unit.minute")))
                                        .append($("<option></option>").val("second").text(node._("change.list.unit.second")))
                                        .append($("<option></option>").val("millisecond").text(node._("change.list.unit.millisecond")))
                                        .appendTo(setPartBox);
                    $("<label/>", {style: "margin-bottom: 0px; width: auto; text-align: right; margin-left: 4px; margin-right: 4px;"})
                                        .text(node._("change.label.to"))
                                        .appendTo(setPartBox);
                    let setPartValue = $("<input/>", {class: "node-input-setPartValue", style: "width: 100px !important;"})
                                        .appendTo(setPartBox)
                                        .spinner(partInput);

                    let addsub = $("<input/>", {class: "node-input-addsub", style: "width: 100px !important;"})
                                        .appendTo(addsubBox)
                                        .spinner(addsubInput);
                    let addsubUnit = $("<select/>", {class: "node-input-addsubUnit", style: "width: auto; margin-left: 4px"})
                                        .append($("<option></option>").val("years").text(node._("change.list.unit.years")))
                                        .append($("<option></option>").val("quarters").text(node._("change.list.unit.quarters")))
                                        .append($("<option></option>").val("months").text(node._("change.list.unit.months")))
                                        .append($("<option></option>").val("weeks").text(node._("change.list.unit.weeks")))
                                        .append($("<option></option>").val("days").text(node._("change.list.unit.days")))
                                        .append($("<option></option>").val("hours").text(node._("change.list.unit.hours")))
                                        .append($("<option></option>").val("minutes").text(node._("change.list.unit.minutes")))
                                        .append($("<option></option>").val("seconds").text(node._("change.list.unit.seconds")))
                                        .append($("<option></option>").val("milliseconds").text(node._("change.list.unit.milliseconds")))
                                        .appendTo(addsubBox);

                    let startEndOfArg = $("<select/>", {class: "node-input-startEndOfArg", style: "width: auto;"})
                                        .append($("<option></option>").val("year").text(node._("change.list.unit.year")))
                                        .append($("<option></option>").val("quarter").text(node._("change.list.unit.quarter")))
                                        .append($("<option></option>").val("month").text(node._("change.list.unit.month")))
                                        .append($("<option></option>").val("week").text(node._("change.list.unit.week")))
                                        .append($("<option></option>").val("day").text(node._("change.list.unit.day")))
                                        .append($("<option></option>").val("hour").text(node._("change.list.unit.hour")))
                                        .append($("<option></option>").val("minute").text(node._("change.list.unit.minute")))
                                        .append($("<option></option>").val("second").text(node._("change.list.unit.second")))
                                        .appendTo(startEndOfBox);

                    let stringFormat = $("<input/>", {type: "text", class: "node-input-stringFormat", title: node._("change.label.format"), placeholder: "YYYY-MM-DD HH:mm:ss"})
                                        .appendTo(toStringBox)
                                        .typedInput({types: [formatInput]});
                    stringFormat.typedInput("width", "280px");

                    action.change(function()
                    {
                        setBox.hide();
                        changeBox.hide();

                        var value = $(this).val();
                        switch (value)
                        {
                            case "set":
                            {
                                setBox.show();
                                break;
                            }
                            case "change":
                            {
                                changeBox.show();
                                break;
                            }
                        }
                    });

                    changeType.change(function()
                    {
                        setPartBox.hide();
                        addsubBox.hide();
                        startEndOfBox.hide();
                        toStringBox.hide();

                        var value = $(this).val();
                        switch (value)
                        {
                            case "set":
                            {
                                setPartBox.show();
                                break;
                            }
                            case "add":
                            case "subtract":
                            {
                                addsubBox.show();
                                break;
                            }
                            case "startOf":
                            case "endOf":
                            {
                                startEndOfBox.show();
                                break;
                            }
                            case "toString":
                            {
                                toStringBox.show();
                                break;
                            }
                        }
                    });

                    setPartType.change(function()
                    {
                        var value = $(this).val();
                        switch (value)
                        {
                            case "year":
                            {
                                setPartValue.spinner("option", "min", -270000);
                                setPartValue.spinner("option", "max", 270000);
                                break;
                            }
                            case "quarter":
                            {
                                setPartValue.spinner("option", "min", 1);
                                setPartValue.spinner("option", "max", 4);
                                break;
                            }
                            case "month":
                            {
                                setPartValue.spinner("option", "min", 1);
                                setPartValue.spinner("option", "max", 12);
                                break;
                            }
                            case "week":
                            {
                                setPartValue.spinner("option", "min", 1);
                                setPartValue.spinner("option", "max", 52);
                                break;
                            }
                            case "weekday":
                            {
                                setPartValue.spinner("option", "min", 1);
                                setPartValue.spinner("option", "max", 7);
                                break;
                            }
                            case "day":
                            {
                                setPartValue.spinner("option", "min", 1);
                                setPartValue.spinner("option", "max", 31);
                                break;
                            }
                            case "hour":
                            {
                                setPartValue.spinner("option", "min", 0);
                                setPartValue.spinner("option", "max", 23);
                                break;
                            }
                            case "minute":
                            {
                                setPartValue.spinner("option", "min", 0);
                                setPartValue.spinner("option", "max", 59);
                                break;
                            }
                            case "second":
                            {
                                setPartValue.spinner("option", "min", 0);
                                setPartValue.spinner("option", "max", 59);
                                break;
                            }
                            case "millisecond":
                            {
                                setPartValue.spinner("option", "min", 0);
                                setPartValue.spinner("option", "max", 999);
                                break;
                            }
                        }

                        numericValidator.call(setPartValue);
                    });

                    date.on("change", function()
                    {
                        let type = date.typedInput("type");
                        if ((type === "now") || (type === "jsonata"))
                        {
                            setRow2.hide();
                        }
                        else
                        {
                            setRow2.show();
                        }
                    });

                    let now = new Date();
                    if (!("action" in data))
                    {
                        data = {action: "set", target: {type: "msg", name: "payload"}, type: "now"};
                    }

                    setRow2.hide();

                    // initialize to default
                    changeType.val("add");
                    addsubUnit.val("years");
                    startEndOfArg.val("year");
                    setPartType.val("year");
                    setPartValue.spinner("value", now.getFullYear().toString());
                    addsub.spinner("value", 1);

                    action.val(data.action);
                    property.typedInput("value", data.target.name);
                    property.typedInput("type", data.target.type);

                    if (data.action == "set")
                    {
                        date.typedInput("type", data.type);
                        if (data.type == "date")
                        {
                            date.typedInput("value", data.date);
                            time.typedInput("type", data.time.type);
                            time.typedInput("value", data.time.value);
                        }
                        else if (data.type == "jsonata")
                        {
                            date.typedInput("value", data.expression);
                        }
                    }
                    else if (data.action == "change")
                    {
                        if (data.type == "set")
                        {
                            setPartType.val(data.part);
                            setPartValue.spinner("value", data.value);
                        }
                        else if ((data.type == "add") || (data.type == "subtract"))
                        {
                            addsub.spinner("value", data.value);
                            addsubUnit.val(data.unit);
                        }
                        else if ((data.type == "startOf") || (data.type == "endOf"))
                        {
                            startEndOfArg.val(data.arg);
                        }
                        else if (data.type == "toString")
                        {
                            stringFormat.typedInput("value", data.format);
                        }
                        changeType.val(data.type);
                    }

                    action.change();
                    changeType.change();
                    setPartType.change();

                    item[0].appendChild(fragment);
                }
            });

            node.rules.forEach(data =>
            {
                taskList.editableList("addItem", data);
            });
        },
        oneditsave: function()
        {
            let node = this;

            let taskList = $("#node-input-taskList").editableList("items");
            node.rules = [];

            taskList.each(function(index)
            {
                let data = {};

                let action = $(this).find(".node-input-action");
                let property = $(this).find(".node-input-property");
                let date = $(this).find(".node-input-date");
                let time = $(this).find(".node-input-time");
                let changeType = $(this).find(".node-input-changeType");
                let setPartType = $(this).find(".node-input-setPartType");
                let setPartValue = $(this).find(".node-input-setPartValue");
                let addsub = $(this).find(".node-input-addsub");
                let addsubUnit = $(this).find(".node-input-addsubUnit");
                let startEndOfArg = $(this).find(".node-input-startEndOfArg");
                let stringFormat = $(this).find(".node-input-stringFormat");

                data.action = action.val();
                data.target = {};
                data.target.type = property.typedInput("type");
                data.target.name = property.typedInput("value");

                if (data.action == "set")
                {
                    data.type = date.typedInput("type");
                    if (data.type == "date")
                    {
                        data.date = date.typedInput("value");
                        data.time = {};
                        data.time.type = time.typedInput("type");
                        data.time.value = time.typedInput("value");
                    }
                    else if (data.type == "jsonata")
                    {
                        data.expression = date.typedInput("value");
                    }
                }
                else if (data.action == "change")
                {
                    data.type = changeType.val();
                    if (data.type == "set")
                    {
                        data.part = setPartType.val();
                        data.value = setPartValue.spinner("value");
                    }
                    else if ((data.type == "add") || (data.type == "subtract"))
                    {
                        data.value = addsub.spinner("value");
                        data.unit = addsubUnit.val();
                    }
                    else if ((data.type == "startOf") || (data.type == "endOf"))
                    {
                        data.arg = startEndOfArg.val();
                    }
                    else if (data.type == "toString")
                    {
                        data.format = stringFormat.typedInput("value");
                    }
                }

                node.rules.push(data);
            });
        },
        oneditresize: function(size)
        {
            let height = size.height;
            let conditionListRow = $("#dialog-form>div.node-input-taskList-row");
            let otherRows = $("#dialog-form>div:not(.node-input-taskList-row)");

            for (let i=0; i<otherRows.length; ++i)
            {
                height -= $(otherRows[i]).outerHeight(true);
            }

            height -= (parseInt(conditionListRow.css("marginTop")) + parseInt(conditionListRow.css("marginBottom")));
            height -= $("#dialog-form>div.node-input-taskList-row>label").outerHeight(true);

            $("#node-input-taskList").editableList("height", height);
        }
    });
</script>
<!--
Copyright (c) 2022 Jens-Uwe Rossbach

This code is licensed under the MIT License.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->

<script type="text/x-red" data-help-name="chronos-change">
    <p>
        Sets or changes time values from message properties, flow variables or
        global variables.
    </p>
    <h3>Details</h3>
    <p>
        This node sets message properties, flow variables or global variables
        to specific times or manipulates and converts timestamps from these
        input fields. Multiple actions can be configured per node which will be
        executed in the specified order. It is also possible to chain different
        actions for the same property or variable.
    </p>
    <p>
        For more information, please refer to the detailed documentation in the
        <a href="https://github.com/jensrossbach/node-red-contrib-chronos/wiki/Time-Change-Node">repository wiki</a>.
    </p>
    <h3>Configuration</h3>
    <dl>
        <dt>Name</dt>
        <dd>The name of the node (optional).</dd>
        <dt>Configuration</dt>
        <dd>
            A reference to the configuration node to be used.
        </dd>
        <dt>Change Rules</dt>
        <dd>
            <p>
                The list containing the rules for setting or changing target
                values. New entries can be added using the button below the
                list. Existing entries can be reordered or deleted. The following
                actions can be selected:
                <ul>
                    <li>
                        <i>Set</i>: Sets the selected target to a specific date
                        and time.
                    </li>
                    <li>
                        <i>Change</i>: Modifies the timestamp value of the
                        selected target according to the configured manipulation
                        and conversion rules. The original target value can be
                        either a number containing the milliseconds elapsed since
                        the UNIX epoch or a string containing a date and time
                        which must be parsable according to
                        <a href="https://momentjs.com/docs/#/parsing/string/">Moment.js documentation</a>.
                    </li>
                </ul>
            </p>
            <p>
                To the right of the rule action, the target to set or change
                can be selected. This can be either a message property, a flow
                variable or a global variable.
            </p>
            <p>
                For the set action, the following possibilities can be selected:
                <ul>
                    <li>
                        <i>current time</i>: Sets the target to the current time
                        of the current day.
                    </li>
                    <li>
                        <i>date and time</i>: Sets the target to a specific date
                        and time. See below for more details.
                    </li>
                    <li>
                        <i>expression</i>: Sets the target to the result of the
                        provided JSONata expression. Additional time calculation
                        functions are supported and the current target value can
                        be accessed through variable <code>$target</code>.
                    </li>
                </ul>
                For the date and time input, the date has to be entered in the
                form <code>YYYY-MM-DD</code> and the time can be provided in the
                following ways:
                <ul>
                    <li>
                        <i>time of day</i>: A specific time can be entered
                        directly in the form <code>hh:mm[:ss] [am|pm]</code>.
                    </li>
                    <li>
                        <i>sun position</i>: The sun position can be selected
                        from a list of predefined values.
                    </li>
                    <li>
                        <i>moon position</i>: The moon position can be selected
                        from a list of predefined values.
                    </li>
                    <li>
                        <i>custom sun position</i>: One of the user-defined sun position
                        names can be entered.
                    </li>
                </ul>
            </p>
            <p>
                For the change action, different types of manipulation and
                conversion can be selected:
                <ul>
                    <li>
                        <i>Set</i>: Modifies a part of the target timestamp.
                        The part to be changed can be selected in the dropdown
                        box.
                    </li>
                    <li>
                        <i>Add</i>: Adds time to the target timestamp. The amount
                        of time has to entered as number and the unit of time
                        to be added can be selected in the dropdown box.
                    </li>
                    <li>
                        <i>Subtract</i>: Similar to <i>Add</i>, but subtracts
                        time from the target timestamp.
                    </li>
                    <li>
                        <i>Start of</i>: Sets the target timestamp to the start
                        of a unit of time. The latter can be selected in the
                        dropdown box.
                    </li>
                    <li>
                        <i>End of</i>: Similar to <i>Start of</i>, but sets the
                        target timestamp to the end of a unit of time.
                    </li>
                    <li>
                        <i>Convert</i>: Converts the target timestamp to a
                        string representation. The format of the string is
                        specified via the text box and must follow the rules
                        from the <a href="https://momentjs.com/docs/#/displaying/format/">Moment.js documentation</a>.
                    </li>
                </ul>
            </p>
        </dd>
    </dl>
    <h3>Input</h3>
    <p>
        Incoming messages are modified if there are change rules containing
        message property based targets.
    </p>
    <h3>Outputs</h3>
    <p>
        The output port forwards any incoming message.
    </p>
</script></div></div><div id="red-ui-full-shade" class="hide"></div><div id="red-ui-notifications"></div><textarea type="text" id="red-ui-clipboard-hidden" tabindex="-1"></textarea><div id="red-ui-drop-target"><div data-i18n="[append]workspace.dropFlowHere"><i class="fa fa-download"></i><br>把流程放到这里</div></div><span class="red-ui-palette-label" style="position: absolute; top: -1000px;">time   change</span><span class="red-ui-flow-node-label" style="position: absolute; top: -1000px;">安装变动赋值</span><span class="red-ui-flow-port-tooltip-label" style="position: absolute; top: -1000px;">UTF8格式的字符串</span></div>
<script src="./Node-RED _ 192.168.50.1_files/vendor.js"></script><remove-web-limits-iqxin id="rwl-iqxin" class="rwl-exempt" style="position: fixed; top: 0px; left: 0px;"><qxinbutton type="qxinbutton" id="rwl-setbtn"> set </qxinbutton> <lalala style="cursor:move; font-size:12px;">限制解除</lalala> <input type="checkbox" name="" id="black_node"><style type="text/css">#rwl-iqxin{position:fixed;transform:translate(-95px,0);width:85px;height:25px;font-size:12px;font-weight: 500;font-family:Verdana, Arial, '宋体';color:#fff;background:#333;z-index:2147483647;margin: 0;opacity:0.05;transition:0.3s;overflow:hidden;user-select:none;text-align:center;white-space:nowrap;line-height:25px;padding:0 16px;border:1px solid #ccc;border-width:1px 1px 1px 0;border-bottom-right-radius:5px;box-sizing: content-box;}#rwl-iqxin input{margin: 0;padding: 0;vertical-align:middle;-webkit-appearance:checkbox;-moz-appearance:checkbox;position: static;clip: auto;opacity: 1;cursor: pointer;}#rwl-iqxin.rwl-active-iqxin{left: 0px;transform:translate(0,0);opacity: 0.9;height: 32px;line-height: 32px}#rwl-iqxin label{margin:0;padding:0;font-weight:500;}#rwl-iqxin #rwl-setbtn{margin: 0 4px 0 0;padding: 0 0 0 4px;border: none;border-radius: 2px;cursor: pointer;background: #fff;color: #000;} </style></remove-web-limits-iqxin>
<script src="./Node-RED _ 192.168.50.1_files/red.min.js"></script>
<script src="./Node-RED _ 192.168.50.1_files/main.min.js"></script>




<div tabindex="-1" role="dialog" class="ui-dialog red-ui-editor-dialog ui-widget ui-widget-content ui-front ui-dialog-buttons ui-draggable" aria-describedby="red-ui-library-dialog-save" style="display: none;" aria-labelledby="ui-id-1"><div class="ui-dialog-titlebar ui-corner-all ui-widget-header ui-helper-clearfix ui-draggable-handle"><span id="ui-id-1" class="ui-dialog-title">保存到库...</span><button type="button" class="ui-button ui-corner-all ui-widget ui-button-icon-only ui-dialog-titlebar-close hide" title="Close"><span class="ui-button-icon ui-icon ui-icon-closethick"></span><span class="ui-button-icon-space"> </span>Close</button></div><div id="red-ui-library-dialog-save" class="hide ui-dialog-content ui-widget-content" style="display: block;"><form class="form-horizontal"><div class="red-ui-library-dialog-box" style="height: 400px; position:relative; "><div id="red-ui-library-dialog-save-browser"><div class="red-ui-library-browser"><div class="red-ui-treeList" tabindex="0" style="width: 100%; height: 100%;"><div class="red-ui-treeList-container"><div class="red-ui-editableList" style="inset: 0px; position: absolute;"><div style="inset: 0px; position: absolute; max-height: none; overflow-y: scroll;" class="red-ui-editableList-border red-ui-editableList-container"><ol class="red-ui-treeList-list red-ui-editableList-list" style="position: static; inset: auto; height: auto;"></ol></div></div></div></div></div></div><div class="form-row"><label data-i18n="clipboard.export.exportAs">导出为</label><input id="red-ui-library-dialog-save-filename" type="text"></div></div></form></div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-corner-all ui-widget">取消</button><button type="button" id="red-ui-library-dialog-save-button" class="primary ui-button ui-corner-all ui-widget">保存</button></div></div></div><div tabindex="-1" role="dialog" class="ui-dialog red-ui-editor-dialog ui-widget ui-widget-content ui-front ui-dialog-buttons ui-draggable" aria-describedby="red-ui-library-dialog-load" style="display: none;" aria-labelledby="ui-id-2"><div class="ui-dialog-titlebar ui-corner-all ui-widget-header ui-helper-clearfix ui-draggable-handle"><span id="ui-id-2" class="ui-dialog-title">&nbsp;</span><button type="button" class="ui-button ui-corner-all ui-widget ui-button-icon-only ui-dialog-titlebar-close hide" title="Close"><span class="ui-button-icon ui-icon ui-icon-closethick"></span><span class="ui-button-icon-space"> </span>Close</button></div><div id="red-ui-library-dialog-load" class="hide ui-dialog-content ui-widget-content" style="display: block;"><form class="form-horizontal"><div class="red-ui-library-dialog-box" style="height: 400px; position:relative; "><div id="red-ui-library-dialog-load-panes" class="red-ui-panels red-ui-panels-horizontal"><div class="red-ui-panel" id="red-ui-library-dialog-load-browser"><div class="red-ui-library-browser"><div class="red-ui-treeList" tabindex="0" style="width: 100%; height: 100%;"><div class="red-ui-treeList-container"><div class="red-ui-editableList" style="inset: 0px; position: absolute;"><div style="inset: 0px; position: absolute; max-height: none; overflow-y: scroll;" class="red-ui-editableList-border red-ui-editableList-container"><ol class="red-ui-treeList-list red-ui-editableList-list" style="position: static; inset: auto; height: auto;"></ol></div></div></div></div></div></div><div class="red-ui-panels-separator ui-draggable ui-draggable-handle" style="position: relative;"></div><div class="red-ui-panel"><div id="red-ui-library-dialog-load-preview" class="red-ui-panels"><div class="red-ui-panel" id="red-ui-library-dialog-load-preview-text" style="position:relative; height: 50%; overflow-y: hidden;"></div><div class="red-ui-panels-separator ui-draggable ui-draggable-handle" style="position: relative;"></div><div class="red-ui-panel" id="red-ui-library-dialog-load-preview-details"><table id="red-ui-library-dialog-load-preview-details-table" class="red-ui-info-table"></table></div></div></div></div></div></form></div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-corner-all ui-widget">取消</button><button type="button" class="primary ui-button ui-corner-all ui-widget">读取</button></div></div></div><div class="red-ui-editor-dialog red-ui-popover-panel" style="display: none;"><ul class="red-ui-menu red-ui-menu-compact"><li><a href="http://192.168.50.1:1880/#">配置节点</a></li><li><a href="http://192.168.50.1:1880/#">未使用的配置节点</a></li><li><a href="http://192.168.50.1:1880/#">无效的节点</a></li><li><a href="http://192.168.50.1:1880/#">未知的节点</a></li><li><a href="http://192.168.50.1:1880/#">未使用的子流程</a></li></ul></div><div tabindex="-1" role="dialog" class="ui-dialog red-ui-editor-dialog ui-widget ui-widget-content ui-front ui-dialog-buttons ui-draggable" aria-describedby="red-ui-clipboard-dialog" style="display: none;" aria-labelledby="ui-id-3"><div class="ui-dialog-titlebar ui-corner-all ui-widget-header ui-helper-clearfix ui-draggable-handle"><span id="ui-id-3" class="ui-dialog-title">&nbsp;</span><button type="button" class="ui-button ui-corner-all ui-widget ui-button-icon-only ui-dialog-titlebar-close hide" title="Close"><span class="ui-button-icon ui-icon ui-icon-closethick"></span><span class="ui-button-icon-space"> </span>Close</button></div><div id="red-ui-clipboard-dialog" class="hide ui-dialog-content ui-widget-content" style="display: block;"><form class="dialog-form form-horizontal"></form></div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" id="red-ui-clipboard-dialog-cancel" class="ui-button ui-corner-all ui-widget">取消</button><button type="button" id="red-ui-clipboard-dialog-download" class="primary ui-button ui-corner-all ui-widget">下载</button><button type="button" id="red-ui-clipboard-dialog-export" class="primary ui-button ui-corner-all ui-widget">导出到剪贴板</button><button type="button" id="red-ui-clipboard-dialog-ok" class="primary ui-button ui-corner-all ui-widget">导入</button><button type="button" id="red-ui-clipboard-dialog-import-conflict" class="primary ui-button ui-corner-all ui-widget">导入所选项</button></div></div></div><div id="download_plus_animation"></div></body></html>