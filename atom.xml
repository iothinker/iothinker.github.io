<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>宁静致远</title>
  
  <subtitle>静心整理/分享生活</subtitle>
  <link href="https://www.wangxingyang.com/atom.xml" rel="self"/>
  
  <link href="https://www.wangxingyang.com/"/>
  <updated>2022-03-28T03:40:29.660Z</updated>
  <id>https://www.wangxingyang.com/</id>
  
  <author>
    <name>彤爸比</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>周末分享</title>
    <link href="https://www.wangxingyang.com/dayshare220327.html"/>
    <id>https://www.wangxingyang.com/dayshare220327.html</id>
    <published>2022-03-27T13:27:16.000Z</published>
    <updated>2022-03-28T03:40:29.660Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>南京疫情，居家办公一周了，周末在家就搞点事情做做，所以准备做些西点吃吃。</p></blockquote><h3 id="0-第一天"><a href="#0-第一天" class="headerlink" title="0.第一天"></a>0.第一天</h3><hr><p>白天没啥事情，就陪她玩玩，下去跑跑，晚上回来开始做纸杯蛋糕，步骤咱就不啰嗦了，晚上都有，这边交作业。看看结果如何吧。</p><p><img src="/img/20220327/1.jpg" alt="吃蛋糕🧁"></p><p><img src="/img/20220327/2.jpg" alt="吃蛋糕🧁"><br><img src="/img/20220327/3.jpg" alt="吃蛋糕🧁"></p><p><img src="/img/20220327/4.jpg" alt="新鲜出炉的🧁"></p><h3 id="1-第二天"><a href="#1-第二天" class="headerlink" title="1.第二天"></a>1.第二天</h3><hr><p>晚上准备来个披萨，做的时候发现材料没准备齐全，所以就带她出去玩玩，顺便买个材料，下面看看彤宝玩滑草板吧。</p><p><img src="/img/20220327/5.jpg" alt="坐在滑草板上"></p><p><img src="/img/20220327/6.jpg" alt="开滑"></p><p><img src="/img/20220327/7.jpg" alt="“头疼”的造型"></p><p><img src="/img/20220327/8.jpg" alt="👌造型"></p><p><img src="/img/20220327/9.jpg" alt="合照"></p><p><img src="/img/20220327/10.jpg" alt="哈哈又是一个OK"></p><p>下面看看披萨🍕的照片</p><p><img src="/img/20220327/11.jpeg" alt="烹饪中"></p><p><img src="/img/20220327/12.jpeg" alt="出锅的🍕"></p><h3 id="2-总结"><a href="#2-总结" class="headerlink" title="2.总结"></a>2.总结</h3><hr><p>周末自己动手做些之前没做过的东西还是很解压的。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;南京疫情，居家办公一周了，周末在家就搞点事情做做，所以准备做些西点吃吃。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-第一天&quot;&gt;&lt;a href=&quot;#0-第一天&quot; class=&quot;headerlink&quot; title=&quot;0.第一天&quot;&gt;&lt;/a&gt;</summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="遛娃" scheme="https://www.wangxingyang.com/tags/%E9%81%9B%E5%A8%83/"/>
    
    <category term="纸杯蛋糕" scheme="https://www.wangxingyang.com/tags/%E7%BA%B8%E6%9D%AF%E8%9B%8B%E7%B3%95/"/>
    
    <category term="披萨" scheme="https://www.wangxingyang.com/tags/%E6%8A%AB%E8%90%A8/"/>
    
  </entry>
  
  <entry>
    <title>Twikoo评论通知</title>
    <link href="https://www.wangxingyang.com/twikooComment.html"/>
    <id>https://www.wangxingyang.com/twikooComment.html</id>
    <published>2022-03-23T02:33:08.000Z</published>
    <updated>2022-03-23T06:44:53.663Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>博客上的评论系统是用的<a href="https://twikoo.js.org/">Twikoo</a>的，它是有评论邮件提醒功能的，我尝试了但是没有成功，所以就想用之前的自己搭的<code>Server酱</code>来实现新评论提醒功能。</p></blockquote><h3 id="0-抓包分析"><a href="#0-抓包分析" class="headerlink" title="0.抓包分析"></a>0.抓包分析</h3><hr><p>整个分析下来，主要的是请求的内容不一样，请求的URL地址都是一样的。<a href="https://tcb-api.tencentcloudapi.com/web?env=XXXXX">https://tcb-api.tencentcloudapi.com/web?env=XXXXX</a>，我是基于腾讯云函数搭建的，具体的教程之前的文章中也有写过，这边就不啰嗦了，这里主要用到两个函数。一个是刷新Token的，一个是获得评论的。内容如下：</p><pre class="line-numbers language-none"><code class="language-none">// 刷新Token{"action": "auth.fetchAccessTokenWithRefreshToken","dataVersion": "2020-01-10","env": "$env","refresh_token": "$refresh_token","seqId": "$seqId"}// 获得评论{"action": "functions.invokeFunction","dataVersion": "2020-01-10","env": "$env","function_name": "twikoo","request_data": "{\"event\":\"COMMENT_GET_FOR_ADMIN\",\"per\":5,\"page\":1}","access_token": "$access_token","seqId": "$seqId"};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这边有个小坑，就是用<code>Node-RED</code>的时候一直报如下的错误：</p><pre class="line-numbers language-none"><code class="language-none">{"code": "INVALID_APP_SIGN","message": "jwt must be provided","requestId": "bf131bb336c26"}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我用<code>PostMan</code>和<code>ApiPost</code>发送请求都能够成功，但是一到<code>Node-RED</code>上就报错，百思不解，最后把头全部搞过去，一个个排除，最后发现是头要加上<strong>origin</strong>这个头才行。加上这个之后，报错就变成了：</p><pre class="line-numbers language-none"><code class="language-none">{"code": "ACCESS_TOKEN_EXPIRED","message": "Access_token expired","requestId": "0e3de4a761649"}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个错误很明显了，Token过期了，所以只要刷新下Token一下就行了。</p><h3 id="1-开始写流"><a href="#1-开始写流" class="headerlink" title="1.开始写流"></a>1.开始写流</h3><hr><p>有了上面的铺垫，写起来就很简单了，有两种做法，一种是上来直接调用刷新<strong>token</strong>然后再调用获取评论，还有一种做法是先用缓存的<strong>token</strong>请求调用获取评论，如果返回<strong>token</strong>过期，则再刷新<strong>token</strong>再去请求。这边图省事就直接用第一种。<br><img src="/img/20220323/9f5f2aa893c74903a022079aa9b628a7.jpg" alt="Node-RED流"><br>JSON信息如下：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"4b5ebb669cd0e232"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"comment"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"网站评论数更新通知"</span><span class="token punctuation">,</span>        <span class="token property">"info"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"2eb6253b6231925f"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"inject"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"props"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"repeat"</span><span class="token operator">:</span> <span class="token string">"3600"</span><span class="token punctuation">,</span>        <span class="token property">"crontab"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"once"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"onceDelay"</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>        <span class="token property">"topic"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">70</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"de4ca953468e4720"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"de4ca953468e4720"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"function"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"刷新token"</span><span class="token punctuation">,</span>        <span class="token property">"func"</span><span class="token operator">:</span> <span class="token string">"var headers = {\n    \"content-type\": \"application/json;charset=UTF-8\",\n    \"origin\": \"https://www.wangxingyang.com\"\n};\n\nvar data = {\"action\":\"auth.fetchAccessTokenWithRefreshToken\",\"dataVersion\":\"2020-01-10\",\"env\":\"EEEEEE\",\"refresh_token\":\"EEEEE\",\"seqId\":\"437ef9ewde67\"};\n\nmsg.headers = headers;\n\nmsg.payload = JSON.stringify(data);\nreturn msg;"</span><span class="token punctuation">,</span>        <span class="token property">"outputs"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"noerr"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"initialize"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"finalize"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"libs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"439f033b91296d4d"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"439f033b91296d4d"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"http request"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"method"</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>        <span class="token property">"ret"</span><span class="token operator">:</span> <span class="token string">"obj"</span><span class="token punctuation">,</span>        <span class="token property">"paytoqs"</span><span class="token operator">:</span> <span class="token string">"ignore"</span><span class="token punctuation">,</span>        <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://tcb-api.tencentcloudapi.com/web?env=EEEEE"</span><span class="token punctuation">,</span>        <span class="token property">"tls"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"persist"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"proxy"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"authType"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"senderr"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">340</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"1093b292b44df7cf"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"1093b292b44df7cf"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"function"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"请求获取评论"</span><span class="token punctuation">,</span>        <span class="token property">"func"</span><span class="token operator">:</span> <span class="token string">"var headers = {\n    \"content-type\": \"application/json;charset=UTF-8\",\n    \"origin\": \"https://www.wangxingyang.com\"\n};\n\nvar data = {\n\t\"action\": \"functions.invokeFunction\",\n\t\"dataVersion\": \"2020-01-10\",\n\t\"env\": \"EEEEE\",\n\t\"function_name\": \"twikoo\",\n\t\"request_data\": \"{\\\"event\\\":\\\"COMMENT_GET_FOR_ADMIN\\\",\\\"per\\\":5,\\\"page\\\":1}\",\n\t\"access_token\": msg.payload.access_token,\n\t\"seqId\": \"c854eedewsc6\"\n};\n\nmsg.headers = headers;\n\nmsg.payload = JSON.stringify(data);\nreturn msg;"</span><span class="token punctuation">,</span>        <span class="token property">"outputs"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"noerr"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"initialize"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"finalize"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"libs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"f7ce907edcd55bcb"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"f7ce907edcd55bcb"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"http request"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"method"</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>        <span class="token property">"ret"</span><span class="token operator">:</span> <span class="token string">"obj"</span><span class="token punctuation">,</span>        <span class="token property">"paytoqs"</span><span class="token operator">:</span> <span class="token string">"ignore"</span><span class="token punctuation">,</span>        <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://tcb-api.tencentcloudapi.com/web?env=EEEEEE"</span><span class="token punctuation">,</span>        <span class="token property">"tls"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"persist"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"proxy"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"authType"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"senderr"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">660</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"9898c4f905717a13"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"9898c4f905717a13"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"property"</span><span class="token operator">:</span> <span class="token string">"payload.data.response_data"</span><span class="token punctuation">,</span>        <span class="token property">"action"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"pretty"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">790</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"7c1a5eb76c9ab46a"</span><span class="token punctuation">,</span>                <span class="token string">"d64dd8d502b22cff"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"7c1a5eb76c9ab46a"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"rbe"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"func"</span><span class="token operator">:</span> <span class="token string">"rbei"</span><span class="token punctuation">,</span>        <span class="token property">"gap"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"inout"</span><span class="token operator">:</span> <span class="token string">"out"</span><span class="token punctuation">,</span>        <span class="token property">"septopics"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"property"</span><span class="token operator">:</span> <span class="token string">"payload.data.response_data.count"</span><span class="token punctuation">,</span>        <span class="token property">"topi"</span><span class="token operator">:</span> <span class="token string">"topic"</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">910</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"9119b6c2921a0102"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"d48e19601ad7ae9f"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"http request"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"发送通知"</span><span class="token punctuation">,</span>        <span class="token property">"method"</span><span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>        <span class="token property">"ret"</span><span class="token operator">:</span> <span class="token string">"txt"</span><span class="token punctuation">,</span>        <span class="token property">"paytoqs"</span><span class="token operator">:</span> <span class="token string">"ignore"</span><span class="token punctuation">,</span>        <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://EEEEEEE.tencentcs.com/release/wecomchan?sendkey=EEEEE&amp;msg_type=text&amp;msg={{msgText}}&amp;to_user=EEEEE"</span><span class="token punctuation">,</span>        <span class="token property">"tls"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"persist"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"proxy"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"authType"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"senderr"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">1220</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"9119b6c2921a0102"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"function"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"评论变动赋值"</span><span class="token punctuation">,</span>        <span class="token property">"func"</span><span class="token operator">:</span> <span class="token string">"let nick = msg.payload.data.response_data.data[0].nick;\nlet url = msg.payload.data.response_data.data[0].link;\nlet commentText = msg.payload.data.response_data.data[0].commentText;\n\nmsg.msgText = \"📢|[\" + nick + \"] 在博客中评论道: [ \" + commentText + \" ];\"\nreturn msg;"</span><span class="token punctuation">,</span>        <span class="token property">"outputs"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"noerr"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"initialize"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"finalize"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"libs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">1060</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"d48e19601ad7ae9f"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"d64dd8d502b22cff"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"debug"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"active"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"tosidebar"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"console"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"tostatus"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token string">"true"</span><span class="token punctuation">,</span>        <span class="token property">"targetType"</span><span class="token operator">:</span> <span class="token string">"full"</span><span class="token punctuation">,</span>        <span class="token property">"statusVal"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"statusType"</span><span class="token operator">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">910</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后的通知结果如下：<br><img src="/img/20220323/962596d93e1a411a9a2aacd25fa491de.jpg" alt="通知结果"><br>这样就搞定了。因为没有什么实时性要求，所以这边是每个小时获取一次。如果获取时间间隔比较短，建议把Token缓存起来。</p><h3 id="2-写在最后"><a href="#2-写在最后" class="headerlink" title="2.写在最后"></a>2.写在最后</h3><hr><p>很多时候想做一些事情，但是如果你没有沉下心来做，很多时候你只会停留在想象的阶段，所以做事还是得动手。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;博客上的评论系统是用的&lt;a href=&quot;https://twikoo.js.org/&quot;&gt;Twikoo&lt;/a&gt;的，它是有评论邮件提醒功能的，我尝试了但是没有成功，所以就想用之前的自己搭的&lt;code&gt;Server酱&lt;/code&gt;来实现新评论提醒功能。&lt;</summary>
      
    
    
    
    
    <category term="Node-RED" scheme="https://www.wangxingyang.com/tags/Node-RED/"/>
    
    <category term="Twikoo" scheme="https://www.wangxingyang.com/tags/Twikoo/"/>
    
    <category term="评论" scheme="https://www.wangxingyang.com/tags/%E8%AF%84%E8%AE%BA/"/>
    
  </entry>
  
  <entry>
    <title>Homebridge和Node-RED组合</title>
    <link href="https://www.wangxingyang.com/node-red.html"/>
    <id>https://www.wangxingyang.com/node-red.html</id>
    <published>2022-03-17T00:43:12.000Z</published>
    <updated>2022-03-17T07:07:14.254Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近有开始折腾了，树莓派又整出来了。之前系统总是崩，所以这次给他刷原生的系统。准备把路由器上的<code>Node-RED</code>和<code>Homebridge</code>给迁移到这个上面。虽然之前运行的狠稳定，但是树莓派总吃灰也不好。</p></blockquote><h3 id="0-树莓派散热"><a href="#0-树莓派散热" class="headerlink" title="0.树莓派散热"></a>0.树莓派散热</h3><hr><p>树莓派之前壳子上的风扇坏了，转起来的声音贼大，所以考虑给他换一个风扇，这不网上买了一个，回来装上后，效果非常不错，温度基本稳定在<code>50度</code>以下，而且非常的静音。这个风扇是PWN调速的，照着设置了下。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 修改/boot/config.txt 增加如下内容dtoverlay=gpio-fan,gpiopin=18,temp=55000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>下图是我买的风扇。做工不错，值得推荐<br><img src="/img/20220317/ad32742fe75ea4827e8ca54ef6dcf4ae.jpg" alt="PWN风扇"></p><h3 id="1-家庭中枢自动充电"><a href="#1-家庭中枢自动充电" class="headerlink" title="1.家庭中枢自动充电"></a>1.家庭中枢自动充电</h3><hr><p>之前路由器重启了下，<code>Homebridge</code>的相关配置就没了，这就更加坚定了迁移到树莓派上的决心。所以就三下五除二整了起来，整好之后想在外面控制的话就得有<code>家庭中枢</code>之前的<strong>iPad mini</strong>就派上用场了，用了一段时间，遇到了一个问题，就是这个<strong>iPad</strong>平时不会用，所以就不会充电，用一段时间后，电池没电了，导致在外面就控制不了家中的设备了。所以就开始找解决方案了。最后终于给我整到了，下面就和大家分享一下我的整的流程吧。</p><h4 id="0-Homebridge安装"><a href="#0-Homebridge安装" class="headerlink" title="0.Homebridge安装"></a>0.Homebridge安装</h4><p>这个过程就不多说了，网上都有的，所以咱就不整了参看<a href="https://sspai.com/post/59636#!">HomeBridge 操作指南：从零开始，将你的米家设备接入 Homekit</a>这个文章吧。</p><h4 id="1-安装Node-RED"><a href="#1-安装Node-RED" class="headerlink" title="1.安装Node-RED"></a>1.安装Node-RED</h4><p>这边也不说了，放个官网的连接<a href="https://nodered.org/docs/getting-started/raspberrypi">Running on Raspberry Pi</a>，参看这个就安装<code>Node-RED</code>。下面就开始整了</p><h4 id="2-流程简介"><a href="#2-流程简介" class="headerlink" title="2.流程简介"></a>2.流程简介</h4><p>首先得能获得<strong>iPad</strong>的当前的状态，在GitHub上找了下，找到了这个<code>node-red-contrib-apple-find-me</code>插件，通过他就能获得我们所有设备的状态。里面的信息很多，其他的都不要，要当前手机的电量和是否在充电的状态就行。这个结果也被我推到路由器的上面。这个后面用来做<strong>Homebridge</strong>的插件。搞完之后的流程是这样的。</p><p><img src="/img/20220317/19d22e3dc625bc9bd1038b1b703505da.jpg" alt="流"></p><p>流程是通过<code>Apple Find Me</code>拿到相关状态，然后经过逻辑判断，发送报文到<strong>MQTT</strong>的<code>plugswitch</code>这个主题上。在路由器上写了一个订阅这个主题的程序，接收到后，通过<code>python-miio</code>来控制开关的状态，当然这一步你可以直接安装<strong>miio</strong>插件完成也是可以的。到此就完成了家庭中枢的自动充电了。</p><h3 id="2-Homebridge的周边"><a href="#2-Homebridge的周边" class="headerlink" title="2.Homebridge的周边"></a>2.Homebridge的周边</h3><hr><h4 id="0-电池状态显示"><a href="#0-电池状态显示" class="headerlink" title="0.电池状态显示"></a>0.电池状态显示</h4><p>上面推到路由器上的数据写了一个获得当前状态的插件。<br><img src="/img/20220317/3c8b4717928cb4e10032eb6bf2e4c818.jpg" alt="插件展示"><br>目录结构是这样的：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">homebridge-appledevice/├── index.js└── package.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>下面的是代码：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> inherits <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>inherits<span class="token punctuation">;</span><span class="token keyword">const</span> version <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token punctuation">;</span><span class="token keyword">let</span> Service<span class="token punctuation">;</span><span class="token keyword">let</span> Characteristic<span class="token punctuation">;</span><span class="token keyword">let</span> logger<span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token constant">API</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">homebridge</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token constant">API</span><span class="token operator">=</span>homebridge<span class="token punctuation">;</span>Service <span class="token operator">=</span> homebridge<span class="token punctuation">.</span>hap<span class="token punctuation">.</span>Service<span class="token punctuation">;</span>Characteristic <span class="token operator">=</span> homebridge<span class="token punctuation">.</span>hap<span class="token punctuation">.</span>Characteristic<span class="token punctuation">;</span>homebridge<span class="token punctuation">.</span><span class="token function">registerAccessory</span><span class="token punctuation">(</span><span class="token string">'homebridge-appledevice'</span><span class="token punctuation">,</span> <span class="token string">'AppleDevice'</span><span class="token punctuation">,</span> AppleDevice<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">AppleDevice</span><span class="token punctuation">(</span><span class="token parameter">log<span class="token punctuation">,</span> config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>logger <span class="token operator">=</span> log<span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>services <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> config<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">'iPad'</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> config<span class="token punctuation">.</span>num <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>interval<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">360000</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>statusLowBattery <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>batteryLevel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>chargingState <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token class-name">AppleDevice</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token function-variable function">updateStatus</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://192.168.xxx.xxx/_api/home'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>            resp<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                data <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        resp<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">let</span> devices <span class="token operator">=</span> ret<span class="token punctuation">.</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>home_devices<span class="token punctuation">;</span>                <span class="token keyword">let</span> devList <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>devices<span class="token punctuation">)</span><span class="token punctuation">;</span>                that<span class="token punctuation">.</span>batteryLevel <span class="token operator">=</span> devList<span class="token punctuation">[</span>that<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">[</span>that<span class="token punctuation">.</span>num<span class="token punctuation">]</span><span class="token punctuation">.</span>batteryLevel<span class="token punctuation">;</span>                that<span class="token punctuation">.</span>displayName <span class="token operator">=</span> devList<span class="token punctuation">[</span>that<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">[</span>that<span class="token punctuation">.</span>num<span class="token punctuation">]</span><span class="token punctuation">.</span>displayName<span class="token punctuation">;</span>                <span class="token keyword">let</span> status <span class="token operator">=</span> devList<span class="token punctuation">[</span>that<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">[</span>that<span class="token punctuation">.</span>num<span class="token punctuation">]</span><span class="token punctuation">.</span>batteryState<span class="token punctuation">;</span>                <span class="token comment">//console.log("batteryLevel: " + that.batteryLevel);</span>                <span class="token comment">//console.log("status: " + status);</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"NotCharging"</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    that<span class="token punctuation">.</span>batteryService<span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>ChargingState<span class="token punctuation">,</span> Characteristic<span class="token punctuation">.</span>ChargingState<span class="token punctuation">.</span><span class="token constant">NOT_CHARGING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    that<span class="token punctuation">.</span>batteryService<span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>ChargingState<span class="token punctuation">,</span> Characteristic<span class="token punctuation">.</span>ChargingState<span class="token punctuation">.</span><span class="token constant">CHARGING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                                <span class="token keyword">if</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>batteryLevel <span class="token operator">&lt;=</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    that<span class="token punctuation">.</span>batteryService<span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>StatusLowBattery<span class="token punctuation">,</span> Characteristic<span class="token punctuation">.</span>StatusLowBattery<span class="token punctuation">.</span><span class="token constant">BATTERY_LEVEL_LOW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    that<span class="token punctuation">.</span>batteryService<span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>StatusLowBattery<span class="token punctuation">,</span> Characteristic<span class="token punctuation">.</span>StatusLowBattery<span class="token punctuation">.</span><span class="token constant">BATTERY_LEVEL_NORMAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                                that<span class="token punctuation">.</span>batteryService<span class="token punctuation">.</span><span class="token function">getCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>BatteryLevel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateValue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>batteryLevel<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Error: "</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function-variable function">identify</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function-variable function">getServices</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>serviceInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Service<span class="token punctuation">.</span>AccessoryInformation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>serviceInfo        <span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>Manufacturer<span class="token punctuation">,</span> <span class="token string">'Apple'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>Model<span class="token punctuation">,</span> <span class="token string">"Battery"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>SerialNumber<span class="token punctuation">,</span> <span class="token string">"1353234"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>FirmwareRevision<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>batteryService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Service<span class="token punctuation">.</span>BatteryService</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>serviceInfo <span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>batteryService<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-Scriptable插件"><a href="#1-Scriptable插件" class="headerlink" title="1.Scriptable插件"></a>1.Scriptable插件</h4><p>这个插件是真的好看，不过一开始遇到一个坑，上面的图标不能下载下来，一直报错，最后自己下载下来放进去就可以的。<br><img src="/img/20220317/da07027bd952f37b952cf653fe6926bb.jpg" alt="小组件"></p><h3 id="3-总结"><a href="#3-总结" class="headerlink" title="3.总结"></a>3.总结</h3><hr><p>后面在优化再整哈，学无止境。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;最近有开始折腾了，树莓派又整出来了。之前系统总是崩，所以这次给他刷原生的系统。准备把路由器上的&lt;code&gt;Node-RED&lt;/code&gt;和&lt;code&gt;Homebridge&lt;/code&gt;给迁移到这个上面。虽然之前运行的狠稳定，但是树莓派总吃灰也不好。</summary>
      
    
    
    
    <category term="智能家居" scheme="https://www.wangxingyang.com/categories/%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85/"/>
    
    
    <category term="Node-RED" scheme="https://www.wangxingyang.com/tags/Node-RED/"/>
    
    <category term="HomeBridge" scheme="https://www.wangxingyang.com/tags/HomeBridge/"/>
    
    <category term="树莓派" scheme="https://www.wangxingyang.com/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/"/>
    
  </entry>
  
  <entry>
    <title>周末分享</title>
    <link href="https://www.wangxingyang.com/dayshare220219.html"/>
    <id>https://www.wangxingyang.com/dayshare220219.html</id>
    <published>2022-02-21T03:23:30.000Z</published>
    <updated>2022-03-07T14:44:33.557Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>周末到了，天气也还不错，好久没有出去玩了。早上起来之后准备去梅花山逛逛。</p></blockquote><h3 id="0-梅花山"><a href="#0-梅花山" class="headerlink" title="0. 梅花山"></a>0. 梅花山</h3><hr><p>早上起来的比较晚，所以随便吃吃就出发了，这次听了彤宝的话，开车去的梅花山，最后发现开车真的是个不明智的选择，停车费贼不便宜，<strong>20元/小时</strong>。这边之前带彤彤来过的，只是没有逛梅花山♣️⛰️，这次专门来看花的，过来之后就纯看花，天气还是有点冷的，所以看了一会会就回家了。下面就看看看咱们排的一些照片吧。</p><p><img src="/img/20220219/1.JPG" alt="看看够不够的着"></p><p><img src="/img/20220219/2.JPG" alt="够着了"></p><p><img src="/img/20220219/3.JPG" alt="啥东西这么这么吸引人"></p><p><img src="/img/20220219/4.JPG" alt="好像也没啥"></p><p><img src="/img/20220219/5.JPG" alt="抓拍"></p><p><img src="/img/20220219/6.JPG" alt="比耶"></p><h3 id="1-总结"><a href="#1-总结" class="headerlink" title="1.总结"></a>1.总结</h3><hr><p>那天去还是比较冷的，梅花也没完全开放，后面有时间再去看看。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;周末到了，天气也还不错，好久没有出去玩了。早上起来之后准备去梅花山逛逛。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-梅花山&quot;&gt;&lt;a href=&quot;#0-梅花山&quot; class=&quot;headerlink&quot; title=&quot;0. 梅花山&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="遛娃" scheme="https://www.wangxingyang.com/tags/%E9%81%9B%E5%A8%83/"/>
    
    <category term="梅花山" scheme="https://www.wangxingyang.com/tags/%E6%A2%85%E8%8A%B1%E5%B1%B1/"/>
    
  </entry>
  
  <entry>
    <title>米家养生壶定时烹饪</title>
    <link href="https://www.wangxingyang.com/health-pot.html"/>
    <id>https://www.wangxingyang.com/health-pot.html</id>
    <published>2022-01-06T02:19:40.000Z</published>
    <updated>2022-01-12T07:57:20.802Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>冬天来了，老妈也不想早起烧水了，让我用手机预约，但是米家里没有定时烹饪，我自己又总会忘记。让她自己预约，她说不会，这不就想搞的简单点，让他能够自己操作，或者不用操作，所以就有了现在这个。</p></blockquote><h3 id="0-基本信息"><a href="#0-基本信息" class="headerlink" title="0.基本信息"></a>0.基本信息</h3><hr><p><code>token</code>的获取，网上有很多的方法，我用的是从<code>SQLite</code>里面查的。拿到令牌后就可以执行一下命令，得到养生壶的基本信息了。<br><strong>获得米家养生壶基本信息</strong></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">miiocli device --ip 192.168.xxx.xxx --token ff11axxxxxxxxxxx2ff info<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>IP</code>:  <strong>192.168.xxx.xxx</strong><br><code>token</code> : <strong>ff11axxxxxxxxxxx2ff</strong><br><code>Model</code>: <strong>chunmi.health_pot.a1</strong><br><code>Hardware version</code>: <strong>esp32</strong><br><code>Firmware version</code>: <strong>2.1.8_0006</strong></p><p>🏠  &lt;—–&gt;  ☁️  &lt;—–📱</p><ol><li>手机发送指令给巴法云，控制定时器的开关</li><li>家中的Node-Red和应用程序分别订阅相关主题</li><li>如果定时任务打开，到指定时间会想巴法云推送开始烹饪的指令</li><li>程序收到相关指令就开始操作养生壶烹饪</li></ol><p>其实这个比较绕了，可以直接crontab定时调用程序就行了，但是想小程序控制就绕了一圈。</p><h3 id="1-miio获取相关信息"><a href="#1-miio获取相关信息" class="headerlink" title="1.miio获取相关信息"></a>1.miio获取相关信息</h3><hr><p>下面是一些miio获取的命令，可以参照一下。集体的属性要看它的文档，相关链接在文章的末尾，可以参看。</p><p> <strong>获得当前状态</strong></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">miiocli -d device --ip 192.168.xxx.xxx --token ff11axxxxxxxxxxx2ff raw_command get_properties "[{'did': 'status', 'piid': 1, 'siid': 2} ]"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>  <strong>获得错误码</strong><br> </p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">miiocli -d device --ip 192.168.xxx.xxx --token ff11axxxxxxxxxxx2ff raw_command get_properties "[{'did': 'fault', 'piid': 2, 'siid': 2} ]"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><br> <img src="/img/20220106/e5513d8426c38a84778fc3cda6579785.jpg" alt="属性截图"><br> 动作的参数经过多方查找和尝试，最后在<strong>python-miio</strong>的<strong>issues</strong>里面找到了正确的写法。<br> <img src="/img/20220106/28ab48f35bc638e649ca27584aa71a51.jpg" alt="命令写法"><br> 经过尝试，总结出了如下的命令：<br>   <strong>开始烧水</strong><p></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">miiocli -d device --ip 192.168.xxx.xxx --token ff11axxxxxxxxxxx2ff raw_command action "[{'did': 'start-cook', 'aiid': 1, 'siid': 2, 'in': [{'piid': 3, 'value': 4}]} ]"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>   <strong>取消烹饪</strong></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">miiocli -d device --ip 192.168.xxx.xxx --token ff11axxxxxxxxxxx2ff raw_command action "[{'did': 'cancel-cooking', 'aiid': 2, 'siid': 2}]"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p> <img src="/img/20220106/37df2befafca69c8cd3f650480eade6d.jpg" alt="动作截图"></p><h3 id="2-路由器上安装-python-miio"><a href="#2-路由器上安装-python-miio" class="headerlink" title="2.路由器上安装 python-miio"></a>2.路由器上安装 python-miio</h3><hr> <pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 安装相关包opkg install python3-pip opkg install python3-devopkg install gcc# 安装 python-miiopip install python-miio<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-代码编写-调试"><a href="#3-代码编写-调试" class="headerlink" title="3.代码编写/调试"></a>3.代码编写/调试</h3><hr><p>在路由上起一个服务，订阅巴法云上的主题来控制养生壶动作。代码就不贴了，没啥特别的。然后把定时放到<strong>Node-Red</strong>上，也可以用<strong>crontab</strong>定时，这个看自己实现方式了。但是在控制的时候运行报错，报<strong>No module named ‘_cffi_backend‘</strong>，截图如下：</p><p> <img src="/img/20220106/7707ebe64e8513b30b2dc4a8e5986d9b.jpg" alt="报错截图"></p><p> 网上多半说是因为没有安装 <code>cffi</code> ，但是实际情况是已经安装好了的，最后看<a href="https/img/20220106//stackoverflow.editcode.net/thread-39527-1-1.html">找不到32位Python的_cffi_backend。如何检查共享对象的预期后缀？</a>看了这个文章，是不是因为文件名的问题，我尝试了一下，把之前的拷贝了一份，发现可以成功运行了。<br> </p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cd /tmp/mnt/sda/entware/lib/python3.9/site-packagescp ./_cffi_backend.cpython-39-aarch64-linux-gnu.so _cffi_backend.sofind . -name "*_cffi_backend*"|./_cffi_backend.so|./_cffi_backend.cpython-39-aarch64-linux-gnu.so<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p><p> 在<strong>Node-Red</strong>中添加<strong>node-red-contrib-chronos</strong>节点，实现定时功能。小程序上实现定时器的开关。<br> <img src="/img/20220106/17b02a69037a7358721b018fbf3489b7.jpg" alt="Node-Red截图"><br> 实战了下，在早上5:30成功的烧水了，加了server酱的通知。<br> <img src="/img/20220106/ca03fe462eef2cc7df970d7d76a7ebdc.jpg" alt="通知截图"></p><h3 id="4-总结"><a href="#4-总结" class="headerlink" title="4.总结"></a>4.总结</h3><hr><p>这个其实很早之前就想整了，但是之前一直都没成功，后面就搁浅了。这不功夫不负苦心人，终于搞定了。所以只要坚持就是胜利啊。</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><hr><p><a href="https://github.com/fineemb/Xiaomi-Smart-Multipurpose-Kettle/blob/master/custom_components/xiaomi_miio_health_pot/__init__.py">小米养生壶接入</a><br><a href="https://post.smzdm.com/p/az5g23x0/">米家miot设备接入HA</a><br><a href="http://miot-spec.org/miot-spec-v2/instances?status=all">MIOTALL</a><br><a href="https://miot-spec.org/miot-spec-v2/instance?type=urn:miot-spec-v2:device:health-pot:0000A051:chunmi-a1:3">chunmi.health_pot.a1</a><br><a href="https://github.com/al-one/hass-xiaomi-miot/blob/master/README_zh.md">Xiaomi Miot For HomeAssistant</a><br><a href="https://github.com/rytilahti/python-miio/issues/543">python-miio issues</a><br><a href="https://stackoverflow.editcode.net/thread-39527-1-1.html">找不到32位Python的_cffi_backend。如何检查共享对象的预期后缀？</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;冬天来了，老妈也不想早起烧水了，让我用手机预约，但是米家里没有定时烹饪，我自己又总会忘记。让她自己预约，她说不会，这不就想搞的简单点，让他能够自己操作，或者不用操作，所以就有了现在这个。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-基本</summary>
      
    
    
    
    <category term="智能家居" scheme="https://www.wangxingyang.com/categories/%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85/"/>
    
    
    <category term="miio" scheme="https://www.wangxingyang.com/tags/miio/"/>
    
    <category term="米家" scheme="https://www.wangxingyang.com/tags/%E7%B1%B3%E5%AE%B6/"/>
    
    <category term="Node-Red" scheme="https://www.wangxingyang.com/tags/Node-Red/"/>
    
  </entry>
  
  <entry>
    <title>百度文库复制破解</title>
    <link href="https://www.wangxingyang.com/baiduwenku.html"/>
    <id>https://www.wangxingyang.com/baiduwenku.html</id>
    <published>2021-12-28T13:16:46.000Z</published>
    <updated>2022-02-16T02:23:49.341Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近老婆告诉我，百度文库突然不能复制了，我记得之前都是好好的啊，除非它改版了，这不看了一下，还真的是改版了。使命必达，下面就和我一起找找破解之法吧。</p></blockquote><h3 id="Greasy-Fork相关信息："><a href="#Greasy-Fork相关信息：" class="headerlink" title="Greasy Fork相关信息："></a>Greasy Fork相关信息：</h3><hr><div style="display: flex;justify-content:flex-end;flex-direction:row"><div style="background-size: cover;background:url('https://palerock.cn/node-service/images/greasyfork/views-info/440057') no-repeat;width:100%">&nbsp;</div><div style="background-size:cover;background:url('https://palerock.cn/node-service/images/greasyfork/stats/daily-installs/440057') no-repeat;width:100%">&nbsp;</div><div style="background-size: cover;background:url('https://palerock.cn/node-service/images/greasyfork/stats/daily-updates/440057') no-repeat;width:100%">&nbsp;</div><div style="background-size: cover;background:url('https://palerock.cn/node-service/images/greasyfork/stats/total-installs/440057') no-repeat;width:100%">&nbsp;</div></div><blockquote><p><strong>更新日志：</strong></p><hr><p>20220210：</p><ol><li>美化显示格式</li><li>增加第一获取失败提示</li><li>图片可以显示</li></ol><p>20220215:</p><ol><li>提交脚本到<strong>Greasy Fork</strong> ，<a href="https://greasyfork.org/zh-CN/scripts/440057-%E7%99%BE%E5%BA%A6%E6%96%87%E5%BA%93%E6%8B%B7%E8%B4%9D%E7%A0%B4%E8%A7%A3">脚本安装地址</a>在这里</li><li>增加Greasy Fork相关信息展示</li></ol></blockquote><h3 id="0-思路与过程"><a href="#0-思路与过程" class="headerlink" title="0.思路与过程"></a>0.思路与过程</h3><hr><p>从下图可以看到，现在的文章是写在<strong>canvas</strong>里的，感觉他应该是在前端渲染的，所以肯定有相关文章数据，接下来就开始找渲染的数据。<br><img src="/img/20211228/261b2163dddab25dc3606bf5823d741a.jpg" alt="文章节点定位"><br>看了一下下图请求的数据，发现下面这几个请求比较符合。里面是数据也能匹配上文章内容。<br><img src="/img/20211228/ad0da574d3e44ee693e4bedf95978059.jpg" alt="有用的数据"><br>但是这些请求链接有点过分的长，参数也很多，想要把参数弄齐不是件简单的事情，所以想想是不是有别的地方有这个数据。这不看了一下页面数据，找到了一个<code>pageData</code>这个变量，看名字是<strong>页面数据</strong>，拿出来看看数据是啥样的。下图是格式化后的数据。<br><img src="/img/20211228/df726260f5b2e3886e4c6d27d3ac968a.jpg" alt="页面数据"><br>发现这个变量里面是有相关数据的，这不就可以开始撸代码了。</p><h3 id="1-编码"><a href="#1-编码" class="headerlink" title="1.编码"></a>1.编码</h3><hr><p>这边使用的是<strong>油猴</strong>，英文名是<code>Tampermonkey</code>来开发脚本的。之前一直用，但是没有开发过它的脚本，好在是<code>JavaScript</code>的，所以搞起来很快。</p><blockquote><p>Tampermonkey 是一款免费的浏览器扩展和最为流行的用户脚本管理器，它适用于 Chrome, Microsoft Edge, Safari, Opera Next, 和 Firefox。<br>虽然有些受支持的浏览器拥有原生的用户脚本支持，但 Tampermonkey 将在您的用户脚本管理方面提供更多的便利。 它提供了诸如便捷脚本安装、自动更新检查、标签中的脚本运行状况速览、内置的编辑器等众多功能， 同时Tampermonkey还有可能正常运行原本并不兼容的脚本。</p></blockquote><p>有了前面的铺垫，编码其实很简单了，就不着重介绍了，代码贴出来，可以自己试试，写的仓促，弹窗和按钮用的别人脚本里的，有功夫的话可以自己画画写写。功能可以使用，后面在慢慢优化。油猴的安装方法和相关的API大家可以自行查找，还是很多的。</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ==UserScript==</span><span class="token comment">// @name         百度文库拷贝</span><span class="token comment">// @namespace    http://tampermonkey.net/</span><span class="token comment">// @homepage     https://www.wangxingyang.com/baiduwenku.html</span><span class="token comment">// @version      0.2</span><span class="token comment">// @description  破解百度文库复制限制</span><span class="token comment">// @author       freefitter</span><span class="token comment">// @icon         data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAABpElEQVR4nO3Vv2uUQRDG8c/ebSMWqay0trATAxrUSi1S2AiWFoJYpNCgoBjURsHWJKeNRfAvsDgFixQqKdPZ2ViEiCJYBOQu8f1hEXO59713j7MUfLZ6d2a/O8vMO0OzDnin9Ku2Mjvuaw07xgSAYEVXe2indMhj92zpKJLnBhF8MDeye9hn6zbN70eRiqCw02Bra3up8BBLu1FEBxsBucXqW4csz0ULe4jorSCMuPU89boRELDMHiI6Y8V65bbCUTccc70RkaOwKLOg0IkyXa9qTjOu2LAs6NZuD86hrdTyxRNTkUqqdhXlHrngGRVEZsMpJwex9DxIZSHYclesIb65LCoHgIs66UJq6btDBZHZrPh8V6YBOX66LbOkTGckBYimBW2FVTNeuOZNyrFJ236Yl4NSy5SbVm1PDvhodqgyMledTdRlAtDzqfL9tfkwUtyaRkv9LwFj9B/w7wPycXOhqlJ0yZHKPChMi5MCiM47XhsopbVJAUHfrYbmN/EToN+02eLPfz9OYyZhFJzW1Jn3lTsxaKQjCkp52jy45r1ZvSbTb9M0d4PBozGZAAAAAElFTkSuQmCC</span><span class="token comment">// @include      *://wenku.baidu.com/*</span><span class="token comment">// @run-at       document-end</span><span class="token comment">// @grant        GM_xmlhttpRequest</span><span class="token comment">// @grant        GM_setValue</span><span class="token comment">// @grant        GM_getValue</span><span class="token comment">// @grant        GM_listValues</span><span class="token comment">// @grant        GM_deleteValue</span><span class="token comment">// @grant        unsafeWindow</span><span class="token comment">// @require      https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js</span><span class="token comment">// ==/UserScript==</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token string">'use strict'</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>    <span class="token keyword">var</span> host <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>host<span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"wenku.baidu.com/view"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"wenku.baidu.com/link"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> host<span class="token operator">!=</span><span class="token string">"wenku.baidu.com"</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>    <span class="token keyword">var</span> allContent <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> $ <span class="token operator">=</span> $ <span class="token operator">||</span> window<span class="token punctuation">.</span>$<span class="token punctuation">;</span> <span class="token comment">//获得jquery的$标识符</span>    <span class="token keyword">var</span> pageNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>loadPageNum <span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">,</span>docid <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token comment">// 添加相关按钮</span>    <span class="token keyword">var</span> copyBtn <span class="token operator">=</span> <span class="token string">"&lt;div style='position:fixed;z-index:999;background-color:#ccc;cursor:pointer;top:120px;left:0px;'&gt;"</span><span class="token operator">+</span>        <span class="token string">"&lt;div id='copyBtn' style='font-size:12px;padding:8px 2px;color:#FFF;background-color:#FE8A23;'&gt;复制&lt;/div&gt;"</span><span class="token operator">+</span>        <span class="token string">"&lt;/div&gt;"</span><span class="token punctuation">;</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>copyBtn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">getCopyData</span><span class="token punctuation">(</span><span class="token parameter">indexpagedata</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">//debugger;</span>        allContent <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> indexpagedata <span class="token operator">||</span> <span class="token keyword">undefined</span> <span class="token operator">==</span> indexpagedata <span class="token operator">||</span> <span class="token string">""</span> <span class="token operator">==</span> indexpagedata<span class="token punctuation">)</span>        <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"页面数据没取到啊"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token comment">//解析出文章路径</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>indexpagedata<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">"readerInfo"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"这个文章还不能解析....."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">var</span> htmlUrls<span class="token operator">=</span> indexpagedata<span class="token punctuation">.</span>readerInfo<span class="token punctuation">.</span>htmlUrls<span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>htmlUrls<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">"json"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"PPT 解析成图片....."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> htmlUrls<span class="token punctuation">)</span><span class="token punctuation">{</span>                    allContent <span class="token operator">+=</span> <span class="token string">"&lt;img src='"</span> <span class="token operator">+</span> htmlUrls<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"'/&gt;"</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token comment">//console.log(GM_listValues())</span>                <span class="token keyword">var</span> pageinfos <span class="token operator">=</span> htmlUrls<span class="token punctuation">.</span>json<span class="token punctuation">;</span>                <span class="token keyword">var</span> pnginfos <span class="token operator">=</span> htmlUrls<span class="token punctuation">.</span>png<span class="token punctuation">;</span>                <span class="token comment">// 总页数</span>                pageNum <span class="token operator">=</span> indexpagedata<span class="token punctuation">.</span>readerInfo<span class="token punctuation">.</span>page<span class="token punctuation">;</span>                docid <span class="token operator">=</span> indexpagedata<span class="token punctuation">.</span>readerInfo<span class="token punctuation">.</span>docId<span class="token punctuation">;</span>                <span class="token comment">// 返回的数据页数</span>                loadPageNum <span class="token operator">=</span> pageinfos<span class="token punctuation">.</span>length<span class="token punctuation">;</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token keyword">in</span> pageinfos<span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">let</span> pageLoadUrl <span class="token operator">=</span> pageinfos<span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token punctuation">.</span>pageLoadUrl<span class="token punctuation">;</span>                    <span class="token function">GM_xmlhttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                        url<span class="token operator">:</span> pageLoadUrl<span class="token punctuation">,</span>                        method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>                        <span class="token function-variable function">onload</span><span class="token operator">:</span> <span class="token parameter">obj</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                            <span class="token keyword">let</span> data<span class="token operator">=</span>obj<span class="token punctuation">.</span>response<span class="token punctuation">;</span>                            <span class="token comment">//console.log(data)</span>                            <span class="token comment">// 1、将数据拆分成key和value</span>                            <span class="token keyword">let</span> key <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"("</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">let</span> val <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"("</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">")"</span><span class="token punctuation">)</span><span class="token operator">-</span>data<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"("</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment">// 2、解析文章数据</span>                            <span class="token keyword">let</span> retJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">let</span> articleInfos <span class="token operator">=</span> retJson<span class="token punctuation">.</span>body<span class="token punctuation">;</span>                            <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>                            <span class="token comment">//console.log(articleInfos);</span>                            <span class="token comment">// 组成完整的章节文章</span>                            <span class="token keyword">var</span> lineY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> articleInfos<span class="token punctuation">)</span><span class="token punctuation">{</span>                                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"word"</span> <span class="token operator">==</span> articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span><span class="token punctuation">{</span>                                    <span class="token comment">// 增加换行</span>                                    <span class="token keyword">let</span> y <span class="token operator">=</span> articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>p<span class="token punctuation">.</span>y                                    <span class="token keyword">if</span><span class="token punctuation">(</span>lineY <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                        content <span class="token operator">+=</span> articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>c                                        lineY <span class="token operator">=</span> y<span class="token punctuation">;</span>                                    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>y <span class="token operator">==</span> lineY<span class="token punctuation">)</span><span class="token punctuation">{</span>                                        content <span class="token operator">+=</span> articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>c                                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">""</span> <span class="token operator">!=</span> articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                                            content <span class="token operator">+=</span> <span class="token string">"&lt;br/&gt;"</span> <span class="token operator">+</span> articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>c<span class="token punctuation">;</span>                                        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                                            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">" "</span> <span class="token operator">==</span> articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">{</span>                                                content <span class="token operator">+=</span> <span class="token string">"&lt;br/&gt;"</span> <span class="token operator">+</span> articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>c<span class="token punctuation">;</span>                                            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                                                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"未处理的字符:["</span><span class="token operator">+</span> articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>c <span class="token operator">+</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token punctuation">}</span>                                        <span class="token punctuation">}</span>                                        lineY <span class="token operator">=</span> y<span class="token punctuation">;</span>                                    <span class="token punctuation">}</span>                                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"pic"</span> <span class="token operator">==</span> articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span><span class="token punctuation">{</span>                                    <span class="token comment">//style="position: absolute;clip: rect(0px,250px,200px,50px);width: 300px;height: 200px"&gt;</span>                                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>s <span class="token operator">||</span> <span class="token string">""</span> <span class="token operator">==</span> articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>s <span class="token operator">||</span> <span class="token keyword">undefined</span> <span class="token operator">==</span>articleInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>                                        <span class="token comment">//content += "=****pic"+ i +"*****=";</span>                                        <span class="token comment">// 文章中包含图片，不处理</span>                                        content <span class="token operator">+=</span> <span class="token string">""</span><span class="token punctuation">;</span>                                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                                        content <span class="token operator">=</span> <span class="token string">"PIC"</span>                                    <span class="token punctuation">}</span>                                    <span class="token comment">//content += '&lt;img src="' + pnginfos[0].pageLoadUrl + '" style="position: absolute;clip: rect('+ articleInfos[i].c.ix +'px,'+ articleInfos[i].c.iy +'px,'+ articleInfos[i].c.iw +'px,'+ articleInfos[i].c.ih +'px);"/&gt;'</span>                                <span class="token punctuation">}</span>                            <span class="token punctuation">}</span>                            <span class="token function">GM_setValue</span><span class="token punctuation">(</span>docid<span class="token operator">+</span>key<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function-variable function">onerror</span><span class="token operator">:</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/**/</span>                <span class="token punctuation">}</span>                <span class="token comment">// 按序输出结果</span>                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> j<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">&lt;=</span> loadPageNum <span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">let</span> tmp <span class="token operator">=</span> <span class="token function">GM_getValue</span><span class="token punctuation">(</span>docid<span class="token operator">+</span><span class="token string">"wenku_"</span><span class="token operator">+</span>j<span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span>tmp <span class="token operator">==</span> <span class="token string">"PIC"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token comment">//allContent = allContent.replace("=****pic"+ (j - 1 )+"*****=","&lt;img src='" + pnginfos[j-1].pageLoadUrl + "'/&gt;");</span>                        allContent <span class="token operator">+=</span> <span class="token string">"&lt;img src='"</span> <span class="token operator">+</span> pnginfos<span class="token punctuation">[</span>j<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pageLoadUrl <span class="token operator">+</span> <span class="token string">"'/&gt;"</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                        allContent <span class="token operator">+=</span> tmp<span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token comment">// 移除相关Key</span>                    <span class="token function">GM_deleteValue</span><span class="token punctuation">(</span>docid<span class="token operator">+</span><span class="token string">"wenku_"</span><span class="token operator">+</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token comment">//console.log(GM_listValues())</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// 点击拷贝</span>    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span><span class="token string">"#copyBtn"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">let</span> indexpagedata <span class="token operator">=</span> unsafeWindow<span class="token punctuation">.</span>pageData<span class="token punctuation">;</span>        <span class="token function">getCopyData</span><span class="token punctuation">(</span>indexpagedata<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>        <span class="token keyword">let</span> opacity <span class="token operator">=</span> <span class="token string">'0.95'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"Edge"</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            opacity <span class="token operator">=</span> <span class="token string">'0.6'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>            opacity <span class="token operator">=</span> <span class="token string">'0.95'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>loadPageNum <span class="token operator">!=</span> pageNum<span class="token punctuation">)</span><span class="token punctuation">{</span>            str <span class="token operator">=</span> <span class="token string">"当前加载了["</span> <span class="token operator">+</span> loadPageNum <span class="token operator">+</span><span class="token string">"]页，总共["</span> <span class="token operator">+</span> pageNum <span class="token operator">+</span> <span class="token string">"]页，登录会加载更多页。"</span>        <span class="token punctuation">}</span>        <span class="token keyword">let</span> copyTextBox <span class="token operator">=</span> <span class="token string">'&lt;div id="copy_text_box" style="width:100%;height:100%;position: fixed;z-index: 99;display: block;top: 0px;left: 0px;background:rgba(255,255,255,'</span> <span class="token operator">+</span> opacity <span class="token operator">+</span> <span class="token string">');-webkit-backdrop-filter: blur(20px);display: flex;justify-content:center;align-items:center;"&gt;'</span><span class="token operator">+</span>            <span class="token string">'&lt;div id="copy_box_close" style="width:100%;height:100%;position:fixed;top:0px;left:0px;"&gt;&lt;div style="font-size:16px;margin-top:20px;text-align:center;"&gt;&lt;b&gt;点击文本外关闭弹框&lt;/b&gt;&lt;div&gt;&lt;b style="color:red"&gt;'</span> <span class="token operator">+</span> str <span class="token operator">+</span><span class="token string">'&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;'</span><span class="token operator">+</span>            <span class="token string">'&lt;pre id="copy_text_content" style="padding:20px;border:1px solid #CCC;border-radius:4px;width:60%;font-size:16px;line-height:22px;z-index:10000;white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word;word-break:break-all;max-height:70%;overflow:auto;"&gt;&lt;/pre&gt;'</span><span class="token operator">+</span>            <span class="token string">'&lt;/div&gt;"'</span><span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#copy_text_box'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">""</span> <span class="token operator">==</span> allContent<span class="token punctuation">)</span><span class="token punctuation">{</span>            allContent <span class="token operator">=</span> <span class="token string">"未获取成功，请再次点击复制按钮！"</span>        <span class="token punctuation">}</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>copyTextBox<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#copy_text_content'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>allContent<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#copy_box_close'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#copy_text_box'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-成果展示"><a href="#2-成果展示" class="headerlink" title="2.成果展示"></a>2.成果展示</h3><hr><p>点击旁边的复制就可以愉快的复制相关内容啦。<br><img src="/img/20211228/c259e929a9529eb7273327981072d881.jpg" alt="原始文档"></p><p><img src="/img/20211228/306d1bd415f33f6caf22e4f31db27be1.jpg" alt="可复制的"></p><h3 id="3-说在最后"><a href="#3-说在最后" class="headerlink" title="3.说在最后"></a>3.说在最后</h3><hr><p>到此功能完成了，后续可以优化一下，加上图片啥的。这个数据都是有的，就是花时间弄就完事了。这个仅做学习交流使用哈。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;最近老婆告诉我，百度文库突然不能复制了，我记得之前都是好好的啊，除非它改版了，这不看了一下，还真的是改版了。使命必达，下面就和我一起找找破解之法吧。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;Greasy-Fork相关信息：&quot;&gt;&lt;a hr</summary>
      
    
    
    
    <category term="插件" scheme="https://www.wangxingyang.com/categories/%E6%8F%92%E4%BB%B6/"/>
    
    
    <category term="百度文库复制" scheme="https://www.wangxingyang.com/tags/%E7%99%BE%E5%BA%A6%E6%96%87%E5%BA%93%E5%A4%8D%E5%88%B6/"/>
    
    <category term="Tampermonkey" scheme="https://www.wangxingyang.com/tags/Tampermonkey/"/>
    
    <category term="油猴" scheme="https://www.wangxingyang.com/tags/%E6%B2%B9%E7%8C%B4/"/>
    
  </entry>
  
  <entry>
    <title>周末分享</title>
    <link href="https://www.wangxingyang.com/dayshare211205.html"/>
    <id>https://www.wangxingyang.com/dayshare211205.html</id>
    <published>2021-12-06T03:10:02.000Z</published>
    <updated>2022-02-16T01:06:49.517Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>距离上次更新彤宝已经过去了一段时间了，因为疫情，所以没怎么出去玩，所以抽空整理下最近的照片，记录一下彤彤的生活吧。</p></blockquote><h3 id="0-上周记录"><a href="#0-上周记录" class="headerlink" title="0. 上周记录"></a>0. 上周记录</h3><hr><p>上周带彤彤去搭帐篷了，还是挺不错的，天气很好，然后还去抓了个野生的小🐟，现在还在鱼缸里呢。周日陪我去体检了，做了公交车🚌，在车上全程睡觉。不过说实话起的确实很早。</p><p>踢球⚽️</p><p><video src="/img/20211205/1.mp4" controls="controls" width="100%" muted="" autoplay="true" loop="loop"></video></p><h3 id="1-本周记录"><a href="#1-本周记录" class="headerlink" title="1.本周记录"></a>1.本周记录</h3><hr><p>这周基本是在外面玩的，比上班还累，周日上午去挖了沙子，下午去上了课。晚上的时候和福宝宝见了个面。晚上回来在车上就睡着了。</p><p><img src="/img/20211205/0.jpeg" alt="买的雪地靴"></p><p><img src="/img/20211205/1.jpeg" alt="乐高逛逛"></p><p><img src="/img/20211205/2.jpeg" alt="午饭"></p><p><img src="/img/20211205/3.jpeg" alt="气球🎈"></p><p><img src="/img/20211205/4.jpeg" alt="吃着棒棒糖去公园"></p><p><img src="/img/20211205/5.jpeg" alt="随手一拍"></p><p><img src="/img/20211205/6.jpg" alt="挖沙子"></p><p><img src="/img/20211205/7.jpg" alt="挖沙子"></p><p><img src="/img/20211205/8.jpg" alt="挖沙子"></p><p><img src="/img/20211205/9.jpg" alt="挖沙子"></p><p>还有一个剥鸡蛋的</p><p><video src="/img/20211205/2.mp4" controls="controls" width="100%" muted="" autoplay="true" loop="loop"></video></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;距离上次更新彤宝已经过去了一段时间了，因为疫情，所以没怎么出去玩，所以抽空整理下最近的照片，记录一下彤彤的生活吧。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-上周记录&quot;&gt;&lt;a href=&quot;#0-上周记录&quot; class=&quot;headerl</summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="周末" scheme="https://www.wangxingyang.com/tags/%E5%91%A8%E6%9C%AB/"/>
    
    <category term="遛娃" scheme="https://www.wangxingyang.com/tags/%E9%81%9B%E5%A8%83/"/>
    
  </entry>
  
  <entry>
    <title>华硕路由折腾记录</title>
    <link href="https://www.wangxingyang.com/router.html"/>
    <id>https://www.wangxingyang.com/router.html</id>
    <published>2021-12-01T07:29:40.000Z</published>
    <updated>2022-02-11T02:06:35.897Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>树莓派已经第二次死机了，SSH连不上，没有找到相应的解决方案，准备换个TF卡，换个系统试试。顺便买了个U盘，准备折腾一下路由器。</p></blockquote><h3 id="0-背景"><a href="#0-背景" class="headerlink" title="0.背景"></a>0.背景</h3><hr><p>树莓派已经连续两次死机了，这样的感觉很不好。这让我有了折腾路由器的想法。所以准备折腾下路由器。之前找了个金士顿的旧的U盘，说读写速度不够，不给我折腾。然后路由器的固件版本也不够，所以都得升级下。<a href="https://www.koolcenter.com/posts/12">这边</a>是路由器的固件地址。升级完成之后，开始安装相关软件。发现U盘读写速度不够是唬人的。</p><blockquote><p>Entware<br>This is a software repository for network attached storages, routers and other embedded devices.<br>Browse through 2500+ packages for different platforms.<br>See how to use it.<br>Feel free to ask for new packages or report any bugs you’ve found.</p></blockquote><p>开始安装<code>Entware</code> ，<a href="https://entware.net/">链接在这</a>，刷了官改后，里面有相关的插件可以直接拿来用，省去了自己安装的痛苦。安装完成之后，安装<a href="https://mosquitto.org/">MQTT</a>，接着安装<strong>Python</strong>，安装完成之后，把代码移植过来就Okay了。</p><h3 id="1-实战"><a href="#1-实战" class="headerlink" title="1.实战"></a>1.实战</h3><hr><h4 id="a-安装MQTT"><a href="#a-安装MQTT" class="headerlink" title="a.安装MQTT"></a>a.安装MQTT</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">opkg install mosquitto mosquitto-client libmosquittomosquitto -c /tmp/mnt/sda/entware/etc/mosquitto/mosquitto.conf -d <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>修改<strong>mosquitto.conf</strong>，不加<strong>IP</strong>地址的话会导致连不上的</p><pre class="line-numbers language-none"><code class="language-none">allow_anonymous falselistener 1883 192.168.xxx.xpassword_file /tmp/mnt/sda/entware/etc/mosquitto/pwfile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="b-安装Pyhton以及相关模块"><a href="#b-安装Pyhton以及相关模块" class="headerlink" title="b.安装Pyhton以及相关模块"></a>b.安装Pyhton以及相关模块</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">opkg install python3opkg install python3-requestsopkg install python3-lxml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>软件包中没有<strong>mqtt</strong>相关的模块，所以后面准备通过命令行进行推送。</p><h4 id="c-编写推送脚本"><a href="#c-编写推送脚本" class="headerlink" title="c.编写推送脚本"></a>c.编写推送脚本</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cd /opt/home# get push infoecho "gen push data"data=$(python info.py)echo $dataecho "start to push data"# start push data to bafamosquitto_pub -d -h bemfa.com -p 9xx1 -t "pushbafa" -i "XXXXXXXXXXX"  -m "$data"echo "push success"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="d-添加定时任务"><a href="#d-添加定时任务" class="headerlink" title="d.添加定时任务"></a>d.添加定时任务</h4><p>发现路由器里没有<strong>crontab</strong>这个命令，翻看了一下其他插件的定时做法，发现<code>cru</code>这个命令。所以就用这个来个定时，还是每分钟执行，命令格式和<strong>crontab</strong>很像</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">cru a push_info "* * * * * /opt/home/push.sh &gt; push.log"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>到这，上面的就部署好了。<br>观察了一下系统资源使用情况，以前风平浪静，现在终于泛起了波澜。<br><img src="https://ae04.alicdn.com/kf/H92594d65dc7e458488d793211e5ca0a7g.png" alt="系统状态"></p><h4 id="e-安装Node-Red"><a href="#e-安装Node-Red" class="headerlink" title="e.安装Node-Red"></a>e.安装<code>Node-Red</code></h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">opkg install nodeopkg install node-npmopkg install makenpm install -g --unsafe-perm node-red<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>安装过程有报错，但是Node-Red居然可以用，看了报错这个应该是可选的，后续如果用到了估计就会报错了。记录一下错误日志。<br><img src="https://ae02.alicdn.com/kf/Hc271aeb0163f4ee6bdd65286db526828i.png" alt="安装报错日志"><br>这个后续看看是啥原因。<br>安装完成把之前的通知啥的都安排上了。希望这次能持久的运行下去哈。</p><h3 id="2-结语"><a href="#2-结语" class="headerlink" title="2.结语"></a>2.结语</h3><hr><p>这次搞这个还是踩了一些坑的，但是好在最后都搞定了。世上无难事，只怕有心人。坚持下去就会成功的。哎呀，又鸡汤了。后面看看有没有别的可以折腾的。写着写着，发现<strong>Typora</strong>提示更新的时候，在Beta版之后就要开始收费了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;树莓派已经第二次死机了，SSH连不上，没有找到相应的解决方案，准备换个TF卡，换个系统试试。顺便买了个U盘，准备折腾一下路由器。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-背景&quot;&gt;&lt;a href=&quot;#0-背景&quot; class=&quot;head</summary>
      
    
    
    
    <category term="路由器" scheme="https://www.wangxingyang.com/categories/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
    
    <category term="路由器" scheme="https://www.wangxingyang.com/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
    <category term="华硕" scheme="https://www.wangxingyang.com/tags/%E5%8D%8E%E7%A1%95/"/>
    
    <category term="GT-AC5300" scheme="https://www.wangxingyang.com/tags/GT-AC5300/"/>
    
  </entry>
  
  <entry>
    <title>周末记录</title>
    <link href="https://www.wangxingyang.com/happybirthday2021.html"/>
    <id>https://www.wangxingyang.com/happybirthday2021.html</id>
    <published>2021-11-21T09:42:56.000Z</published>
    <updated>2021-11-25T00:40:54.200Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>小孩子真的是联系家庭关系的纽带，如果不是彤宝的生日大家都不会来的这么齐。能聚在一起吃个饭真的很开心。</p></blockquote><h3 id="0-生日会"><a href="#0-生日会" class="headerlink" title="0.生日会"></a>0.生日会</h3><hr><p>这次也邀请了福宝宝一家，两个小孩格外的热闹。这次没有太多的照片搬运了几张妈妈朋友圈的照片。</p><p><img src="/img/20211118/49c1c35fd2697906d749e60b8fe0bc.jpg" alt="开始前"></p><p><img src="/img/20211118/804e12989457c6b78e0a84403cffae.jpg" alt="宝宝合照"></p><p><img src="/img/20211118/52442d0d3056524739903d5b8a34ca.jpg" alt="宝宝合照"></p><h3 id="1-体检-amp-遛娃"><a href="#1-体检-amp-遛娃" class="headerlink" title="1.体检&amp;遛娃"></a>1.体检&amp;遛娃</h3><hr><p>周六早上带她体检了，这次早起去的，到医院8点钟。这次是真的早，第一个开始，全部做完八点半还没有。所以就带她去绿博园逛了下子。下面看看小彤逛绿博园吧。</p><p><img src="/img/20211118/5cc11aa2e4ca050d43a85e48dd7403.jpg" alt="小猪和我"></p><p><img src="/img/20211118/b794410f740641d14a96234df4853b.jpg" alt="风车和我"></p><p><img src="/img/20211118/6cd7736b1f07800e44605fc028e7a8.jpg" alt="兔子和我"></p><p><img src="/img/20211118/aa2b2f0c0a6bbad7f530118c62b2eb.jpg" alt="兔子和我"></p><p><img src="/img/20211118/553f89a892d787eef20951f1adc645.jpg" alt="圆圈和我"></p><p><img src="/img/20211118/dc900bbfe65ebb641d239ba6a9d6a3.jpg" alt="沙子和我"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;小孩子真的是联系家庭关系的纽带，如果不是彤宝的生日大家都不会来的这么齐。能聚在一起吃个饭真的很开心。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-生日会&quot;&gt;&lt;a href=&quot;#0-生日会&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="遛娃" scheme="https://www.wangxingyang.com/tags/%E9%81%9B%E5%A8%83/"/>
    
    <category term="生日" scheme="https://www.wangxingyang.com/tags/%E7%94%9F%E6%97%A5/"/>
    
    <category term="体检" scheme="https://www.wangxingyang.com/tags/%E4%BD%93%E6%A3%80/"/>
    
  </entry>
  
  <entry>
    <title>IOT智能看板</title>
    <link href="https://www.wangxingyang.com/iotdashboard.html"/>
    <id>https://www.wangxingyang.com/iotdashboard.html</id>
    <published>2021-11-17T00:27:26.000Z</published>
    <updated>2021-11-19T15:40:20.340Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近折腾了一下<code>Node-RED</code>和小程序，虽然之前已经折腾过了，之前群晖不是挂了嘛，也懒得启动了，所以准备在现在的树莓派上折腾折腾。</p></blockquote><h3 id="0-概述"><a href="#0-概述" class="headerlink" title="0.概述"></a>0.概述</h3><hr><p>在树莓派上已经安装了<code>MQTT</code> ，因为这次想在小程序上能够展示一些信息，但是买的域名没有备案，检查就过不了。正好某天在逛论坛的时候看到了<a href="https://cloud.bemfa.com/">巴法云</a>，而且现在人家还免费，这不正中我的下怀嘛，这不就整起来了。<br><img src="/img/20211117/e4e98ffa309ba3d313bfc2d42d3b04f6.jpg" alt="巴法云截图"></p><h3 id="1-实战"><a href="#1-实战" class="headerlink" title="1.实战"></a>1.实战</h3><hr><p>首先得在树莓派上安装好<strong>MQTT</strong>和<strong>Node-RED</strong>，安装<strong>Node-RED</strong>的教程咱就不贴了。<a href="https://nodered.org/">官网在这</a>，<a href="https://github.com/node-red/node-red">GitHub地址在这</a>，研究一下这两个就差不多了。下面这个是我做好的流，主要是通知和推数据到巴法云。微信通知的可以参看我之前的<a href="http://wangxingyang.com/wecomchan.html">Server酱推送</a>，这个用的企业微信的接口，后续准备自己搞一个，让推送消息的内容更加的丰富。在<strong>Node-RED</strong>里还弄了一个<strong>小爱音箱TTS</strong>的功能，可以远在外面通知家里了，后续可以拍个短视频看看效果。<br> <img src="/img/20211117/97f283cd730f5ed9a2cf94c46e08795b.jpg" alt="Node-RED截图"><br>这些准备工作做好了，就开始搭小程序了。写小程序比较简单，主要是UI设计，这边参照之前<strong>Scriptable</strong>里面的那个小组件，做了一个差不多的。下面这个是界面，现在有点简陋，后续慢慢添加和优化吧。小程序现已经上线了，小程序名称为<strong>IOT智能看板</strong>。大家可以搜索查看。因为现在没有加控制，大家都可以操作，但是最好不要用音箱播放哈，会吓人的。现在数据是1分钟执行一次推送，所以没看到数据的话，稍微等待⌛️下就好。<br><img src="/img/20211117/8b862769e444d8e5b0a897d1cc40d436.jpg" alt="小程序截图V1"></p><h4 id="20211119-更新"><a href="#20211119-更新" class="headerlink" title="20211119 更新"></a>20211119 更新</h4><hr><p>把小程序界面优化了下，显示信息加入了路由器的基本信息和油价的监控，控制方面，加入了M5Stack中RGB灯的控制：</p><p><img src="/img/20211117/2151637335711_pic.jpg" alt="小程序截图V2"></p><p>下面是录的操作视频，偷懒直接通过<strong>Node-RED</strong>将数据从巴法云转发到树莓派上的<strong>MQTT</strong>上，所以有点延时。</p><p><video src="/img/20211117/1637336039111419.mp4" controls="controls" width="100%" muted="" autoplay="true" loop="loop"></video></p><h3 id="2-总结"><a href="#2-总结" class="headerlink" title="2.总结"></a>2.总结</h3><hr><p>后续准备和<strong>M5Stack</strong>结合在一起，双11买了些传感器，后续准备搞起来用小程序控制。上个周末给老妈研究自动刷抖音的，用的彤宝的乐高，可能因为乐高搭的比较松散，不够硬导致没成功，后面继续研究，等研究好给大家展示下子。年轻的时候有想法但是经济实力不够，现在是有想法，但是时间不够，不过不着急，慢慢把想法变成现实，让自己不断的提升吧。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;最近折腾了一下&lt;code&gt;Node-RED&lt;/code&gt;和小程序，虽然之前已经折腾过了，之前群晖不是挂了嘛，也懒得启动了，所以准备在现在的树莓派上折腾折腾。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-概述&quot;&gt;&lt;a href=&quot;#0-概</summary>
      
    
    
    
    <category term="物联网" scheme="https://www.wangxingyang.com/categories/%E7%89%A9%E8%81%94%E7%BD%91/"/>
    
    
    <category term="Node-Red" scheme="https://www.wangxingyang.com/tags/Node-Red/"/>
    
    <category term="mqtt" scheme="https://www.wangxingyang.com/tags/mqtt/"/>
    
    <category term="小程序" scheme="https://www.wangxingyang.com/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>周末分享</title>
    <link href="https://www.wangxingyang.com/dayshare211108.html"/>
    <id>https://www.wangxingyang.com/dayshare211108.html</id>
    <published>2021-11-08T00:55:35.000Z</published>
    <updated>2021-11-08T07:45:04.781Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>这周还是带着宝宝上早教，周日的晚上还有培训机构给她们准备的生日🎂晚会，下面就和我一起来看看吧。</p></blockquote><h3 id="0-上课"><a href="#0-上课" class="headerlink" title="0.上课"></a>0.上课</h3><hr><p>早上起床，洗漱完毕就去上课了，今天的亲子课是看影子找到相应的水果，还有就是扣环。大运动环节是让他们分类数字。</p><p>找影子环节呢，除了中间的西瓜没有自己找到，其他的都是她自己完成的。基本上这些水果也都认识了。</p><p><img src="/img/20211108/5c4c2f119bcfb102bb6f469637fb246f.jpg" alt="找影子"></p><p><img src="/img/20211108/84ba1d2224f3a527f6128e0e7338e72e.jpg" alt="找影子"></p><p>一开始扣和解的时候有些不能控制，但是后面慢慢的就好些了。</p><p><img src="/img/20211108/eefa5df120511c6b458b7719ed06aa1a.jpg" alt="连环扣"></p><p><img src="/img/20211108/964df8a45aa3d943a17f05e2a9a40239.jpg" alt="连环扣"></p><p>现在玩玩具她都只玩一次，自己完成了就要去换下一个玩具了。其他小孩都还沉浸在玩玩具的氛围中，她都结束了🤦‍♂️。</p><p><img src="/img/20211108/85240e3f43eb941d3ee9f2166498697e.jpg" alt="数字分类"></p><p><img src="/img/20211108/7bfae4f73c58c72db0bc5f76930738b9.jpg" alt="数字分类"></p><p>数字分类她已经可以自己独立完成了，走独木桥的时候还是有点害怕，扶着她就好了。这次的1，3，5这几个数字她都已经掌握了，能够快速准确的放到对应的篮子🧺里，很棒！</p><p>下午上的是感统课，这次的感统课有点儿乱，不像之前一个环节一个环节串起来的，是分成每个小的部分，每个小朋友可以挑一个没人的项目开始，这样导致彤彤很快就放飞自我了，玩一会这个玩一会那个然后就完全自己玩了。不过最后老师还是带她完成了几个小项目的。</p><p><img src="/img/20211108/4aff0c7bba791dbc4403c0944639bd6c.jpg" alt="用小腿抬球"></p><p><img src="/img/20211108/0b104590521b42ffc61c723824d37ee3.jpg" alt="我踢"></p><p><img src="/img/20211108/8d136979841757962ff688a163d49781.jpg" alt="我再踢"></p><p><img src="/img/20211108/b29f7e31160fd04c5e51cc5b9446f0be.jpg" alt="单手推球过障碍"></p><p><img src="/img/20211108/ce8b0e41fbad4d8ef3d0e4508bfb48ce.jpg" alt="高抬腿"></p><p><img src="/img/20211108/cf96f99a6378c102bf1b2851af3d9fb1.jpg" alt="小可爱"></p><h3 id="1-生日会"><a href="#1-生日会" class="headerlink" title="1.生日会"></a>1.生日会</h3><hr><p>彤彤很快就要过生日了，早教机构那边给她们准备了生日晚会，那天晚上正好碰上降温，真的是贼冷。晚会主要是几个小游戏和还有小朋友吃吃吃两个环节，彤宝还是很开心的，下面让大家一起开心一下吧。</p><p><img src="/img/20211108/539889e8af46b60eeb138ba755a605c9.jpg" alt="彤宝举手"></p><p><img src="/img/20211108/0ea2fb370b9e745910e41262cf6c6776.jpg" alt="游戏前准备"></p><p><img src="/img/20211108/882d7212559f653f15d2ee54d212cd77.jpg" alt="游戏后领奖"></p><p><img src="/img/20211108/764d5b007c87f5e8c16142e012176690.jpg" alt="大合照"></p><p><img src="/img/20211108/daf539d8836205778b8a315f6a3beaf1.jpg" alt="吃吃吃"></p><h3 id="2-写在最后"><a href="#2-写在最后" class="headerlink" title="2.写在最后"></a>2.写在最后</h3><hr><p>孩子每天都不一样，所以很珍惜和她的每一天，也不愿错过她成长的每个时刻。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;这周还是带着宝宝上早教，周日的晚上还有培训机构给她们准备的生日🎂晚会，下面就和我一起来看看吧。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-上课&quot;&gt;&lt;a href=&quot;#0-上课&quot; class=&quot;headerlink&quot; title=&quot;0</summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="早教" scheme="https://www.wangxingyang.com/tags/%E6%97%A9%E6%95%99/"/>
    
    <category term="生日会" scheme="https://www.wangxingyang.com/tags/%E7%94%9F%E6%97%A5%E4%BC%9A/"/>
    
  </entry>
  
  <entry>
    <title>M5Stack入坑记录</title>
    <link href="https://www.wangxingyang.com/m5stack.html"/>
    <id>https://www.wangxingyang.com/m5stack.html</id>
    <published>2021-11-02T14:52:55.000Z</published>
    <updated>2021-11-08T15:29:09.271Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>看了很多的模块和套件，最后还是选择了M5Stack。Core2 for AWS是AWS物联网学习项目的专属套件。它由M5Stack Core2核心主控和M5GO-Bottom For AWS拓展底座组成,并且额外定制集成了ATECC608 Trust&amp;GO 硬件加密,是物联网学习和安全项目构建的理想套件。</p></blockquote><h3 id="0-📖简介"><a href="#0-📖简介" class="headerlink" title="0.📖简介"></a>0.📖简介</h3><hr><p>详细的参数和说明在<a href="https://docs.m5stack.com/zh_CN/core/core2_for_aws">这里</a>，实物还是很好看的。首先想用它来显示一下相关信息。前不久在树莓派上装了个<code>Pi-hole</code>，结果树莓派跪了，进不去系统了，没得办法只能重新刷了系统。<br>在上面装了<code>MQTT</code> ，这边有<a href="https://zhuanlan.zhihu.com/p/359395794">教程</a>，大家可以参照安装，之前一直没有尝试，就这次就来尝试一下。<br>下面是拆箱图，忽略已经脏了的沙发：<br><img src="/img/20211102/00316b36d7829086159f361c2610123b.jpg" alt="拆箱图"><br><img src="/img/20211102/9c5060bc803e07a19fbfaa00c064131e.jpg" alt="拆箱图"><br><img src="/img/20211102/43f31b91e47f2e6add34a879ab4260bb.jpg" alt="拆箱图"></p><h3 id="1-💡想法"><a href="#1-💡想法" class="headerlink" title="1.💡想法"></a>1.💡想法</h3><hr><p>准备在这上面来展示一下信息：</p><ol><li>树莓派的运行状态</li><li>家里的水电燃气费用的显示</li><li>天气的显示</li><li>设备的一些信息</li><li>博客访问统计</li><li>生日倒计时</li></ol><p>控制方面：</p><ol><li>控制旁边的RGB灯</li><li>控制设备震动</li><li>控制设备发声</li><li>家中常用设备的控制</li></ol><h3 id="2-🏃实践"><a href="#2-🏃实践" class="headerlink" title="2.🏃实践"></a>2.🏃实践</h3><hr><p>信息展示方面，准备把之前的接口改造一下，加上<code>mqtt</code>推送，这样就能够使用订阅来获取相关数据了。记得安装<code>mqtt</code>的包 <strong>pip install paho-mqtt</strong>；例程网上都有，可以参照着改一下。代码就不贴了，不是很复杂。<br>接下来就是下载相关的软件给M5烧录系统了，这边没有用<code>Arduino</code>，用官方提供的<strong>M5Burner</strong>来烧系统，用<strong>UIFlow</strong>来进行编程。这个比较适合新上手，不够开放，但是方便快捷，后面可以试试用<code>Arduino</code>来写。<br><img src="/img/20211102/054730216c001a75771f82577aca9d5b.jpg" alt="UIFlow"><br>右边的UI所见即所得，但是到真机上还是有些许的误差，还是需要自己调整的。之前下载的离线版的IDE，发现版本比较低，恨到模块都没有。所以最后还是转战到在线编辑。在线编辑比较好，不用接线，有网络就行。教程在<a href="https://docs.m5stack.com/en/quick_start/core2_for_aws/uiflow">官网</a>都有。<br>准备就绪后就是开始拖拽编码了，说实话，拖拽编码还不如手打来的方便。经过几个晚上的奋战，终于搞好了一大部分，还有写空间不知道怎么利用，等有弄结束了再最后的成果图。<br>下图是拖拽的部分截图。<br><img src="/img/20211102/e54432962766f644b5e29e2a90412d8c.jpg" alt="UIFlow代码图"><br>最后做好的界面是这样的：<br><img src="/img/20211102/5acc8ab8370952ed7d1b6d9fc047fb4b.jpg" alt="最终成果图"><br>看起来还是不错的，后面准备在接一些传感器啥的一起玩玩。</p><p>录了个控制RGB灯的视频，灯是会呼吸的哦，感受一下哈。</p><p><video src="/img/20211102/1636385089845653.mp4" controls="controls" width="100%" muted="" autoplay="true" loop="loop"></video></p><h3 id="3-🔚总结："><a href="#3-🔚总结：" class="headerlink" title="3.🔚总结："></a>3.🔚总结：</h3><hr><p>整体来说这个东西还是很适合我这种没有太多硬件基础的的人玩的，现在研究的都是里面集成好的函数，后续看看能不能通过<code>Arduino</code>来自己去调它的硬件，或者不购买它的周边，自己驱动其他的外设。很多东西都是需要实战的，想做就去做，你会有成果出来的，后面。我喜欢捣鼓这些，之前的<code>Pi-hole</code>没用爽，后续准备再折腾折腾，也推荐大家去玩玩这个。<a href="https://github.com/pi-hole/pi-hole">GitHub</a>链接，下面是它的简介：</p><blockquote><p>The Pi-hole® is a <a href="https://en.wikipedia.org/wiki/DNS_Sinkhole">DNS sinkhole</a> that protects your devices from unwanted content without installing any client-side software.</p></blockquote><ul><li><strong>Easy-to-install</strong>: our versatile installer walks you through the process and takes less than ten minutes</li><li><strong>Resolute</strong>: content is blocked in <em>non-browser locations</em>, such as ad-laden mobile apps and smart TVs</li><li><strong>Responsive</strong>: seamlessly speeds up the feel of everyday browsing by caching DNS queries</li><li><strong>Lightweight</strong>: runs smoothly with <a href="https://docs.pi-hole.net/main/prerequisites/">minimal hardware and software requirements</a></li><li><strong>Robust</strong>: a command line interface that is quality assured for interoperability</li><li><strong>Insightful</strong>: a beautiful responsive Web Interface dashboard to view and control your Pi-hole</li><li><strong>Versatile</strong>: can optionally function as a <a href="https://discourse.pi-hole.net/t/how-do-i-use-pi-holes-built-in-dhcp-server-and-why-would-i-want-to/3026">DHCP server</a>, ensuring <em>all</em> your devices are protected automatically</li><li><strong>Scalable</strong>: <a href="https://pi-hole.net/2017/05/24/how-much-traffic-can-pi-hole-handle/">capable of handling hundreds of millions of queries</a> when installed on server-grade hardware</li><li><strong>Modern</strong>: blocks ads over both IPv4 and IPv6</li><li><strong>Free</strong>: open source software that helps ensure <em>you</em> are the sole person in control of your privacy</li></ul><p>如果家里本身就有树莓派，建议用起来，免得吃灰。现在我的树莓派还是有用的。群晖现在只有上传照片的时候开开机了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;看了很多的模块和套件，最后还是选择了M5Stack。Core2 for AWS是AWS物联网学习项目的专属套件。它由M5Stack Core2核心主控和M5GO-Bottom For AWS拓展底座组成,并且额外定制集成了ATECC608 Trus</summary>
      
    
    
    
    <category term="M5Stack" scheme="https://www.wangxingyang.com/categories/M5Stack/"/>
    
    
    <category term="M5Stack" scheme="https://www.wangxingyang.com/tags/M5Stack/"/>
    
    <category term="MQTT" scheme="https://www.wangxingyang.com/tags/MQTT/"/>
    
    <category term="Pi-hole" scheme="https://www.wangxingyang.com/tags/Pi-hole/"/>
    
  </entry>
  
  <entry>
    <title>周末分享</title>
    <link href="https://www.wangxingyang.com/dayshare211024.html"/>
    <id>https://www.wangxingyang.com/dayshare211024.html</id>
    <published>2021-10-24T13:51:28.000Z</published>
    <updated>2021-10-25T00:24:07.883Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>又是周末了，又是一个遛娃的周末，也一定是一个丰富多彩的周末。这个周末周六是早教课和给福宝宝过生日，周日约了一起去红山动物园玩。下面就和我一起来回顾一下精彩的周末吧。</p></blockquote><hr><blockquote><p><strong>小插曲:</strong><br>周五晚上想带她出去买个鞋子的，出去的时候比较晚，所以回来的时候也有点晚了。去的时候答应她买蛋糕的，最后回来的时候她有些困了，我就和她说，如果在车上睡着的话，回家就没有蛋糕🍰吃咯。没想到她居然坚持到家🏠都没有睡觉，回家了还兴奋的说，<code>吃蛋糕咯</code> ，当时看她兴奋的样子真的很好玩。</p></blockquote><hr><h3 id="0-早教-amp-生日"><a href="#0-早教-amp-生日" class="headerlink" title="0.早教 &amp; 生日"></a>0.早教 &amp; 生日</h3><hr><p>早上起来，准备不带彤彤去上上午的亲子课的，因为上次的体验不是很棒。但是早上她妈妈问了她一句要不要去上课，她肯定的回答要去上课，那时候已经八点多了，急急忙忙的弄弄就去上课了。这次上课的人还是很多的，玩了一个上次的小熊穿衣和拉拉链，最后的大运动是运送星星到指定的地方。彤彤都完成了，下面看看过程吧。<br><img src="/img/20211024/f6a687a978b9153ee69c5c6c67161da0.jpg" alt="小熊穿衣"><br><img src="img/20211024/8f86ac8e508416109979ddbb34c60004.jpg" alt="小熊穿衣"><br><img src="img/20211024/f19b7ad982dabe91bd82d57d05dd5993.jpg" alt="节奏棒"><br><img src="img/20211024/e63e1ed376dd1071f76daedb55453276.jpg" alt="大运动环节"><br>中午睡了一个午觉，下午就早点去了，下午的课他就表现的非常的活泼，这次是坐在老师的腿上自己做自我介绍的。当时老师叫了一个小男孩去做自我介绍，可能小男孩比较害羞，我就问了她一下，要不要举手去做自我介绍，没想到她居然答应了，并且流利的完成了自我介绍。有机会下次拍个自我介绍的视频。这次的课程，爬高爬低的时候还是有点害怕的，我常说她比较惜命，哈哈。还有就是第一关爬行的时候，需要屁股放低，但是她总是抬的高高的，其他的完成的都是比较好的。下面也来看看她的精彩过程吧。<br><img src="img/20211024/bb901ef053971b862780ea7f97b324fa.jpg" alt="这个姿势很OK"><br><img src="img/20211024/2c111b30f3d5eb93e95825888ad595e5.jpg" alt="跑起来"><br><img src="img/20211024/96e9a03e089c19c89e9b2cf542702e65.jpg" alt="第一关"><br><img src="img/20211024/f7a3e0260d15819ea45122249951ae21.jpg" alt="第二关"><br><img src="img/20211024/001ec2acbd3776b84d10a5940d81b263.jpg" alt="第二关"><br><img src="img/20211024/ab33ea897f3a16fd3f45856f6cdc09ac.jpg" alt="爬A字架"></p><p><img src="img/20211024/e1357166058fd8ea48930faeb57ad838.jpg" alt="大象爬"></p><p><img src="img/20211024/e7b6643219144a1e7429fa214b250b59.jpg" alt="平衡踏板"><br>晚上是福宝宝的生日🎂，约了一起吃个晚饭。给福宝宝买了玩具，小家伙也找我要了一个，福宝宝带了生日帽，她也有。她妈妈说感觉好像她自己过生日一样。晚上的彤宝吃的还是很多的，回家都没有要喝奶。放一张他们的合照。<br><img src="img/20211024/9f917b00a658e5e1bc08a4288d1d8300.jpg" alt="两个小寿星"></p><h3 id="1-动物园"><a href="#1-动物园" class="headerlink" title="1.动物园"></a>1.动物园</h3><hr><p>去动物园还是坐地铁去，开车过去真的不是很方便，而且巨堵，所以还是公共交通比较香。来一张地铁的的合照吧。<br><img src="img/20211024/f2bce45fa15988645bf784b2cad2bcfb.jpg" alt="合照"><br>动物园已经去了好几次了，感觉都是为了年卡去的，不去多去几次感觉亏了😂。里面就是看看动物啦，没啥特别的事情，最后结束的时候要来个游客照哈。<br><img src="img/20211024/4b69f555fd024b5f85c2e07ee7c6fa72.jpg" alt="游客照"></p><h3 id="2-总结"><a href="#2-总结" class="headerlink" title="2.总结"></a>2.总结</h3><hr><p>和宝宝在一起，每天都是新鲜的，哈哈，总会给你想不到的快乐。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;又是周末了，又是一个遛娃的周末，也一定是一个丰富多彩的周末。这个周末周六是早教课和给福宝宝过生日，周日约了一起去红山动物园玩。下面就和我一起来回顾一下精彩的周末吧。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;s</summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="早教" scheme="https://www.wangxingyang.com/tags/%E6%97%A9%E6%95%99/"/>
    
    <category term="遛娃" scheme="https://www.wangxingyang.com/tags/%E9%81%9B%E5%A8%83/"/>
    
    <category term="动物园" scheme="https://www.wangxingyang.com/tags/%E5%8A%A8%E7%89%A9%E5%9B%AD/"/>
    
  </entry>
  
  <entry>
    <title>免费的梯子</title>
    <link href="https://www.wangxingyang.com/toolshare211019.html"/>
    <id>https://www.wangxingyang.com/toolshare211019.html</id>
    <published>2021-10-19T02:50:36.000Z</published>
    <updated>2021-10-19T04:37:28.758Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>程序员都有需要<code>梯子</code>的时候，所以这次就出一个自己现在用的<code>梯子</code>，可以留着备用。</p></blockquote><h3 id="0-历程"><a href="#0-历程" class="headerlink" title="0.历程"></a>0.历程</h3><hr><p>在此之前用的是<code>小手电</code> [现在应该也还可以用的]。这个工具就是有时候呢不是很稳定，有时候死活连不上，服务器你还不能选，后面继续逛<code>Github</code>的时候，发现了现在的这个<a href="https://github.com/freefq/free">freefq</a>，页面上有简介和使用方式，就不啰嗦了。下面是<code>Github</code>的截图。可以看到<code>Star</code>还是很多的。</p><p><img src="/img/20211019/freefq.png" alt="Github截图"></p><h3 id="1-优化"><a href="#1-优化" class="headerlink" title="1.优化"></a>1.优化</h3><hr><p>上面有各个平台使用的工具，如果是<code>Windows</code>的话，他推荐的软件就不错。但是Mac的话，那个软件使用起来就不是很友好，不能订阅，服务器得自己一个一个加。后面找找发现了现在用的这个<a href="https://github.com/yanue/v2rayu">V2rayU</a>，这个使用起来就比较的友好了，怎么用大家上手就知道了。可以看到<code>Star</code>数也不少啊。</p><p><img src="/img/20211019/v2rayu.png" alt="Github截图"></p><p>但是有个问题是，换了这个工具后，<code>Chrome</code>居然不能访问墙外的，这就很蛋疼，因为用<code>Chrome</code>用习惯了，后面发现<code>Safari</code>是可以。网上查了很久，最后是通过<a href="https://github.com/FelisCatus/SwitchyOmega">SwitchyOmega</a>这个插件来解决的，曲线救国，先<code>Safari</code>下载这个插件，然后再装到<code>Chrome</code>上，最后终于可以愉快的上网了。可以看到<code>Star</code>数也不在少数，可能有同样问题的人也不少吧。</p><p><img src="/img/20211019/so.png" alt="Github截图"></p><h3 id="2-结语"><a href="#2-结语" class="headerlink" title="2.结语"></a>2.结语</h3><hr><p>工具这种东西，还是看个人的，如果大家有更好更方便的工具欢迎交流。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;程序员都有需要&lt;code&gt;梯子&lt;/code&gt;的时候，所以这次就出一个自己现在用的&lt;code&gt;梯子&lt;/code&gt;，可以留着备用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-历程&quot;&gt;&lt;a href=&quot;#0-历程&quot; class=&quot;heade</summary>
      
    
    
    
    <category term="工具" scheme="https://www.wangxingyang.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="梯子" scheme="https://www.wangxingyang.com/tags/%E6%A2%AF%E5%AD%90/"/>
    
    <category term="vpn" scheme="https://www.wangxingyang.com/tags/vpn/"/>
    
    <category term="免费" scheme="https://www.wangxingyang.com/tags/%E5%85%8D%E8%B4%B9/"/>
    
  </entry>
  
  <entry>
    <title>hexo微信分享链接添加缩略图</title>
    <link href="https://www.wangxingyang.com/toolshare211018.html"/>
    <id>https://www.wangxingyang.com/toolshare211018.html</id>
    <published>2021-10-18T11:13:39.000Z</published>
    <updated>2021-10-18T15:04:15.738Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>hexo搭建的静态站，分享时光秃秃的一片，想给它加个图片，所以就有了现在的文章</p></blockquote><h3 id="0-前期准备"><a href="#0-前期准备" class="headerlink" title="0.前期准备"></a>0.前期准备</h3><hr><p>在网上找了找，看看有没有现成的，网上大部分是讲接入SDK的，这个太麻烦了，还得绑定域名啥的。最后找到一个很方便的方法，亲测有效，这是<a href="https://blog.zhheo.com/p/89870d07.html">原文链接</a>，很简单的两句话。下面简要说下步骤：</p><ol><li><p>准备一张<code>300*300</code>的图片作为缩略图。</p></li><li><p>在head头部添加一个div，包含img标签。</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">display</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/img/wechat.png<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>og:image<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://*.***.***/*.png<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><p>到此就大功告成了。但是我想做成一个插件的形式，这个只能够指定一张图片，图片也不能变，所以接下来就开始改造了。</p><h3 id="1-实操"><a href="#1-实操" class="headerlink" title="1.实操"></a>1.实操</h3><hr><p>在<code>themes/hexo-theme-matery/_config.yml</code>中添加开关</p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token comment"># 分享图标设置</span><span class="token key atrule">shareIcon</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>接着修改<code>themes/hexo-theme-matery/layout/_partial/head.ejs</code> </p><pre class="line-numbers language-ejs" data-language="ejs"><code class="language-ejs"> <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript">         <span class="token keyword">var</span> shareIconPath <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>shareIcon <span class="token operator">&amp;&amp;</span> theme<span class="token punctuation">.</span>shareIcon<span class="token punctuation">.</span>enable<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>page<span class="token punctuation">.</span>shareIcon<span class="token punctuation">)</span> <span class="token punctuation">{</span>                shareIconPath <span class="token operator">=</span> <span class="token string">"https://www.wangxingyang.com"</span> <span class="token operator">+</span> page<span class="token punctuation">.</span>shareIcon<span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                 shareIconPath <span class="token operator">=</span> <span class="token string">"https://www.wangxingyang.com/share.png"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> </span><span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">display</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> shareIconPath </span><span class="token delimiter punctuation">%&gt;</span></span><span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>og:image<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> shareIconPath </span><span class="token delimiter punctuation">%&gt;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果开关打开，并且配置了链接图片地址，那么就用配置的，否则用默认的图片地址。</p><p>使用的时候需要在md文件中加入<code>shareIcon</code></p><p><img src="/img/20211018/2.jpeg" alt="使用截图"></p><h3 id="2-成果展示"><a href="#2-成果展示" class="headerlink" title="2.成果展示"></a>2.成果展示</h3><hr><p><img src="/img/20211018/0.jpeg" alt="成果展示"></p><p>看起来还是不错的，默认是彤宝的照片哈。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;hexo搭建的静态站，分享时光秃秃的一片，想给它加个图片，所以就有了现在的文章&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-前期准备&quot;&gt;&lt;a href=&quot;#0-前期准备&quot; class=&quot;headerlink&quot; title=&quot;0.前期准备</summary>
      
    
    
    
    <category term="工具" scheme="https://www.wangxingyang.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="hexo" scheme="https://www.wangxingyang.com/tags/hexo/"/>
    
    <category term="页面分享" scheme="https://www.wangxingyang.com/tags/%E9%A1%B5%E9%9D%A2%E5%88%86%E4%BA%AB/"/>
    
    <category term="缩略图" scheme="https://www.wangxingyang.com/tags/%E7%BC%A9%E7%95%A5%E5%9B%BE/"/>
    
  </entry>
  
  <entry>
    <title>周末分享</title>
    <link href="https://www.wangxingyang.com/dayshare211016.html"/>
    <id>https://www.wangxingyang.com/dayshare211016.html</id>
    <published>2021-10-16T15:20:11.000Z</published>
    <updated>2021-12-07T06:56:55.983Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>今天上了一天的课，上午是亲子课，下午是感统课。很是充实，虽然低温加下雨☔️，还是没有挡住求学的心</p></blockquote><h3 id="0-上午的亲子课"><a href="#0-上午的亲子课" class="headerlink" title="0.上午的亲子课"></a>0.上午的亲子课</h3><hr><p>之前上课的老师换了，今天的老师又换了。导致彤宝一点都提不起兴趣，不过彤彤还是很认真的听的，事后问她喜不喜欢今天的老师，彤宝说不喜欢。一直换老师真的不好，后面问了其他的老师，说老师可能还会变。所以后面的想法是，如果老师再变的话，后面亲子课就不想上了，等她两岁的时候换别的课了。</p><h3 id="1-下午的感统课"><a href="#1-下午的感统课" class="headerlink" title="1.下午的感统课"></a>1.下午的感统课</h3><hr><p>下午的感统课，彤彤表现的非常好，很活跃也很开心，现在任教的肖恩老师也很棒。感统课的课程安排大致是这样的，首先是自我介绍环节，因为老师已经很熟悉了，所以能够很好的做自我介绍。接着是一首音乐🎵 <strong>one little finger</strong> 并配合相应的动作。彤彤的反应虽然慢半拍，但是大部分还是能跟着老师一起做的。腾讯视频的<a href="https://v.qq.com/x/cover/2bvisw6nog7xwuf/d085999a4yx.html">One Little Finger 一只小手指</a>链接，大家可以看看。接着的环节就是组合运动环节了。第一个是手印脚印，按照摆拍的脚印👣和👋手印来完成动作，用小脚踩在脚印上，小手按住手印。接着是扶走空梯，让宝宝扶着走过横着放置的梯子。接下来是跳捡圈圈，跳进圈圈里，然后把圈圈提起来，这样重复操作。最后一个是钻到大斜坡下面，按照老师的指令拿指定颜色的沙包。这些彤彤都完成的很棒。事后问她开心吗，她说开心。</p><p>照片没怎么拍，就不贴了，下次记录吧。</p><h3 id="2-晚上的活动"><a href="#2-晚上的活动" class="headerlink" title="2.晚上的活动"></a>2.晚上的活动</h3><hr><p>晚上出去吃了个晚饭，带彤彤去理了发，之前就在那边理的，开业的时候团了一张劵才15元，发现在那边理发，她很乖，不哭也不闹，就是价格有点贵，一次88元。今天去依然很乖，还洗了头。最后没忍住还是给她办了张卡😂，希望不要像成人理发一样，理理后面就跑路了。下面放一些图和视频吧。</p><p>遛小鳄鱼，哈哈</p><p><video src="/img/20211016/11.mp4" controls="controls" width="100%" muted="" autoplay="true" loop="loop"></video></p><p>晚上理发</p><p><img src="/img/20211016/1.jpg" alt="理发中"></p><p><img src="/img/20211016/2.jpg" alt="理发中"></p><p><img src="/img/20211016/3.jpg" alt="理发中"></p><p><img src="/img/20211016/4.jpg" alt="洗头中"></p><h3 id="3-最后说点什么"><a href="#3-最后说点什么" class="headerlink" title="3.最后说点什么"></a>3.最后说点什么</h3><hr><p>总的来说，彤彤表现还是很棒的，不论是上课还是出去玩，都很乖很听话。希望她快乐成长，这就是最幸福的事情了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;今天上了一天的课，上午是亲子课，下午是感统课。很是充实，虽然低温加下雨☔️，还是没有挡住求学的心&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-上午的亲子课&quot;&gt;&lt;a href=&quot;#0-上午的亲子课&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="早教" scheme="https://www.wangxingyang.com/tags/%E6%97%A9%E6%95%99/"/>
    
    <category term="遛娃" scheme="https://www.wangxingyang.com/tags/%E9%81%9B%E5%A8%83/"/>
    
  </entry>
  
  <entry>
    <title>小插件分享</title>
    <link href="https://www.wangxingyang.com/toolshare211011.html"/>
    <id>https://www.wangxingyang.com/toolshare211011.html</id>
    <published>2021-10-11T02:58:11.000Z</published>
    <updated>2021-10-19T13:38:58.594Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近逛逛博客，看到个好玩的东西，已经加到博客中了，欢迎大家观看和使用</p></blockquote><h3 id="0-小地球"><a href="#0-小地球" class="headerlink" title="0.小地球"></a>0.小地球</h3><hr><p>这个是展示访客的地理位置，能够直观的看到有哪些地方的人访问了，并标注到小地球🌍上。<br><img src="/img/20211011/0.png" alt="小地球"></p><h3 id="1-在线聊天工具"><a href="#1-在线聊天工具" class="headerlink" title="1.在线聊天工具"></a>1.在线聊天工具</h3><hr><p>这个是一个在线聊天工具，弄起来非常简单，推荐玩玩。下面这个是网站截图。<a href="https://www.tawk.to/">官网地址</a><br><img src="/img/20211011/1.png" alt="在线聊天工具"></p><h3 id="2-总结"><a href="#2-总结" class="headerlink" title="2.总结"></a>2.总结</h3><hr><p>新奇好玩的东西实在是太多了，还是要多看多尝试多记录。这样才能拓宽自己的知识的广度。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;最近逛逛博客，看到个好玩的东西，已经加到博客中了，欢迎大家观看和使用&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-小地球&quot;&gt;&lt;a href=&quot;#0-小地球&quot; class=&quot;headerlink&quot; title=&quot;0.小地球&quot;&gt;&lt;/a&gt;0.</summary>
      
    
    
    
    <category term="插件" scheme="https://www.wangxingyang.com/categories/%E6%8F%92%E4%BB%B6/"/>
    
    
    <category term="在线聊天" scheme="https://www.wangxingyang.com/tags/%E5%9C%A8%E7%BA%BF%E8%81%8A%E5%A4%A9/"/>
    
    <category term="小地球" scheme="https://www.wangxingyang.com/tags/%E5%B0%8F%E5%9C%B0%E7%90%83/"/>
    
  </entry>
  
  <entry>
    <title>国庆假日分享</title>
    <link href="https://www.wangxingyang.com/dayshare211001.html"/>
    <id>https://www.wangxingyang.com/dayshare211001.html</id>
    <published>2021-10-06T13:16:28.000Z</published>
    <updated>2021-10-08T14:52:07.974Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>疫情有了好转，不出远门，就近带着宝宝四处逛逛，散散心。</p></blockquote><h3 id="0-游玩历程"><a href="#0-游玩历程" class="headerlink" title="0.游玩历程"></a>0.游玩历程</h3><hr><h4 id="第一天"><a href="#第一天" class="headerlink" title="第一天"></a>第一天</h4><hr><p>从南京回老家，上午在家休整了一下，下午的时候约了小宝姐姐一起玩。晚上和家人们一起吃了晚饭。彤彤还是很喜欢和小宝姐姐玩的。</p><h4 id="第二天"><a href="#第二天" class="headerlink" title="第二天"></a>第二天</h4><hr><p>彤妈约了闺蜜喝茶叙旧，傍晚才回的仪征。上午就在家玩玩，下午带她睡了午觉，因为空调坏了，所以昨晚没有怎么睡好，上午空调修好了，接着这个午觉睡的好长，直到她妈妈回来也没有醒，最后还是慢慢叫醒的。回去之后，晚上和家人们一起吃了个晚饭。</p><h4 id="第三天"><a href="#第三天" class="headerlink" title="第三天"></a>第三天</h4><hr><p>早上吃了个早茶然后逛了逛白沙公园，中午大家一起去了海底捞。下午去了趟京华城逛了逛。放几张妈妈朋友圈的图，现在我是一个盗图的人。哈哈！</p><p>下面是吃的早茶，点的有点多，面条吃下去就有点顶了。最后还是打包了。</p><p><img src="/img/20211001/0.jpg" alt="奏乐中"></p><p><img src="/img/20211001/1.jpg" alt="松子烧卖"></p><p><img src="/img/20211001/2.jpg" alt="蟹黄汤包"></p><p><img src="/img/20211001/3.jpg" alt="蒸饺"></p><p><img src="/img/20211001/4.jpg" alt="紫薯包"></p><p><img src="/img/20211001/5.jpg" alt="腰花面"></p><p>接下来去的白沙公园，就是因为它的小城堡，里面拍照还是很好的，还有很多小孩子玩的，很适合带小朋友去逛逛的。</p><p><img src="/img/20211001/6.jpg" alt="仰望天空"></p><p><img src="/img/20211001/7.jpg" alt="回眸一笑"></p><p><img src="/img/20211001/8.jpg" alt="摆个造型"></p><p><img src="/img/20211001/9.jpg" alt="游客照"></p><p><img src="/img/20211001/10.jpg" alt="小城堡"></p><p><img src="/img/20211001/11.jpg" alt="大笑"></p><p><img src="/img/20211001/12.jpg" alt="荡秋千"></p><p><img src="/img/20211001/13.jpg" alt="看前面小姐姐跳舞"></p><p><img src="/img/20211001/14.jpg" alt="日常"></p><h4 id="第四天"><a href="#第四天" class="headerlink" title="第四天"></a>第四天</h4><hr><p>今天一早就起床准备回南京了，但是回之前准备去金牛湖野生动物园逛一下，大家如果想去玩的话，可以关注<code>南京金牛湖野生动物王国</code>的公众号，里面有园区地图和各种表演的时间安排。去了之后直接安排的**<code>国际大马戏</code>**。看攻略说要租一个电动自行车游玩会方便很多，一开始没有租，后面租的时候发现没有车，在那边等车的时候晒出了油。园区的动物没怎么看，彤宝貌似对它们没兴趣，最后租到车之后，看了几个动物，居然在电动车上睡着了，无奈就骑着车在园区里逛了一圈，带的食物也没有喂给小动物，最后也没有继续逛了，就回南京了。图还是盗的妈妈的朋友圈，励志做朋友圈的搬运工😄。</p><p><img src="/img/20211001/15.jpg" alt="大门口"></p><p><img src="/img/20211001/16.jpg" alt="入口"></p><p><img src="/img/20211001/17.jpg" alt="大熊"></p><p><img src="/img/20211001/18.jpg" alt="羊驼"></p><p><img src="/img/20211001/19.jpg" alt="彤宝"></p><p><img src="/img/20211001/20.jpg" alt="鹦鹉"></p><p><img src="/img/20211001/21.jpg" alt="大马戏"></p><p><img src="/img/20211001/22.jpg" alt="水母"></p><p>这一天就这么结束了。</p><h4 id="第五天"><a href="#第五天" class="headerlink" title="第五天"></a>第五天</h4><hr><p>今天没什么特殊的安排，带彤妈去医院看个眼睛。之后去迪卡侬逛了逛，然后就回来了。买了一个小凳子，有点贵，不过彤宝还是很喜欢的。<a href="https://www.decathlon.com.cn/zh/p/folding-camping-chair-mh500-grey/_/R-p-173601?mc=8492643&amp;c=%E7%81%B0%E8%89%B2">链接</a> 支付宝领个劵减了15块。</p><p><img src="/img/20211001/24.png" alt="小椅子"></p><h4 id="第六天"><a href="#第六天" class="headerlink" title="第六天"></a>第六天</h4><hr><p>假期余额不足了，今天带彤宝坐地铁去了明孝陵逛逛，景色还是不错的，而且天公作美，不是很晒。去的时候喂了梅花鹿，算是弥补了在动物园没有喂食的遗憾吧。玩了一会，她还是睡着了，这次她睡了一个小时，很热很热的睡了一个小时。还是很佩服的。晚上回来吃了晚饭，吃的还是比较多的，晚上都没有要喝奶。</p><p><img src="/img/20211001/25.jpeg" alt="手牵手下楼梯"></p><p><img src="/img/20211001/26.jpeg" alt="彤妈随手拍的"></p><p><img src="/img/20211001/27.jpeg" alt="喂鹿"></p><p><img src="/img/20211001/28.jpeg" alt="晚餐"></p><p><img src="/img/20211001/29.jpeg" alt="三只松鼠购物"></p><p><img src="/img/20211001/30.jpeg" alt="安静的睡着了"></p><p>今天彤宝的表现还是很棒的</p><h4 id="第七天"><a href="#第七天" class="headerlink" title="第七天"></a>第七天</h4><hr><p>准备带彤宝做个轮渡感受下，图后补。</p><p>早上去的比较晚了，11点左右才到的轮渡，12点正好有一班，就上去了。过去的时候，发现现在甲板上可以上去了，但是要收费，10元一个人。去程没上去，回来的时候上去看了下，还是很舒服的，视野比较开阔。</p><p><img src="/img/20211001/31.jpeg" alt="随手拍"></p><p><img src="/img/20211001/32.jpeg" alt="一家三口"></p><h3 id="1-总结"><a href="#1-总结" class="headerlink" title="1.总结"></a>1.总结</h3><hr><p>这个国庆没有出远门，回了老家也去了几个景点，感觉还是很充实的。彤彤在家的时候不哭不闹，每天按时睡觉，有时候两个人带娃感觉也是一种享受。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;疫情有了好转，不出远门，就近带着宝宝四处逛逛，散散心。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-游玩历程&quot;&gt;&lt;a href=&quot;#0-游玩历程&quot; class=&quot;headerlink&quot; title=&quot;0.游玩历程&quot;&gt;&lt;/a&gt;0.游玩历程</summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="遛娃" scheme="https://www.wangxingyang.com/tags/%E9%81%9B%E5%A8%83/"/>
    
    <category term="国庆" scheme="https://www.wangxingyang.com/tags/%E5%9B%BD%E5%BA%86/"/>
    
  </entry>
  
  <entry>
    <title>节假日分享</title>
    <link href="https://www.wangxingyang.com/dayshare210919.html"/>
    <id>https://www.wangxingyang.com/dayshare210919.html</id>
    <published>2021-09-19T13:55:33.000Z</published>
    <updated>2021-09-22T02:32:29.865Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>好久不见了，是不是还是有点想念。因为疫情的原因，一直到现在都没有更新博客了。现在好些了，加上现在正是中秋佳节，所以我们又回来啦。</p></blockquote><h3 id="0-珍珠泉玩耍"><a href="#0-珍珠泉玩耍" class="headerlink" title="0.珍珠泉玩耍"></a>0.珍珠泉玩耍</h3><hr><p>之前的年卡办了，好久都没用了，感觉不用就浪费了，所以今天就去了珍珠泉玩了。离家还是比较近，所以起来之后，洗洗弄弄就出发了。来到这里当然是要玩玩水啦，小孩子还是很喜欢玩水的。然后又去爬了爬楼梯，小家伙很喜欢爬楼梯，让我很是欣慰啊。接着就去小孩子玩的地方荡了会秋千，就去吃吃喝喝等小伙伴了。本来是要等小伙伴一起玩索道的，但是最后还是我们自己玩了索道，大彤彤一点都不怕，就是回来的时候睡着了。下面看看照片吧！</p><p><img src="/img/20210919/0.jpeg" alt="游客照"></p><p><img src="/img/20210919/0.1.jpg" alt="玩水中"></p><p><img src="/img/20210919/1.jpeg" alt="还是游客照"></p><p><img src="/img/20210919/1.1.jpg" alt="大彤宝"></p><p><img src="/img/20210919/cover.jpeg" alt="珍珠泉"></p><p><img src="/img/20210919/2.jpeg" alt="索道上拍的"></p><p><img src="/img/20210919/6.jpeg" alt="老婆拍的索道"></p><h3 id="1-兰溪公园"><a href="#1-兰溪公园" class="headerlink" title="1.兰溪公园"></a>1.兰溪公园</h3><hr><p>晚上去了个兰溪公园，还是不错的，有小孩的朋友可以去玩玩，小孩玩的东西孩是很多的，特别是沙子，玩的走不动路了。下面看看照片吧。</p><p><img src="/img/20210919/4.jpeg" alt="入口处"></p><p><img src="/img/20210919/5.jpeg" alt="老婆拍的"></p><p><img src="/img/20210919/7.jpeg" alt="玩沙子中"></p><h3 id="2-总结"><a href="#2-总结" class="headerlink" title="2.总结"></a>2.总结</h3><hr><p>没事还是得多出去看看，小孩子还是喜欢外面的世界。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;好久不见了，是不是还是有点想念。因为疫情的原因，一直到现在都没有更新博客了。现在好些了，加上现在正是中秋佳节，所以我们又回来啦。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-珍珠泉玩耍&quot;&gt;&lt;a href=&quot;#0-珍珠泉玩耍&quot; class</summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="遛娃" scheme="https://www.wangxingyang.com/tags/%E9%81%9B%E5%A8%83/"/>
    
    <category term="节假日" scheme="https://www.wangxingyang.com/tags/%E8%8A%82%E5%81%87%E6%97%A5/"/>
    
  </entry>
  
  <entry>
    <title>利用Word生成报告</title>
    <link href="https://www.wangxingyang.com/genReport.html"/>
    <id>https://www.wangxingyang.com/genReport.html</id>
    <published>2021-08-26T12:47:29.000Z</published>
    <updated>2021-08-26T14:17:13.076Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>前段时间，有人问我能不能自动生成Word报告。需求是这样的，简述一下。要求根据提供的基础信息来生成所要的word报告。</p></blockquote><h3 id="0-思路"><a href="#0-思路" class="headerlink" title="0.思路"></a>0.思路</h3><hr><p>之前想直接用vbscript整篇生成的，但是整个报告的篇幅还是很长的，所以手写还是很费时很费力的。所以想转换思路，直接在Word中查找替换来实现，这样省去了排版的和输出文字等很多重复性的工作。但是这样的话有几个之前没弄过的：</p><ol><li>图片和表格保持原样式</li><li>将添加的按钮控件删除</li><li>定位和文件格式</li><li>生成的文档不能有宏</li><li>页眉的修改</li></ol><h3 id="1-实现"><a href="#1-实现" class="headerlink" title="1.实现"></a>1.实现</h3><hr><p>其实掌握了其中的诀窍之后，也不是很难的。首先查找替换功能网上都有现成的例子，可以参考，下面是代码：</p><pre class="line-numbers language-vbscript" data-language="vbscript"><code class="language-vbscript">Sub findAndReplace(find, replace)    Dim oRng As Range    Set oRng = Word.ActiveDocument.Content    With oRng.find        .ClearFormatting        With .Replacement            .ClearFormatting        End With        .Execute FindText:=find, ReplaceWith:=replace, replace:=wdReplaceAll    End WithEnd Sub<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接着是查找替换表格，这边略有不同，是利用了复制粘贴的功能，不得不说这个还是很实用的。<a href="https://docs.microsoft.com/zh-cn/office/vba/api/overview/word">微软的文档</a></p><pre class="line-numbers language-vbscript" data-language="vbscript"><code class="language-vbscript">' 查找到标签时会选中，然后将表格选中并粘贴进来就行Sub copyTable(ObjWD, table, tag)    table.Select    ObjWD.selection.Copy    With Word.selection.find     .Forward = True     .ClearFormatting     .MatchWholeWord = True     .MatchCase = False     .Wrap = wdFindContinue     .Execute FindText:=tag    End With    ' 这边需要注意，粘贴时需要保持原格式。参数的枚举值可以去官网查    Word.selection.PasteAndFormat 16End Sub<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>图片的处理和表格大同小异，主要是图片怎么取到的问题。这边看了文档没法确定那个图片是哪个，所以最后还是按顺序来操作的</p><pre class="line-numbers language-vbscript" data-language="vbscript"><code class="language-vbscript">Dim picArray, numnum = 0picArray = Array("pic0", "pic1", "pic2", "pic3", "pic4")For Each shp In ObjDOC.InlineShapes  If shp.Type = 3 Then ' 3 代表是图片    copyPicture ObjWD, shp, picArray(num)     num = num + 1   End If Next<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>之前提到的删除控件也和上面类似，只是类型不同，具体可参看官方文档。</p><p>保存不带宏的是通过新建一个新的文档，把处理好的结果全部拷贝过来，然后粘贴到新的文档中，注意⚠️要保存原格式。</p><p>替换使用唯一标签🏷️标记出来，找到了直接替换就行</p><p>页眉的也记录下</p><pre class="line-numbers language-vbscript" data-language="vbscript"><code class="language-vbscript">Sub EditHeaders(text)Dim i As LongFor i = 1 To ActiveDocument.Sections.Count    With ActiveDocument.Sections(i)        .Headers(1).Range.text = text    End WithNextEnd Sub<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-结语"><a href="#2-结语" class="headerlink" title="2.结语"></a>2.结语</h3><hr><p>这个还有很多值得优化的地方，比如现在表格是和替换逻辑是写死，后续可以提供相关的信息来让用户选择。还有很多细节的东西可以推敲。今天就写到这吧，完整的代码就不贴了，其他的也没啥好贴的。如果想要的可以留言我。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;前段时间，有人问我能不能自动生成Word报告。需求是这样的，简述一下。要求根据提供的基础信息来生成所要的word报告。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-思路&quot;&gt;&lt;a href=&quot;#0-思路&quot; class=&quot;headerlin</summary>
      
    
    
    
    <category term="工具" scheme="https://www.wangxingyang.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="vbscript" scheme="https://www.wangxingyang.com/tags/vbscript/"/>
    
    <category term="word" scheme="https://www.wangxingyang.com/tags/word/"/>
    
  </entry>
  
</feed>
