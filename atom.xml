<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>宁静致远</title>
  
  <subtitle>静心整理/分享生活</subtitle>
  <link href="https://www.wangxingyang.com/atom.xml" rel="self"/>
  
  <link href="https://www.wangxingyang.com/"/>
  <updated>2023-11-30T00:32:46.828Z</updated>
  <id>https://www.wangxingyang.com/</id>
  
  <author>
    <name>彤爸比</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>umami的搭建与HA接入</title>
    <link href="https://www.wangxingyang.com/umami.html"/>
    <image>https://freefitter.synology.me:6884/uploads/big/36b1f0ef8394236452af2a72e719cd60.png</image>
    
    <id>https://www.wangxingyang.com/umami.html</id>
    <published>2023-11-30T00:24:34.000Z</published>
    <updated>2023-11-30T00:32:46.828Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://freefitter.synology.me:6884/uploads/big/36b1f0ef8394236452af2a72e719cd60.png" alt="cover"></p><blockquote><p>百度统计又报错了，统计都不顶用了，这不只能自己想办法了，别人还是靠不住。网上找了找类似的。好像<strong>umami</strong>可以，所以就自己搭了一下。</p></blockquote><blockquote><p>umami是一个简单、快速、注重隐私的开源分析解决方案，它与Google Analytics相比有很多优势。它让用户对自己的数据有更多的控制权，并且不会侵犯用户的隐私。使用umami，您可以更好地了解您的网站或应用程序的使用情况，从而优化您的产品和服务。</p></blockquote><h3 id="0-搭建"><a href="#0-搭建" class="headerlink" title="0.搭建"></a>0.搭建</h3><hr><p>搭建很简单，项目在<a href="https://github.com/umami-software/umami">这里</a>，使用的<strong>docker</strong>，之前HA用的 <strong>PostgreSQL</strong>，所以就拉取了 <strong>umami:postgresql-latest</strong> 镜像，这边使用了 <strong>m.daocloud.io</strong> 加速。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">docker pull m.daocloud.io/ghcr.io/umami-software/umami:postgresql-latest<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>搭建的时候注意需要增加三个环境变量，然后直接启动即可。</p><pre class="line-numbers language-none"><code class="language-none">DATABASE_URL=postgresql://user:passwd@db:5432/dbnameDATABASE_TYPE=postgresqlHASH_SALT=changeme<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="1-使用"><a href="#1-使用" class="headerlink" title="1.使用"></a>1.使用</h3><hr><p>这边要用到我的博客上，所以做了个反代，直接访问部署机器的3000端口，就能看到界面了。<br>添加一个网站，在跟踪代码页签获得你的跟踪脚本，把它放到页面上就行了。<br><img src="https://freefitter.synology.me:6884/uploads/big/297058198833b22c9c75b5feeaf56a71.png" alt="完成图"></p><h3 id="2-接入HA"><a href="#2-接入HA" class="headerlink" title="2.接入HA"></a>2.接入HA</h3><hr><p>把这个数据接入HA，写了个 <strong>Node-Red</strong> 流，本质上就是调用它提供的 <em><strong>API</strong></em>，<a href="https://umami.is/docs">官方文档</a>在这里。<br>大致流程是先调用 <strong>POST /api/auth/login</strong>  换 token ，然后再用这个token 去调用其他的接口，现在调的是 <strong>GET /api/websites/{websiteId}/stats</strong>，有别的需求可以自己去修改。<br>最后接入的样子是这样的<br><img src="https://freefitter.synology.me:6884/uploads/big/4bac9f7d31498d70c40a8027f8876765.png" alt="HA接入"><br>流是这样的<br><img src="https://freefitter.synology.me:6884/uploads/big/1271693e4b2a11fecfe41fec3af7d0d2.png" alt="Node-red流"></p><h3 id="3-总结"><a href="#3-总结" class="headerlink" title="3.总结"></a>3.总结</h3><hr><p>没事多折腾，很多东西可以多换换多了解了解，不仅可以拓宽自己的知识面，说不定还能发现比现在更有趣的东西。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;https://freefitter.synology.me:6884/uploads/big/36b1f0ef8394236452af2a72e719cd60.png&quot; alt=&quot;cover&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;百度统计又报错了</summary>
      
    
    
    
    
    <category term="HA" scheme="https://www.wangxingyang.com/tags/HA/"/>
    
    <category term="umami" scheme="https://www.wangxingyang.com/tags/umami/"/>
    
    <category term="网站分析统计" scheme="https://www.wangxingyang.com/tags/%E7%BD%91%E7%AB%99%E5%88%86%E6%9E%90%E7%BB%9F%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>周末分享</title>
    <link href="https://www.wangxingyang.com/dayshare231115.html"/>
    <image>https://freefitter.synology.me:6884/uploads/medium/54ad5cd9a9f321dff7c508ce07c1d468.jpg</image>
    
    <id>https://www.wangxingyang.com/dayshare231115.html</id>
    <published>2023-11-26T00:20:19.000Z</published>
    <updated>2023-11-30T00:30:40.692Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>好久没有写周末分享了，天气渐渐冷了，可能出去的机会也会慢慢的变少，这周去了珍珠泉，走了一圈，享受生活。</p></blockquote><h3 id="0-照片"><a href="#0-照片" class="headerlink" title="0.照片"></a>0.照片</h3><hr><p><img src="https://freefitter.synology.me:6884/uploads/medium/54ad5cd9a9f321dff7c508ce07c1d468.jpg" alt="捡银杏叶"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/0615555b62fc2a38b7c85b2bf67380a1.jpg" alt="若有所思"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/1fd60626ee0250e0e1ebd0bffa778d08.jpg" alt="抓枫叶"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/87a783fc5646ac3f1fe8c647935b38b9.jpg" alt="湖光山色"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/820aee1874ddb4e35c139c5005015b9d.jpg" alt="背影"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;好久没有写周末分享了，天气渐渐冷了，可能出去的机会也会慢慢的变少，这周去了珍珠泉，走了一圈，享受生活。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-照片&quot;&gt;&lt;a href=&quot;#0-照片&quot; class=&quot;headerlink&quot; title</summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="遛娃" scheme="https://www.wangxingyang.com/tags/%E9%81%9B%E5%A8%83/"/>
    
    <category term="珍珠泉" scheme="https://www.wangxingyang.com/tags/%E7%8F%8D%E7%8F%A0%E6%B3%89/"/>
    
    <category term="拾秋" scheme="https://www.wangxingyang.com/tags/%E6%8B%BE%E7%A7%8B/"/>
    
  </entry>
  
  <entry>
    <title>HA遇上LiteSpeedTest</title>
    <link href="https://www.wangxingyang.com/haandlite.html"/>
    <image>https://freefitter.synology.me:6884/uploads/medium/3f3c2e63c159e8e69004b5b7c3a6a599.png</image>
    
    <id>https://www.wangxingyang.com/haandlite.html</id>
    <published>2023-10-26T14:45:37.000Z</published>
    <updated>2023-10-26T15:44:18.134Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在之前的博客中有提到<a href="https://github.com/xxf098/LiteSpeedTest/#litespeedtest">LiteSpeedTest</a> 这个项目，之前一直用的<code>v2rayA</code>还是不错的，但是内存占用还是稍微高那么一点，<code>LiteSpeedTest</code> 占用还是很小的，但是使用没有<code>v2rayA</code>那么方便，之前不是在搞<strong>Home Assistant</strong>，这不想在上面再整点活。</p></blockquote><h3 id="0-设计思路"><a href="#0-设计思路" class="headerlink" title="0.设计思路"></a>0.设计思路</h3><hr><p>目前<code>LiteSpeedTest</code>有命令行，手边<code>Node-RED</code>也可以加入战斗，用<code>RESTful Command</code>集成请求<code>Node-RED</code>中的接口，通过<code>Node-RED</code> 中的<strong>exec</strong> 执行<code>shell</code>脚本来控制<strong>LiteSpeedTest</strong>，然后把可用的节点通过 <strong>RESTful</strong> 这个集成保存到<strong>Home Assistant</strong>中。相关的状态更新通过调用<strong>Home Assistant</strong>的<strong>API</strong>实现。</p><h3 id="1-动手开整"><a href="#1-动手开整" class="headerlink" title="1.动手开整"></a>1.动手开整</h3><hr><h4 id="a-首先需要这几个辅助元素"><a href="#a-首先需要这几个辅助元素" class="headerlink" title="a)首先需要这几个辅助元素"></a>a)首先需要这几个<strong>辅助元素</strong></h4><p>添加下面这些辅助元素，页面编辑的时候会用到 </p><p><img src="https://freefitter.synology.me:6884/uploads/medium/18f00ece10639091597425c3f9cd082c.png" alt="辅助元素"></p><h4 id="b-测速自动化"><a href="#b-测速自动化" class="headerlink" title="b)测速自动化"></a>b)测速自动化</h4><p>该自动化在测速按钮按下时触发。没有其实也可以，在实体的动作时添加。</p><h4 id="c-配置集成"><a href="#c-配置集成" class="headerlink" title="c) 配置集成"></a>c) 配置集成</h4><h4 id="d-写流"><a href="#d-写流" class="headerlink" title="d) 写流"></a>d) 写流</h4><p><img src="https://freefitter.synology.me:6884/uploads/big/866f9a24c38e970ee0accf88a87d7be4.png" alt="l流"></p><h4 id="f-画界面"><a href="#f-画界面" class="headerlink" title="f) 画界面"></a>f) 画界面</h4><p><img src="https://freefitter.synology.me:6884/uploads/medium/663980992cef1983d5ff6ce5dd9a38bb.png" alt="界面"></p><p>到这里就打工告成了，里面的的细节就不写了，有需要了解的可以留言，后面整理整理发出来。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;在之前的博客中有提到&lt;a href=&quot;https://github.com/xxf098/LiteSpeedTest/#litespeedtest&quot;&gt;LiteSpeedTest&lt;/a&gt; 这个项目，之前一直用的&lt;code&gt;v2rayA&lt;/code&gt;还</summary>
      
    
    
    
    <category term="工具" scheme="https://www.wangxingyang.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
    <category term="Home Assistant" scheme="https://www.wangxingyang.com/tags/Home-Assistant/"/>
    
    <category term="LiteSpeedTest" scheme="https://www.wangxingyang.com/tags/LiteSpeedTest/"/>
    
    <category term="魔法" scheme="https://www.wangxingyang.com/tags/%E9%AD%94%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Home Assistant再次起航</title>
    <link href="https://www.wangxingyang.com/haagain.html"/>
    <image>https://freefitter.synology.me:6884/uploads/medium/681bb442d41c5148b3a9936e5080808f.png</image>
    
    <id>https://www.wangxingyang.com/haagain.html</id>
    <published>2023-10-15T14:03:00.000Z</published>
    <updated>2023-10-16T11:21:55.882Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>之前在群晖中搭建了<em>Home Assistant</em> ，后面由于后面群晖总是自动重启，导致它并不是很稳定，后面发现是因为群晖加的内存不兼容导致的，问题解决了但是一直没有重新搭建，之前不是买了香橙派嘛，准备在上面搭建一个。</p></blockquote><h3 id="0-1Pane安装"><a href="#0-1Pane安装" class="headerlink" title="0.1Pane安装"></a>0.1Pane安装</h3><hr><p><a href="https://www.1panel.cn/">1Panel</a>是新一代的 Linux 服务器运维管理面板，在香橙派中安装它，主要是感觉有个工具管理起来会更方便些。安装方法可以去官网中查看，安装完成如下：<br><img src="https://freefitter.synology.me:6884/uploads/big/c60bd6063ff3e6b74661e95b62f269b7.png" alt="1Panel"></p><h3 id="1-安装Home-Assistant"><a href="#1-安装Home-Assistant" class="headerlink" title="1.安装Home Assistant"></a>1.安装Home Assistant</h3><hr><p>在应用商店中找到它，然后点击安装即可。安装完成后可在应用商店中管理。完成后会在容器中显示你安装的应用。<br><img src="https://freefitter.synology.me:6884/uploads/big/69b68bdfbe1556b9e70a81fa026b7328.png" alt="HA安装"><br><img src="https://freefitter.synology.me:6884/uploads/big/36056a46f5ce67aa09c678bf1354da02.png" alt="HA容器"><br>应用中心下载的不是最新的，可以自己升级一下，拉取最新的镜像。这边有个注意的地方，如果需要用到蓝牙的话，需要挂载<code>/run/dbus</code>这个目录，不然蓝牙用不了。<br><img src="https://freefitter.synology.me:6884/uploads/big/853ca520b6260fea8cc29e1168fb1a06.png" alt="挂载目录"></p><h3 id="2-配置Home-Assistant"><a href="#2-配置Home-Assistant" class="headerlink" title="2.配置Home Assistant"></a>2.配置Home Assistant</h3><hr><p>现在很多都已经集成在里面了，所以很多事情都不需要去做了，直接按照引导去做就行了。不用敲代码和复杂的操作，就可以集成下面这么多。添加小米设备主要是Token的获取，可以使用 <a href="https://github.com/PiotrMachowski/Xiaomi-cloud-tokens-extractor#xiaomi-cloud-tokens-extractor">Xiaomi Cloud Tokens Extractor</a> 这个项目，方便快捷。<br><img src="https://freefitter.synology.me:6884/uploads/big/996bf4284ab85e4568fb3960a25e45f8.png" alt="所有集成"><br>在配置<code>HTTPS</code>访问的时候需要增加如下配置，主要是指定证书的路径：<br><img src="https://freefitter.synology.me:6884/uploads/medium/b6bbc9041f8acf79e8e5e2a8315eff41.png" alt="HA配置"><br>到此你的<code>Home Assistant</code>已经安装的差不多了，下面就是自己写自动化，然后美化美化了。这边还有一个问题，就是添加<code>Private BLE Device</code>这个集成的时候， 如果手机找不到相应的<strong>IRK</strong>，可以通过<a href="https://github.com/dansonskywalker/esp_ble_tracker">esp_ble_tracker</a>这个项目中的 <em><strong>get_irk</strong></em> 来拿到对应的<code>IRK</code>，这边需要<code>ESP32</code>烧录这个程序，我用的是<code>M5stack</code>，然后使用<code>LightBlue</code> App搜索到ESP打头的蓝牙，链接后会在串口的日志中打印如下内容：</p><pre class="line-numbers language-none"><code class="language-none">IRK:,0x2X,0x5D,0x45,0xFD,0x42,0x68,0x4F,0x57,0xF4,0x9F,0x8D,0xB4,0xA9,0x25,0x4E,0xC4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>接着去掉,0x并转成小写，使用如下Python代码转成base64。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"> <span class="token keyword">import</span> codecshex_str<span class="token operator">=</span><span class="token string">"2x5d45fd42684f57f49f8db4a9254ec4"</span>b64_str <span class="token operator">=</span> codecs<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>codecs<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>hex_str<span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>b64_str<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>文档中说是支持hex encoding的，但是格式我没试出来，一直添加失败，所以只能转成base64 添加了。</p><h3 id="3-结语"><a href="#3-结语" class="headerlink" title="3.结语"></a>3.结语</h3><hr><p>现在家里两个派了，也做了个两个派的运行状态的显示，用的<code>M5Stack BASIC</code>来显示。现在两个派运行的挺稳定的。后面看看要不要再弄点别的折腾下。<br><img src="https://freefitter.synology.me:6884/uploads/big/d55d05d61439e523989d5196467055c4.png" alt="M5Stack BASIC"><br>运行情况如图:<br><img src="https://freefitter.synology.me:6884/uploads/big/0f5d8758524a97401a7be8ca2b462515.jpg" alt="两个Pi运行状态对比"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;之前在群晖中搭建了&lt;em&gt;Home Assistant&lt;/em&gt; ，后面由于后面群晖总是自动重启，导致它并不是很稳定，后面发现是因为群晖加的内存不兼容导致的，问题解决了但是一直没有重新搭建，之前不是买了香橙派嘛，准备在上面搭建一个。&lt;/p&gt;
&lt;/b</summary>
      
    
    
    
    <category term="智能家居" scheme="https://www.wangxingyang.com/categories/%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85/"/>
    
    
    <category term="M5Stack" scheme="https://www.wangxingyang.com/tags/M5Stack/"/>
    
    <category term="ESP32" scheme="https://www.wangxingyang.com/tags/ESP32/"/>
    
    <category term="Home Assistant" scheme="https://www.wangxingyang.com/tags/Home-Assistant/"/>
    
  </entry>
  
  <entry>
    <title>我上幼儿园了</title>
    <link href="https://www.wangxingyang.com/dayshare230903.html"/>
    <image>https://freefitter.synology.me:6884/uploads/big/eacc792fbdebc29751df2696a42248c9.png</image>
    
    <id>https://www.wangxingyang.com/dayshare230903.html</id>
    <published>2023-09-03T11:29:52.000Z</published>
    <updated>2023-11-30T00:30:38.674Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>彤彤今天去幼儿园体验了，感觉现在的幼儿园真的太棒了，有小菜园，有鸡鸭鹅，有游乐场，有小桥流水等等，话不多说，直接上图。还有很多教室没有图，户外的地方还是比较吸引我的。</p></blockquote><h3 id="0-带你上幼儿园"><a href="#0-带你上幼儿园" class="headerlink" title="0.带你上幼儿园"></a>0.带你上幼儿园</h3><hr><p><img src="https://freefitter.synology.me:6884/uploads/medium/7acb52d6728fa2f9648a732d826f63e1.png" alt="小红花"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/758ef74d120e26a9cc969d903e51610e.png" alt="运动"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/6fde7065f7efd62d44a7ef3d555b5bb8.png" alt="就是玩"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/c9cec6e71ac831cfe33c5d63ebfcc020.png" alt="还是玩"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/d98785d3e44d43c17af6d89d55c428c0.png" alt="爱劳动的"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/cf5199dacc5f6f7196a018af4644a9ea.png" alt="老师教做小绵羊"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/40f190b149f5887cb50d1ef1fc8baba6.png" alt="看看我的作品"></p><p><img src="https://freefitter.synology.me:6884/uploads/big/4ada2aea6dcd0baeb01cdac63144df1a.png" alt="签到台"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/0a02c33482724c52214a7bdcb935c97b.png" alt="山洞探索"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/c0cf1efb5e563a90a6d106b7d3501ac0.png" alt="准备滑索"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/0fe64161fcc357120cac681c6855ca20.png" alt="滑索"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/42f8d6c8d6d04ffd0ad627bc33f4e648.png" alt="菜地"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/76ced99b95f8dc9b7c2a20c3e58e9280.png" alt="鸡鸭鹅"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/c364fc8e2baf10fc3808cddacc98daa4.png" alt="玩水"></p><p><img src="https://freefitter.synology.me:6884/uploads/medium/dff6a34b68faf2a692706e926e2a9556.png" alt="骑车"></p><h3 id="1-感受"><a href="#1-感受" class="headerlink" title="1.感受"></a>1.感受</h3><hr><p>希望彤宝的幼儿园生活丰富多彩，开心快乐每一天。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;彤彤今天去幼儿园体验了，感觉现在的幼儿园真的太棒了，有小菜园，有鸡鸭鹅，有游乐场，有小桥流水等等，话不多说，直接上图。还有很多教室没有图，户外的地方还是比较吸引我的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-带你上幼儿园&quot;&gt;&lt;a h</summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="幼儿园" scheme="https://www.wangxingyang.com/tags/%E5%B9%BC%E5%84%BF%E5%9B%AD/"/>
    
    <category term="上学" scheme="https://www.wangxingyang.com/tags/%E4%B8%8A%E5%AD%A6/"/>
    
    <category term="小红花" scheme="https://www.wangxingyang.com/tags/%E5%B0%8F%E7%BA%A2%E8%8A%B1/"/>
    
  </entry>
  
</feed>
