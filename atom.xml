<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>宁静致远</title>
  
  <subtitle>静心整理/分享生活</subtitle>
  <link href="https://www.wangxingyang.com/atom.xml" rel="self"/>
  
  <link href="https://www.wangxingyang.com/"/>
  <updated>2024-11-09T13:30:45.795Z</updated>
  <id>https://www.wangxingyang.com/</id>
  
  <author>
    <name>彤爸比</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>智能家庭新技能：Home Assistant中的快递取件码接入方法</title>
    <link href="https://www.wangxingyang.com/ddkdha.html"/>
    <image>https://freefitter.synology.me:9012/blog/20241109213033.png</image>
    
    <id>https://www.wangxingyang.com/ddkdha.html</id>
    <published>2024-11-09T10:45:04.000Z</published>
    <updated>2024-11-09T13:30:45.795Z</updated>
    
    <content type="html"><![CDATA[<hr><h3 id="0-起因"><a href="#0-起因" class="headerlink" title="0.起因"></a>0.起因</h3><hr><p>之前一直用的<strong>菜鸟裹裹</strong>去查快递信息，但是最近它不好使了，取件码都不显示了，直接卸载。然后驿站的人让关注<strong>多多买菜代收点</strong>这个公众号，关注了之后发现取件码显示正常了。之前有把快递接入HA的案例，故现在也想把它接进去。</p><h3 id="1-过程"><a href="#1-过程" class="headerlink" title="1.过程"></a>1.过程</h3><hr><ol><li>按照国际惯例，上来先抓包。首先关注一下这个公众号，然后打开<strong>Stream</strong>开始抓包，分析一下抓的包，找到相关接口即可<br><img src="https://freefitter.synology.me:9012/blog/20241109182129.png" alt="image.png"></li><li>找到相关接口，直接使用<strong>Node-Red</strong>模拟请求即可，接着把相关的数据再处理下，最后生成传感器至HA就完工了。下面是流的结构，模拟请求，这边两个，一个是老婆的一个是自己，接着把未取的快递信息解析出来，组合排序后生成传感器。<br><img src="https://freefitter.synology.me:9012/blog/20241109182828.png" alt="image.png"></li><li>最后的结果如下：<br><img src="https://freefitter.synology.me:9012/blog/20241109183045.png" alt="image.png"><h3 id="2-总结"><a href="#2-总结" class="headerlink" title="2.总结"></a>2.总结</h3></li></ol><hr><p>虽然这个不是必须的，微信也有推送，但是这种公众号一般都是屏蔽的，但是<strong>Home Assistant</strong>是经常看的，把想知道的信息都放在这边，这样省去查找的麻烦。下面的图就是我想知道的所有信息和操作了。<br><img src="https://freefitter.synology.me:9012/blog/20241109183426.png" alt="image.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;hr&gt;
&lt;h3 id=&quot;0-起因&quot;&gt;&lt;a href=&quot;#0-起因&quot; class=&quot;headerlink&quot; title=&quot;0.起因&quot;&gt;&lt;/a&gt;0.起因&lt;/h3&gt;&lt;hr&gt;
&lt;p&gt;之前一直用的&lt;strong&gt;菜鸟裹裹&lt;/strong&gt;去查快递信息，但是最近它不好使了，取件码都不显示了</summary>
      
    
    
    
    <category term="智能家居" scheme="https://www.wangxingyang.com/categories/%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85/"/>
    
    
    <category term="HA" scheme="https://www.wangxingyang.com/tags/HA/"/>
    
    <category term="快递" scheme="https://www.wangxingyang.com/tags/%E5%BF%AB%E9%80%92/"/>
    
  </entry>
  
  <entry>
    <title>秋收节手工制作</title>
    <link href="https://www.wangxingyang.com/dayshare241108.html"/>
    <image>https://freefitter.synology.me:9012/blog/20241104223956.png</image>
    
    <id>https://www.wangxingyang.com/dayshare241108.html</id>
    <published>2024-11-08T10:59:12.000Z</published>
    <updated>2024-11-08T11:03:31.511Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>幼儿园又搞活动啦，这次是丰收节，需要用南瓜和树叶做好服装去走秀。周末收集了树叶，然后就开干了。打算做个帽子和衣服，南瓜的话准备搞个南瓜灯。</p></blockquote><h3 id="0-帽子的制作"><a href="#0-帽子的制作" class="headerlink" title="0.帽子的制作"></a>0.帽子的制作</h3><hr><p>网上买了个草帽，然后构思下，把树叶用热熔胶沾上去就好了。又用超轻粘土做了几个小南瓜。废话不多说，直接上图。<br><img src="https://freefitter.synology.me:9012/blog/20241104223938.png" alt="原材料"><br><img src="https://freefitter.synology.me:9012/blog/20241104224014.png" alt="南瓜"><br><img src="https://freefitter.synology.me:9012/blog/20241104223956.png" alt="正视图"><br><img src="https://freefitter.synology.me:9012/blog/20241104224023.png" alt="俯视图"></p><h3 id="1-衣服的制作"><a href="#1-衣服的制作" class="headerlink" title="1.衣服的制作"></a>1.衣服的制作</h3><hr><p>衣服就就是直接构思好，做了个裙边，然后中间做了小女孩的样子。<br><img src="https://freefitter.synology.me:9012/blog/20241104224144.png" alt="裙边"><br><img src="https://freefitter.synology.me:9012/blog/20241104224151.png" alt="小女孩特写"><br><img src="https://freefitter.synology.me:9012/blog/20241104224208.png" alt="成果展示"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;幼儿园又搞活动啦，这次是丰收节，需要用南瓜和树叶做好服装去走秀。周末收集了树叶，然后就开干了。打算做个帽子和衣服，南瓜的话准备搞个南瓜灯。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-帽子的制作&quot;&gt;&lt;a href=&quot;#0-帽子的制作&quot; </summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="幼儿园" scheme="https://www.wangxingyang.com/tags/%E5%B9%BC%E5%84%BF%E5%9B%AD/"/>
    
    <category term="手工" scheme="https://www.wangxingyang.com/tags/%E6%89%8B%E5%B7%A5/"/>
    
  </entry>
  
  <entry>
    <title>HA薅羊毛助力：简化步骤，让Microsoft Rewards积分赚取更简单</title>
    <link href="https://www.wangxingyang.com/microsoft-rewards.html"/>
    <image>https://freefitter.synology.me:9012/blog/ff4293b834cc279ff03cd50302f14d9.png</image>
    
    <id>https://www.wangxingyang.com/microsoft-rewards.html</id>
    <published>2024-10-11T12:50:53.000Z</published>
    <updated>2024-10-11T12:55:16.382Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>搜索一直用必应，有账号但是没有登陆，最近看到必应上可以各种礼品卡，只要每天做好任务，日积月累总能达到你的目标的。</p></blockquote><h3 id="0-Microsoft-Rewards"><a href="#0-Microsoft-Rewards" class="headerlink" title="0.Microsoft Rewards"></a>0.Microsoft Rewards</h3><hr><p><strong>Microsoft Rewards</strong>移动端和电脑端加起来一天至少能够获得<strong>210</strong>积分，以盒马的100元礼品卡为例，100的礼品卡需要<strong>17915</strong>个积分，这样算下来的话，一张卡需要<strong>86</strong>天就能够拿到了，实际肯定是比这个天数少的。用这个速度划下来一天一块多钱。<br><img src="https://freefitter.synology.me:9012/blog/232386bad63951ef19aa0767d2c1f1a.png" alt="可以兑换的礼品卡"></p><h3 id="1-HomeAssistant"><a href="#1-HomeAssistant" class="headerlink" title="1.HomeAssistant"></a>1.HomeAssistant</h3><hr><p>现在目标和方法都知道了，现在开看看怎样让这个羊毛薅的更轻松方便吧。每日活动的阅读获得积分获得的比较容易，就直接阅读文章就行了。搜索赚积分的比较麻烦，通过这几天的观察，每次搜索最多12个积分，达到了之后需要等15分钟后搜索才能获得积分。每日活动的话，上午是点不了的，等到下午的时候再做就行。所以针对这些问题来解决。<br><img src="https://freefitter.synology.me:9012/blog/4a80acd0ed60156248ed74d12383901.jpg" alt="每日任务"></p><p>利用HA的上次更新时间可以知道积分距离上次更新的时间，超过15分钟就可以操作了。还将没完成的任务列了出来，还有距离目标的百分比和天数都展示出来了。跟踪了一段时间，使用<strong>iPad也能够获得电脑搜索的积分，而且还没有时间限制</strong>。所以有Pad的同学可以尝试下这个方案。<br>HA中任务未完成的展示如下：<br><img src="https://freefitter.synology.me:9012/blog/0aa7d466267adad8872bde67307182f.jpg" alt="HA中信息展示"><br>HA中任务完成后的展示如下：<br><img src="https://freefitter.synology.me:9012/blog/3f1c0c0134ea55ebf64dc912e520619.jpg" alt="任务完成的展示"><br>这些数据来源都是通过<strong>Node-Red</strong>来实现的，主要还是自己去抓包分析一下，实现的方式多种多样，只要你觉得好用就行。下面是流的图<br><img src="https://freefitter.synology.me:9012/blog/20241011143853.png" alt="Node_Red流"></p><h3 id="2-总结"><a href="#2-总结" class="headerlink" title="2.总结"></a>2.总结</h3><hr><p>手机和电脑端都是有油猴脚本的，可以一键帮你做任务，有需要的可以搜搜。但是我还是自己去做的，因为每天本来就有很多搜索，不知不觉就已经做完了，其他的任务很快就能够完成的。所以也没必要去使用脚本，关键脚本貌似可能会被封号。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;搜索一直用必应，有账号但是没有登陆，最近看到必应上可以各种礼品卡，只要每天做好任务，日积月累总能达到你的目标的。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-Microsoft-Rewards&quot;&gt;&lt;a href=&quot;#0-Microsof</summary>
      
    
    
    
    <category term="教程" scheme="https://www.wangxingyang.com/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="HA" scheme="https://www.wangxingyang.com/tags/HA/"/>
    
    <category term="Microsoft Rewards" scheme="https://www.wangxingyang.com/tags/Microsoft-Rewards/"/>
    
  </entry>
  
  <entry>
    <title>解锁苹果影音新方式：探索HamHub私人云影专家</title>
    <link href="https://www.wangxingyang.com/hamhub.html"/>
    <image>https://freefitter.synology.me:9012/blog/20240925224702.png</image>
    
    <id>https://www.wangxingyang.com/hamhub.html</id>
    <published>2024-09-25T15:19:52.000Z</published>
    <updated>2024-09-25T15:21:14.148Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>之前写过一个使用<a href="https://mp.weixin.qq.com/s/TgNcVw3aeZ93-zh-FHrw5g">AList+阿里云盘+NOVA搭建自己的影视中心</a>，投影可以愉快的使用了，但是手机上由于<strong>VidHub</strong>收费了，所以就弃了。没它之后就一直用<strong>SenPlayer</strong>替代，它啥啥都好，就是没有刮削，没有海报墙，总之就是不美观。一直在找免费且好看好用的，最近重拾了<strong>HamHub</strong>感觉还不错。</p></blockquote><h3 id="0-介绍"><a href="#0-介绍" class="headerlink" title="0.介绍"></a>0.介绍</h3><hr><p>这个播放器在<strong>VidHub</strong>快收费时试过，功能差不多，但是之前的版本，功能还不是很完善。比如不能设置某个文件夹扫描，只能全局扫描，而且刮削不准且慢。这次重拾它，发现这些功能都有改善，所以推荐给大家。这是官网<a href="https://www.hamhub.app/">HamHub</a><br><img src="https://freefitter.synology.me:9012/blog/20240925224702.png" alt="image.png"><br>另外还有一个阿里云盘限速了，看4K的话会很卡的。现在的解决方案是通过阿里云盘找资源，有了资源后同步到家里的群晖，然后家里使用<strong>HamHub</strong>连接家里的群晖，这样就能畅快的看视频了。</p><h3 id="1-设置"><a href="#1-设置" class="headerlink" title="1.设置"></a>1.设置</h3><hr><h4 id="a-添加文件库"><a href="#a-添加文件库" class="headerlink" title="a) 添加文件库"></a>a) 添加文件库</h4><p>添加一下新的文件库，通过SMB方式连接到群晖，可以新建一个用户，只开放某个目录，权限再放小点，这样会安全些。下面是配置信息，填上就好了。<br><img src="https://freefitter.synology.me:9012/blog/20240925230704.png" alt="image.png"></p><h4 id="b-标记影视夹"><a href="#b-标记影视夹" class="headerlink" title="b) 标记影视夹"></a>b) 标记影视夹</h4><p>添加完了文件库，找到你放视频的文件夹，长按后选择<strong>标记为影视夹</strong>即可<br><img src="https://freefitter.synology.me:9012/blog/20240925231027.png" alt="image.png"></p><h3 id="2-展示"><a href="#2-展示" class="headerlink" title="2.展示"></a>2.展示</h3><hr><p>设置完成之后，等他刮削完成就能看到海报墙了。<br>这是盘里电视剧的资源<br><img src="https://freefitter.synology.me:9012/blog/20240925231144.png" alt="image.png"><br>这是电视剧的海报页面，还是很好看的。<br><img src="https://freefitter.synology.me:9012/blog/20240925231239.png" alt="image.png"><br>最后是播放页面，可以愉快的看电视了。<br><img src="https://freefitter.synology.me:9012/blog/20240925231327.png" alt="image.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;之前写过一个使用&lt;a href=&quot;https://mp.weixin.qq.com/s/TgNcVw3aeZ93-zh-FHrw5g&quot;&gt;AList+阿里云盘+NOVA搭建自己的影视中心&lt;/a&gt;，投影可以愉快的使用了，但是手机上由于&lt;strong&gt;V</summary>
      
    
    
    
    <category term="教程" scheme="https://www.wangxingyang.com/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="群晖" scheme="https://www.wangxingyang.com/tags/%E7%BE%A4%E6%99%96/"/>
    
    <category term="hamhub" scheme="https://www.wangxingyang.com/tags/hamhub/"/>
    
  </entry>
  
  <entry>
    <title>智能家居小贴士：如何将电信和移动余额集成到Home Assistant</title>
    <link href="https://www.wangxingyang.com/phonefee.html"/>
    <image>https://freefitter.synology.me:9012/blog/20240924225838.png</image>
    
    <id>https://www.wangxingyang.com/phonefee.html</id>
    <published>2024-09-24T15:01:50.000Z</published>
    <updated>2024-09-24T15:03:08.190Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>现在的查询手机余额的方式多种多样，余额不足时也会发短信息提醒你，但是有时候就是想看看手机余额，如果只有一个运营商还好，多了的话可能查起来就比较繁琐了，所以就想把余额给监控起来，并且集成到Home Assistant中。</p></blockquote><h3 id="0-余额获取"><a href="#0-余额获取" class="headerlink" title="0.余额获取"></a>0.余额获取</h3><hr><p>身边有两个运营商分别时电信和移动，电信的之前是通过抓包的方式获取的余额，抓包的就不详细说了，主要说个移动的方式，因为这个会了，电信不用抓包也行的。</p><h4 id="移动余额获取思路"><a href="#移动余额获取思路" class="headerlink" title="移动余额获取思路"></a>移动余额获取思路</h4><ol><li>写一个快捷指令，给10086发送查话费的短信</li><li>在自动化中每天定时运行这个快捷指令</li><li>当收到10086的短信时，将短信内容推送到服务器</li><li>服务器将内容通过巴法云的MQTT发送到指定的主题</li><li>家里的Node-Red订阅这个主题，将内容解析并生成传感器至Home Assistant</li></ol><p>通过以上的步骤就能够把话费余额集成到HA中了。这边也可以简化的，可以直接把短信内容推送到Node-Red，然后解析内容生成传感器。为啥绕了这一圈呢，因为不想把Node-Red暴露到公网上，而且有现成的服务器，所以就绕了一圈。</p><h3 id="1-具体实施"><a href="#1-具体实施" class="headerlink" title="1.具体实施"></a>1.具体实施</h3><hr><p>在手机上做好基本的配置，编辑好查话费的快捷指令如下：<br><img src="https://freefitter.synology.me:9012/blog/20240924224359.png" alt="查询话费"><br>添加好两个自动化，一个用于发短息，一个用于推送接收到的短信内容。<br><img src="https://freefitter.synology.me:9012/blog/20240924224412.png" alt="自动化运行"><br>服务器上需要一个小脚本，用来做HTTP到MQTT的转换的，脚本如下：</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> bottle <span class="token keyword">import</span> Bottle<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token keyword">import</span> paho<span class="token punctuation">.</span>mqtt<span class="token punctuation">.</span>client <span class="token keyword">as</span> mqtt<span class="token comment"># MQTT配置</span>MQTT_BROKER <span class="token operator">=</span> <span class="token string">'bemfa.com'</span>MQTT_PORT <span class="token operator">=</span> <span class="token number">9501</span>MQTT_TOPIC <span class="token operator">=</span> <span class="token string">'替换主题'</span><span class="token comment"># 创建MQTT客户端实例</span>client <span class="token operator">=</span> mqtt<span class="token punctuation">.</span>Client<span class="token punctuation">(</span>client_id<span class="token operator">=</span><span class="token string">"替换成巴法云的"</span><span class="token punctuation">)</span><span class="token comment"># 定义连接成功的回调函数</span><span class="token keyword">def</span> <span class="token function">on_connect</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> userdata<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> rc <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Connected successfully."</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Connected with result code "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>rc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># 定义连接丢失的回调函数</span><span class="token keyword">def</span> <span class="token function">on_disconnect</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> userdata<span class="token punctuation">,</span> rc<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> rc <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Unexpected disconnection."</span><span class="token punctuation">)</span><span class="token comment"># 定义消息发布的回调函数</span><span class="token keyword">def</span> <span class="token function">on_publish</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> userdata<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Message published."</span><span class="token punctuation">)</span><span class="token comment"># 连接到MQTT服务器</span>client<span class="token punctuation">.</span>on_connect <span class="token operator">=</span> on_connectclient<span class="token punctuation">.</span>on_disconnect <span class="token operator">=</span> on_disconnectclient<span class="token punctuation">.</span>on_publish <span class="token operator">=</span> on_publishclient<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>MQTT_BROKER<span class="token punctuation">,</span> MQTT_PORT<span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token comment"># 启动MQTT客户端的循环，但不阻塞主线程</span>client<span class="token punctuation">.</span>loop_start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># Bottle应用</span>app <span class="token operator">=</span> Bottle<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 定义HTTP POST路由，用于接收数据并将其发送到MQTT</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">'/publish'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 从请求中获取数据</span>    data <span class="token operator">=</span> request<span class="token punctuation">.</span>json    topic <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'topic'</span><span class="token punctuation">,</span> MQTT_TOPIC<span class="token punctuation">)</span>    message <span class="token operator">=</span> data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>    <span class="token comment"># 检查MQTT连接状态</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> client<span class="token punctuation">.</span>is_connected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"MQTT client is not connected. Attempting to reconnect..."</span><span class="token punctuation">)</span>        client<span class="token punctuation">.</span>reconnect<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 等待一段时间，让重连逻辑生效</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>    <span class="token comment"># 再次检查连接状态</span>    <span class="token keyword">if</span> client<span class="token punctuation">.</span>is_connected<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment"># 发布消息到MQTT</span>        result <span class="token operator">=</span> client<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>topic<span class="token punctuation">,</span> message<span class="token punctuation">)</span>        status <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> status <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span>            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'status'</span><span class="token punctuation">:</span> <span class="token string">'message published'</span><span class="token punctuation">}</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">500</span>            <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'status'</span><span class="token punctuation">:</span> <span class="token string">'message send failed with result code '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">}</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">500</span>        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'status'</span><span class="token punctuation">:</span> <span class="token string">'mqtt client is not connected after reconnect attempt'</span><span class="token punctuation">}</span><span class="token comment"># 运行Bottle应用</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8989</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Node-Red中订阅主题后，解析收到的短信内容并生成传感器信息推送给HA的MQTT就完成了。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> message <span class="token operator">=</span> msg<span class="token punctuation">.</span>payload<span class="token punctuation">;</span><span class="token keyword">let</span> balancePattern <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">账户余额(\d+\.\d+)元</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span><span class="token keyword">let</span> match <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>balancePattern<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 检查是否找到了匹配项</span><span class="token keyword">if</span> <span class="token punctuation">(</span>match<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 提取余额</span>    totalMoney <span class="token operator">=</span> match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    totalMoney <span class="token operator">=</span> <span class="token string">"-"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">let</span> dxphone_fee <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"totalMoney"</span><span class="token operator">:</span> totalMoney<span class="token punctuation">}</span><span class="token keyword">const</span> prefix <span class="token operator">=</span> <span class="token string">"home/sensor/ydphone_fee"</span><span class="token keyword">let</span> msg_config <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>msg_config <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token punctuation">{</span>        <span class="token string">"topic"</span><span class="token operator">:</span> <span class="token string">"homeassistant/sensor/ydphone_fee/config"</span><span class="token punctuation">,</span>        <span class="token string">"payload"</span><span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token string">"~"</span><span class="token operator">:</span> prefix<span class="token punctuation">,</span>            <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"ydphone_fee"</span><span class="token punctuation">,</span>            <span class="token string">"state_topic"</span><span class="token operator">:</span> <span class="token string">"~/state"</span><span class="token punctuation">,</span>            <span class="token string">"unique_id"</span><span class="token operator">:</span> <span class="token string">"ydphone_fee"</span><span class="token punctuation">,</span>            <span class="token string">"icon"</span><span class="token operator">:</span> <span class="token string">"mdi:cellphone"</span><span class="token punctuation">,</span>            <span class="token string">"json_attributes_topic"</span><span class="token operator">:</span> <span class="token string">"~/info"</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token string">"topic"</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/state</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>        <span class="token string">"payload"</span><span class="token operator">:</span> dxphone_fee<span class="token punctuation">.</span>totalMoney    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token string">"topic"</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/info</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>        <span class="token string">"payload"</span><span class="token operator">:</span> dxphone_fee    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token keyword">return</span> <span class="token punctuation">[</span>msg_config<span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-成果展示"><a href="#2-成果展示" class="headerlink" title="2.成果展示"></a>2.成果展示</h3><hr><p>最后两个余额都能获取到了，看到这个，你就知道话费每天都花了多少。<br><img src="https://freefitter.synology.me:9012/blog/20240924225036.png" alt="电信余额"></p><p><img src="https://freefitter.synology.me:9012/blog/20240924225049.png" alt="移动余额"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;现在的查询手机余额的方式多种多样，余额不足时也会发短信息提醒你，但是有时候就是想看看手机余额，如果只有一个运营商还好，多了的话可能查起来就比较繁琐了，所以就想把余额给监控起来，并且集成到Home Assistant中。&lt;/p&gt;
&lt;/blockquo</summary>
      
    
    
    
    <category term="智能家居" scheme="https://www.wangxingyang.com/categories/%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85/"/>
    
    
    <category term="捷径" scheme="https://www.wangxingyang.com/tags/%E6%8D%B7%E5%BE%84/"/>
    
    <category term="Home Assistant" scheme="https://www.wangxingyang.com/tags/Home-Assistant/"/>
    
    <category term="话费" scheme="https://www.wangxingyang.com/tags/%E8%AF%9D%E8%B4%B9/"/>
    
  </entry>
  
</feed>
