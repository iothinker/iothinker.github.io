<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>宁静致远</title>
  
  <subtitle>静心整理/分享生活</subtitle>
  <link href="https://www.wangxingyang.com/atom.xml" rel="self"/>
  
  <link href="https://www.wangxingyang.com/"/>
  <updated>2022-04-07T02:16:34.316Z</updated>
  <id>https://www.wangxingyang.com/</id>
  
  <author>
    <name>彤爸比</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>假日分享</title>
    <link href="https://www.wangxingyang.com/dayshare220404.html"/>
    <image>https://www.wangxingyang.com/img/20220404/cover.jpg</image>
    <notify>true</notify>
    <id>https://www.wangxingyang.com/dayshare220404.html</id>
    <published>2022-04-05T01:14:34.000Z</published>
    <updated>2022-04-07T02:16:34.316Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>3天的小假期，天天在家闷坏了，南京的疫情也好转了，所以准备带彤宝出去玩玩。彤彤说要出去搭帐篷，要去挖沙子。不知道能完成几个呢。</p></blockquote><h3 id="0-开车出去玩"><a href="#0-开车出去玩" class="headerlink" title="0.开车出去玩"></a>0.开车出去玩</h3><hr><p>今天开车准备去<strong>不老村</strong>玩，但是早上起的有点晚，搭帐篷估计是玩不起来了，所以就准备去那边看看，挖挖沙子。等到了之后发现，不老村闭园，不得不转战别的地方。去了附近的兰溪公园挖沙子去。下面咱们一起去看看吧。</p><p><img src="/img/20220404/0.jpg" alt="不老村闭园"></p><p>闭园了人也不少，准备掉头去兰溪公园</p><p><img src="/img/20220404/1.jpg" alt="比✌️"></p><p><img src="/img/20220404/2.jpg" alt="比✌️"></p><p><img src="/img/20220404/3.jpg" alt="抓拍"></p><p><img src="/img/20220404/4.jpg" alt="开始挖沙子"></p><p><img src="/img/20220404/5.jpg" alt="挖沙子中"></p><p><img src="/img/20220404/%C3%9F%C3%9F6.jpg" alt="挖沙子中"></p><p>沙子挖完了，就回家做披萨了，</p><p><img src="/img/20220404/11.jpg" alt="开始烤披萨🍕"></p><h3 id="1-约上小伙伴"><a href="#1-约上小伙伴" class="headerlink" title="1.约上小伙伴"></a>1.约上小伙伴</h3><hr><p>福宝又回到这边来住了，所以就约着出去一起骑滑板车，正好她买的玩具小猪也到了，迫不及待的想要玩。下面看看照片吧。</p><p><img src="/img/20220404/7.jpg" alt="准备比赛"></p><p><img src="/img/20220404/8.jpg" alt="比赛开始"></p><p><img src="/img/20220404/71.jpg" alt="牵着小猪"></p><p><img src="/img/20220404/9.jpg" alt="趴在她妈背上"></p><p><img src="/img/20220404/12.jpg" alt="扎了小辫子"></p><p><img src="/img/20220404/13.jpg" alt="扎小辫"></p><p>晚上回去做了个千层蛋糕，看起来还不错。</p><p><img src="/img/20220404/10.jpeg" alt="千层蛋糕"></p><h3 id="2-写在最后"><a href="#2-写在最后" class="headerlink" title="2.写在最后"></a>2.写在最后</h3><hr><p>彤彤真的在一天天长大，突然发现自己并不是那么的好，脾气还是得收敛收敛，好好的和她一起成长。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;3天的小假期，天天在家闷坏了，南京的疫情也好转了，所以准备带彤宝出去玩玩。彤彤说要出去搭帐篷，要去挖沙子。不知道能完成几个呢。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-开车出去玩&quot;&gt;&lt;a href=&quot;#0-开车出去玩&quot; class=</summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="遛娃" scheme="https://www.wangxingyang.com/tags/%E9%81%9B%E5%A8%83/"/>
    
    <category term="美食" scheme="https://www.wangxingyang.com/tags/%E7%BE%8E%E9%A3%9F/"/>
    
  </entry>
  
  <entry>
    <title>博客发文通知</title>
    <link href="https://www.wangxingyang.com/qywechat.html"/>
    <image>https://www.wangxingyang.com/img/20220401/cover.jpg</image>
    <notify>true</notify>
    <id>https://www.wangxingyang.com/qywechat.html</id>
    <published>2022-04-01T07:02:19.000Z</published>
    <updated>2022-04-01T07:44:51.698Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>之前更新关于彤宝的博客会分享给老婆，但是每次手动分享有点麻烦，所以就有了这篇文章了。</p></blockquote><h3 id="0-前期准备"><a href="#0-前期准备" class="headerlink" title="0.前期准备"></a>0.前期准备</h3><hr><ol start="0"><li>首先博客开启<strong>RSS</strong>，这个网上有很多的教程，这边就不多赘述了，放个<a href="https/img/20220401//segmentfault.com/a/1190000012647294">为hexo博客添加RSS订阅功能</a>的链接。</li><li>编写<strong>企业微信通知</strong>简单的程序，这个后面说</li><li>需要编写一个<strong>Node-RED</strong>流</li></ol><h3 id="1-开始折腾"><a href="#1-开始折腾" class="headerlink" title="1.开始折腾"></a>1.开始折腾</h3><hr><p>增加了订阅功能之后，就能够通过他来获得博客网站以及文章的信息，内容如下图所示<br><img src="/img/20220401/9ba2d8477659519542ef5aa9b9120e09.jpg" alt="RSS"><br>不过 <strong>image</strong> 这个字段是后面自己加上的，因为推送的时候想把封面也推送过去。修改的地方如下：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 先到刚刚安装的那个插件目录下cd blog/node_modules/hexo-generator-feed# 编辑 atom.xmlvi atom.xml <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>在图示位置，添加如下内容：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span><span class="token punctuation">&gt;</span></span>{{ post.img | formatUrl}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/img/20220401/6970f3b3454623b0dd7fb084c7a34340.jpg" alt="添加封面图"><br>【⚠️注意】在文章的头上需要有<code>img</code>这个字段，如果你的封面是别的字段，注意更换。<br><img src="/img/20220401/da90a186843db9639554cbd91c7aa88f.jpg" alt="文章中标签"><br>到目前为止，数据已经齐活了。下面整企业微信通知的代码。这边是使用的<code>Python</code><br>代码写的比较简单，按照企业微信的逻辑来即可。这边是<a href="https/img/20220401//developer.work.weixin.qq.com/document/path/90236">官方API地址</a>照着来就行。</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> json<span class="token keyword">import</span> requests<span class="token keyword">from</span> bottle <span class="token keyword">import</span> route<span class="token punctuation">,</span> run<span class="token punctuation">,</span> request<span class="token keyword">import</span> configparser<span class="token keyword">from</span> requests <span class="token keyword">import</span> RequestException<span class="token punctuation">,</span> ReadTimeoutcfg <span class="token operator">=</span> configparser<span class="token punctuation">.</span>ConfigParser<span class="token punctuation">(</span><span class="token punctuation">)</span>cfg<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'qy.ini'</span><span class="token punctuation">)</span>TOKEN_API <span class="token operator">=</span> <span class="token string">"https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=%s&amp;corpsecret=%s"</span>SEND_API <span class="token operator">=</span> <span class="token string">"https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=%s"</span><span class="token keyword">global</span> access_tokenaccess_token <span class="token operator">=</span> cfg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'QYParam'</span><span class="token punctuation">,</span> <span class="token string">'access_token'</span><span class="token punctuation">)</span>agentid <span class="token operator">=</span> cfg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'QYParam'</span><span class="token punctuation">,</span> <span class="token string">'agentid'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@route</span><span class="token punctuation">(</span><span class="token string">'/getToken'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 获得企业信息</span>    <span class="token comment"># print("getToken start")</span>    corpid <span class="token operator">=</span> cfg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'QYParam'</span><span class="token punctuation">,</span> <span class="token string">'corpid'</span><span class="token punctuation">)</span>    corpsecret <span class="token operator">=</span> cfg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'QYParam'</span><span class="token punctuation">,</span> <span class="token string">'corpsecret'</span><span class="token punctuation">)</span>    url <span class="token operator">=</span> TOKEN_API <span class="token operator">%</span> <span class="token punctuation">(</span>corpid<span class="token punctuation">,</span> corpsecret<span class="token punctuation">)</span>    <span class="token comment"># print("url=" + str(url))</span>    ret <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span>    errcode <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>ret<span class="token punctuation">[</span><span class="token string">"errcode"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> errcode <span class="token operator">==</span> <span class="token string">"0"</span><span class="token punctuation">:</span>        <span class="token keyword">global</span> access_token        access_token <span class="token operator">=</span> ret<span class="token punctuation">[</span><span class="token string">"access_token"</span><span class="token punctuation">]</span>        cfg<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">"QYParam"</span><span class="token punctuation">,</span> <span class="token string">"access_token"</span><span class="token punctuation">,</span> ret<span class="token punctuation">[</span><span class="token string">"access_token"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        cfg<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'qy.ini'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> ret<span class="token decorator annotation punctuation">@route</span><span class="token punctuation">(</span><span class="token string">'/sendMsg'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">sendmsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> SEND_API <span class="token operator">%</span> access_token    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"sendmsg url="</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token string">"touser"</span><span class="token punctuation">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span>        <span class="token string">"msgtype"</span><span class="token punctuation">:</span> <span class="token string">"textcard"</span><span class="token punctuation">,</span>        <span class="token string">"agentid"</span><span class="token punctuation">:</span> agentid<span class="token punctuation">,</span>        <span class="token string">"textcard"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>            <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"博客通知"</span><span class="token punctuation">,</span>            <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"&lt;div class=\"gray\"&gt;2016年9月26日&lt;/div&gt; &lt;div class=\"normal\"&gt;恭喜你抽中iPhone 7一台，领奖码：xxxx&lt;/div&gt;&lt;div class=\"highlight\"&gt;请于2016年10月10日前联系行政同事领取&lt;/div&gt;"</span><span class="token punctuation">,</span>            <span class="token string">"url"</span><span class="token punctuation">:</span> <span class="token string">"http://www.wangxingyang.com"</span><span class="token punctuation">,</span>            <span class="token string">"btntxt"</span><span class="token punctuation">:</span> <span class="token string">"更多"</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token string">"safe"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token string">"enable_id_trans"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token string">"enable_duplicate_check"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token string">"duplicate_check_interval"</span><span class="token punctuation">:</span> <span class="token number">1800</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>    <span class="token keyword">except</span> ReadTimeout<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Connection timeout...."</span>    <span class="token keyword">except</span> ConnectionError<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Connection Error...."</span>    <span class="token keyword">except</span> RequestException<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Unknown Error"</span>    ret <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    errcode <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>ret<span class="token punctuation">[</span><span class="token string">"errcode"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> errcode <span class="token operator">==</span> <span class="token string">"42001"</span><span class="token punctuation">:</span>        <span class="token comment"># 重新获得Token</span>        getToken<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 重新发送</span>        sendmsg<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> response<span class="token punctuation">.</span>text<span class="token decorator annotation punctuation">@route</span><span class="token punctuation">(</span><span class="token string">'/sendNewsMsg'</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'POST'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">sendNewsMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> SEND_API <span class="token operator">%</span> access_token    <span class="token comment"># print("sendmsg url=" + str(url))</span>    title <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"latin1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>    link <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"latin1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>    img <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"latin1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>    summary <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'summary'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"latin1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>    data <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{</span>       <span class="token string">"touser"</span><span class="token punctuation">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span>       <span class="token string">"msgtype"</span><span class="token punctuation">:</span> <span class="token string">"news"</span><span class="token punctuation">,</span>       <span class="token string">"agentid"</span><span class="token punctuation">:</span> agentid<span class="token punctuation">,</span>       <span class="token string">"news"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>           <span class="token string">"articles"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>               <span class="token punctuation">{</span>                   <span class="token string">"title"</span><span class="token punctuation">:</span> title<span class="token punctuation">,</span>                   <span class="token string">"description"</span><span class="token punctuation">:</span> summary<span class="token punctuation">,</span>                   <span class="token string">"url"</span><span class="token punctuation">:</span> link<span class="token punctuation">,</span>                   <span class="token string">"picurl"</span><span class="token punctuation">:</span> img<span class="token punctuation">,</span>               <span class="token punctuation">}</span>           <span class="token punctuation">]</span>       <span class="token punctuation">}</span><span class="token punctuation">,</span>       <span class="token string">"enable_id_trans"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>       <span class="token string">"enable_duplicate_check"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>       <span class="token string">"duplicate_check_interval"</span><span class="token punctuation">:</span> <span class="token number">1800</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>    <span class="token keyword">except</span> ReadTimeout<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Connection timeout...."</span>    <span class="token keyword">except</span> ConnectionError<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Connection Error...."</span>    <span class="token keyword">except</span> RequestException<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Unknown Error"</span>    ret <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    errcode <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>ret<span class="token punctuation">[</span><span class="token string">"errcode"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> errcode <span class="token operator">==</span> <span class="token string">"42001"</span><span class="token punctuation">:</span>        <span class="token comment"># 重新获得Token</span>        getToken<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># 重新发送</span>        sendmsg<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> response<span class="token punctuation">.</span>textrun<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个代码我放到树莓派上了，接着就是通过<code>Node-RED</code>来调这个接口。当然你也可以直接用<code>Node-RED</code>来实现，我比较喜欢封装下，不然流得搞的老长。<br>最后看看<strong>Node-RED</strong>流<br><img src="/img/20220401/6e2a064bf94f8d88e2927257a7b5afdc.jpg" alt="流"><br>没啥特别的就不贴代码了。</p><p>最后效果如下图：<br><img src="/img/20220401/37a597f192a1c1df381d8d34f31d0e0b.jpg" alt="效果图"></p><h3 id="2-写在最后"><a href="#2-写在最后" class="headerlink" title="2.写在最后"></a>2.写在最后</h3><hr><p>这个还可以扩展，比如加上在文章上加上推送开关，或者要推送的人，这样就可以实现个性化通知了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;之前更新关于彤宝的博客会分享给老婆，但是每次手动分享有点麻烦，所以就有了这篇文章了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-前期准备&quot;&gt;&lt;a href=&quot;#0-前期准备&quot; class=&quot;headerlink&quot; title=&quot;0.前</summary>
      
    
    
    
    <category term="教程" scheme="https://www.wangxingyang.com/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="企业微信通知" scheme="https://www.wangxingyang.com/tags/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E9%80%9A%E7%9F%A5/"/>
    
    <category term="RSS" scheme="https://www.wangxingyang.com/tags/RSS/"/>
    
    <category term="Node_RED" scheme="https://www.wangxingyang.com/tags/Node-RED/"/>
    
  </entry>
  
  <entry>
    <title>周末分享</title>
    <link href="https://www.wangxingyang.com/dayshare220327.html"/>
    <image>https://www.wangxingyang.com/img/20220327/cover.jpeg</image>
    <notify>true</notify>
    <id>https://www.wangxingyang.com/dayshare220327.html</id>
    <published>2022-03-27T13:27:16.000Z</published>
    <updated>2022-04-01T07:00:41.489Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>南京疫情，居家办公一周了，周末在家就搞点事情做做，所以准备做些西点吃吃。</p></blockquote><h3 id="0-第一天"><a href="#0-第一天" class="headerlink" title="0.第一天"></a>0.第一天</h3><hr><p>白天没啥事情，就陪她玩玩，下去跑跑，晚上回来开始做纸杯蛋糕，步骤咱就不啰嗦了，晚上都有，这边交作业。看看结果如何吧。</p><p><img src="/img/20220327/1.jpg" alt="吃蛋糕🧁"></p><p><img src="/img/20220327/2.jpg" alt="吃蛋糕🧁"><br><img src="/img/20220327/3.jpg" alt="吃蛋糕🧁"></p><p><img src="/img/20220327/4.jpg" alt="新鲜出炉的🧁"></p><h3 id="1-第二天"><a href="#1-第二天" class="headerlink" title="1.第二天"></a>1.第二天</h3><hr><p>晚上准备来个披萨，做的时候发现材料没准备齐全，所以就带她出去玩玩，顺便买个材料，下面看看彤宝玩滑草板吧。</p><p><img src="/img/20220327/5.jpg" alt="坐在滑草板上"></p><p><img src="/img/20220327/6.jpg" alt="开滑"></p><p><img src="/img/20220327/7.jpg" alt="“头疼”的造型"></p><p><img src="/img/20220327/8.jpg" alt="👌造型"></p><p><img src="/img/20220327/9.jpg" alt="合照"></p><p><img src="/img/20220327/10.jpg" alt="哈哈又是一个OK"></p><p>下面看看披萨🍕的照片</p><p><img src="/img/20220327/11.jpeg" alt="烹饪中"></p><p><img src="/img/20220327/12.jpeg" alt="出锅的🍕"></p><h3 id="2-总结"><a href="#2-总结" class="headerlink" title="2.总结"></a>2.总结</h3><hr><p>周末自己动手做些之前没做过的东西还是很解压的。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;南京疫情，居家办公一周了，周末在家就搞点事情做做，所以准备做些西点吃吃。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;0-第一天&quot;&gt;&lt;a href=&quot;#0-第一天&quot; class=&quot;headerlink&quot; title=&quot;0.第一天&quot;&gt;&lt;/a&gt;</summary>
      
    
    
    
    <category term="生活" scheme="https://www.wangxingyang.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
    <category term="遛娃" scheme="https://www.wangxingyang.com/tags/%E9%81%9B%E5%A8%83/"/>
    
    <category term="纸杯蛋糕" scheme="https://www.wangxingyang.com/tags/%E7%BA%B8%E6%9D%AF%E8%9B%8B%E7%B3%95/"/>
    
    <category term="披萨" scheme="https://www.wangxingyang.com/tags/%E6%8A%AB%E8%90%A8/"/>
    
  </entry>
  
  <entry>
    <title>Twikoo评论通知</title>
    <link href="https://www.wangxingyang.com/twikooComment.html"/>
    <image>https://www.wangxingyang.com/img/20220323/cover.jpg</image>
    
    <id>https://www.wangxingyang.com/twikooComment.html</id>
    <published>2022-03-23T02:33:08.000Z</published>
    <updated>2022-03-23T06:44:53.663Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>博客上的评论系统是用的<a href="https://twikoo.js.org/">Twikoo</a>的，它是有评论邮件提醒功能的，我尝试了但是没有成功，所以就想用之前的自己搭的<code>Server酱</code>来实现新评论提醒功能。</p></blockquote><h3 id="0-抓包分析"><a href="#0-抓包分析" class="headerlink" title="0.抓包分析"></a>0.抓包分析</h3><hr><p>整个分析下来，主要的是请求的内容不一样，请求的URL地址都是一样的。<a href="https://tcb-api.tencentcloudapi.com/web?env=XXXXX">https://tcb-api.tencentcloudapi.com/web?env=XXXXX</a>，我是基于腾讯云函数搭建的，具体的教程之前的文章中也有写过，这边就不啰嗦了，这里主要用到两个函数。一个是刷新Token的，一个是获得评论的。内容如下：</p><pre class="line-numbers language-none"><code class="language-none">// 刷新Token{"action": "auth.fetchAccessTokenWithRefreshToken","dataVersion": "2020-01-10","env": "$env","refresh_token": "$refresh_token","seqId": "$seqId"}// 获得评论{"action": "functions.invokeFunction","dataVersion": "2020-01-10","env": "$env","function_name": "twikoo","request_data": "{\"event\":\"COMMENT_GET_FOR_ADMIN\",\"per\":5,\"page\":1}","access_token": "$access_token","seqId": "$seqId"};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这边有个小坑，就是用<code>Node-RED</code>的时候一直报如下的错误：</p><pre class="line-numbers language-none"><code class="language-none">{"code": "INVALID_APP_SIGN","message": "jwt must be provided","requestId": "bf131bb336c26"}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我用<code>PostMan</code>和<code>ApiPost</code>发送请求都能够成功，但是一到<code>Node-RED</code>上就报错，百思不解，最后把头全部搞过去，一个个排除，最后发现是头要加上<strong>origin</strong>这个头才行。加上这个之后，报错就变成了：</p><pre class="line-numbers language-none"><code class="language-none">{"code": "ACCESS_TOKEN_EXPIRED","message": "Access_token expired","requestId": "0e3de4a761649"}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个错误很明显了，Token过期了，所以只要刷新下Token一下就行了。</p><h3 id="1-开始写流"><a href="#1-开始写流" class="headerlink" title="1.开始写流"></a>1.开始写流</h3><hr><p>有了上面的铺垫，写起来就很简单了，有两种做法，一种是上来直接调用刷新<strong>token</strong>然后再调用获取评论，还有一种做法是先用缓存的<strong>token</strong>请求调用获取评论，如果返回<strong>token</strong>过期，则再刷新<strong>token</strong>再去请求。这边图省事就直接用第一种。<br><img src="/img/20220323/9f5f2aa893c74903a022079aa9b628a7.jpg" alt="Node-RED流"><br>JSON信息如下：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"4b5ebb669cd0e232"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"comment"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"网站评论数更新通知"</span><span class="token punctuation">,</span>        <span class="token property">"info"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">90</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"2eb6253b6231925f"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"inject"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"props"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"repeat"</span><span class="token operator">:</span> <span class="token string">"3600"</span><span class="token punctuation">,</span>        <span class="token property">"crontab"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"once"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"onceDelay"</span><span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>        <span class="token property">"topic"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">70</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"de4ca953468e4720"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"de4ca953468e4720"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"function"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"刷新token"</span><span class="token punctuation">,</span>        <span class="token property">"func"</span><span class="token operator">:</span> <span class="token string">"var headers = {\n    \"content-type\": \"application/json;charset=UTF-8\",\n    \"origin\": \"https://www.wangxingyang.com\"\n};\n\nvar data = {\"action\":\"auth.fetchAccessTokenWithRefreshToken\",\"dataVersion\":\"2020-01-10\",\"env\":\"EEEEEE\",\"refresh_token\":\"EEEEE\",\"seqId\":\"437ef9ewde67\"};\n\nmsg.headers = headers;\n\nmsg.payload = JSON.stringify(data);\nreturn msg;"</span><span class="token punctuation">,</span>        <span class="token property">"outputs"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"noerr"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"initialize"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"finalize"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"libs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"439f033b91296d4d"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"439f033b91296d4d"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"http request"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"method"</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>        <span class="token property">"ret"</span><span class="token operator">:</span> <span class="token string">"obj"</span><span class="token punctuation">,</span>        <span class="token property">"paytoqs"</span><span class="token operator">:</span> <span class="token string">"ignore"</span><span class="token punctuation">,</span>        <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://tcb-api.tencentcloudapi.com/web?env=EEEEE"</span><span class="token punctuation">,</span>        <span class="token property">"tls"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"persist"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"proxy"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"authType"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"senderr"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">340</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"1093b292b44df7cf"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"1093b292b44df7cf"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"function"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"请求获取评论"</span><span class="token punctuation">,</span>        <span class="token property">"func"</span><span class="token operator">:</span> <span class="token string">"var headers = {\n    \"content-type\": \"application/json;charset=UTF-8\",\n    \"origin\": \"https://www.wangxingyang.com\"\n};\n\nvar data = {\n\t\"action\": \"functions.invokeFunction\",\n\t\"dataVersion\": \"2020-01-10\",\n\t\"env\": \"EEEEE\",\n\t\"function_name\": \"twikoo\",\n\t\"request_data\": \"{\\\"event\\\":\\\"COMMENT_GET_FOR_ADMIN\\\",\\\"per\\\":5,\\\"page\\\":1}\",\n\t\"access_token\": msg.payload.access_token,\n\t\"seqId\": \"c854eedewsc6\"\n};\n\nmsg.headers = headers;\n\nmsg.payload = JSON.stringify(data);\nreturn msg;"</span><span class="token punctuation">,</span>        <span class="token property">"outputs"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"noerr"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"initialize"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"finalize"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"libs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"f7ce907edcd55bcb"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"f7ce907edcd55bcb"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"http request"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"method"</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>        <span class="token property">"ret"</span><span class="token operator">:</span> <span class="token string">"obj"</span><span class="token punctuation">,</span>        <span class="token property">"paytoqs"</span><span class="token operator">:</span> <span class="token string">"ignore"</span><span class="token punctuation">,</span>        <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://tcb-api.tencentcloudapi.com/web?env=EEEEEE"</span><span class="token punctuation">,</span>        <span class="token property">"tls"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"persist"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"proxy"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"authType"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"senderr"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">660</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"9898c4f905717a13"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"9898c4f905717a13"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"json"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"property"</span><span class="token operator">:</span> <span class="token string">"payload.data.response_data"</span><span class="token punctuation">,</span>        <span class="token property">"action"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"pretty"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">790</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"7c1a5eb76c9ab46a"</span><span class="token punctuation">,</span>                <span class="token string">"d64dd8d502b22cff"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"7c1a5eb76c9ab46a"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"rbe"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"func"</span><span class="token operator">:</span> <span class="token string">"rbei"</span><span class="token punctuation">,</span>        <span class="token property">"gap"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"inout"</span><span class="token operator">:</span> <span class="token string">"out"</span><span class="token punctuation">,</span>        <span class="token property">"septopics"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"property"</span><span class="token operator">:</span> <span class="token string">"payload.data.response_data.count"</span><span class="token punctuation">,</span>        <span class="token property">"topi"</span><span class="token operator">:</span> <span class="token string">"topic"</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">910</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"9119b6c2921a0102"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"d48e19601ad7ae9f"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"http request"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"发送通知"</span><span class="token punctuation">,</span>        <span class="token property">"method"</span><span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>        <span class="token property">"ret"</span><span class="token operator">:</span> <span class="token string">"txt"</span><span class="token punctuation">,</span>        <span class="token property">"paytoqs"</span><span class="token operator">:</span> <span class="token string">"ignore"</span><span class="token punctuation">,</span>        <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://EEEEEEE.tencentcs.com/release/wecomchan?sendkey=EEEEE&amp;msg_type=text&amp;msg={{msgText}}&amp;to_user=EEEEE"</span><span class="token punctuation">,</span>        <span class="token property">"tls"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"persist"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"proxy"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"authType"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"senderr"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">1220</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"9119b6c2921a0102"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"function"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"评论变动赋值"</span><span class="token punctuation">,</span>        <span class="token property">"func"</span><span class="token operator">:</span> <span class="token string">"let nick = msg.payload.data.response_data.data[0].nick;\nlet url = msg.payload.data.response_data.data[0].link;\nlet commentText = msg.payload.data.response_data.data[0].commentText;\n\nmsg.msgText = \"📢|[\" + nick + \"] 在博客中评论道: [ \" + commentText + \" ];\"\nreturn msg;"</span><span class="token punctuation">,</span>        <span class="token property">"outputs"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token property">"noerr"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token property">"initialize"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"finalize"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"libs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">1060</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1320</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">[</span>                <span class="token string">"d48e19601ad7ae9f"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span>        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"d64dd8d502b22cff"</span><span class="token punctuation">,</span>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"debug"</span><span class="token punctuation">,</span>        <span class="token property">"z"</span><span class="token operator">:</span> <span class="token string">"0217ee1fba23525d"</span><span class="token punctuation">,</span>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"active"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"tosidebar"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"console"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token property">"tostatus"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token property">"complete"</span><span class="token operator">:</span> <span class="token string">"true"</span><span class="token punctuation">,</span>        <span class="token property">"targetType"</span><span class="token operator">:</span> <span class="token string">"full"</span><span class="token punctuation">,</span>        <span class="token property">"statusVal"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>        <span class="token property">"statusType"</span><span class="token operator">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span>        <span class="token property">"x"</span><span class="token operator">:</span> <span class="token number">910</span><span class="token punctuation">,</span>        <span class="token property">"y"</span><span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span>        <span class="token property">"wires"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">}</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后的通知结果如下：<br><img src="/img/20220323/962596d93e1a411a9a2aacd25fa491de.jpg" alt="通知结果"><br>这样就搞定了。因为没有什么实时性要求，所以这边是每个小时获取一次。如果获取时间间隔比较短，建议把Token缓存起来。</p><h3 id="2-写在最后"><a href="#2-写在最后" class="headerlink" title="2.写在最后"></a>2.写在最后</h3><hr><p>很多时候想做一些事情，但是如果你没有沉下心来做，很多时候你只会停留在想象的阶段，所以做事还是得动手。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;博客上的评论系统是用的&lt;a href=&quot;https://twikoo.js.org/&quot;&gt;Twikoo&lt;/a&gt;的，它是有评论邮件提醒功能的，我尝试了但是没有成功，所以就想用之前的自己搭的&lt;code&gt;Server酱&lt;/code&gt;来实现新评论提醒功能。&lt;</summary>
      
    
    
    
    
    <category term="Node-RED" scheme="https://www.wangxingyang.com/tags/Node-RED/"/>
    
    <category term="Twikoo" scheme="https://www.wangxingyang.com/tags/Twikoo/"/>
    
    <category term="评论" scheme="https://www.wangxingyang.com/tags/%E8%AF%84%E8%AE%BA/"/>
    
  </entry>
  
  <entry>
    <title>Homebridge和Node-RED组合</title>
    <link href="https://www.wangxingyang.com/node-red.html"/>
    <image>https://www.wangxingyang.com/img/20220317/cover.jpg</image>
    
    <id>https://www.wangxingyang.com/node-red.html</id>
    <published>2022-03-17T00:43:12.000Z</published>
    <updated>2022-03-17T07:07:14.254Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近有开始折腾了，树莓派又整出来了。之前系统总是崩，所以这次给他刷原生的系统。准备把路由器上的<code>Node-RED</code>和<code>Homebridge</code>给迁移到这个上面。虽然之前运行的狠稳定，但是树莓派总吃灰也不好。</p></blockquote><h3 id="0-树莓派散热"><a href="#0-树莓派散热" class="headerlink" title="0.树莓派散热"></a>0.树莓派散热</h3><hr><p>树莓派之前壳子上的风扇坏了，转起来的声音贼大，所以考虑给他换一个风扇，这不网上买了一个，回来装上后，效果非常不错，温度基本稳定在<code>50度</code>以下，而且非常的静音。这个风扇是PWN调速的，照着设置了下。</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"># 修改/boot/config.txt 增加如下内容dtoverlay=gpio-fan,gpiopin=18,temp=55000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>下图是我买的风扇。做工不错，值得推荐<br><img src="/img/20220317/ad32742fe75ea4827e8ca54ef6dcf4ae.jpg" alt="PWN风扇"></p><h3 id="1-家庭中枢自动充电"><a href="#1-家庭中枢自动充电" class="headerlink" title="1.家庭中枢自动充电"></a>1.家庭中枢自动充电</h3><hr><p>之前路由器重启了下，<code>Homebridge</code>的相关配置就没了，这就更加坚定了迁移到树莓派上的决心。所以就三下五除二整了起来，整好之后想在外面控制的话就得有<code>家庭中枢</code>之前的<strong>iPad mini</strong>就派上用场了，用了一段时间，遇到了一个问题，就是这个<strong>iPad</strong>平时不会用，所以就不会充电，用一段时间后，电池没电了，导致在外面就控制不了家中的设备了。所以就开始找解决方案了。最后终于给我整到了，下面就和大家分享一下我的整的流程吧。</p><h4 id="0-Homebridge安装"><a href="#0-Homebridge安装" class="headerlink" title="0.Homebridge安装"></a>0.Homebridge安装</h4><p>这个过程就不多说了，网上都有的，所以咱就不整了参看<a href="https://sspai.com/post/59636#!">HomeBridge 操作指南：从零开始，将你的米家设备接入 Homekit</a>这个文章吧。</p><h4 id="1-安装Node-RED"><a href="#1-安装Node-RED" class="headerlink" title="1.安装Node-RED"></a>1.安装Node-RED</h4><p>这边也不说了，放个官网的连接<a href="https://nodered.org/docs/getting-started/raspberrypi">Running on Raspberry Pi</a>，参看这个就安装<code>Node-RED</code>。下面就开始整了</p><h4 id="2-流程简介"><a href="#2-流程简介" class="headerlink" title="2.流程简介"></a>2.流程简介</h4><p>首先得能获得<strong>iPad</strong>的当前的状态，在GitHub上找了下，找到了这个<code>node-red-contrib-apple-find-me</code>插件，通过他就能获得我们所有设备的状态。里面的信息很多，其他的都不要，要当前手机的电量和是否在充电的状态就行。这个结果也被我推到路由器的上面。这个后面用来做<strong>Homebridge</strong>的插件。搞完之后的流程是这样的。</p><p><img src="/img/20220317/19d22e3dc625bc9bd1038b1b703505da.jpg" alt="流"></p><p>流程是通过<code>Apple Find Me</code>拿到相关状态，然后经过逻辑判断，发送报文到<strong>MQTT</strong>的<code>plugswitch</code>这个主题上。在路由器上写了一个订阅这个主题的程序，接收到后，通过<code>python-miio</code>来控制开关的状态，当然这一步你可以直接安装<strong>miio</strong>插件完成也是可以的。到此就完成了家庭中枢的自动充电了。</p><h3 id="2-Homebridge的周边"><a href="#2-Homebridge的周边" class="headerlink" title="2.Homebridge的周边"></a>2.Homebridge的周边</h3><hr><h4 id="0-电池状态显示"><a href="#0-电池状态显示" class="headerlink" title="0.电池状态显示"></a>0.电池状态显示</h4><p>上面推到路由器上的数据写了一个获得当前状态的插件。<br><img src="/img/20220317/3c8b4717928cb4e10032eb6bf2e4c818.jpg" alt="插件展示"><br>目录结构是这样的：</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">homebridge-appledevice/├── index.js└── package.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>下面的是代码：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span class="token punctuation">;</span><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> inherits <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>inherits<span class="token punctuation">;</span><span class="token keyword">const</span> version <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>version<span class="token punctuation">;</span><span class="token keyword">let</span> Service<span class="token punctuation">;</span><span class="token keyword">let</span> Characteristic<span class="token punctuation">;</span><span class="token keyword">let</span> logger<span class="token punctuation">;</span><span class="token keyword">let</span> <span class="token constant">API</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">homebridge</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token constant">API</span><span class="token operator">=</span>homebridge<span class="token punctuation">;</span>Service <span class="token operator">=</span> homebridge<span class="token punctuation">.</span>hap<span class="token punctuation">.</span>Service<span class="token punctuation">;</span>Characteristic <span class="token operator">=</span> homebridge<span class="token punctuation">.</span>hap<span class="token punctuation">.</span>Characteristic<span class="token punctuation">;</span>homebridge<span class="token punctuation">.</span><span class="token function">registerAccessory</span><span class="token punctuation">(</span><span class="token string">'homebridge-appledevice'</span><span class="token punctuation">,</span> <span class="token string">'AppleDevice'</span><span class="token punctuation">,</span> AppleDevice<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">AppleDevice</span><span class="token punctuation">(</span><span class="token parameter">log<span class="token punctuation">,</span> config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>logger <span class="token operator">=</span> log<span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>services <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> config<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">'iPad'</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> config<span class="token punctuation">.</span>num <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>interval<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">360000</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>statusLowBattery <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>batteryLevel <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>chargingState <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token class-name">AppleDevice</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token function-variable function">updateStatus</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://192.168.xxx.xxx/_api/home'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">resp</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>            resp<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                data <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        resp<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>                <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">let</span> devices <span class="token operator">=</span> ret<span class="token punctuation">.</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>home_devices<span class="token punctuation">;</span>                <span class="token keyword">let</span> devList <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>devices<span class="token punctuation">)</span><span class="token punctuation">;</span>                that<span class="token punctuation">.</span>batteryLevel <span class="token operator">=</span> devList<span class="token punctuation">[</span>that<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">[</span>that<span class="token punctuation">.</span>num<span class="token punctuation">]</span><span class="token punctuation">.</span>batteryLevel<span class="token punctuation">;</span>                that<span class="token punctuation">.</span>displayName <span class="token operator">=</span> devList<span class="token punctuation">[</span>that<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">[</span>that<span class="token punctuation">.</span>num<span class="token punctuation">]</span><span class="token punctuation">.</span>displayName<span class="token punctuation">;</span>                <span class="token keyword">let</span> status <span class="token operator">=</span> devList<span class="token punctuation">[</span>that<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">[</span>that<span class="token punctuation">.</span>num<span class="token punctuation">]</span><span class="token punctuation">.</span>batteryState<span class="token punctuation">;</span>                <span class="token comment">//console.log("batteryLevel: " + that.batteryLevel);</span>                <span class="token comment">//console.log("status: " + status);</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"NotCharging"</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    that<span class="token punctuation">.</span>batteryService<span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>ChargingState<span class="token punctuation">,</span> Characteristic<span class="token punctuation">.</span>ChargingState<span class="token punctuation">.</span><span class="token constant">NOT_CHARGING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    that<span class="token punctuation">.</span>batteryService<span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>ChargingState<span class="token punctuation">,</span> Characteristic<span class="token punctuation">.</span>ChargingState<span class="token punctuation">.</span><span class="token constant">CHARGING</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                                <span class="token keyword">if</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>batteryLevel <span class="token operator">&lt;=</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    that<span class="token punctuation">.</span>batteryService<span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>StatusLowBattery<span class="token punctuation">,</span> Characteristic<span class="token punctuation">.</span>StatusLowBattery<span class="token punctuation">.</span><span class="token constant">BATTERY_LEVEL_LOW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    that<span class="token punctuation">.</span>batteryService<span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>StatusLowBattery<span class="token punctuation">,</span> Characteristic<span class="token punctuation">.</span>StatusLowBattery<span class="token punctuation">.</span><span class="token constant">BATTERY_LEVEL_NORMAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                                that<span class="token punctuation">.</span>batteryService<span class="token punctuation">.</span><span class="token function">getCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>BatteryLevel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateValue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>batteryLevel<span class="token punctuation">)</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Error: "</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function-variable function">identify</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function-variable function">getServices</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>serviceInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Service<span class="token punctuation">.</span>AccessoryInformation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>serviceInfo        <span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>Manufacturer<span class="token punctuation">,</span> <span class="token string">'Apple'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>Model<span class="token punctuation">,</span> <span class="token string">"Battery"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>SerialNumber<span class="token punctuation">,</span> <span class="token string">"1353234"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">setCharacteristic</span><span class="token punctuation">(</span>Characteristic<span class="token punctuation">.</span>FirmwareRevision<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>batteryService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Service<span class="token punctuation">.</span>BatteryService</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>serviceInfo <span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>batteryService<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-Scriptable插件"><a href="#1-Scriptable插件" class="headerlink" title="1.Scriptable插件"></a>1.Scriptable插件</h4><p>这个插件是真的好看，不过一开始遇到一个坑，上面的图标不能下载下来，一直报错，最后自己下载下来放进去就可以的。<br><img src="/img/20220317/da07027bd952f37b952cf653fe6926bb.jpg" alt="小组件"></p><h3 id="3-总结"><a href="#3-总结" class="headerlink" title="3.总结"></a>3.总结</h3><hr><p>后面在优化再整哈，学无止境。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;最近有开始折腾了，树莓派又整出来了。之前系统总是崩，所以这次给他刷原生的系统。准备把路由器上的&lt;code&gt;Node-RED&lt;/code&gt;和&lt;code&gt;Homebridge&lt;/code&gt;给迁移到这个上面。虽然之前运行的狠稳定，但是树莓派总吃灰也不好。</summary>
      
    
    
    
    <category term="智能家居" scheme="https://www.wangxingyang.com/categories/%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85/"/>
    
    
    <category term="Node-RED" scheme="https://www.wangxingyang.com/tags/Node-RED/"/>
    
    <category term="HomeBridge" scheme="https://www.wangxingyang.com/tags/HomeBridge/"/>
    
    <category term="树莓派" scheme="https://www.wangxingyang.com/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/"/>
    
  </entry>
  
</feed>
