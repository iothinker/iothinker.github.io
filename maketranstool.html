<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="交易制作工具, hexo,智能家居,生活记录,技术">
    <meta name="description" content="慢下来，整理一下工作生活的点滴">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>交易制作工具 | 宁静致远</title>
    <link rel="icon" type="image/png" href="/logo.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">宁静致远</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">宁静致远</div>
        <div class="logo-desc">
            
            慢下来，整理一下工作生活的点滴
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/img/20210407/tools.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">交易制作工具</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E5%B7%A5%E5%85%B7/">
                                <span class="chip bg-color">工具</span>
                            </a>
                        
                            <a href="/tags/vbs/">
                                <span class="chip bg-color">vbs</span>
                            </a>
                        
                            <a href="/tags/%E6%95%88%E7%8E%87/">
                                <span class="chip bg-color">效率</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%B7%A5%E5%85%B7/" class="post-category">
                                工具
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-04-07
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2021-04-07
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    7.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    36 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h3 id="0-工具简介"><a href="#0-工具简介" class="headerlink" title="0.工具简介"></a>0.工具简介</h3><hr>
<p>由于开发交易是固定繁琐的动作，所以想开发一款交易制作工具来达到提高生产力。有更多的时间去做更有意义的事情。工具定制性比较强，可能都不能用。但是可以共享其中的想法和思路。是18年写的，也运行了几年了，没出什么大问题，运行还算稳定。小工具采用VBS编码，比较轻便，能够在Windows平台下顺利运行，也不占用系统空间。这个小程序主要使用了 模拟POST请求，使用Sqlplus和数据库进行交互，xml文件解析和文件的读写操作以及移动。代码不是很复杂</p>
<h3 id="1-目录结构"><a href="#1-目录结构" class="headerlink" title="1.目录结构"></a>1.目录结构</h3><hr>
<p>|   MakeTrans.vbs     —&gt;  小工具的运行程序,双击即可运行<br>|<br>|   CheckIsValid.vbs  —&gt;  检查XML报文是否合法[要在文件都修改完成后检测]<br>|<br>+—Log                       —&gt;  日志输出文件夹<br>|       Run-[20180417092345].log        —&gt;   日志文件<br>|    Script.log            —&gt;   协议相关脚本<br>|<br>+—traninfo.txt      —&gt;  交易粘贴处<br>|<br>+—Metadata          —&gt;  元数据输出文件夹<br>|       3001300000333-metadata.zip      —&gt;   元数据文件<br>|       service       —&gt;  模板修改后的文件会出现在这个文件夹下<br>|<br>+—Template          —&gt;  模板文件夹<br>|       BIBPS.xml     —&gt;  会将拆组报文件中的Body内的内容替换模板中的 XXXXXXXXXXXXXXXXXXXX 内容<br>|<br>+—Tmp                                 —&gt;  临时文件夹[用于存储从SVN中拷贝过来的文件]<br>|       metadata.xml             —&gt;  修改的元数据文件<br>|       serviceIdentify.xml    —&gt;  修后的服务识别文件<br>|       systemIdentify.xml    —&gt;  修改后的系统识别<br>|<br>-–SQLScript                               —&gt;  工具中用到的SQL脚本文件夹[勿删勿改]<br>        CheckTran.sql                   —&gt;   检查交易是否为存量脚本<br>        GetInfo.sql                         —&gt;   获得下载Metadata的参数<br>        GetName.sql                     —&gt;   获得系统名对应的简称<br>        AddChannel.sql                —&gt;   添加新增渠道<br>        AddSystem.sql                  —&gt;   添加新增系统方<br>        GetCHName.sql                —&gt;   获得中文描述</p>
<h3 id="2-功能介绍"><a href="#2-功能介绍" class="headerlink" title="2.功能介绍"></a>2.功能介绍</h3><hr>
<p><strong>0、 更新SVN[需要安装svn命令行]<br>1、 登录服务治理平台下载脚本以及配置文件<br>2、 将下载好的脚本入库<br>3、 检查交易的类型[存量或者新增]<br>4、 将配置文件拷贝至本地SVN[根据交易类型进行拷贝]<br>5、 比对元数据并修改<br>6、 修改公共文件[服务识别，系统识别]<br>7、 根据模板文件修改拆组包报文<br>8、 增加XML可用性检测[由于多次出现低级错误，故添加]<br>9、 可选择执行的步骤</strong></p>
<h3 id="3-常见问题"><a href="#3-常见问题" class="headerlink" title="3.常见问题"></a>3.常见问题</h3><hr>
<p>Q：换到其他机器上时出现错误，原因是sqlplus连接出现乱码<br>A：可以使用 echo %NLS_LANG% 查看，并配置该环境变量<br>    C:\Users\XXXXX&gt;echo %NLS_LANG%<br>    AMERICAN_AMERICA.ZHS32GB18030</p>
<p>Q: 出现 BComp.exe 不是命令<br>A: 使用BCompare工具时需要添加环境变量</p>
<p>Q: 出现不能解压文件时<br>A: 需要将winrar加入环境变量</p>
<h3 id="4-代码展示"><a href="#4-代码展示" class="headerlink" title="4.代码展示"></a>4.代码展示</h3><hr>
<pre class="line-numbers language-vbscript" data-language="vbscript"><code class="language-vbscript">'Author:wangxingyang
'Date:20180413
'write at nanjing bank
Set http=CreateObject("MSXML2.XMLHTTP")
Set html = CreateObject("htmlfile")
Set wshshell = CreateObject("wscript.shell")
Set xdoc = CreateObject("MSXML2.DOMDocument")
Set logfso = CreateObject("Scripting.FileSystemObject")
Set tranfso = CreateObject("Scripting.FileSystemObject")
Set scriptfdo = CreateObject("Scripting.FileSystemObject")
Set attrDict = CreateObject("Scripting.Dictionary")
nowdate = Now()
nowdate = Year(nowdate) &amp; Right("0" &amp; Month(nowdate),2)&amp; Right("0" &amp; Day(nowdate),2)&amp; Right("0" &amp; Hour(nowdate),2)&amp; Right("0" &amp; Minute(nowdate),2)&amp;  Right("0" &amp; Second(nowdate),2)
logpath = "Log/Run-[" &amp; nowdate &amp; "].log"
tranpath = "Log/Tran-[" &amp; nowdate &amp; "].log"
scriptpath1 = "Log/Script.log"
Set logfile = logfso.CreateTextFile(logpath,True)
Set tranfile = tranfso.CreateTextFile(tranpath,True)
Set scriptfile = scriptfdo.CreateTextFile(scriptpath1,True)
Dim cookies
'---------服务治理控制台地址----------- [ 注意:需要斜杠 ]
mainurl = "http://159.1.XXX.XXX:PPPP/"
'---------跑库的连接地址---------------
linkurl33 = "XXXX/XXXX@159.1.XX.XXX:PPPP/RFRFR"
linkurl39 = "XXXX/XXXXX@159.1.XX.XXX:PPPP/DEDEE"
'---------服务治理库地址---------------
serviceurl = "SSS/SSS@159.1.XX.XXX:PPPP/SESES"
'---------生成临时文件----------------- [ 注意:需要斜杠 ]
commpath = "Tmp\"
'---------脚本存放目录----------------- [ 注意:需要斜杠 ]
scriptpath = "SQLScript\"
'---------元数据存放目录--------------- [ 注意:需要斜杠 ]
metadatapath = "Metadata\"
'---------svn metadata-----------------
'---------svn路径----------------------
svnpath = "Z:\WorkSpace\SmartESB\configs"
inconfpath = svnpath &amp; "\in_conf\"
outconfpath = svnpath &amp; "\out_conf\"
svndestin = inconfpath &amp; "metadata\"
svndestout = outconfpath &amp; "metadata\"
svnmetadata = svndestin &amp; "metadata.xml"
'---------服务定义文件-----------------
newpath = "C:\Users\WWW\Desktop\交易制作工具\Metadata\"
'存放数据字典中所有字段名称
alldata = ""
'存放需要增加的语句
allNewData = ""
'----------是否为存量交易标识-----------
'True  存量
'False 新增复用
isExistFlag = True  
totalNum = 0
'=======================
'版本更新日志打印
'=======================
Sub versionLog()
	logfile.WriteLine("------------------" &amp; Now() &amp; "---------------------" &amp; Chr(13) &amp; Chr(13) &amp; Chr(13))
	logfile.WriteLine("=============================================================" &amp; Chr(13))
	logfile.WriteLine("︻┳═一 " &amp; Now() &amp; "---&gt;Author : wangxingyang")
	logfile.WriteLine("︻┳═一 " &amp; Now() &amp; "---&gt;Date : 2018/04/13")
    logfile.WriteLine("︻┳═一 " &amp; Now() &amp; "---&gt;Contact : freefitter@163.com")
	logfile.WriteLine("=============================================================" &amp; Chr(13))
	logfile.WriteLine(Now() &amp; "---&gt;Version : v1.0 At 2018/04/13")
	logfile.WriteLine(Now() &amp; "---&gt;1、 检查交易是否为新增")
	logfile.WriteLine(Now() &amp; "---&gt;2、 导出并只执行脚本")
	logfile.WriteLine(Now() &amp; "---&gt;3、 导出相关配置文件")
	logfile.WriteLine(Now() &amp; "---&gt;4、 修改公共文件结构")
	logfile.WriteLine(Now() &amp; "---&gt;Version : v2.0 At 2018/04/16")
	logfile.WriteLine(Now() &amp; "---&gt;1、 增加解压文件功能")
	logfile.WriteLine(Now() &amp; "---&gt;2、 增加比较元数据功能")
	logfile.WriteLine(Now() &amp; "---&gt;3、 增加拷贝至配置库功能")
	logfile.WriteLine(Now() &amp; "---&gt;Version : v2.1 At 2018/05/04")
	logfile.WriteLine(Now() &amp; "---&gt;1、 修改弹出框BUG[弹出框有长度限制，导致处理交易报错]")
	logfile.WriteLine(Now() &amp; "---&gt;2、 修改文件系统名称小写问题")
	logfile.WriteLine(Now() &amp; "---&gt;Version : v2.2 At 2018/05/06")
	logfile.WriteLine(Now() &amp; "---&gt;1、 增加交易执行判断日志")
	logfile.WriteLine(Now() &amp; "---&gt;2、 增加读文件进行处理交易")
	logfile.WriteLine(Now() &amp; "---&gt;Version : v2.3 At 2018/05/10")
	logfile.WriteLine(Now() &amp; "---&gt;1、 修改元数据检查不出新增的BUG")
	logfile.WriteLine(Now() &amp; "---&gt;2、 修改重复添加元数据BUG")
	logfile.WriteLine(Now() &amp; "---&gt;Version : v2.4 At 2018/05/14")
	logfile.WriteLine(Now() &amp; "---&gt;1、 修改当元数据中包含元数据时不能添加的问题")
	logfile.WriteLine(Now() &amp; "---&gt;2、 新增修改元数据文件功能")
	logfile.WriteLine(Now() &amp; "---&gt;Version : v2.5 At 2018/05/15")
	logfile.WriteLine(Now() &amp; "---&gt;1、 增加文件比对功能，使用BCompare打开需要比较的工具")
	logfile.WriteLine(Now() &amp; "---&gt;2、 服务定义文件中，不存在的调用关系会新增")
	logfile.WriteLine(Now() &amp; "---&gt;Version : v2.6 At 2018/05/17")
	logfile.WriteLine(Now() &amp; "---&gt;1、 新增根据交易类型判断是否跑库")
	logfile.WriteLine(Now() &amp; "---&gt;2、 添加交易简称查询缓存，在一次运行中相同名称值检查一次")
	logfile.WriteLine(Now() &amp; "---&gt;3、 新增渠道会自动新增服务识别并跑新增脚本")
	logfile.WriteLine(Now() &amp; "---&gt;Version : v2.7 At 2018/05/13")
	logfile.WriteLine(Now() &amp; "---&gt;1、 新增根据模板替换拆组报文件功能")
	logfile.WriteLine(Now() &amp; "---&gt;2、 新增拼接更新适配器SQL功能")
	logfile.WriteLine(Now() &amp; "---&gt;Version : v2.8 At 2018/05/30")
	logfile.WriteLine(Now() &amp; "---&gt;1、 新增选择执行指定流程")
	logfile.WriteLine(Now() &amp; "---&gt;2、 优化路径，尽量少更改路径")
	logfile.WriteLine(Now() &amp; "---&gt;Version : v2.9 At 2018/06/12")
	logfile.WriteLine(Now() &amp; "---&gt;1、 修改元数据少添加的BUG")
	logfile.WriteLine(Now() &amp; "---&gt;Version : v3.0 At 2018/11/15")
	logfile.WriteLine(Now() &amp; "---&gt;1、 修改查询元数据比对堆栈溢出BUG")
	logfile.WriteLine(Now() &amp; "---&gt;2、 增加粘贴格式校验")
	logfile.WriteLine("------------------" &amp; Now() &amp; "---------------------" &amp; vbcrlf &amp; vbcrlf)
End Sub
'=======================
'登录服务治理系统
'=======================
Sub login(username,password)
	url = mainurl &amp; "login/"
	http.Open "POST",url,False
	http.setRequestHeader "Content-Type","application/x-www-form-urlencoded; charset=UTF-8"
	http.Send "username=" &amp; username &amp; "&amp;password=" &amp; password
	strHtml = http.responsetext
	cookies = http.getResponseHeader("Set-Cookie")
	logfile.WriteLine(Now() &amp; "---&gt;登录服务治理成功")
End Sub
'=======================
'检查交易是否是新增复用
'=======================
Sub checkTran(code,from,dest)
	logfile.WriteLine(Now() &amp; "---&gt;开始查看["&amp; code &amp;"]是否是全新交易")
	cmdstr = "sqlplus "&amp; linkurl33 &amp;" @" &amp; scriptpath &amp; "CheckTran.sql" &amp; " " &amp; code
	Set exeRs = wshshell.exec(cmdstr)
	retmsg = exeRs.StdOut.ReadAll()
	logfile.WriteLine(Now() &amp; "---&gt;查询结果如下:")
	logfile.WriteLine(Now() &amp; "---&gt;"&amp; retmsg)
	If InStr(retmsg,"no rows") = 0 Then
		logfile.WriteLine(Now() &amp; "---&gt;交易[" &amp; code &amp; "]为新增复用交易!!!")
		fromname = queryName(from)
		tranfile.WriteLine("交易[" &amp; code &amp; "] ------&gt; 新增复用，调用关系为: [ " &amp; from &amp; " = " &amp; fromname &amp;" ] -&gt; " &amp; code &amp; " -&gt; [ " &amp; dest &amp; " ]")
		isExistFlag = True
		totalNum = totalNum + 2
	Else
		logfile.WriteLine(Now() &amp; "---&gt;交易[" &amp; code &amp; "]为全新交易!!!")
		fromname = queryName(from)
		tranfile.WriteLine("交易[" &amp; code &amp; "] ------&gt; 全新，调用关系为: [ " &amp; from &amp; " = " &amp; fromname &amp;" ] -&gt; " &amp; code &amp; " -&gt; [ " &amp; dest &amp; " ]")
		isExistFlag = False
		totalNum = totalNum + 6
	End If
	logfile.WriteLine(Now() &amp; "---&gt;查看["&amp; code &amp;"]是否是全新交易结束")
End Sub
'=======================
'导出并执行脚本
'=======================
Sub exportAndRunSQLOne(tranId)
	'--------导出脚本--------------
	'判断是否是存量，如果是存量，不用跑数据库脚本
	If isExistFlag Then
		logfile.WriteLine(Now() &amp; "---&gt;交易[" &amp; tranId &amp; "]为新增复用交易，不跑脚本。直接退出！")
		Exit Sub
	End If
	logfile.WriteLine(Now() &amp; "---&gt;开始导出[" &amp; tranId &amp; "]SQL脚本")
	type1 = "service"
	operationIds = tranId
	url = mainurl &amp; "esbScriptExport/preview"
	http.Open "POST",url,False
	http.setRequestHeader "Content-Type","application/x-www-form-urlencoded; charset=UTF-8"
	http.setRequestHeader "Cookie",cookies
	http.Send "type=" &amp; type1 &amp; "&amp;operationIds=" &amp; operationIds
	strHtml = http.responsetext
	Set window = html.parentWindow
	window.execScript "var json = " &amp; strHtml, "JScript"
	Set ret = window.json
	sqltmp = ret.result
	'----------替换Adapter----------
	'---后期添加
	'------可采用先跑在更新的方式
	'------或者拿到后替换更新
	'----------写文件---------------
	Set fso = CreateObject("Scripting.FileSystemObject")
	Set file = fso.CreateTextFile( scriptpath &amp; operationIds &amp;".sql",True)
	file.WriteLine(sqltmp)
	file.WriteLine("commit;")
	file.WriteLine("exit;")
	file.close()
	logfile.WriteLine(Now() &amp; "---&gt;导出[" &amp; tranId &amp; "]SQL脚本完成")
	logfile.WriteLine(Now() &amp; "---&gt;导出内容如下：")
	logfile.WriteLine(Now() &amp; "---&gt; ")
	logfile.WriteLine(sqltmp &amp; "commit;")
	logfile.WriteLine(sqltmp &amp; "exit;")
	'-----------跑刚刚保存下来的SQL文件---------
	logfile.WriteLine(Now() &amp; "---&gt;在["&amp; linkurl33 &amp;"]开始执行导出脚本 " &amp; scriptpath &amp; operationIds &amp;".sql")
	Set exeRs = wshshell.exec("sqlplus " &amp; linkurl33 &amp;" @" &amp; scriptpath &amp; operationIds &amp;".sql")
	retmsg = exeRs.StdOut.ReadAll()
	If InStr(retmsg,"ORA") &gt; 0 Then
		logfile.WriteLine(Now() &amp; " Error-&gt;执行["&amp; tranId &amp;"]存在错误，请查看日志......")
	End If
	logfile.WriteLine(Now() &amp; "---&gt;拼接更新适配器语句开始..................."&amp; vbcrlf)
	'拼接服务场景码，用于写SQL更新
	sqlText = ""
	scriptfile.WriteLine("---" &amp; tranId)
	If InStr(retmsg,"BIND_PROTOCOLID_REF") &gt; 0 Then
		sqlText = "insert into BINDMAP(SERVICEID, STYPE, LOCATION, VERSION, PROTOCOLID, MAPTYPE) VALUES('" &amp; tranId &amp; "', 'SERVICE', 'local_out', '0', '" &amp; tranId &amp; "Adapter', 'request');" &amp; vbcrlf
	End If
	sqlText = sqlText &amp; "UPDATE SERVICESYSTEMMAP SET ADAPTER = '" &amp; tranId &amp; "Adapter' WHERE SERVICEID = '" &amp; tranId &amp; "';" &amp; vbcrlf
	sqlText = sqlText &amp; "UPDATE BINDMAP SET PROTOCOLID = '" &amp; tranId &amp; "Adapter' WHERE SERVICEID = '" &amp; tranId &amp; "';" &amp; vbcrlf
	scriptfile.WriteLine(sqlText)
	logfile.WriteLine(sqlText)
	logfile.WriteLine(Now() &amp; "---&gt;拼接更新适配器语句结束..................."&amp; vbcrlf)
	logfile.WriteLine(Now() &amp; "---&gt;执行结果：")
	logfile.WriteLine(Now() &amp; "-----------------------------------------------------------")
	logfile.WriteLine(retmsg)
	logfile.WriteLine(Now() &amp; "-----------------------------------------------------------")
	logfile.WriteLine(Now() &amp; "---&gt;导出脚本执行结束 " &amp; scriptpath &amp; operationIds &amp;".sql")
	'-----------跑刚刚保存下来的SQL文件---------
	logfile.WriteLine(Now() &amp; "---&gt;在["&amp; linkurl39 &amp;"]开始执行导出脚本 " &amp; scriptpath &amp; operationIds &amp;".sql")
	Set exeRs = wshshell.exec("sqlplus " &amp; linkurl39 &amp;" @" &amp; scriptpath &amp; operationIds &amp;".sql")
	retmsg = exeRs.StdOut.ReadAll()
	If InStr(retmsg,"ORA") &gt; 0 Then
		logfile.WriteLine(Now() &amp; " Error-&gt;执行["&amp; tranId &amp;"]存在错误，请查看日志......")
	End If
	logfile.WriteLine(Now() &amp; "---&gt;执行结果：")
	logfile.WriteLine(Now() &amp; "-----------------------------------------------------------")
	logfile.WriteLine(retmsg)
	logfile.WriteLine(Now() &amp; "-----------------------------------------------------------")
	logfile.WriteLine(Now() &amp; "---&gt;导出脚本执行结束 " &amp; scriptpath &amp; operationIds &amp;".sql")
	Set sfile = fso.getfile(scriptpath &amp; operationIds &amp;".sql")
	sfile.delete
	Set fso = Nothing
End Sub
'=======================
'执行SQL脚本
'=======================
Sub RunSqlScript(en_name,ch_name,sqlname)
	If sqlname = "AddChannel" Then
		cmdstr = "sqlplus "&amp; linkurl33 &amp;" @" &amp; scriptpath &amp; sqlname &amp; ".sql" &amp; " " &amp; en_name &amp; " " &amp; en_name &amp; "Connector " &amp; ch_name
	Else
		cmdstr = "sqlplus "&amp; linkurl33 &amp;" @" &amp; scriptpath &amp; sqlname &amp; ".sql" &amp; " " &amp; en_name &amp; " " &amp; en_name &amp; "Adapter " &amp; ch_name
	End If
	
	'logfile.WriteLine(Now() &amp; " RunSqlScript " &amp; cmdstr)

	Set exeRs = wshshell.exec(cmdstr)
	retmsg = exeRs.StdOut.ReadAll()
	If InStr(retmsg,"ORA") &gt; 0 Then
		logfile.WriteLine(Now() &amp; " Error-&gt;执行新增渠道["&amp; en_name &amp;"]存在错误，请查看日志......")
	End If
	logfile.WriteLine(Now() &amp; "---&gt;执行结果：")
	logfile.WriteLine(Now() &amp; "-----------------------------------------------------------")
	logfile.WriteLine(retmsg)
	logfile.WriteLine(Now() &amp; "-----------------------------------------------------------")
	
	If sqlname = "AddChannel" Then
		cmdstr = "sqlplus "&amp; linkurl39 &amp;" @" &amp; scriptpath &amp; sqlname &amp; ".sql" &amp; " " &amp; en_name &amp; " " &amp; en_name &amp; "Connector " &amp; ch_name
	Else
		cmdstr = "sqlplus "&amp; linkurl39 &amp;" @" &amp; scriptpath &amp; sqlname &amp; ".sql" &amp; " " &amp; en_name &amp; " " &amp; en_name &amp; "Adapter " &amp; ch_name
	End If

	Set exeRs = wshshell.exec(cmdstr)
	retmsg = exeRs.StdOut.ReadAll()
	If InStr(retmsg,"ORA") &gt; 0 Then
		logfile.WriteLine(Now() &amp; " Error-&gt;执行新增渠道["&amp; en_name &amp;"]存在错误，请查看日志......")
	End If
	logfile.WriteLine(Now() &amp; "---&gt;执行结果：")
	logfile.WriteLine(Now() &amp; "-----------------------------------------------------------")
	logfile.WriteLine(retmsg)
	logfile.WriteLine(Now() &amp; "-----------------------------------------------------------")
End Sub
'=======================
'导出脚本并执行，支持多个
'=======================
Sub exportAndRunSql(tranIds)
	If InStr(tranIds,",") = 0  Then
		exportAndRunSQLOne(tranIds)
	Else
		myarray = Split(tranIds,",")
		For i= 0 To UBound(myarray)
			exportAndRunSQLOne(myarray(i))
		next
	End If
End Sub
'=======================
'导出交易的配置文件
'=======================
Sub exportConf(from,dest,code)
	'连接数据库查询相关数据
	logfile.WriteLine(Now() &amp; "---&gt;准备导出配置文件")
	logfile.WriteLine(Now() &amp; "---&gt;查询导出配置文件所需参数")
	serviceId = Left(code,11)
	senceId = Right(code,2)
	cmdstr = "sqlplus "&amp; serviceurl &amp;" @" &amp; scriptpath &amp; "GetInfo.sql" &amp; " " &amp; serviceId &amp; " " &amp; senceId &amp; " " &amp; from &amp; " " &amp; dest
	Set exeRs = wshshell.exec(cmdstr)
	retmsg = exeRs.StdOut.ReadAll()
	logfile.WriteLine(Now() &amp; "---&gt;查询导出配置文件所需参数如下:")
	logfile.WriteLine(Now() &amp; "---&gt;"&amp; retmsg)

	If InStr(retmsg,"no rows") = 0 Then
		logfile.WriteLine(Now() &amp; "---&gt;开始导出["&amp; code &amp;"]配置文件")
		rets = Split(retmsg,"--------------------------------------------------------------------------------")
		tttt = Split(rets(4),"Disconnected")
		result = tttt(0)
		
		ret = Split(result,Chr(10))

		val1 = Replace(Trim(ret(1)),Chr(13),"")
		val2 = Replace(Trim(ret(3)),Chr(13),"")
		val3 = Replace(Trim(ret(2)),Chr(13),"")
		val4 = Replace(Trim(ret(4)),Chr(13),"")
		
		val1 = Replace(val1,Chr(10),"")
		val2 = Replace(val2,Chr(10),"")
		val3 = Replace(val3,Chr(10),"")
		val4 = Replace(val4,Chr(10),"")

		url = mainurl &amp; "export/exportBatch"
		http.Open "POST",url,False
		http.setRequestHeader "Content-Type","application/x-www-form-urlencoded; charset=UTF-8"
		http.setRequestHeader "Accept-Encoding","gzip,deflate,sdch"
		http.setRequestHeader "Cache-Control","max-age=0"
		http.setRequestHeader "Connection","keep-alive"
		http.setRequestHeader "Cookie",cookies
		http.Send "list[0].consumerServiceInvokeId=" &amp; val1 &amp; "&amp;list[0].providerServiceInvokeId=" &amp; val2 &amp; "&amp;list[0].conGeneratorId=" &amp; val3 &amp; "&amp;list[0].proGeneratorId=" &amp; val4
		Set file1 = CreateObject("ADODB.Stream")
		file1.Mode = 3
		file1.Type = 1
		file1.Open()
		file1.write(http.responseBody)
		file1.SaveToFile metadatapath &amp; code &amp; "-" &amp; "metadata.zip",2
		logfile.WriteLine(Now() &amp; "---&gt;导出["&amp; code &amp;"]配置文件完成")
		Set file1 = Nothing
	Else
		MsgBox "数据库未查询到配置信息,注意查看!!!"
		Exit Sub
	End If 
	'-------------解压文件---------------
	cmdstr = "cmd /c cd %cd%\" &amp; metadatapath  &amp; " &amp; winrar.exe x -ad -y "&amp; code &amp;"-metadata.zip"
	Set exeRs = wshshell.exec(cmdstr)
	'添加这句才能够等待执行完成结果，才能串行
	retmsg = exeRs.StdOut.ReadAll()
	'-------------比较元数据--------------
	'compareMeteData(code)
	'-------------拷贝文件至ESB路径下-----------
	'copyConfToSvn(code)
End Sub
'=======================
'查询对应系统的简称
'=======================
Function queryName(from)
	result = ""
	
	If attrDict.Exists(from) Then
		result = attrDict.Item(from)
		logfile.WriteLine(Now() &amp; "---&gt; 字典中已缓存，直接取缓存")
	Else
		logfile.WriteLine(Now() &amp; "---&gt; 字典中未缓存，需要查库")
		cmdstr = "sqlplus "&amp; serviceurl &amp;" @" &amp; scriptpath &amp; "GetName.sql" &amp; " " &amp; from
		Set exeRs = wshshell.exec(cmdstr)
		retmsg = exeRs.StdOut.ReadAll()
		If InStr(retmsg,"no rows") = 0 Then
			rets = Split(retmsg,"--------------------------------------------------------------------------------")
			tttt = Split(rets(1),"Disconnected")
			result = Replace(tttt(0),Chr(10),"")
			result = Replace(result,Chr(13),"")
		Else
			MsgBox "未查询到[" &amp; from &amp; "]对应的简称,注意查看!!!"
		End If
		attrDict.Add from,result
	End If
	queryName = result
End Function
'=======================
'查询对应系统的名称
'=======================
Function queryCHName(from)
	result = ""
	
	If attrDict.Exists(from) Then
		result = attrDict.Item(from)
		logfile.WriteLine(Now() &amp; "---&gt;字典中已缓存，直接取缓存")
	Else
		logfile.WriteLine(Now() &amp; "---&gt; 字典中未缓存，需要查库")
		cmdstr = "sqlplus "&amp; serviceurl &amp;" @" &amp; scriptpath &amp; "GetCHName.sql" &amp; " " &amp; from
		logfile.WriteLine(Now() &amp; "---&gt; " &amp; cmdstr)
		Set exeRs = wshshell.exec(cmdstr)
		retmsg = exeRs.StdOut.ReadAll()
		If InStr(retmsg,"no rows") = 0 Then
			rets = Split(retmsg,"--------------------------------------------------------------------------------")
			tttt = Split(rets(1),"Disconnected")
			result = Replace(tttt(0),Chr(10),"")
			result = Replace(result,Chr(13),"")
		Else
			MsgBox "未查询到[" &amp; from &amp; "]对应的简称,注意查看!!!"
		End If
		attrDict.Add from,result
	End If
	queryCHName = result
End Function
'=======================
'修改服务识别和系统识别
'=======================
Sub modifyXml(from,dest,code)
	logfile.WriteLine(Now() &amp; "---&gt;开始修改公共文件")

	pathService = commpath &amp; "serviceIdentify.xml"
	pathSystem = commpath &amp; "systemIdentify.xml"
	'连接数据库查询相关数据
	logfile.WriteLine(Now() &amp; "---&gt;开始查询[" &amp; from &amp; "]对应的简称")
	serviceId = Left(code,11)
	senceId = Right(code,2)

	result = queryName(from)

	If result = "" Then
		logfile.WriteLine(Now() &amp; "---&gt;没查到简称呢，直接退出了哟.....")
		Exit Sub
	End If 
	
	logfile.WriteLine(Now() &amp; "---&gt;[" &amp; from &amp; "]===&gt;[" &amp; result &amp; "]")
	logfile.WriteLine(Now() &amp; "---&gt;查询[" &amp; from &amp; "]对应的简称结束")
	
	logfile.WriteLine(Now() &amp; "---&gt;开始修改[" &amp; pathService &amp; "]文件")
	xdoc.Load(pathService)
	ReadServiceXml xdoc,result,from,dest,code
	xdoc.Save pathService
	logfile.WriteLine(Now() &amp; "---&gt;修改[" &amp; pathService &amp; "]文件结束")

	logfile.WriteLine(Now() &amp; "---&gt;开始修改[" &amp; pathSystem &amp; "]文件")
	xdoc.Load(pathSystem)
	ReadSystemXml  xdoc,result,dest,code
	xdoc.Save pathSystem
	logfile.WriteLine(Now() &amp; "---&gt;修改[" &amp; pathSystem &amp; "]文件结束")
	logfile.WriteLine(Now() &amp; "---&gt;修改公共文件结束")
End Sub
'=======================
'解析服务识别文件并添加新交易
'=======================
Sub ReadServiceXml(xdoc,from,ch_name,dest,code)
	'取出所有channel
	Set nodes = xdoc.documentElement.selectNodes(".//channel")
	For Each node In nodes
		Set Alist = node.Attributes
		Dim node2
		For i = 0 To Alist.Length - 1
			Dim attr
			Set attr = Alist.Item(i)
			If attr.NodeName = "id" And attr.NodeValue = from Then
				'取出所有 switch
				Set m = node.getElementsByTagName("switch")(0)
				Set childs = m.childNodes

				For Each node1 In node.selectNodes(".//switch")
					For j = 0 To node1.ChildNodes.Length -1
						Set tmp = node1.ChildNodes(j)
						Set node2 = node1
						'判断是否存在该交易
						If tmp.NodeType = 1 And tmp.NodeName = "case" And Trim(tmp.Text) = code Then
							'有的话直接退出
							logfile.WriteLine(Now() &amp; "---&gt;存在该调用关系"&amp; from &amp;" -- " &amp; code)
							Exit Sub
						End If 
					Next
				Next
				
				'在注释处插入该交易
				For n = 1 To childs.length-1
					If childs(n).NodeType = 8 Then
						If Trim(childs(n).NodeValue) = dest Then
							Set nodetmp = xdoc.createElement("case")
							Set nodeattr = xdoc.createAttribute("value")

							If from = "ECIF" Or from = "PPL" Or from = "BIBPS" Then
								nodeattr.text = code
								nodetmp.setAttributeNode nodeattr
								nodetmp.text = code
							Else
								nodeattr.text = "Req" &amp; code
								nodetmp.setAttributeNode nodeattr
								nodetmp.text = code
							End If

							m.insertBefore nodetmp,childs(n+1)

							logfile.WriteLine(Now() &amp; "---&gt; 在注释处插入该交易 "&amp; from &amp;" --&gt; " &amp; code &amp; " --&gt; " &amp; dest)
							Exit Sub
						End If 
					End If
				Next
				
				'插入注释和交易
				Set nodetmp = xdoc.createElement("case")
				Set nodeattr = xdoc.createAttribute("value")
				Set nodecomm = xdoc.createComment(dest)

				If from = "ECIF" Or from = "PPL" Or from = "BIBPS"Then
					nodeattr.text = code
					nodetmp.setAttributeNode nodeattr
					nodetmp.text = code
				Else
					nodeattr.text = "Req" &amp; code
					nodetmp.setAttributeNode nodeattr
					nodetmp.text = code
				End If

				m.appendChild(nodecomm)
				m.appendChild(nodetmp)
				Exit Sub
			End If 
		Next
	Next
	'若没有查到CHANNEL则为新增渠道，需要新增渠道
	logfile.WriteLine(Now() &amp; "---&gt;**********此渠道为新增渠道 "&amp; from &amp;" --&gt; " &amp; code &amp; " --&gt; " &amp; dest)
	Set channels = xdoc.documentElement
	logfile.WriteLine(Now() &amp; "---&gt; 新增 CHANNEL 节点")
	Set channel = xdoc.createElement("channel")
	Set channelid = xdoc.createAttribute("id")
	Set channeltype = xdoc.createAttribute("type")

	channelid.text = from
	channel.setAttributeNode channelid
	channeltype.text = "dynamic"
	channel.setAttributeNode channeltype
	
	logfile.WriteLine(Now() &amp; "---&gt; 新增 Switch 节点")
	Set switch = xdoc.createElement("switch")
	Set switchmode = xdoc.createAttribute("mode")
	Set switchexpression = xdoc.createAttribute("expression")

	switchmode.text = "soap"
	switch.setAttributeNode switchmode
	switchexpression.text = "/soapenv:Envelope/soapenv:Body"
	switch.setAttributeNode switchexpression
	
	logfile.WriteLine(Now() &amp; "---&gt; 新增 namespace 节点")
	Set namespace = xdoc.createElement("namespace")
	Set namespacevalue = xdoc.createAttribute("value")

	namespacevalue.text = "soapenv"
	namespace.setAttributeNode namespacevalue
	namespace.text = "http://schemas.xmlsoap.org/soap/envelope/"


	logfile.WriteLine(Now() &amp; "---&gt; 新增 交易 节点")
	Set nodetmp = xdoc.createElement("case")
	Set nodeattr = xdoc.createAttribute("value")
	Set nodecomm = xdoc.createComment(dest)

	If from = "ECIF" Or from = "PPL" Or from = "BIBPS" Then
		nodeattr.text = code
		nodetmp.setAttributeNode nodeattr
		nodetmp.text = code
	Else
		nodeattr.text = "Req" &amp; code
		nodetmp.setAttributeNode nodeattr
		nodetmp.text = code
	End If

	channels.appendChild(channel)
	channel.appendChild(switch)
	switch.appendChild(namespace)
	switch.appendChild(nodecomm)
	switch.appendChild(nodetmp)

	'执行 渠道插入脚本 
	RunSqlScript from,"","AddChannel"
End Sub
'=======================
'将执行结果写回到文件
'=======================
Sub AddLineAfterWord(frompath,topath,word,text)
	'非标准的XML文件，不能使用XML函数处理
	logfile.WriteLine(Now() &amp; "---&gt;开始添加元数据的差异")
	If Trim(text) = "" Then
		logfile.WriteLine(Now() &amp; "---&gt;无差异，无需操作")
		Exit Sub 
	End If 
	
	Set fso = CreateObject("Scripting.FileSystemObject")
	pathMetadata4Read = frompath
	pathMetadata4Write = topath
	Set fileMetadata4Read = fso.OpenTextFile(pathMetadata4Read,1,False)
	Set fileMetadata4Write = fso.OpenTextFile(pathMetadata4Write,2,True)
	Do While fileMetadata4Read.AtEndOfStream &lt;&gt; True
		line = fileMetadata4Read.ReadLine()
		If Trim(line) = "&lt;/"&amp; word &amp;"&gt;" Then 
			fileMetadata4Write.Write(text)
			fileMetadata4Write.WriteLine("&lt;/"&amp; word &amp;"&gt;")
		Else
			fileMetadata4Write.WriteLine line
		End If
		
	Loop
	fileMetadata4Read.close()
	fileMetadata4Write.close()
	Set fso = Nothing
	logfile.WriteLine(Now() &amp; "---&gt;内容如下")
	logfile.WriteLine(Now() &amp; "---&gt;")
	logfile.WriteLine(text)
	logfile.WriteLine(Now() &amp; "---&gt;完成添加元数据的差异")
End Sub
'=======================
'未使用
'=======================
Sub notuse()
	Set xdocu = CreateObject("MSXML2.DOMDocument")
	pathMetadata = commpath &amp; "metadata.xml"
	xdocu.Load(pathMetadata)
	
	Set nodetmp1 = xdocu.documentElement
	MsgBox (nodetmp1 Is Nothing)
	Set cNode = xdocu.createElement(nodename)
	
	Set nodeattr1 = xdocu.createAttribute("type")
	nodeattr1.text = nodetype
	cNode.setAttributeNode nodeattr1

	If nodetype = "string" Then 
		Set nodeattr2 = xdocu.createAttribute("length")
		nodeattr2.text = "255"
		cNode.setAttributeNode nodeattr2
	End If 

	nodetmp1.appendChild(cNode)
	xdocu.Save pathMetadata
End Sub 
'=======================
'解析系统识别并添加新增交易
'=======================
Sub ReadSystemXml(xdoc,from,dest,code)
	logfile.WriteLine(Now() &amp; from &amp;" --&gt; " &amp; code &amp; " --&gt; " &amp; dest)
	Set nodes = xdoc.documentElement.selectNodes(".//system")
	For Each node In nodes
		Set Alist = node.Attributes
		For i = 0 To Alist.Length - 1
			Dim attr
			Set attr = Alist.Item(i)
			If attr.NodeName = "id" And attr.NodeValue = dest Then
				For Each node1 In node.selectNodes(".//service")
					If node1.Text = code Then
						logfile.WriteLine(Now() &amp; "存在该交易.......")
						Exit Sub 
					End If
				Next
				'插入该交易
				Set cNode = xdoc.createElement("service")
				cNode.Text = code
				node.appendChild(cNode)
				Exit Sub
			End If
		Next
	Next
	'若是新增系统问题
	logfile.WriteLine(Now() &amp; "---&gt;**********系统[ " &amp; dest &amp; " ]为新增提供方 "&amp; from &amp;" --&gt; " &amp; code &amp; " --&gt; " &amp; dest)
	Set systems = xdoc.documentElement

	Set system = xdoc.createElement("system")
	Set systemid = xdoc.createAttribute("id")

	systemid.text = dest
	system.setAttributeNode systemid

	Set cNode = xdoc.createElement("service")
	cNode.Text = code
	
	systems.appendChild(system)
	system.appendChild(cNode)

	ch_name=queryCHName(dest)
	'MsgBox (dest &amp; "--&gt;" &amp; ch_name)

	'执行 系统插入脚本 
	RunSqlScript dest,ch_name,"AddSystem"
End Sub
'=======================
'加载元数据
'=======================
Sub loadMetaData()
	logfile.WriteLine(Now() &amp; "---&gt;开始加载最新Metadata.xml文件...")
	Set fso = CreateObject("Scripting.FileSystemObject")
	Set svnfile = fso.OpenTextFile(svnmetadata,1,False)
	Do While svnfile.AtEndOfStream &lt;&gt; True
		line = svnfile.ReadLine()
		If InStr(line,"type") &gt; 0 Then 
			tmpp = Split(line,"&lt;")(1)
			name = Trim(Split(tmpp," ")(0))
			alldata = alldata &amp; name &amp; ","
		End If
	Loop
	logfile.WriteLine(Now() &amp; "---&gt;加载最新Metadata.xml完成..." )
	Set fso = Nothing
End Sub 
'=======================
'比对元数据
'=======================
Sub compareMeteData(code)
	'文件方式比较
	logfile.WriteLine(Now() &amp; "---&gt;开始比较[" &amp; code &amp; "]与元数据的差异")
	Set fso = CreateObject("Scripting.FileSystemObject")
	temp = newpath &amp; code &amp; "-metadata\in_config\servicedefine"

	Set localfile = fso.GetFolder(temp)
	Set outpath = fso.CreateTextFile(newpath &amp; "\out" &amp; code &amp; ".txt",True)	
	
	Set oFiles = localfile.Files
	For Each oFile In oFiles
		tmppath = oFile.Path
		Set file1 = fso.OpenTextFile(tmppath,1,False)
		Do While file1.AtEndOfStream &lt;&gt; True
			line = file1.ReadLine()
			If InStr(line,"metadataid") &gt; 0 Then
				tmpp = Split(line,"metadataid")(1)
				tmpp1 = Trim(Split(tmpp,Chr(34))(1))
				If InStr(line,"type") &gt; 0 Then
					tmpp2 = Split(line,"type")(1)
					tmpp3 = Split(tmpp2,Chr(34))(1)
					isExists = 1
					checkExists alldata,tmpp1,isExists
					'MsgBox len(alldata)   416771
					If (tmpp3 = "array" Or tmpp3 = "sopform") And isExists = 0 Then
						outpath.WriteLine("&lt;" &amp; tmpp1 &amp; " type=" &amp; Chr(34) &amp; "array"&amp; Chr(34) &amp;"/&gt;")
						logfile.WriteLine(Now() &amp; "---&gt;开始添加[" &amp; tmpp1 &amp; "]元数据,类型为[array]")
						'添加已经添加的字段，以免重复新增
						allNewData = allNewData &amp; "	&lt;" &amp; tmpp1 &amp; " type=" &amp; Chr(34) &amp; "array"&amp; Chr(34) &amp;"/&gt;"&amp; vbcrlf
						alldata = alldata &amp; tmpp1 &amp; ","
					End If 
				Else
					isExists = 1
					checkExists alldata,tmpp1,isExists
					If isExists = 0 Then
						outpath.WriteLine("&lt;" &amp; tmpp1 &amp; " type=" &amp; Chr(34) &amp; "string"&amp; Chr(34) &amp;" length="&amp; Chr(34) &amp; "255" &amp; Chr(34) &amp;"/&gt;")
						logfile.WriteLine(Now() &amp; "---&gt;开始添加[" &amp; tmpp1 &amp; "]元数据,类型为[string]")
						allNewData = allNewData &amp; "	&lt;" &amp; tmpp1 &amp; " type=" &amp; Chr(34) &amp; "string"&amp; Chr(34) &amp;" length="&amp; Chr(34) &amp; "255" &amp; Chr(34) &amp;"/&gt;" &amp; vbcrlf
						alldata = alldata &amp; tmpp1 &amp; ","
					End If
				End If

			End If
		Loop
	Next
	Set fso = Nothing
	logfile.WriteLine(Now() &amp; "---&gt;完成比较[" &amp; code &amp; "]与元数据的差异")
End Sub
'=======================
'修改拆组包文件
'=======================
Sub modifyPackFile(from,dest,code)
	'此处需要根据各个现场修改
	'修改拆组包文件逻辑需要再次判断
	'isExistFlag = False
	Set fso = CreateObject("Scripting.FileSystemObject")
	logfile.WriteLine(Now() &amp; "---&gt;开始修改拆组包文件[" &amp; code &amp; "]")
	If Not fso.fileExists("Template\" &amp; dest &amp; ".xml") Or isExistFlag Then
		logfile.WriteLine(Now() &amp; "---&gt;没有模版文件[" &amp; code &amp; "]")
		Exit Sub 
	End If 
	servicepath = newpath &amp; code &amp; "-metadata\out_config\" &amp; dest &amp; "\service_"&amp; code &amp;"_system_" &amp; dest &amp; ".xml"
	servicenewpath = newpath &amp; "service\service_"&amp; code &amp;"_system_" &amp; dest &amp; ".xml"

	channelepath = newpath &amp; code &amp; "-metadata\out_config\" &amp; dest &amp; "\channel_" &amp; dest &amp; "_service_" &amp; code &amp; ".xml"
	channelenewpath = newpath &amp; "service\channel_" &amp; dest &amp; "_service_" &amp; code &amp; ".xml"

	logfile.WriteLine(Now() &amp; "---&gt;开始修改组包文件[" &amp; code &amp; "]")
	xdoc.load(servicepath)
	tmp1 = Replace(xdoc.xml,"s:","")
	tmp2 = Replace(tmp1,"d:","")
	tmp = Replace(tmp2,":","")
	tp = Replace(tmp,"xmlns=" &amp; Chr(34) &amp; "http//esb.dcitsbiz.com/services/"&amp; Left(code,11) &amp; Chr(34),"")
	xdoc.loadXML(tp)
	Set nodes = xdoc.documentElement.selectNodes(".//ReqAppBody")(0)
	addstr = ""
	For Each node In nodes.ChildNodes
		addstr = addstr  &amp; "		" &amp; node.Xml &amp; vbcrlf
	Next
	RepalceFile "Template\" &amp; dest &amp; ".xml",servicenewpath,addstr

	logfile.WriteLine(Now() &amp; "---&gt;开始修改拆包文件[" &amp; code &amp; "]")
	xdoc.load(channelepath)
	tmp1 = Replace(xdoc.xml,"s:","")
	tmp2 = Replace(tmp1,"d:","")
	tmp = Replace(tmp2,":","")
	tp = Replace(tmp,"xmlns=" &amp; Chr(34) &amp; "http//esb.dcitsbiz.com/services/"&amp; Left(code,11) &amp; Chr(34),"")
	xdoc.loadXML(tp)
	Set nodes = xdoc.documentElement.selectNodes(".//RspAppBody")(0)
	addstr = ""
	For Each node In nodes.ChildNodes
		addstr = addstr  &amp; "		" &amp; node.Xml &amp; vbcrlf
	Next
	RepalceFile "Template\" &amp; dest &amp; ".xml",channelenewpath,addstr

	logfile.WriteLine(Now() &amp; "---&gt;完成修改拆组包文件[" &amp; code &amp; "]")
End Sub
'=======================
'替换文件
'=======================
Sub RepalceFile(fromfile,tofile,text)
	Set file1 = CreateObject("ADODB.Stream")
	file1.Mode = 3
	file1.Type = 1
	file1.Open()
	file1.LoadFromFile fromfile
	file1.Position = 0
	file1.Type = 2
	file1.Charset = "utf-8"
	tmpfile = file1.ReadText
	file1.Position = 0
	file1.SetEos
	file1.Type = 2
	file1.Charset = "utf-8"
	file1.WriteText Replace(tmpfile,"XXXXXXXXXXXXXXXXXXXX",text)
	file1.SaveToFile tofile,2
	Set file1 = Nothing
End Sub
'=======================
'检查元数据是否存在
'=======================
Function checkExists(strBase,strNeed,isExists)
	startPos = InStr(strBase,strNeed)
	If startPos = 0 Then
		isExists = 0
		Exit Function
	Else
		'此处若需要的元数据在字段结尾会出现问题
		isExists = startPos
	End If
	endPos = InStr(startPos,strBase,",")
	newstart = InstrRev(Mid(strBase,1,startPos),",")
	newval =  Mid(strBase,newstart+1,endPos-newstart-1)
	newStrBase = Mid(strBase,endPos)
	'只有长度相等的元数据才继续检查,减少递归的次数
	While Len(newval) &lt;&gt; Len(strNeed)
		startPos = InStr(newStrBase,strNeed)
		'若新的基础字符串中不含需要的元数据，直接退出
		If startPos = 0 Then
			isExists = 0
			Exit Function
		End If
		endPos = InStr(startPos,newStrBase,",")
		newstart = InstrRev(Mid(newStrBase,1,startPos),",")
		newval =  Mid(newStrBase,newstart+1,endPos-newstart-1)
		newStrBase = Mid(newStrBase,endPos)
	Wend
	If strNeed &lt;&gt; newval Then
		checkExists newStrBase,strNeed,isExists
	Else
		isExists = newstart+1
		Exit Function
	End If 
End Function
'=======================
'拷贝元数据至SVN
'=======================
Sub copyConfToSvn(code,from)
	logfile.WriteLine(Now() &amp; "---&gt;开始拷贝文件至SVN[" &amp; code &amp; "]")
	intemp = newpath &amp; code &amp; "-metadata\in_config\"
	outtemp = newpath &amp; code &amp; "-metadata\out_config\"
	Set fso = CreateObject("Scripting.FileSystemObject")
	
	Set oFolder = fso.GetFolder(intemp)
	Set oSubFolder = oFolder.SubFolders

	Set outFolder = fso.GetFolder(outtemp)
	Set outSubFolder = outFolder.SubFolders
	
	'isExistFlag = False

	For Each otmp In oSubFolder
		If isExistFlag Then
			If Trim(LCase(otmp.Name)) &lt;&gt; "servicedefine" Then 
				logfile.WriteLine(Now() &amp; "---&gt;开始拷贝文件夹--&gt;[" &amp; intemp &amp; otmp.Name &amp; "]")
				fso.CopyFolder intemp &amp; otmp.Name &amp; "*",svndestin
			End If 
		Else
			logfile.WriteLine(Now() &amp; "---&gt;开始拷贝文件夹--&gt;[" &amp; intemp &amp; otmp.Name &amp; "]")
			fso.CopyFolder intemp &amp; otmp.Name &amp; "*",svndestin
		End If 
	Next 

	For Each itmp In outSubFolder
		If Not isExistFlag Then
			logfile.WriteLine(Now() &amp; "---&gt;开始拷贝文件夹--&gt;[" &amp; outtemp &amp; "]")
			fso.CopyFolder outtemp &amp; "*",svndestout
		End If 
	Next

	Set fso = Nothing
End Sub
'=======================
'加载文件中的交易
'=======================
Function LoadTrans()
	versionLog()
	
	Set fso = CreateObject("Scripting.FileSystemObject")
	Set traninfo = fso.OpenTextFile("traninfo.txt",1,False)
	tmpstr = ""

	Do While traninfo.AtEndOfStream &lt;&gt; True
		line = traninfo.ReadLine()
		If Trim(line) &lt;&gt; "" Then
			num = Len(line)- Len(Replace(line," ",""))
			If num &lt;&gt; 2 Then
				Exit Function
			End If 
			tmpstr = tmpstr &amp; Replace(line," ",",") &amp; ";"
		End If
	Loop

	'拷贝文件至tmp下
	serviceIdentify = "serviceIdentify.xml"
	systemIdentify = "systemIdentify.xml"
	metadata = "metadata.xml"

	fso.copyfile inconfpath &amp; serviceIdentify,commpath &amp; serviceIdentify
	fso.copyfile inconfpath &amp; systemIdentify,commpath &amp; systemIdentify
	fso.copyfile svnmetadata,commpath &amp; metadata

	LoadTrans = tmpstr

	Set fso = Nothing
End Function
'=======================
' 更新SVN
'=======================
Function updateSVN()
	logfile.WriteLine(Now() &amp; "---&gt;开始更新 SVN .......")
	cmdstr = "svn update "&amp; svnpath
	Set exeRs = wshshell.exec(cmdstr)
	retmsg = exeRs.StdOut.ReadAll()
	logfile.WriteLine(Now() &amp; "---&gt;更新 SVN 日志如下:")
	logfile.WriteLine( retmsg)
	logfile.WriteLine(Now() &amp; "---&gt;更新 SVN 完成.......")
End Function
'=======================
'主方法
'=======================
Sub Main()
	'tranText = InputBox("请输入需要开发的交易，形如[3001300000333,双屏系统,NCBS;]","提醒","3001300000333,双屏系统,NCBS;")
	'==========更新SVN至最新============
	updateSVN
	'==========加载文本文件中的交易============
	tranText = LoadTrans()
	If tranText = "" Then
		MsgBox "请检查[ traninfo.txt ]是否已[ 经粘贴交易 ] 或 [ 有多余空格 ]!",0,"星阳提醒"
		Exit Sub
	Else		
		Ans = MsgBox("[开始处理]:   共[ " &amp;  UBound(Split(tranText,";")) &amp; " ]个交易" &amp; Chr(13) &amp; tranText,VbOKCancel,"星阳提醒")
		If Ans = vbCancel Then
			MsgBox "你取消了操作！",0,"星阳提醒"
			Exit Sub 
		End If
		'==========登录服务治理平台============
		login "admin","753951"
		'===========加载最新元数据=============
		loadMetaData()
		'分割每条记录
		trans = Split(tranText,";")
		'根据填写的执行方法进行
		tranFlow = InputBox("请输入需要执行的动作:" &amp; Chr(13) &amp; "    1.  检查交易是否为新增       [ 1 ]" &amp; Chr(13) &amp; "    2.  导出并只执行脚本         [ 2 ]" &amp; Chr(13) &amp; "    3.  导出相关配置文件         [ 3 ]" &amp; Chr(13) &amp; "    4.  修改公共文件结构         [ 4 ]" &amp; Chr(13) &amp; "    5.  比较元数据差异           [ 5 ]" &amp; Chr(13) &amp; "    6.  拷贝文件至SVN路径        [ 6 ]" &amp; Chr(13) &amp; "    7.  修改组包文件             [ 7 ]" &amp; Chr(13) &amp; "    8.  修改Metadata.xml文件     [ 8 ]" &amp; Chr(13) &amp; "    9.  运行文件比对             [ 9 ]" &amp; Chr(13) &amp; "    10. 流程全部执行             [ A ]","提醒","A")
		tranFlow = UCase(tranFlow)
		If tranFlow = "" Then 
			MsgBox "你取消了操作！"
			Exit Sub
		End If

		For i= 0 To UBound(trans)
			'分割交易明细信息  --&gt;  3001300000333,双屏系统,NCBS;
			If trans(i) &lt;&gt; "" Then
				traninfo =  Split(trans(i),",")
				code = Trim(traninfo(0))
				from = Trim(traninfo(1))
				dest = Trim(traninfo(2))
				'=========检查交易是否为新增===========
				If InStr(tranFlow,"1") &gt; 0 Or InStr(tranFlow,"A") &gt; 0 Then
					checkTran code,from,dest
				End If 
				'==========导出并只执行脚本============
				If InStr(tranFlow,"2") &gt; 0 Or InStr(tranFlow,"A") &gt; 0 Then
					exportAndRunSQLOne(code)
				End If 
				'==========导出相关配置文件============
				If InStr(tranFlow,"3") &gt; 0 Or InStr(tranFlow,"A") &gt; 0 Then
					exportConf from,dest,code
				End If
				'==========修改公共文件结构============
				If InStr(tranFlow,"4") &gt; 0 Or InStr(tranFlow,"A") &gt; 0 Then
					modifyXml from,dest,code
				End If 
				'===========比较元数据差异=============
				If InStr(tranFlow,"5") &gt; 0 Or InStr(tranFlow,"A") &gt; 0 Then
					compareMeteData code
				End If 
				'========拷贝文件至SVN路径=============
				If InStr(tranFlow,"6") &gt; 0 Or InStr(tranFlow,"A") &gt; 0 Then
					copyConfToSvn code,from
				End If 
				'===========修改组包文件===============
				If InStr(tranFlow,"7") &gt; 0 Or InStr(tranFlow,"A") &gt; 0 Then
					modifyPackFile from,dest,code
				End If 
			End If 
		Next
		'修改Metadata.xml文件
		If InStr(tranFlow,"8") &gt; 0 Or InStr(tranFlow,"A") &gt; 0 Then
			AddLineAfterWord svnmetadata,commpath &amp; "metadata.xml","metadata",allNewData
		End If 
		'运行文件比对
		'CompareAns = MsgBox("需要进行文件比对吗？",VbOKCancel,"星阳提醒")
		'If CompareAns &lt;&gt; vbCancel Then
		If InStr(tranFlow,"9") &gt; 0 Or InStr(tranFlow,"A") &gt; 0 Then
			'比对 serviceIdentify.xml
			wshshell.run("BComp.exe " &amp; commpath &amp; "serviceIdentify.xml "&amp; inconfpath &amp;"serviceIdentify.xml")
			'比对 systemIdentify.xml
			wshshell.run("BComp.exe " &amp; commpath &amp; "systemIdentify.xml "&amp; inconfpath &amp;"systemIdentify.xml")
			'比对 metadata.xml
			wshshell.run("BComp.exe " &amp; commpath &amp; "metadata.xml "&amp; inconfpath &amp;"metadata\metadata.xml")
			'in out 比对
			wshshell.run("BComp.exe " &amp; outconfpath &amp; "systemIdentify.xml "&amp; inconfpath &amp;"systemIdentify.xml")
			wshshell.run("BComp.exe " &amp; outconfpath &amp; "metadata\metadata.xml "&amp; inconfpath &amp;"metadata\metadata.xml")
		'End If
		End If
	End If
	logfile.WriteLine(Now() &amp; "---&gt;配置文件共[" &amp; totalNum &amp; "]个")
	MsgBox "o(∩_∩)o 啦啦啦-&gt;[ 全部处理完成 ] o(∩_∩)o",0,"星阳提醒"
End Sub
Main()
Set http = Nothing
Set html = Nothing
Set wshshell = Nothing
Set xdoc = Nothing
Set logfso = Nothing
Set tranfso = Nothing<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-总结"><a href="#5-总结" class="headerlink" title="5.总结"></a>5.总结</h3><hr>
<p>代码不复杂，就是要把各个东西串联起来比较麻烦。在这做个备份，以防以后会用到中间的东西。</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">彤爸比</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.wangxingyang.com/maketranstool.html">https://www.wangxingyang.com/maketranstool.html</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">彤爸比</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E5%B7%A5%E5%85%B7/">
                                    <span class="chip bg-color">工具</span>
                                </a>
                            
                                <a href="/tags/vbs/">
                                    <span class="chip bg-color">vbs</span>
                                </a>
                            
                                <a href="/tags/%E6%95%88%E7%8E%87/">
                                    <span class="chip bg-color">效率</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,wechat,weibo" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    
        <style>
    .twikoo-card {
        margin: 1.5rem auto;
    }

    .twikoo-card .card-content {
        padding: 20px;
    }

    #tcomments textarea {
        box-sizing: border-box;
        background: url("/") 100% 100% no-repeat;
    }

    #tcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #tcomments blockquote p {
        text-indent: 0.2rem;
    }

    #tcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #tcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #tcomments ol li {
        list-style-type: decimal;
    }

    #tcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #tcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #tcomments ul li {
        list-style-type: disc;
    }

    #tcomments ul ul li {
        list-style-type: circle;
    }

    #tcomments table,
    th,
    td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #tcomments table,
    th,
    td {
        border: 0;
    }

    table tr:nth-child(2n),
    thead {
        background-color: #fafafa;
    }

    #tcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #tcomments table td {
        min-width: 80px;
    }

    #tcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #tcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #tcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #tcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #tcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #tcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #tcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #tcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #tcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #tcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #tcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #tcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #tcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #tcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #tcomments [type="checkbox"]:not(:checked),
    [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #tcomments b,
    strong {
        font-weight: bold;
    }

    #tcomments dfn {
        font-style: italic;
    }

    #tcomments small {
        font-size: 85%;
    }

    #tcomments cite {
        font-style: normal;
    }

    #tcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #tcomments table,
    th,
    td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n),
    thead {
        background-color: #fafafa;
    }

    #tcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #tcomments table td {
        min-width: 80px;
    }

    #tcomments [type="checkbox"]:not(:checked),
    [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card twikoo-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div class="card-content" style="display: grid">
        <div id="tcomments"></div>
    </div>
</div>

<script src="/libs/twikoo/twikoo.all.min.js"></script>
<script>
    twikoo.init({
        envId: 'freefitter-8gx8lldy312991c5',
        el: '#tcomments',
        region: '',
        path: ''
    }).then(function () {
        var tkInputs = document.querySelector('#twikoo').getElementsByTagName('input');
        for (var tkInputsIndex = 0; tkInputsIndex < tkInputs.length; tkInputsIndex++) {
            if (tkInputs[tkInputsIndex]) {
                tkInputs[tkInputsIndex].classList.add('browser-default');
            }
        }
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/life-20210407.html">
                    <div class="card-image">
                        
                        <img src="/img/20210407/cover0.webp" class="responsive-img" alt="生活记事">
                        
                        <span class="card-title">生活记事</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-04-07
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%94%9F%E6%B4%BB/" class="post-category">
                                    生活
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%AE%9D%E5%AE%9D/">
                        <span class="chip bg-color">宝宝</span>
                    </a>
                    
                    <a href="/tags/%E7%85%A7%E7%89%87/">
                        <span class="chip bg-color">照片</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/jsdf.html">
                    <div class="card-image">
                        
                        <img src="/img/20210406/lighting.jpg" class="responsive-img" alt="HA江苏电费插件">
                        
                        <span class="card-title">HA江苏电费插件</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-04-06
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85/" class="post-category">
                                    智能家居
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/homeassistant/">
                        <span class="chip bg-color">homeassistant</span>
                    </a>
                    
                    <a href="/tags/python/">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                    <a href="/tags/%E6%8F%92%E4%BB%B6/">
                        <span class="chip bg-color">插件</span>
                    </a>
                    
                    <a href="/tags/%E7%94%B5%E8%B4%B9/">
                        <span class="chip bg-color">电费</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 宁静致远<br />'
            + '文章作者: 彤爸比<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">彤爸比</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">31.9k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2021";
                    var startMonth = "4";
                    var startDate = "2";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/iothinker" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:freefitter@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1013792042" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1013792042" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?431b832769cb793e8c72a6a28cd875a0";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
